"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[63738],{22385:(e,t,o)=>{o.d(t,{$W:()=>c,Br:()=>n,G6:()=>p,YU:()=>d,Zm:()=>u,dG:()=>s,eZ:()=>a,nK:()=>f,zw:()=>l});var r=o(74719),i=o(35920);class n extends r.default{constructor(e,t){super("shared-template-query-failed",`Request to fetch templates failed. templateIds: ${e.join(",")}`,{error:t}),this.templateIds=e}}class s extends r.default{constructor(e,t){const o=new Set(t.map((e=>e.templateId))),r=(0,i.iv)(new Set(e),o);super("shared-template-some-templates-missing",`The service failed to return templates for the following 'templateId's: ${Array.from(r).join(",")}`)}}class a extends r.default{constructor(){super("shared-template-required-properties-not-set","Values must be specified for the `definition`, `featureService`, `layer`, and `view` properties of a `SharedTemplate` in order to load it")}}class l extends r.default{constructor(){super("shared-template-definition-required-properties-not-set","The `featureService`, `makeSharedTemplateFromJSON`, and `view` properties must all be set in order to load a template definition")}}class d extends r.default{constructor(e){super("shared-template-unsupported-builder",`This template uses an unsupported builder type, '${e}'`),this.builderType=e}}class u extends r.default{constructor(e,t){super("shared-template-layer-resolver-error",`The 'layerResolver' function failed to provide any layers for template with 'templateId: ${e}'`,{error:t}),this.templateId=e}}class p extends r.default{constructor(e,t){super("shared-template-utility-network-resolver-error",`The 'utilityNetworkResolver' function threw an error while attempting to find a utility network for template with 'templateId: ${e}'`,{error:t}),this.templateId=e}}class c extends r.default{constructor(e){super("shared-template-layer-unavailable",`None of the layers with which the template is associated are present in the view. Layer IDs: [${e.join(",")}]`),this.layerIds=e}}class f extends r.default{constructor(e){super("shared-template-relationship-not-found",`Relationship class '${e}' could not be found.`),this.relationshipCatalogId=e}}r.default;r.default},28417:(e,t,o)=>{o.d(t,{Kw:()=>n,RE:()=>a,Sl:()=>s});var r=o(13248),i=o(23060);async function n(e,t,o){const n=r.id?.findCredential(e.restUrl);if(!n)return null;if("loaded"===e.loadStatus&&""===t&&e.user?.sourceJSON&&!1===o)return e.user.sourceJSON;const s={responseType:"json",query:{f:"json"}};if(o&&(s.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,i.default)(e.restUrl+"/community/self",s);if(t.data){const e=t.data;if(e?.username)return e}return null}const a=await(0,i.default)(e.restUrl+"/community/users/"+t,s);if(a.data){const e=a.data;return e.error?null:e}return null}async function s(e,t,o){const r=await n(e,t,!0);return r?.privileges?.includes(o)??!1}async function a(e,t,o){const r=await n(e,t,!0);return r?.userLicenseTypeExtensions?.includes(o)??!1}},42985:(e,t,o)=>{o.d(t,{Cq:()=>h,Dt:()=>v,JC:()=>m,Rj:()=>c,Sf:()=>f,b:()=>_,gZ:()=>p,w2:()=>y,xZ:()=>g});var r=o(50925),i=o(45622),n=o(49959),s=o(35920),a=o(91046),l=o(78076),d=o(48485);const u=()=>r.A.getLogger("esri.editing.templateUtils");function p(e){return null!=e&&"prototype"in e}function c(e){return y(e)&&!("definition"in e)}function f(e){return y(e)&&"definition"in e}function y(e){return null!=e&&"templateId"in e}function h(e){return f(e)&&"feature"===e?.type&&(null==e.definition||(0,a.sC)(e.definition))}function v(e){return f(e)&&"group"===e?.type&&(null==e.definition||(0,a.Xc)(e.definition))}function m(e){return f(e)&&"preset"===e?.type&&(null==e.definition||(0,a.vf)(e.definition))}function g(e){return f(e)&&null!=e?.definition}const w=e=>null==e||"object"!=typeof e?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap((e=>e.templates)):[]];async function _(e,t,o){if(null==t)return e.map((e=>({layer:e,templates:w(e)})));const r=await async function(e,t){const o=await(0,d.Z)(t).load(),r=new Set;for(const i of e)(0,s.kb)(r,S(o,i));return await Promise.all(Array.from(r).map((e=>e.featureService.load()))),r}(e,t);(0,n.throwIfAborted)(o);const a=new Map,p=Array.from(r).map((e=>async function(e){let{serviceInfo:t,out:o,signal:r}=e;const{featureService:s,layersAndTables:a}=t,d=await async function(e){let{featureService:t,layers:o,signal:r}=e;if(!t.capabilities?.editing.supportsSharedTemplates)return new Map;const n=new Map(o.map((e=>[e.layerId,e]))),s=await t.querySharedTemplates({query:{layers:Array.from(n.keys())},requestOptions:{signal:r}}),a=new Map;for(const l of s)for(const e of l.layerIds)n.has(e)&&(0,i.tE)(a,n.get(e),(()=>[])).push(l);return a}({featureService:s,layers:a.toArray(),signal:r});(0,n.throwIfAborted)(r);for(const[i,n]of d.entries())if(0!==n.length)if((0,l.F2)(i)){const e=T(n),t=[],r=e.get(1/0)??t;for(const n of i.sublayers){const i=e.get(n.subtypeCode)??t;o.set(n,[...i,...r])}}else o.set(i,n)}({serviceInfo:e,out:a,signal:o,view:t}))),c=await Promise.allSettled(p);for(const i of c.filter((e=>"rejected"===e.status)))u().warn("Failed to fetch shared templates for service. Will use standard templates if available.",i.reason);return e.map((e=>({layer:e,templates:a.get(e)??w(e)})))}function S(e,t){return(0,l.Sv)(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):(0,l.yZ)(t)?e.tablesAndLayersLookup.get(t):null}function T(e){const t=new Map;for(const o of e)(0,i.tE)(t,o.subtypeCode??1/0,(()=>[])).push(o);return t}},48485:(e,t,o)=>{o.d(t,{Z:()=>M});var r=o(93800),i=o(13248),n=o(89129),s=o(74719),a=o(58448),l=o(81933),d=o(50925),u=o(45622),p=o(20620),c=o(49959),f=o(90450),y=o(79953),h=o(43103),v=o(48602),m=(o(21265),o(14746),o(75269)),g=o(15492),w=o(65073),_=o(78076),S=o(78139),T=o(28417),I=o(46707),A=o(6946);let b=class extends A.default{constructor(e){super(e),this.layers=new n.default,this.lockType="none",this.tables=new n.default,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new n.default([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){return this.featureService.sourceJSON?.currentVersion??0}};(0,r._)([(0,v.MZ)({constructOnly:!0})],b.prototype,"canCreateVersion",void 0),(0,r._)([(0,v.MZ)({constructOnly:!0})],b.prototype,"canEditVersionedData",void 0),(0,r._)([(0,v.MZ)({constructOnly:!0})],b.prototype,"featureService",void 0),(0,r._)([(0,v.MZ)({constructOnly:!0})],b.prototype,"layers",void 0),(0,r._)([(0,v.MZ)()],b.prototype,"layersAndTables",null),(0,r._)([(0,v.MZ)()],b.prototype,"lockType",void 0),(0,r._)([(0,v.MZ)({constructOnly:!0})],b.prototype,"tables",void 0),(0,r._)([(0,v.MZ)()],b.prototype,"versionInfo",void 0),(0,r._)([(0,v.MZ)({constructOnly:!0})],b.prototype,"versionService",void 0),(0,r._)([(0,v.MZ)()],b.prototype,"hasAdvancedEditingUserTypeExtension",void 0),(0,r._)([(0,v.MZ)()],b.prototype,"loggedInServiceUser",void 0),(0,r._)([(0,v.MZ)()],b.prototype,"featureServiceVersion",null),b=(0,r._)([(0,m.$)("esri.undoredo.support.ServiceVersionInfo")],b);var k=o(46538);const C=new Map;function M(e){return(0,u.tE)(C,e,(()=>{const t=new N({view:e});return e.addHandles({remove(){C.delete(e),t.destroy()}}),t.load().catch((e=>{d.A.getLogger("esri.views.Services").error("Failed to load service metadata",e)})),t}))}let N=class extends(l.A.LoadableMixin(p.A.EsriPromiseMixin(a.A.EventedAccessor))){constructor(e){super(e),this._updatingHandles=new g.U,this.items=new n.default,this.tablesAndLayersLookup=new f.A,this.additionalLayers=new n.default,this._debouncedCheckAndUpdateServiceInfos=(0,c.debounce)((async()=>{const e=[];for(const t of this.items){if(0===t.layersAndTables.length)continue;const o=t.layersAndTables.getItemAt(0);o?.gdbVersion!==t.versionInfo?.versionIdentifier.name&&e.push(t)}0!==e.length&&(await(0,y.whenOnce)((()=>!this.updating)),await this._updateVersionInfos(e))})),this._debouncedLayersChanged=(0,c.debounce)((async()=>{const e=this._detectNewLayersAndTables();0!==e.length&&(await(0,y.whenOnce)((()=>!this._updatingHandles.updating)),await this._updatingHandles.addPromise((async()=>{const t=new Set;for(const r of e)if("feature"===r.type||"subtype-group"===r.type){if(!r.url)continue;const e=(0,w.qg)(r.url).url.path,i=this._findServiceInfo(e);if(i)this.tablesAndLayersLookup.set(r,i),r.isTable?i.tables.push(r):i.layers.push(r);else if(!t.has(e))try{await this._addServiceInfo(e,r)}catch(o){d.A.getLogger(this).error(`Failed to load feature service: ${e}`,o)}finally{t.add(e)}}})()))})),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(e){return(0,c.throwIfAborted)(e),this.addHandles([(0,y.watch)((()=>this._allLayersAndTables),(()=>{this._debouncedLayersChanged().catch((e=>{d.A.getLogger(this).warn("Failed to update service info",e)}))})),(0,y.watch)((()=>this.items.map((e=>e.layersAndTables.map((e=>e.gdbVersion??"")).join(",")))),(()=>{this.checkAndUpdateServiceInfos().catch((e=>{d.A.getLogger(this).warn("Failed to update service info",e)}))}))]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return"loading"===this.loadStatus||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(e,t,o){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(e,t,o)})())}createVersion(e){return this._updatingHandles.addPromise((async()=>{const t=e.featureServerUrl,o=this._findServiceInfo(t);if(!o?.versionService)throw new s.default("services:no-version-management-service");const r=o.hasAdvancedEditingUserTypeExtension,i=o.loggedInServiceUser.toUpperCase(),n=function(e){return!e||0===e.trim().length}(e.ownerName)?i:e.ownerName?.trim().toUpperCase();if(n!==i){if(o.featureServiceVersion<=11.1)throw new s.default("services:versioning-api-error");if(!r)throw new s.default("services:no-advanced-editing-user-type-extension")}if("SDE"===n?.toUpperCase()&&"DEFAULT"===e.versionName.toUpperCase())throw new s.default("services:no-valid-version-name");{const t=await o.versionService.getVersionInfos();if(t?.find((t=>t.versionIdentifier.name.toUpperCase()===(n+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(i+"."+e.versionName).toUpperCase())))throw new s.default("services:no-valid-version-name")}const a=await o.versionService.createVersion({versionName:e.versionName,access:n!==i?"public":e.access,description:e.description});if(n!==i){const{guid:t,name:r}=a.versionIdentifier;await o.versionService.alterVersion({guid:t,name:r},{ownerName:n,access:e.access})}e.switchToVersion&&await this._changeVersionInternal(t,a.versionIdentifier.name,a.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:a.versionIdentifier,versionManagementService:o.versionService})})())}deleteVersion(e,t,o){return this._updatingHandles.addPromise((async()=>{const r=this._findServiceInfo(e);if(!r?.versionService)throw new s.default("services:no-version-management-service");if(r.featureServiceVersion<=11.1)throw new s.default("services:versioning-api-error");if(!r.hasAdvancedEditingUserTypeExtension)throw new s.default("services:no-advanced-editing-user-type-extension");const i={name:t,guid:o};await r.versionService.deleteVersion(i)&&(await this._updateVersionInfo(r),this.emit("version-deleted",{versionIdentifier:i,versionManagementService:r.versionService}))})())}startEditing(e){return this._updatingHandles.addPromise((async()=>{const t=this._findServiceInfo(e);if(!t?.versionService)throw new s.default("services:no-version-management-service");if(!t.hasAdvancedEditingUserTypeExtension)throw new s.default("services:no-advanced-editing-user-type-extension");const o=t.versionInfo?.versionIdentifier??{name:t.versionService.defaultVersionIdentifier.name,guid:t.versionService.defaultVersionIdentifier.guid};let r=!0;("none"!==t.versionService.getLockType(o)||(r=await t.versionService.startReading(o),r))&&(r=await t.versionService.startEditing(o),t.updateLockType())})())}finishEditing(e,t){return this._updatingHandles.addPromise((async()=>{const o=this._findServiceInfo(e);if(!o?.versionService)throw new s.default("services:no-version-management-service");if(!o.hasAdvancedEditingUserTypeExtension)throw new s.default("services:no-advanced-editing-user-type-extension");const r=o.versionInfo?.versionIdentifier??{name:o.versionService.defaultVersionIdentifier.name,guid:o.versionService.defaultVersionIdentifier.guid},i=o.versionService.getLockType(r);if("none"!==i)return"read"===i?(await o.versionService.stopReading(r),void o.updateLockType()):"edit"===i?(await o.versionService.stopEditing(r,t),await o.versionService.stopReading(r),void o.updateLockType()):void 0})())}async _changeVersionInternal(e,t,o){const r=this._findServiceInfo(e);if(!r?.versionService)throw new s.default("services:no-version-management-service");const i=r.versionInfo?.versionIdentifier??{name:r.versionService.defaultVersionIdentifier.name,guid:r.versionService.defaultVersionIdentifier.guid},n={name:t,guid:o};await r.versionService.changeVersion(this.view?.map,i,n)&&await this._updateVersionInfo(r)}async _updateVersionInfo(e){const t=e.versionService;if(!t)return;if(0===e.layersAndTables.length)return;const o=e.layersAndTables.getItemAt(0)?.gdbVersion,r=o?await t.getVersionIdentifierFromName(o):t.defaultVersionIdentifier;e.versionInfo=await t.getVersionInfoExtended(r)}_findServiceInfo(e){return this.items.find((t=>t.featureService.url===e))??null}_removeFeatureService(e){this.items.remove(e)}async _findPortal(e){const t=i.id?.findServerInfo(e??"");if(!t?.owningSystemUrl)return null;const o=`${t.owningSystemUrl}/sharing/rest`,r=S.default.getDefault();return r?.loaded&&(0,h.normalize)(r.restUrl)===(0,h.normalize)(o)?r:new S.default({authMode:"immediate",url:t.owningSystemUrl}).load()}_updateVersionInfos(e){return this._updatingHandles.addPromise((async()=>{for(const t of e)await this._updateVersionInfo(t).catch((e=>{d.A.getLogger(this).error("Failed to update version details",e)}))})())}async _addServiceInfo(e,t){const o=new I.default({url:e});await o.load();const r=await this._findPortal(e),i=r?.user?.username;let s=!1;i&&(s=await(0,T.RE)(r,i,"advediting"));let a=null;o.versionManagementServiceUrl&&(a=new k.default({url:o.versionManagementServiceUrl}),await a.load());const l=t.isTable?[]:[t],d=t.isTable?[t]:[],u=new b({loggedInServiceUser:i??"",hasAdvancedEditingUserTypeExtension:s,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:o,versionService:a,layers:new n.default(l),tables:new n.default(d)});return a&&await this._updateVersionInfo(u),this.items.push(u),this.tablesAndLayersLookup.set(t,u),t.isTable?u.tables.push(t):u.layers.push(t),u}get _allLayersAndTables(){return[...this.view.map.allLayers,...this.view.map.allTables,...this.additionalLayers]}_detectNewLayersAndTables(){const e=new Set(this._allLayersAndTables),t=[];for(const o of e)"feature"!==o.type&&"subtype-group"!==o.type||this._processed.has(o)||t.push(o);for(const o of this._processed)if(!e.has(o)&&((0,_.F2)(o)||(0,_.yZ)(o))){const e=this.tablesAndLayersLookup.get(o);if(!e)continue;this.tablesAndLayersLookup.delete(o),o.isTable?e.tables.remove(o):e.layers.remove(o),0===e.layersAndTables.length&&this._removeFeatureService(e)}return this._processed=e,t}};(0,r._)([(0,v.MZ)({constructOnly:!0})],N.prototype,"view",void 0),(0,r._)([(0,v.MZ)()],N.prototype,"items",void 0),(0,r._)([(0,v.MZ)()],N.prototype,"tablesAndLayersLookup",void 0),(0,r._)([(0,v.MZ)()],N.prototype,"additionalLayers",void 0),(0,r._)([(0,v.MZ)()],N.prototype,"updating",null),(0,r._)([(0,v.MZ)()],N.prototype,"_allLayersAndTables",null),N=(0,r._)([(0,m.$)("esri.undoredo.support.Services")],N)},63738:(e,t,o)=>{o.r(t),o.d(t,{default:()=>P});var r=o(93800),i=o(7951),n=o(74719),s=o(81933),a=o(20620),l=o(48602),d=(o(50925),o(14746),o(14800)),u=o(75269),p=o(48844),c=o(22385),f=(o(21265),o(19455)),y=o(78012),h=o(78067);let v=class extends(s.A.LoadableMixin(a.A.EsriPromiseMixin(f.A))){constructor(){super(...arguments),this.excludedTools=[],this.featureService=null,this.makeSharedTemplateFromJSON=null,this.view=null}readExcludedTools(e){return e.map((e=>h.T.fromJSON(e)))}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const t=this.allParts,{featureService:o,makeSharedTemplateFromJSON:r,view:i}=this;if(null==o||null==r||null==i)throw new c.zw;for(const n of t)n.assertIsSupportedPart();const s=(0,y.B)(i,{makeSharedTemplateFromJSON:r}),a=t.filter((e=>null==e.template)),l=await s.getTemplates({templateIds:a.map((e=>e.templateId)),featureService:o,signal:e?.signal}),d=new Map(l.map((e=>[e.templateId,e])));for(const u of a){const e=d.get(u.templateId);if(null==e)throw new n.default(`Failed to retrieve template for template ID ${u.templateId}`);u.template=e}await Promise.all(t.map((t=>t.template?.load(e))))}};(0,r._)([(0,l.MZ)({readOnly:!0})],v.prototype,"type",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"excludedTools",void 0),(0,r._)([(0,d.w)("excludedTools")],v.prototype,"readExcludedTools",null),(0,r._)([(0,l.MZ)()],v.prototype,"featureService",void 0),(0,r._)([(0,l.MZ)()],v.prototype,"makeSharedTemplateFromJSON",void 0),(0,r._)([(0,l.MZ)()],v.prototype,"view",void 0),v=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.TemplateDefinitionBase")],v);let m=class extends f.A{constructor(e){super(e),this.template=null}};(0,r._)([(0,l.MZ)()],m.prototype,"template",void 0),(0,r._)([(0,l.MZ)()],m.prototype,"templateGlobalId",void 0),(0,r._)([(0,l.MZ)()],m.prototype,"templateId",void 0),(0,r._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!1}})],m.prototype,"type",void 0),m=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.TemplatePartBase")],m);let g=class extends m{constructor(e){super(e),this.relationshipCatalogId="",this.relationshipMetadata=null,this.template=null,this.type="relationship"}assertIsSupportedPart(){}};(0,r._)([(0,l.MZ)({json:{name:"relationshipClassID"}})],g.prototype,"relationshipCatalogId",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"relationshipMetadata",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"template",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"type",void 0),g=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.FeatureTemplateRelationshipPart")],g);let w=class extends v{constructor(e){super(e),this.type="feature",this.defaultValues=null,this.relationships=[]}get allParts(){return this.relationships}initializeRelationshipMetadata(e){for(const t of this.relationships){const{relationshipCatalogId:o}=t,r=t.template?.layer,i=e.relationships?.find((e=>e.catalogId===o)),n=r?.relationships?.find((e=>e.catalogId===o));if(!i||!r||!n)throw new c.nK(o);t.relationshipMetadata={destinationField:n.keyField,destinationLayerId:r.layerId,sourceField:i.keyField,sourceLayerId:e.layerId}}}};(0,r._)([(0,l.MZ)({readOnly:!0})],w.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],w.prototype,"allParts",null),(0,r._)([(0,l.MZ)()],w.prototype,"defaultValues",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0,type:[g]})],w.prototype,"relationships",void 0),w=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.FeatureTemplateDefinition")],w);var _=o(47332);const S=new(o(42761).J)({esri_editing_transformation_bufferLineToPolygon:"buffer-line-to-polygon",esri_editing_transformation_bufferPointToPolygon:"buffer-point-to-polygon",esri_editing_transformation_bufferPolygonToPolygon:"buffer-polygon-to-polygon",esri_editing_transformation_connectionPoint:"connection-point",esri_editing_transformation_equallySpaced:"equally-spaced",esri_editing_transformation_offsetLine:"offset-line",esri_editing_transformation_offsetPrimaryLine:"offset-primary-line",esri_editing_transformation_pointAtAllVerticesOfLine:"point-at-all-vertices-of-line",esri_editing_transformation_pointAtBeginningOfLine:"point-at-beginning-of-line",esri_editing_transformation_pointAtBeginningOfRadial:"point-at-beginning-of-radial",esri_editing_transformation_pointAtEndOfLine:"point-at-end-of-line",esri_editing_transformation_pointAtInteriorVertices:"point-at-interior-vertices",esri_editing_transformation_pointAtIntersectionVerticesOfLine:"point-at-intersection-vertices-of-line",esri_editing_transformation_pointAtNotBeginningOfLine:"point-at-not-beginning-of-line",esri_editing_transformation_pointAtNotEndOfLine:"point-at-not-end-of-line",esri_editing_transformation_pointAtPolygonCentroid:"point-at-polygon-centroid",esri_editing_transformation_pointAtPolygonNotStart:"point-at-polygon-not-start",esri_editing_transformation_pointAtPolygonStart:"point-at-polygon-start",esri_editing_transformation_pointIdentity:"point-identity",esri_editing_transformation_pointPrimaryIdentity:"point-primary-identity",esri_editing_transformation_polygonBoundary:"polygon-boundary",esri_editing_transformation_polygonBoundaryTwoPoint:"polygon-boundary-two-point",esri_editing_transformation_polygonIdentity:"polygon-identity",esri_editing_transformation_polygonPrimaryIdentity:"polygon-primary-identity",esri_editing_transformation_polygonVertices:"polygon-vertices",esri_editing_transformation_radialLines:"radial-lines",esri_editing_transformation_twoPointLines:"two-point-lines"}),T={"buffer-line-to-polygon":"polyline","buffer-point-to-polygon":"point","buffer-polygon-to-polygon":"polygon","connection-point":"polyline","equally-spaced":"polyline","offset-line":"polyline","offset-primary-line":"polyline","point-at-all-vertices-of-line":"polyline","point-at-beginning-of-line":"polyline","point-at-beginning-of-radial":"polyline","point-at-end-of-line":"polyline","point-at-interior-vertices":"polyline","point-at-intersection-vertices-of-line":"polyline","point-at-not-beginning-of-line":"polyline","point-at-not-end-of-line":"polyline","point-at-polygon-centroid":"polygon","point-at-polygon-not-start":"polygon","point-at-polygon-start":"polygon","point-identity":"point","point-primary-identity":"point","polygon-boundary":"polygon","polygon-boundary-two-point":"polygon","polygon-identity":"polygon","polygon-primary-identity":"polygon","polygon-vertices":"polygon","radial-lines":"polyline","two-point-lines":"polyline"};let I=class extends m{constructor(e){super(e),this.builderConfig={},this.type="group"}assertIsSupportedPart(){const{builderType:e}=this;if(!S.apiValues.includes(e))throw new c.YU(e)}};(0,r._)([(0,_.e)(S,{ignoreUnknown:!1,name:"type"})],I.prototype,"builderType",void 0),(0,r._)([(0,l.MZ)({json:{name:"options"}})],I.prototype,"builderConfig",void 0),(0,r._)([(0,l.MZ)()],I.prototype,"type",void 0),I=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.GroupTemplatePart")],I);let A=class extends v{constructor(e){super(e),this.type="group",this.createUtilityNetworkAssociations=!1,this.parts=[],this.utilityNetwork=null,this.utilityNetworkAssociationsTable=null}get allParts(){return[this.basePart,...this.parts]}get inputGeometryType(){return T[this.basePart.builderType]}};(0,r._)([(0,l.MZ)({readOnly:!0})],A.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],A.prototype,"allParts",null),(0,r._)([(0,l.MZ)({constructOnly:!0,type:I})],A.prototype,"basePart",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],A.prototype,"createUtilityNetworkAssociations",void 0),(0,r._)([(0,l.MZ)()],A.prototype,"inputGeometryType",null),(0,r._)([(0,l.MZ)({constructOnly:!0,type:[I]})],A.prototype,"parts",void 0),(0,r._)([(0,l.MZ)()],A.prototype,"utilityNetwork",void 0),(0,r._)([(0,l.MZ)()],A.prototype,"utilityNetworkAssociationsTable",void 0),A=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.GroupTemplateDefinition")],A);var b=o(78629),k=o(54723);let C=class extends m{constructor(e){super(e),this.geometry=null,this.type="preset"}assertIsSupportedPart(){}};(0,r._)([(0,l.MZ)({types:k.yR,json:{read:b.fromJSON}})],C.prototype,"geometry",void 0),(0,r._)([(0,l.MZ)()],C.prototype,"type",void 0),C=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.parts.PresetTemplatePart")],C);var M=o(75400),N=o(93321);let L=class extends v{constructor(e){super(e),this.type="preset",this.parts=[]}get allParts(){return this.parts}};(0,r._)([(0,l.MZ)({readOnly:!0})],L.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],L.prototype,"allParts",null),(0,r._)([(0,l.MZ)({constructOnly:!0,type:M.default})],L.prototype,"origin",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0,type:[C],json:{name:"features"}})],L.prototype,"parts",void 0),(0,r._)([(0,l.MZ)({type:N.default})],L.prototype,"spatialReference",void 0),L=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.templateDefinitions.PresetTemplateDefinition")],L);var Z=o(91046);const G=e=>R.fromJSON(e);let R=class extends(s.A.LoadableMixin(a.A.EsriPromiseMixin(p.default))){constructor(e){super(e),this.definition=null,this.layer=null,this.type="feature",this.view=null}readDefinition(e,t){switch(t.type){case"feature":return w.fromJSON(e);case"group":return A.fromJSON(e);case"preset":return L.fromJSON(e);default:throw(0,i.Xb)(t.type),new n.default("shared-template:no-definition","No value for 'definition' provided to 'SharedTemplate' constructor")}}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const{definition:t,featureService:o,layer:r,view:i}=this;if(!(t&&o&&r&&i))throw new c.eZ;t.featureService=o,t.makeSharedTemplateFromJSON=G,t.view=i,await(this.definition?.load(e)),(0,Z.sC)(t)&&t.initializeRelationshipMetadata(r)}};(0,r._)([(0,l.MZ)()],R.prototype,"definition",void 0),(0,r._)([(0,d.w)("definition")],R.prototype,"readDefinition",null),(0,r._)([(0,l.MZ)()],R.prototype,"layer",void 0),(0,r._)([(0,l.MZ)()],R.prototype,"type",void 0),(0,r._)([(0,l.MZ)()],R.prototype,"view",void 0),R=(0,r._)([(0,u.$)("esri.editing.sharedTemplates.SharedTemplate")],R);const P=R},78012:(e,t,o)=>{o.d(t,{B:()=>b});var r=o(93800),i=o(23060),n=o(6946),s=o(42198),a=o(45622),l=o(17741),d=o(49959),u=o(79953),p=o(48602),c=(o(21265),o(50925),o(14746),o(75269)),f=o(42985),y=o(22385),h=o(78076),v=o(74719),m=o(81933),g=o(20620),w=o(90450),_=o(79580);let S=class extends(m.A.LoadableMixin(g.A)){constructor(e){super(e),this.layerIdToSourceIdLookup=new w.A,this.sourceIdToLayerIdLookup=new w.A,this.sourceIdToNetworkInfo=new w.A,this._rulesBySourceId=new Map,this._terminalConfigurationsBySourceId=new Map}async load(e){return this.addResolvingPromise(this._load(e)),this}agatFromRule(e,t){let o;switch(t){case"to":o={networkSource:e.toNetworkSource??null,assetGroup:e.toAssetGroup??null,assetType:e.toAssetType??null};break;case"from":o={networkSource:e.fromNetworkSource??null,assetGroup:e.fromAssetGroup??null,assetType:e.fromAssetType??null};break;case"via":o={networkSource:e.viaNetworkSource??null,assetGroup:e.viaAssetGroup??null,assetType:e.viaAssetType??null}}return null===o.networkSource?null:o}agatToFullDefinition(e){let{assetGroup:t,assetType:o,networkSourceId:r}=e;if(null===r||null===t||null===o)return null;const i={networkSource:null,assetGroup:null,assetType:null},n=this.sourceIdToNetworkInfo.get(r);if(!n)return null;i.networkSource=n;const s=n.assetGroupLookup.get(t);return s?(i.assetGroup=s,i.assetType=s.assetTypeLookup.get(o)??null,null===i.assetType?null:i):null}findAgat(e,t){const o=(0,h.Sv)(t)?t.parent:t;if(!o)throw new v.default("Unable to find asset group/asset type for layer. The given layer is a `SubtypeSublayer` with no parent.");if(this.utilityNetwork.featureServiceUrl!==o.url)return null;const r=this.getNetworkSourceIdForLayer(o);if(null===r)return null;const i=o.fieldsIndex.get("assettype")?.name??"";if(""===i)return null;const n=o.fieldsIndex.get("assetgroup")?.name??"";if(""===n)return null;const s=e.attributes[i],a=e.attributes[n];return null==s||null==a?null:{assetGroup:a,assetType:s,networkSourceId:r}}findAgatFullDefinition(e,t){const o=this.findAgat(e,t);return o?this.agatToFullDefinition(o):null}findRules(e){let{networkSourceId:t,assetGroup:o,assetType:r}=e;const i=[];if(null===t||null===o)return i;const n=this._rulesBySourceId.get(t)?.get(o);if(!n)return i;for(const s of n.generalRules)i.push(s);if(null!=r){const e=n.typeSpecificRules.get(r);if(e)for(const t of e)i.push(t)}return i}getNetworkSourceIdForLayer(e){const t=(0,h.Sv)(e)?e.parent:e;return t&&this.utilityNetwork.featureServiceUrl===t.url?this.layerIdToSourceIdLookup.get(t.layerId)??null:null}ruleMatchesAgat(e,t,o){switch(o){case"to":return!(e.toNetworkSource?.sourceId!==t.networkSourceId||e.toAssetGroup&&e.toAssetGroup.assetGroupCode!==t.assetGroup||e.toAssetType&&e.toAssetType.assetTypeCode!==t.assetType);case"from":return!(e.fromNetworkSource?.sourceId!==t.networkSourceId||e.fromAssetGroup&&e.fromAssetGroup.assetGroupCode!==t.assetGroup||e.fromAssetType&&e.fromAssetType.assetTypeCode!==t.assetType);case"via":return!(e.viaNetworkSource?.sourceId!==t.networkSourceId||e.viaAssetGroup&&e.viaAssetGroup.assetGroupCode!==t.assetGroup||e.viaAssetType&&e.viaAssetType.assetTypeCode!==t.assetType)}}ruleMatchesFullDefinitionAgat(e,t,o){switch(o){case"to":return!(e.toNetworkSource?.sourceId!==t.networkSource?.sourceId||e.toAssetGroup&&e.toAssetGroup.assetGroupCode!==t.assetGroup?.assetGroupCode||e.toAssetType&&e.toAssetType.assetTypeCode!==t.assetType?.assetTypeCode);case"from":return!(e.fromNetworkSource?.sourceId!==t.networkSource?.sourceId||e.fromAssetGroup&&e.fromAssetGroup.assetGroupCode!==t.assetGroup?.assetGroupCode||e.fromAssetType&&e.fromAssetType.assetTypeCode!==t.assetType?.assetTypeCode);case"via":return!(e.viaNetworkSource?.sourceId!==t.networkSource?.sourceId||e.viaAssetGroup&&e.viaAssetGroup.assetGroupCode!==t.assetGroup?.assetGroupCode||e.viaAssetType&&e.viaAssetType.assetTypeCode!==t.assetType?.assetTypeCode)}}terminalConfiguration(e,t,o){const r=this._terminalConfigurationsBySourceId.get(e);if(!r)return null;const i=r.get(t);if(!i)return null;return i.get(o)||null}async _load(e){await this.utilityNetwork.load(),(0,d.throwIfAborted)(e);const{dataElement:t}=this.utilityNetwork;if(!t)throw new v.default("no-data-element","No data element found on utility network");for(const r of t.domainNetworks)for(const e of[...r.edgeSources??[],...r.junctionSources??[]]){this.layerIdToSourceIdLookup.set(e.layerId,e.sourceId),this.sourceIdToLayerIdLookup.set(e.sourceId,e.layerId);const t=(e.assetGroups??[]).map((e=>{const t=new w.A;for(const o of e.assetTypes??[])t.set(o.assetTypeCode,o);return{...e,assetTypeLookup:t}})),o=new w.A;for(const e of t)o.set(e.assetGroupCode,e);const r={...e,assetGroupLookup:o,assetGroups:t};this.sourceIdToNetworkInfo.set(r.sourceId,r)}const o=await this.utilityNetwork.getRulesTable();(0,d.throwIfAborted)(e);for(const r of o?.rules??[])switch(r.ruleType){case _.D2.RTAttachment:case _.D2.RTContainment:this._registerRule(r.fromNetworkSource.sourceId,r.fromAssetGroup.assetGroupCode,r.fromAssetType.assetTypeCode,r),this._registerRule(r.toNetworkSource.sourceId,r.toAssetGroup.assetGroupCode,r.toAssetType.assetTypeCode,r);break;case _.D2.RTEdgeJunctionEdgeConnectivity:this._registerRule(r.fromNetworkSource.sourceId,r.fromAssetGroup.assetGroupCode,r.fromAssetType.assetTypeCode,r),this._registerRule(r.toNetworkSource.sourceId,r.toAssetGroup.assetGroupCode,r.toAssetType.assetTypeCode,r),this._registerRule(r.viaNetworkSource.sourceId,r.viaAssetGroup.assetGroupCode,r.viaAssetType.assetTypeCode,r);break;case _.D2.RTJunctionEdgeConnectivity:case _.D2.RTJunctionJunctionConnectivity:this._registerRule(r.fromNetworkSource.sourceId,r.fromAssetGroup.assetGroupCode,r.fromAssetType.assetTypeCode,r),this._registerRule(r.toNetworkSource.sourceId,r.toAssetGroup.assetGroupCode,r.toAssetType.assetTypeCode,r)}this._makeTerminalConfigurationLookups(t)}_makeTerminalConfigurationLookups(e){const t={};for(const o of e.terminalConfigurations??[])t[o.terminalConfigurationId]=o;for(const o of e.domainNetworks??[])for(const e of o.junctionSources)if("esriUNFCUTJunctionObject"===e.utilityNetworkFeatureClassUsageType||"esriUNFCUTDevice"===e.utilityNetworkFeatureClassUsageType)for(const o of e.assetGroups??[])for(const r of o.assetTypes??[])if(null!=r.terminalConfigurationId&&r.terminalConfigurationId>=0){const i=t[r.terminalConfigurationId];if(i){const t=(0,a.tE)(this._terminalConfigurationsBySourceId,e.sourceId,(()=>new Map));(0,a.tE)(t,o.assetGroupCode,(()=>new Map)).set(r.assetTypeCode,i)}}}_registerRule(e,t,o,r){const i=(0,a.tE)(this._rulesBySourceId,e,(()=>new Map)),n=(0,a.tE)(i,t,(()=>({generalRules:[],typeSpecificRules:new Map})));-1===o?n.generalRules.push(r):(0,a.tE)(n.typeSpecificRules,o,(()=>[])).push(r)}};(0,r._)([(0,p.MZ)()],S.prototype,"layerIdToSourceIdLookup",void 0),(0,r._)([(0,p.MZ)()],S.prototype,"sourceIdToLayerIdLookup",void 0),(0,r._)([(0,p.MZ)()],S.prototype,"sourceIdToNetworkInfo",void 0),(0,r._)([(0,p.MZ)()],S.prototype,"utilityNetwork",void 0),S=(0,r._)([(0,c.$)("esri.networks.support.UtilityNetworkLookupHelper")],S);var T=o(48485),I=o(46047);const A=new Map;function b(e,t){return(0,a.tE)(A,e,(()=>{const o=new k({layerResolver:t?.layerResolver??N(e),makeSharedTemplateFromJSON:t.makeSharedTemplateFromJSON,utilityNetworkResolver:t?.utilityNetworkResolver??L(e),view:e});return e.addHandles((0,s.hA)((()=>{A.delete(e),o.destroy()}))),o}))}let k=class extends n.default{constructor(e){super(e),this._abortController=null,this._cache=new Map,this._pending=new Map,this._utilityNetworkLookupHelperCache=new Map,this.layerResolver=null,this.makeSharedTemplateFromJSON=null,this.utilityNetworkResolver=null,this.view=null}initialize(){this.addHandles((0,u.watch)((()=>this.view.spatialReference),(()=>this._reset())))}destroy(){this._abortController=(0,l.DC)(this._abortController)}async getTemplates(e){let{templateIds:t,featureService:o,signal:r}=e;const i=this._cache,n=this._pending,s=[],a=new Set,l=new Set,u=Symbol();for(const y of new Set(t)){const e=M(o,y);if(i.has(e))s.push(i.get(e));else if(n.has(e)){const t=n.get(e);t.subscribers.add(u),l.add(t)}else a.add(y),n.set(e,{resolver:(0,d.createResolver)(),subscribers:new Set})}if(s.length===t.length)return s;const p=()=>{for(const{subscribers:e}of l)e.delete(u)},c=(0,d.onAbort)(r,p);try{const e=await this._loadTemplates({templateIds:Array.from(a),featureService:o,signal:r}),t=await Promise.all(Array.from(l).map((e=>{let{resolver:t}=e;return t.promise})));s.push(...e),s.push(...t)}catch(f){p();for(const e of a){const t=M(o,e),r=n.get(t);r?.resolver.reject(f),n.delete(t)}throw f}finally{c?.remove()}return(0,d.throwIfAborted)(r),s}async _loadTemplates(e){let{templateIds:t,featureService:o,signal:r}=e;if(0===t.length)return[];const n=this._cache,s=this._pending,a=this._abortController=new AbortController,l=(0,d.onAbort)(r,(()=>{for(const e of t)if(C(s.get(M(o,e))))return;a.abort()})),u=await async function(e){let{templateIds:t,featureService:o,spatialReference:r,signal:n}=e;const s=`${o.url}/sharedTemplates/templates`,a=await(0,i.default)(s,{query:{f:"json",outSR:r,ids:t.join(",")},signal:n}).catch((e=>{throw(0,d.throwIfAbortError)(e),new y.Br(t,e)}));return a.data?.templates??[]}({featureService:o,templateIds:t,signal:a.signal,spatialReference:this.view.spatialReference});if(u.length<t.length)throw new y.dG(t,u);const p=await Promise.all(u.map((e=>this._makeTemplate({json:e,featureService:o}))));for(const i of p){const e=M(o,i.templateId),t=s.get(e);!r?.aborted||C(t)?(n.set(e,i),t?.resolver.resolve(i)):t?.resolver.reject((0,d.createAbortError)()),s.delete(e)}return l?.remove(),p}async _makeTemplate(e){let{json:t,featureService:o}=e;const{view:r}=this,i=this.makeSharedTemplateFromJSON(t);i.featureService=o,i.view=r;const{layerIds:n,subtypeCode:s}=i;try{i.layer=await this.layerResolver({featureService:o,layerIds:n,subtypeCode:s})}catch(a){throw new y.Zm(i.templateId,a)}if((0,f.Dt)(i)&&i.definition?.createUtilityNetworkAssociations){let e=null;try{e=await this.utilityNetworkResolver(o)}catch(a){throw new y.G6(i.templateId,a)}if(e){i.definition.utilityNetwork=await this._getOrCreateUtilityNetworkLookupHelper(e);const t=await e.loadAssociationsTable();i.definition.utilityNetworkAssociationsTable=t,(0,T.Z)(r).additionalLayers.add(t)}}if((0,f.JC)(i)&&i.definition){i.definition.spatialReference=r.spatialReference;for(const e of i.definition.allParts)e.geometry&&(e.geometry.spatialReference=r.spatialReference)}if((0,f.Cq)(i)&&i.definition?.defaultValues){const e=i.definition.defaultValues,t={},{fieldsIndex:o}=i.layer;for(const r in i.definition.defaultValues)t[o.get(r)?.name??r]=e[r];i.definition.defaultValues=t}return i}async _getOrCreateUtilityNetworkLookupHelper(e){const t=this._utilityNetworkLookupHelperCache.get(e);if(t)return t;const o=await new S({utilityNetwork:e}).load();this._utilityNetworkLookupHelperCache.set(e,o);const r=(0,s.hA)((()=>{o.destroy(),this._utilityNetworkLookupHelperCache.delete(e)}));return e.addHandles(r),this.addHandles(r),o}_reset(){this._abortController?.abort(),this._cache.clear(),this._pending.clear()}};function C(e){return null!=e&&e.subscribers.size>0}function M(e,t){return`${e.url}/${t}`}function N(e){return async t=>{let{featureService:o,layerIds:r}=t;const i=new Set(r),{allLayers:n,allTables:s}=e.map,a=n.concat(s).find((e=>e.url===o.url&&function(e){return(0,h.yZ)(e)||(0,h.F2)(e)}(e)&&i.has(e.layerId)));if(null==a)throw new y.$W(r);return a}}function L(e){return async t=>{const{map:o}=e;if(!(0,I.r)(o)||!o.utilityNetworks)return null;for(const e of o.utilityNetworks)if(e.featureServiceUrl===t.url)return e.load();return null}}(0,r._)([(0,p.MZ)()],k.prototype,"_abortController",void 0),(0,r._)([(0,p.MZ)()],k.prototype,"_cache",void 0),(0,r._)([(0,p.MZ)()],k.prototype,"_pending",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],k.prototype,"layerResolver",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],k.prototype,"makeSharedTemplateFromJSON",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],k.prototype,"utilityNetworkResolver",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],k.prototype,"view",void 0),k=(0,r._)([(0,c.$)("esri.editing.sharedTemplates.SharedTemplateProvider")],k)},91046:(e,t,o)=>{function r(e){return"feature"===e.type}function i(e){return"group"===e.type}function n(e){return"preset"===e.type}o.d(t,{Xc:()=>i,sC:()=>r,vf:()=>n})}}]);