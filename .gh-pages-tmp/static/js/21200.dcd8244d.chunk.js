"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[10963,21200,36705,60652,60822,64566,66201,74058,85022,88582,90801,95927],{1278:(e,t,r)=>{r.d(t,{Ee:()=>l,Jd:()=>y,Nk:()=>h,OM:()=>g,Oo:()=>m,W4:()=>c,ix:()=>p,t_:()=>d,tr:()=>u,yh:()=>f,zJ:()=>o});var i=r(5839),n=r(92143),a=r(6579);function o(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,a.zJ)(e,(0,n.kM)(t,r).value,r,i,o)}function s(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,a.nD)(e,(0,n.kM)(t,r).value,r,i,o)}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Ee)(e,t.value,t.unit,r,i)}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.W4)(e,t.value,t.unit,r,i)}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.tr)(e,t.value,t.unit,r,i)}function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.t_)(e,t.value,t.unit,r,i)}function h(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.ie,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,a.Me)(e.value,e.unit,e.rotationType,t,r,n,o)}function p(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i=i??2,r){case"imperial":return u(e,t,i,n);case"metric":return l(e,t,i,n);default:return o(e,t,r,i,n)}}function f(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.J1)(e,t.value,t.unit,r,i)}(e,t,i,n);case"metric":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Mm)(e,t.value,t.unit,r,i)}(e,t,i,n);default:return s(e,t,r,i,n)}}function m(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return d(e,t,i,n);case"metric":return c(e,t,i,n);default:return o(e,t,r,i,n)}}function g(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.LF)(e,t.value,t.unit,r,i)}(e,t,i,n);case"metric":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.e_)(e,t.value,t.unit,r,i)}(e,t,i,n);default:return s(e,t,r,i,n)}}function y(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(r){case"imperial":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Sz)(e,t.value,t.unit,r,i)}(e,t,i,n);case"metric":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.zq)(e,t.value,t.unit,r,i)}(e,t,i,n);default:return o(e,t,r,i,n)}}},3481:(e,t,r)=>{r.d(t,{Fq:()=>o,Yc:()=>n,Yq:()=>a});var i=r(12560);function n(e){if(null==e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new i.default({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function a(e){if(null==e)return null;const t=e.clone();return void 0!==e.cache._geVersion&&(t.cache._geVersion=e.cache._geVersion),t}function o(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},3835:(e,t,r)=>{r.d(t,{DV:()=>p,Qv:()=>f,gE:()=>d,gl:()=>h,jQ:()=>m,zT:()=>g});var i=r(79625),n=r(74719),a=r(65920),o=r(78629),s=r(58507),l=r(15739),c=r(57703);function u(e,t,r){const i=e.toLowerCase(),n=t.toLowerCase()===i,a=r?.toLowerCase()===i;return(0,s.or)(n,a)}function d(e,t,r){return function(e){return"point"===e||"polygon"===e||"polyline"===e}(e.geometryType)&&2===e.fields.filter((e=>{let{name:i,type:n,alias:a}=e;return u(r?.length?r:l.uS,i,a)||u(t?.length?t:l.j5,i,a)&&"blob"===n})).length}function h(e){return"feature"===e.type&&function(e){return"point"===e.geometryType||"polygon"===e.geometryType||"polyline"===e.geometryType}(e)}function p(e,t,r){if(!e)return;const{renderer:i}=e,n=(0,c.dg)(t),a=i?"symbol"in i?i.symbol:"defaultSymbol"in i?i.defaultSymbol:i.getSymbol():null,o=n(a?.color);r[`${t}Symbol`]=(t===e.geometryType?a:null)??o}function f(e,t,r){const i=e.fields.find((e=>{let{name:r,alias:i,type:n}=e;return u(t?.length?t:l.j5,r,i)&&"blob"===n})),a=e.fields.find((e=>{let{name:t,alias:i}=e;return u(r?.length?r:l.uS,t,i)}));if(!i||!a)throw new n.default("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:i,oiObjectIdField:a});return{imageGeometryField:i,oiObjectIdField:a}}function m(e,t,r,a,s,l,u){let d=function(e,t){const{geometry:r}=JSON.parse(atob(e[t]));return(0,o.fromJSON)(r)}(e,t);if(!d)throw new n.default("InvalidGeometry");return d=function(e,t,r){switch(t){case"default":return function(e){switch(e.type){case"point":e.x-=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,r]=e;return[t-.5,.5-r]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,r]=e;return[t-.5,.5-r]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,r]=e;return[t-.5,.5-r]}));break;case"extent":e.xmin-=.5,e.xmax-=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return v(e,r)}}(d,l,s),new i.default({attributes:e,layer:r,symbol:(0,c.ph)(d.type,r.geometryType,u),geometry:d,visible:r.visible&&a})}function g(e,t,r){switch(t){case"default":return function(e){switch(e.type){case"point":e.x+=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map((e=>e.map((e=>{let[t,r]=e;return[t+.5,.5-r]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{let[t,r]=e;return[t+.5,.5-r]}))));break;case"multipoint":e.points=e.points.map((e=>{let[t,r]=e;return[t+.5,.5-r]}));break;case"extent":e.xmin+=.5,e.xmax+=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}(e);case"panoramic":return y(e,r)}}function y(e,t){switch(e.type){case"point":{const{x:r,y:i}=(0,s.pq)(e,t[0],t[1]);e.x=r,e.y=i,delete e.z;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const{x:r,y:i}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[r,i]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const{x:r,y:i}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[r,i]}))));break;case"multipoint":e.points=e.points.map((e=>{const{x:r,y:i}=(0,s.pq)({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[r,i]}));break;case"extent":{const{xmin:r,xmax:i,ymin:n,ymax:o}=y(a.default.fromExtent(e),t).extent;e.xmax=i,e.xmin=r,e.ymax=o,e.ymin=n;break}}return e}function v(e,t){switch(e.type){case"point":{const[r,i,n]=(0,s.D5)(e,t[0],t[1]);e.x=r,e.y=i,e.z=n;break}case"polyline":e.paths=e.paths.map((e=>e.map((e=>{const[r,i,n]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[r,i,n]}))));break;case"polygon":e.rings=e.rings.map((e=>e.map((e=>{const[r,i,n]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[r,i,n]}))));break;case"multipoint":e.points=e.points.map((e=>{const[r,i,n]=(0,s.D5)({x:e[0],y:e[1]},t[0],t[1]);return[r,i,n]}));break;case"extent":{const{xmin:r,xmax:i,ymin:n,ymax:o}=v(a.default.fromExtent(e),t).extent;e.xmax=i,e.xmin=r,e.ymax=o,e.ymin=n}}return e}},7631:(e,t,r)=>{r.d(t,{A:()=>v});var i=r(93800),n=r(85715),a=r(19455),o=r(48602),s=(r(21265),r(50925),r(14746),r(75269)),l=r(99480);let c=class extends(n.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=1}toString(){const{type:e,horizontalWKID:t,verticalWKID:r,x:i,y:n,z:a,heading:o,pitch:s,roll:l,affineTransformations:c,focalLength:u,principalOffsetPoint:d,radialDistortionCoefficients:h,tangentialDistortionCoefficients:p}=this,f=[e,t,r,i,n,a,o,s,l];return this.isAdvanced&&(c?.forEach((e=>f.push(e))),f.push(u),d?.forEach((e=>f.push(e))),h?.forEach((e=>f.push(e))),p?.forEach((e=>f.push(e)))),f.map((e=>Number.isNaN(e)?"":e)).join("|")}};(0,i._)([(0,o.MZ)({json:{write:!0}})],c.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"affineTransformations",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"focalLength",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"principalOffsetPoint",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"radialDistortionCoefficients",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],c.prototype,"tangentialDistortionCoefficients",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"heading",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"pitch",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"roll",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"x",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"y",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"z",void 0),c=(0,i._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationHPR")],c);const u=c;let d=class extends(n.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=4}toString(){const{type:e,latitude:t,longitude:r,ellipsoidRadius:i,squaredEccentricity:n,properties:a}=this,o=`${a}`.split("|");return o.splice(1,1),`${e}|${t}|${r}|${i}|${n}|${o.join("|")}`}};(0,i._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"type",void 0),(0,i._)([(0,o.MZ)({json:{write:!0},type:Number})],d.prototype,"latitude",void 0),(0,i._)([(0,o.MZ)({json:{write:!0},type:Number})],d.prototype,"longitude",void 0),(0,i._)([(0,o.MZ)({json:{write:!0},type:Number})],d.prototype,"ellipsoidRadius",void 0),(0,i._)([(0,o.MZ)({json:{write:!0},type:Number})],d.prototype,"squaredEccentricity",void 0),(0,i._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"properties",void 0),d=(0,i._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationLTP")],d);const h=d;let p=class extends(n.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=2}toString(){const{type:e,horizontalWKID:t,verticalWKID:r,x:i,y:n,z:a,omega:o,phi:s,kappa:l,affineTransformations:c,focalLength:u,principalOffsetPoint:d,radialDistortionCoefficients:h,tangentialDistortionCoefficients:p}=this,f=[e,t,r,i,n,a,o,s,l];return this.isAdvanced&&(c?.forEach((e=>f.push(e))),f.push(u),d?.forEach((e=>f.push(e))),h?.forEach((e=>f.push(e))),p?.forEach((e=>f.push(e)))),f.map((e=>isNaN(e)?"":e)).join("|")}};(0,i._)([(0,o.MZ)({json:{write:!0}})],p.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"affineTransformations",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"focalLength",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"principalOffsetPoint",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"radialDistortionCoefficients",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],p.prototype,"tangentialDistortionCoefficients",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"omega",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"phi",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"kappa",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"x",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"y",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],p.prototype,"z",void 0),p=(0,i._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationOPK")],p);const f=p;let m=class extends(n.A.ClonableMixin(a.A.JSONSupportMixin(l.A))){constructor(){super(...arguments),this.type=3}get isAdvanced(){const{affineTransformations:e,focalLength:t,principalOffsetPoint:r,radialDistortionCoefficients:i,tangentialDistortionCoefficients:n}=this;return e?.length>1||!Number.isNaN(t)||r?.length>1||i?.length>1||n?.length>1}toString(){const{type:e,horizontalWKID:t,verticalWKID:r,x:i,y:n,z:a,yaw:o,pitch:s,roll:l,affineTransformations:c,focalLength:u,principalOffsetPoint:d,radialDistortionCoefficients:h,tangentialDistortionCoefficients:p}=this,f=[e,t,r,i,n,a,o,s,l];return this.isAdvanced&&(c?.forEach((e=>f.push(e))),f.push(u),d?.forEach((e=>f.push(e))),d?.forEach((e=>f.push(e))),h?.forEach((e=>f.push(e))),p?.forEach((e=>f.push(e)))),f.map((e=>Number.isNaN(e)?"":e)).join("|")}};(0,i._)([(0,o.MZ)({json:{write:!0}})],m.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"affineTransformations",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"focalLength",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"principalOffsetPoint",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"radialDistortionCoefficients",void 0),(0,i._)([(0,o.MZ)({type:[Number],json:{write:!0}})],m.prototype,"tangentialDistortionCoefficients",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"yaw",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"pitch",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"roll",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"x",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"y",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],m.prototype,"z",void 0),m=(0,i._)([(0,s.$)("esri.layers.orientedImagery.core.CameraOrientationYPR")],m);const g=m;var y=r(82053);const v=new Map;v.set(`${y.g.OPK}`,{desc:"Using Omega Phi Kappa",constructor:f}),v.set(`${y.g.HPR}`,{desc:"Using Heading, Pitch and Roll",constructor:u}),v.set(`${y.g.YPR}`,{desc:"Using Yaw, Pitch and Roll",constructor:g}),v.set(`${y.g.LTP}`,{desc:"Using Local Tangent Plane",constructor:h})},7772:(e,t,r)=>{r.d(t,{Eh:()=>S,PT:()=>N,WD:()=>C,ns:()=>M,nt:()=>A,v3:()=>R});var i=r(49959),n=r(13473),a=r(28473),o=r(67965),s=r(89227),l=r(62776),c=r(26848),u=r(76493),d=r(65920),h=r(96913),p=r(93321),f=r(23311),m=r(28622),g=r(31766),y=r(10872),v=r(70576),w=r(58507);const b=Math.PI/180;function M(e){return e.isSpherical?function(e){const{geometry:t,farDistance:r,objectId:i,nearDistance:n,cameraHeight:a}=e,o=(0,w.i2)(t.y,t.spatialReference),s=new l.default({center:t.clone(),radius:r*o});if(s.imageID=i,n){const e=new l.default({center:t.clone(),radius:n*o});s.addRing(e.rings[0])}const u=t.clone();u.z=a-r*o;const d=c.default.createSphere(u,{size:2*r*o});return d.imageID=i,{polygon:s,frustum:d}}(e):function(e){const{horizontalFieldOfView:t,verticalFieldOfView:r,geometry:i,cameraHeading:n}=e,a=(0,w.i2)(i.y,i.spatialReference);let o=e.cameraPitch,s=e.cameraRoll??0,l=150;t>150&&(o=90,s=0,l=5);const c=Math.ceil(t/l),u=function(e,t,r){const i=[];if(e%2==0)for(let n=0;n<e/2;n++)i.push(t-r/e*(n+.5),t+r/e*(n+.5));else{i.push(t);for(let n=1;n<e/2;n++)i.push(t-r/e*n,t+r/e*n)}return i.sort(),i}(c,n,t);let h=e.farDistance?e.farDistance*a:e.cameraHeight*a/Math.cos(o*b);e.cameraPitch+r/2>=90&&(h=(e.farDistance||20)*a);const p=new d.default({spatialReference:i?.spatialReference});p.imageID=e.objectId;let f=null;for(const d of u)f=_(d,o,e.cameraHeight,i,h,a,r,t,c,p,s,e.nearDistance);return f.imageID=e.objectId,{polygon:p,frustum:f}}(e)}function _(e,t,r,i,l,c,u,d,h,p){let f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0;const g=(0,o.mg)((0,n.vt)(),(0,w._i)([e,t,f??0])),y=P({cameraHeight:r,cameraPitch:t,farDistance:l,location:i,horizontalFieldOfView:d,nearDistance:m,verticalFieldOfView:u},g),v=(0,w.ei)([0,0,-1],g),{x:M,y:_}=i,S=(0,w.MY)([M,_,r],v,l,c),T=2*Math.tan(u*b/2)*l,A=2*Math.tan(d/h*b/2)*l,I=(0,w.ei)([0,1,0],g),R=(0,w.ei)([1,0,0],g),C=(0,w.Qu)(I,T/2,c),F=(0,w.Qu)(R,A/2,c),O=(0,s.a)((0,a.Ul)(),C,F),N=(0,s.g)((0,a.Ul)(),C,F),E=x([(0,s.g)((0,a.Ul)(),S,O),(0,s.g)((0,a.Ul)(),S,N),(0,s.a)((0,a.Ul)(),S,O),(0,s.a)((0,a.Ul)(),S,N)],r,i,c);return E.push(E[0]),p.addRing(E),y}function x(e,t,r,i){return e.map((e=>function(e,t,r,i){{const n=Math.sqrt((e[2]-t)**2+(Math.sqrt((e[0]-r.x)**2+(e[1]-r.y)**2)/i)**2)*i,o=(0,w.Qu)((0,s.a)((0,a.Ul)(),[e[0],e[1],e[2]],[r.x,r.y,t]),1/n,1/i),l=t/(t-e[2]),c={x:(1-l)*r.x+l*e[0],y:(1-l)*r.y+l*e[1],z:(1-l)*t+l*e[2]},u=Math.sqrt((c.z-t)**2+(Math.sqrt((c.x-r.x)**2+(c.y-r.y)**2)/i)**2)*i,d=(0,w.Qu)((0,s.a)((0,a.Ul)(),[c.x,c.y,c.z],[r.x,r.y,t]),1/u,1/i);return T(o[0],d[0])&&T(o[1],d[1])&&T(o[2],d[2])||e[2]>=0?[e[0],e[1],0]:[c.x,c.y,c.z]}}(e,t,r,i)))}function S(e,t){return e.contains(t)}function T(e,t){return Math.sign(e)!==Math.sign(t)}function P(e,t,r){const{cameraHeight:i,cameraPitch:n,farDistance:o,location:l,horizontalFieldOfView:u,nearDistance:d,verticalFieldOfView:h}=e,p=I(l),f=n+h/2>=90==0,m=2*Math.tan(h*b/2)*d,y=2*Math.tan(u*b/2)*d,v=2*Math.tan(h*b/2)*o,M=2*Math.tan(u*b/2)*o;let _,x;x=[0,0,-1],x=(0,w.ei)(x,t),_=(0,w.MY)([l.x,l.y,i],x,o,p),f&&(_[2]=0);const S=(0,w.MY)([l.x,l.y,i],x,d,p);let T=[0,1,0];T=(0,w.ei)(T,t);let P=[1,0,0];P=(0,w.ei)(P,t);let A=[],R=[];d?(R=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],A=A.concat((0,s.g)((0,a.Ul)(),S,(0,s.a)((0,a.Ul)(),(0,w.Qu)(T,m/2,p),(0,w.Qu)(P,y/2,p)))),A=A.concat((0,s.g)((0,a.Ul)(),S,(0,s.g)((0,a.Ul)(),(0,w.Qu)(T,m/2,p),(0,w.Qu)(P,y/2,p)))),A=A.concat((0,s.a)((0,a.Ul)(),S,(0,s.a)((0,a.Ul)(),(0,w.Qu)(T,m/2,p),(0,w.Qu)(P,y/2,p)))),A=A.concat((0,s.a)((0,a.Ul)(),S,(0,s.g)((0,a.Ul)(),(0,w.Qu)(T,m/2,p),(0,w.Qu)(P,y/2,p))))):(A=[l.x,l.y,i],R=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),A=A.concat((0,s.g)((0,a.Ul)(),_,(0,s.a)((0,a.Ul)(),(0,w.Qu)(T,v/2,p),(0,w.Qu)(P,M/2,p)))),A=A.concat((0,s.g)((0,a.Ul)(),_,(0,s.g)((0,a.Ul)(),(0,w.Qu)(T,v/2,p),(0,w.Qu)(P,M/2,p)))),A=A.concat((0,s.a)((0,a.Ul)(),_,(0,s.a)((0,a.Ul)(),(0,w.Qu)(T,v/2,p),(0,w.Qu)(P,M/2,p)))),A=A.concat((0,s.a)((0,a.Ul)(),_,(0,s.g)((0,a.Ul)(),(0,w.Qu)(T,v/2,p),(0,w.Qu)(P,M/2,p))));const C=new g.H({position:Float64Array.from(A)});return new c.default({vertexAttributes:C,components:R,spatialReference:l.spatialReference})}function A(e){const{spatialReference:t,x:r,y:i}=e.geometry,{cameraHeading:n,cameraPitch:a,farDistance:o,nearDistance:s}=e,l=I(e.geometry),c=new d.default({spatialReference:t}),u=Math.abs(1.44*o*l);let h=Math.abs(1.44*s*l);(a<20||null==n)&&(h=u);const p=[];return p[0]={x:r+u*Math.sin((n-45)*b),y:i+u*Math.cos((n-45)*b)},p[1]={x:r+u*Math.sin((n+45)*b),y:i+u*Math.cos((n+45)*b)},p[2]={x:r+h*Math.sin((n+135)*b),y:i+h*Math.cos((n+135)*b)},p[3]={x:r+h*Math.sin((n+225)*b),y:i+h*Math.cos((n+225)*b)},c.addRing([[p[0].x,p[0].y,0],[p[1].x,p[1].y,0],[p[2].x,p[2].y,0],[p[3].x,p[3].y,0],[p[0].x,p[0].y,0]]),c}function I(e){return e&&(0,v.K8)(e?.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/f.$O.radius))):1}function R(e,t){const r=1+t/100;if("esri.geometry.Circle"===e.declaredClass){const{radius:t,center:i}=e,n=new l.default({radius:t*r,center:i});return e.rings.length>1&&n.addRing(e.rings[1]),n}if("esri.geometry.Polygon"===e.declaredClass){const t=new d.default({spatialReference:e.spatialReference}),i=e.centroid;if(i){const n=[];for(let t=0;t<e.rings[0].length;t++){const o=Math.sqrt((i.x-e.rings[0][t][0])**2+(i.y-e.rings[0][t][1])**2),l=(0,w.Qu)((0,s.a)((0,a.Ul)(),[e.rings[0][t][0],e.rings[0][t][1],0],[i.x,i.y,0]),1/o,1),c=(0,w.MY)([i.x,i.y,0],l,o*r,1);n.push({x:c[0],y:c[1]})}t.addRing([[n[0].x,n[0].y,0],[n[1].x,n[1].y,0],[n[2].x,n[2].y,0],[n[3].x,n[3].y,0],[n[0].x,n[0].y,0]])}return t}return e}async function C(e,t,r){const{cameraHeight:i,cameraLocation:n,cameraPitch:a,frustumVertices:o,horizontalFieldOfView:s,imageHeight:l,imageWidth:u,inSRS:d,outSRS:h,verticalFieldOfView:f,cameraRoll:m,options:y}=r,v=new p.default(d),b=new p.default(h),M=(0,w.x1)(s,f,m??0),_=o.length>15;return a+M.vfov/2>=90?await async function(e,t,r,i,n,a,o,s){let l,u=o?new Array:[e[0],e[1],e[2]],d=new Array;for(const c of t)o?(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[r,0,1],[r,i,1],[0,i,1]],[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]]]),u=u.concat(...l),l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[r,0,1],[r,i,1],[0,i,1]],[[e[12],e[13],e[14]],[e[15],e[16],e[17]],[e[18],e[19],e[20]],[e[21],e[22],e[23]]]),d=d.concat(...l)):(l=(0,w.cL)([c[0],c[1],1],[[0,0,1],[r,0,1],[r,i,1],[0,i,1]],[[e[3],e[4],e[5]],[e[6],e[7],e[8]],[e[9],e[10],e[11]],[e[12],e[13],e[14]]]),u=u.concat(...l));u=u.concat(d);const h=await N(u,n,a,s),p=L(h);return new c.default({vertexAttributes:new g.H({position:h}),components:z(o?D(p,!0):Z(p,!0)),spatialReference:a})}(o,e,u,l,v,b,_,y):await async function(e,t,r,i,n,a,o,s,l){const u=function(e,t,r,i,n){const a=E(e),o=E(e,"near");if(!a)return;const s=t.length;for(let l=0;l<s;l++){const e=Array.from(r[l]),t=[e[0]-i[0],e[1]-i[1],e[2]-(i[2]??n)];O(i,t,l,o),F(i,t,l,a)}return{farPlane:a,nearPlane:o}}(e,t,r,i,n);if(!u)return;const{farPlane:d,nearPlane:h}=u,p=await N([...h?.vertexPositions??e.slice(0,3),...d.vertexPositions],o,s,l),f=L(p);return new c.default({vertexAttributes:new g.H({position:p}),components:z(a?D(f,!0):Z(f,!0)),spatialReference:s})}(o,e,t,n,i,_,v,b,y)}function F(e,t,r,i){const{coefficients:n,vertexPositions:o}=i,s=(0,a.Ul)();(0,y.Ui)(n,{origin:e,direction:t},s)&&o.splice(3*r,3,...s)}function O(e,t,r,i){if(!i)return;const n=(0,a.Ul)();(0,y.Ui)(i.coefficients,{origin:e,direction:t},n)&&i.vertexPositions.splice(3*r,3,...n)}async function N(e,t,r,n){if(t.equals(r))return e;const a=e.reduce(((e,t,r)=>{const i=Math.floor(r/3);return e[i]||(e[i]=new Array),e[i].push(t),e}),new Array),{points:o}=await(0,h.projectWithZConversion)(new u.default(a,t),r,n);return(0,i.throwIfAborted)(n),o.flat()}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"far";const r=(0,y.vt)();let i;switch(t){case"far":if(i=Array.from(15===e.length?e.slice(3):e.slice(12)),(0,y.ci)(r,i,!1))return{coefficients:r,vertexPositions:i};break;case"near":if(i=Array.from(e.slice(0,12)),15===e.length||!(0,y.ci)(r,i,!1))return;return{coefficients:r,vertexPositions:i}}}const D=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&e-2<=4||e<=4||e%2!=0)throw new Error("Invalid number of vertices");const r=[],i=e/2,n=Math.round((t?e-2:e)/2);for(let a=0;a<n;a++){const n=a+i,o=t?n+1:n,s=o%e,l=(t?n:o+1)%e;r.push({faces:new Uint32Array([a,l,s,a,a+1,s])})}return r};function Z(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<3||t&&e-1<3)throw new Error("Invalid number of vertices");const r=[],i=t?e-2:e-1;for(let n=0;n<i;n++)r.push({faces:new Uint32Array([0,n+1,n+2])});return r}const z=e=>e.map((e=>new m.default(e))),L=e=>e.length/3},7972:(e,t,r)=>{r.d(t,{H:()=>z,b:()=>N,c:()=>D});var i=r(32006),n=r(98080),a=r(24646),o=r(23311),s=r(96236),l=r(75304),c=r(78731),u=r(67095),d=r(66195),h=r(10043),p=r(89659),f=r(65228),m=r(75762),g=r(66652),y=r(42162),v=r(95206),w=r(35490),b=r(61315),M=r(34927),_=r(21152),x=r(94409),S=r(4241),T=r(42403),P=r(16878),A=r(73712),I=r(67058),R=r(86836),C=r(22131),F=r(8118),O=r(12621);function N(e){const t=new F.N5,r=e.signedDistanceFieldEnabled;t.include(d.Q,e),t.vertex.include(l.rA,e);const{occlusionPass:n,output:N,oitPass:z}=e;if(n)return t.include(h.I,e),t;const{vertex:L,fragment:k}=t;t.include(v.Y6),t.include(m.A,e),t.include(c.g,e),t.include(p.y),k.include(y.W),k.include(g.a),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2");const G=N===s.V.Highlight,V=G&&e.occlusionTestEnabled;V&&t.varyings.add("voccluded","float"),L.uniforms.add(new M.I("viewport",(e=>e.camera.fullViewport)),new b.G("screenOffset",((e,t)=>(0,i.hZ)(Z,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.G("anchorPosition",(e=>D(e))),new x.E("materialColor",(e=>e.color)),new T.m("materialRotation",(e=>e.rotation))),(0,w.Nz)(L),r&&(L.uniforms.add(new x.E("outlineColor",(e=>e.outlineColor))),k.uniforms.add(new x.E("outlineColor",(e=>E(e)?e.outlineColor:a.uY)),new T.m("outlineSize",(e=>E(e)?e.outlineSize:0)))),e.horizonCullingEnabled&&L.uniforms.add(new _.V("pointDistanceSphere",((e,t)=>{const r=t.camera.eye,i=e.origin;return(0,a.fA)(i[0]-r[0],i[1]-r[1],i[2]-r[2],o.$O.radius)}))),e.pixelSnappingEnabled&&L.include(u.K),e.hasScreenSizePerspective&&((0,v.pM)(L),(0,v.OH)(L)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(C.r.UV0,"vec2"),t.attributes.add(C.r.COLOR,"vec4"),t.attributes.add(C.r.SIZE,"vec2"),t.attributes.add(C.r.ROTATION,"float"),t.attributes.add(C.r.FEATUREATTRIBUTE,"vec4"),L.code.add(e.horizonCullingEnabled?P.H`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:P.H`bool behindHorizon(vec3 posModel) { return false; }`),L.main.add(P.H`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,P.If)(e.hasScreenSizePerspective,P.H`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,P.H`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,P.If)(e.vvSize,P.H`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${(0,P.If)(e.occlusionTestEnabled,P.H`
      bool visible = testHUDVisibility(posProj);
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,P.If)(e.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
      ${(0,P.If)(V,P.H`voccluded = visible ? 0.0 : 1.0;`)}
    `);const j=P.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,P.If)(e.hasRotation,P.H`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,H=e.pixelSnappingEnabled?r?P.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:P.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:P.H`posProj += quadOffset;`;L.main.add(P.H`
    ${j}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,P.If)(N===s.V.ObjectAndLayerIdColor,P.H`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${P.H.float(O.Q)};
    ${(0,P.If)(r,`alphaDiscard = alphaDiscard && outlineColor.a < ${P.H.float(O.Q)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${H}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,P.If)(e.debugDrawLabelBorder,P.H`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),k.uniforms.add(new I.N("tex",(e=>e.texture))),e.occludedFragmentFade&&(k.uniforms.add(new A.x("depthMap",(e=>e.mainDepth))),k.uniforms.add(new S.U("occludedOpacity",(e=>e.hudOccludedFragmentOpacity))));const U=e.debugDrawLabelBorder?P.H`(isBorder > 0.0 ? 0.0 : ${P.H.float(O.Q)})`:P.H.float(O.Q),B=P.H`
    ${(0,P.If)(e.debugDrawLabelBorder,P.H`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,P.If)(e.sampleSignedDistanceFieldTexelCenter,P.H`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,P.H`vec2 samplePos = vtc;`)}

    ${r?P.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgbaTofloat(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${U} ||
          fillPixelColor.a + outlinePixelColor.a < ${P.H.float(O.Q)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,P.If)(!G,P.H`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${U}) {
          discard;
        }

        ${(0,P.If)(!G,P.H`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:P.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${U}) {
            discard;
          }
          ${(0,P.If)(!G,P.H`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,P.If)(e.occludedFragmentFade&&!G,P.H`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${(0,P.If)(!G&&e.debugDrawLabelBorder,P.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(N){case s.V.Color:case s.V.ColorEmission:t.outputs.add("fragColor","vec4",0),N===s.V.ColorEmission&&t.outputs.add("fragEmission","vec4",1),z===R.Y.ColorAlpha&&t.outputs.add("fragAlpha","float",N===s.V.ColorEmission?2:1),k.main.add(P.H`
        ${B}
        ${(0,P.If)(z===R.Y.FrontFace,P.H`fragColor.rgb /= fragColor.a;`)}
        ${(0,P.If)(N===s.V.ColorEmission,P.H`fragEmission = vec4(0.0);`)}
        ${(0,P.If)(z===R.Y.ColorAlpha,P.H`fragAlpha = fragColor.a;`)}`);break;case s.V.ObjectAndLayerIdColor:k.main.add(P.H`
        ${B}
        outputObjectAndLayerIdColor();`);break;case s.V.Highlight:t.include(f.Q,e),k.main.add(P.H`
        ${B}
        outputHighlight(${(0,P.If)(V,P.H`voccluded == 1.0`,P.H`false`)});`)}return t}function E(e){return e.outlineColor[3]>0&&e.outlineSize>0}function D(e){return e.textureIsSignedDistanceField?function(e,t,r){(0,i.hZ)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1])}(e.anchorPosition,e.distanceFieldBoundingBox,Z):(0,i.C)(Z,e.anchorPosition),Z}const Z=(0,n.vt)(),z=Object.freeze(Object.defineProperty({__proto__:null,build:N,calculateAnchorPosition:D},Symbol.toStringTag,{value:"Module"}))},9934:(e,t,r)=>{r.d(t,{Qv:()=>g,RR:()=>c,Rf:()=>s,eR:()=>l,fs:()=>d,l6:()=>u,y4:()=>m});var i=r(42761),n=r(7631),a=r(48039),o=r(82053);function s(e,t,r){return t&&(e=`${t}${e}`),r&&(e+=`${r}`),e}function l(e,t,r){return e?(0,a.E1)(e)?new a.Mr(e):function(e,t,r){let{url:i}=e;return i?(i=s(i,t,r),new a.TH({...e,url:i})):null}(e,t,r):e}const c=new i.J({Minutes:"minutes",Hours:"hours",Days:"days",Weeks:"weeks",Months:"months",Years:"years"}),u=new i.J({Feet:"feet",Meter:"meter"}),d=new i.J({360:"360",Horizontal:"horizontal",Inspection:"inspection",Nadir:"nadir",Oblique:"oblique","":null}),h=new Map;h.set(`${o.g.HPR}`,(function(e){const[t,r,i,n,a,o,s,l,c,u,d,h,p,m,g,y,v,w,b,M,_,x]=e.slice(1);return{horizontalWKID:t,verticalWKID:r,x:i,y:n,z:a,heading:o,pitch:s,roll:l,...f([c,u,d,h,p,m],[y,v],[w,b,M],[_,x],g)}})),h.set(`${o.g.YPR}`,(function(e){const[t,r,i,n,a,o,s,l,c,u,d,h,p,m,g,y,v,w,b,M,_,x]=e.slice(1);return{horizontalWKID:t,verticalWKID:r,x:i,y:n,z:a,yaw:o,pitch:s,roll:l,...f([c,u,d,h,p,m],[y,v],[w,b,M],[_,x],g)}})),h.set(`${o.g.OPK}`,(function(e){const[t,r,i,n,a,o,s,l,c,u,d,h,p,m,g,y,v,w,b,M,_,x]=e.slice(1);return{horizontalWKID:t,verticalWKID:r,x:i,y:n,z:a,omega:o,phi:s,kappa:l,...f([c,u,d,h,p,m],[y,v],[w,b,M],[_,x],g)}})),h.set(`${o.g.LTP}`,(function(e){const[t,r,i,a,o,...s]=e.slice(1),l=h.get(o),c=n.A.get(o)?.constructor;return l&&c?{latitude:t,longitude:r,ellipsoidRadius:i,squaredEccentricity:a,properties:new c(l([o,"",...s]))}:null}));const p=e=>{const t=e.map((e=>parseFloat(e))).filter((e=>!isNaN(e)));if(t.length===e.length)return t};function f(e,t,r,i,n){const a=p(e),o=p(t),s=p(r),l=p(i);return{affineTransformations:6===a?.length?a:void 0,focalLength:6===a?.length?parseFloat(n):void 0,principalOffsetPoint:2!==o?.length?[0,0]:o,radialDistortionCoefficients:3!==s?.length?[0,0,0]:s,tangentialDistortionCoefficients:2!==l?.length?[0,0]:l}}function m(e){if(!e)return null;const t=`${e}`.split("|");if(0===t.length)return null;const r=n.A.get(t[0]);if(!r)return null;const i=h.get(t[0]);return i?new(0,r.constructor)(i(t)):null}function g(e){return Array.isArray(e)&&9===e?.length&&!e.some(isNaN)}},10043:(e,t,r)=>{r.d(t,{I:()=>o});var i=r(67095),n=r(61535),a=r(16878);function o(e,t){const{vertex:r,fragment:o}=e;e.include(n.Z,t),r.include(i.K),r.main.add(a.H`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),o.main.add(a.H`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}},15390:(e,t,r)=>{r.d(t,{P:()=>l,r:()=>i});var i,n,a=r(89227),o=r(28473),s=r(12096);class l{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=(0,s.vt)(),this._points=(0,s.Qy)(),this.lines=new Array(12),this._origin=(0,o.vt)(),this._direction=(0,o.vt)(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:(0,o.vt)(),endpoint:null}}update(e){(0,s.ui)(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),(0,a.c)(this._origin,e.eye),(0,a.c)(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)(0,a.c)(this._points[t],e[t]);(0,s.DV)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return(0,s.m7)(this.frustum,e)}intersectsRay(e){return(0,s.pw)(this.frustum,e)}intersectsLineSegment(e,t){return(0,s.ST)(this.frustum,e,t)}intersectsPoint(e){return(0,s.bU)(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const r=t+4;c(this.lines[t],e[t],e[r]),c(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),c(this.lines[t+8],e[r],3===t?e[4]:e[r+1])}}}function c(e,t,r){e.origin=t,e.endpoint=r,(0,a.o)(e.direction,t,r)}l.planePointIndices=s.c8,l.nearFarLineIndices=[[s.J7.NEAR_BOTTOM_LEFT,s.J7.FAR_BOTTOM_LEFT],[s.J7.NEAR_BOTTOM_RIGHT,s.J7.FAR_BOTTOM_RIGHT],[s.J7.NEAR_TOP_RIGHT,s.J7.FAR_TOP_RIGHT],[s.J7.NEAR_TOP_LEFT,s.J7.FAR_TOP_LEFT]],(n=i||(i={}))[n.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT",n[n.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT",n[n.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT",n[n.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT",n[n.NEAR_BOTTOM=4]="NEAR_BOTTOM",n[n.NEAR_RIGHT=5]="NEAR_RIGHT",n[n.NEAR_TOP=6]="NEAR_TOP",n[n.NEAR_LEFT=7]="NEAR_LEFT",n[n.FAR_BOTTOM=8]="FAR_BOTTOM",n[n.FAR_RIGHT=9]="FAR_RIGHT",n[n.FAR_TOP=10]="FAR_TOP",n[n.FAR_LEFT=11]="FAR_LEFT"},18162:(e,t,r)=>{r.d(t,{F:()=>a});r(96913);var i=r(93321),n=r(31183);function a(e,t,r,i,a){return!(null==t||null==i||e.length<2)&&(o.x=e[0],o.y=e[1],o.z=e[2],o.spatialReference=t,(0,n.g)(o,r,i,a))}const o=(0,r(62240).T)(0,0,0,i.default.WGS84)},29867:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Mt});var i=r(93800),n=r(79625),a=r(62631),o=r(58828),s=r(89129),l=r(56082),c=r(74719),u=r(58448),d=r(19455),h=r(82301),p=r(50925),f=r(64682),m=r(17741),g=r(20620),y=r(49959),v=r(90450),w=r(79953),b=r(14125),M=r(84190),_=r(48602),x=(r(21265),r(75269)),S=r(32006),T=r(15492),P=r(60652),A=r(76493),I=r(75400),R=r(65920),C=r(54824),F=r(96913),O=r(93321),N=r(53053),E=r(5616),D=r(70674),Z=r(12560),z=r(88455),L=r(85715),k=r(32980),G=r(47332),V=r(14800),j=r(15484),H=r(30880),U=r(99480),B=(r(14746),r(7631)),W=r(9934);let q=class{static getCameraOrientation(e){return(0,W.y4)(e)}static register(e,t,r){B.A.set(e,{desc:t,constructor:r})}};q=(0,i._)([(0,x.$)("esri.layers.orientedImagery.core.cameraOrientationFactory")],q);const $=q;var J=r(82053),Y=r(58507);const K=e=>({cast:e=>{const t=parseFloat(e);return Number.isFinite(t)?t:void 0},json:{name:e,write:{writer:(e,t,r)=>{t[r]=Number.isFinite(e)?e:void 0}}}}),Q=e=>({cast:e=>"string"==typeof e?e.split(";").map(Number):e,json:{default:e,write:{writer:(e,t,r)=>{t[r]=e?.join(";")}}}});let X=class extends(L.A.ClonableMixin(d.A)){constructor(e){super(e),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(e,t){const r={},{attributes:i,layer:n,geometry:a}=e,o={};for(const s in i)r[s.toLowerCase()]=i[s],o[s.toLowerCase()]=s;super.read({geometry:a,layer:n??{},sourceMap:o,...r},t)}write(e,t){const r=super.write(e,t),{sourceMap:i}=this;if(!i||!r)return r;const n={};for(const a in r){const e=i[a.toLowerCase()];e&&(n[e]=r[a])}return n}readCameraHeading(e,t){const{cameraheading:r,camheading:i,layer:n}=t;return r??i??n.cameraHeading}readCameraHeight(e,t){const{cameraheight:r,avghtag:i,layer:n}=t;return r??i??n.cameraHeight}readCamOffset(e,t){const{cameraoffset:r,camoffset:i}=t;return r?.split(";").map(Number)??i?.split(";").map(Number)??null}writeCameraOffset(e,t){e&&(t.cameraOffset=e.join(";"))}readCameraOrientation(e,t){const{cameraorientation:r,camori:i}=t;return r??i}readCameraPitch(e,t){const{camerapitch:r,campitch:i,layer:n}=t;return r??i??n.cameraPitch}readCameraRoll(e,t){const{cameraroll:r,camroll:i,layer:n}=t;return r??i??n.cameraRoll}readDepthImage(e,t){const{depthimage:r,depthimg:i,layer:n}=t,a=r??i??null,{depthImagePathPrefix:o,depthImagePathSuffix:s}=n??{};return(0,W.Rf)(a,o,s)}readElevationSource(e,t){const{elevationsource:r,layer:i}=t,{demPathSuffix:n,demPathPrefix:a}=i;if(r){const e=this._parseIfJSON(r);return(0,W.eR)(e,a,n)}return i.effectiveElevationSource}readFarDistance(e,t){const{fardistance:r,fardist:i,layer:n}=t;return r??i??n.farDistance}readHFOV(e,t){const{horizontalfieldofview:r,hfov:i,layer:n}=t;return r??i??n.horizontalFieldOfView}readImageURL(e,t){const{imagepath:r,layer:i}=t;r||function(e,t){throw new c.default("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:t})}("imagePath",this);const{imagePathPrefix:n,imagePathSuffix:a}=i;return(0,W.Rf)(r,n,a)}readImageRotation(e,t){const{imagerotation:r,imgrot:i,layer:n}=t;return r??i??n.imageRotation}get isHorizontal(){return"horizontal"===this.orientedImageryType}get isInspection(){return"inspection"===this.orientedImageryType}get isNadir(){return"nadir"===this.orientedImageryType}get isOblique(){return"oblique"===this.orientedImageryType}get isSpherical(){return"360"===this.orientedImageryType}get location(){const{cameraOrientation:e,cameraHeight:t,elevation:r}=this;if(e){const{type:t,x:r,y:i,z:n,horizontalWKID:a,verticalWKID:o}=e,s="number"==typeof a?{wkid:a}:{wkt:a};if(t===J.g.LTP){const{latitude:t,longitude:r,ellipsoidRadius:i,squaredEccentricity:n,properties:a}=e,{x:o,y:s,z:l}=a;return new I.default((0,Y.Zq)([o,s,l],[t,r,i,n]))}const l=new I.default({x:r,y:i,z:n,spatialReference:s}),c=o?(0,H.N)("point",{wkid:o},s):null;return c&&c(l),l}if("number"!=typeof t)throw function(e){throw new c.default("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}("cameraHeight");const i=this.geometry.clone();return i.z=i.hasZ?i.z:(r??0)+t,i}set matrix(e){if(!e||9!==e.length)return p.A.getLogger(this).warn("Ignoring rotation matrix because it doesn't have 9 values",{value:e}),void this._set("matrix",null);this._set("matrix",e)}readNearDistance(e,t){const{neardistance:r,neardist:i,layer:n}=t;return r??i??n.nearDistance}readOrientationAccuracy(e,t){const{accuracy:r,orientationaccuracy:i}=t;return i?.split(";").map(Number)??r?.split(";").map(Number)??null}writeOrientationAccuracy(e,t){e&&(t.orientationAccuracy=e.join(";"))}readOIType(e,t){const{orientedimagerytype:r,oitype:i,camerapitch:n,campitch:a,layer:o}=t,s=W.fs.read(r??i??o.orientedImageryType),l=n??a??o.cameraPitch;return"oblique"===s?l<10?"nadir":"oblique":s}set radial(e){if(e)if("string"!=typeof e)this._set("radial",e);else{const[t,r,i]=e.split(";").map(Number);this._set("radial",[t??0,r??0,i??0])}else this._set("radial",[0,0,0])}set tangential(e){if(e)if("string"!=typeof e)this._set("tangential",e);else{const[t,r]=e.split(";").map(Number);this._set("tangential",[t??0,r??0])}else this._set("tangential",[0,0])}readVFOV(e,t){const{verticalfieldofview:r,vfov:i,layer:n}=t;return r??i??n.verticalFieldOfView}_parseIfJSON(e){let t=null;try{t=JSON.parse(e)}catch(r){p.A.getLogger(this).error("couldn't parse the given elevation source JSON",e,r)}return t}};(0,i._)([(0,_.MZ)(K())],X.prototype,"a0",void 0),(0,i._)([(0,_.MZ)(K())],X.prototype,"a1",void 0),(0,i._)([(0,_.MZ)(K())],X.prototype,"a2",void 0),(0,i._)([(0,_.MZ)({type:Date,json:{write:{enabled:!0,target:"acquisitionDate"},name:"acquisitiondate"}})],X.prototype,"acquisitionDate",void 0),(0,i._)([(0,_.MZ)(K())],X.prototype,"b0",void 0),(0,i._)([(0,_.MZ)(K())],X.prototype,"b1",void 0),(0,i._)([(0,_.MZ)(K())],X.prototype,"b2",void 0),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],X.prototype,"cameraHeading",void 0),(0,i._)([(0,V.w)("cameraHeading")],X.prototype,"readCameraHeading",null),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraHeight",void 0),(0,i._)([(0,V.w)("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],X.prototype,"readCameraHeight",null),(0,i._)([(0,_.MZ)()],X.prototype,"cameraOffset",void 0),(0,i._)([(0,V.w)("cameraOffset",["cameraoffset","camoffset"])],X.prototype,"readCamOffset",null),(0,i._)([(0,j.K)("cameraOffset")],X.prototype,"writeCameraOffset",null),(0,i._)([(0,_.MZ)({json:{write:{writer:(e,t,r)=>{t[r]=e.toString()}}},type:U.A}),(0,k.w)((e=>e?$.getCameraOrientation(e):null))],X.prototype,"cameraOrientation",void 0),(0,i._)([(0,V.w)("cameraOrientation",["cameraorientation","camori"])],X.prototype,"readCameraOrientation",null),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraPitch",void 0),(0,i._)([(0,V.w)("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],X.prototype,"readCameraPitch",null),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"cameraRoll",void 0),(0,i._)([(0,V.w)("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],X.prototype,"readCameraRoll",null),(0,i._)([(0,_.MZ)({json:{write:!0},type:String})],X.prototype,"depthImage",void 0),(0,i._)([(0,V.w)("depthImage",["depthimage","depthimg"])],X.prototype,"readDepthImage",null),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"elevation",void 0),(0,i._)([(0,_.MZ)({json:{write:!0},clonable:"reference"})],X.prototype,"elevationSource",void 0),(0,i._)([(0,V.w)("elevationSource",["elevationsource","layer.effectiveElevationSource"])],X.prototype,"readElevationSource",null),(0,i._)([(0,_.MZ)({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],X.prototype,"exposureStationId",void 0),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"farDistance",void 0),(0,i._)([(0,V.w)("farDistance",["fardistance","fardist","layer.farDistance"])],X.prototype,"readFarDistance",null),(0,i._)([(0,_.MZ)(K("focallength"))],X.prototype,"focalLength",void 0),(0,i._)([(0,_.MZ)({type:I.default,json:{name:"geometry"}})],X.prototype,"geometry",void 0),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"horizontalFieldOfView",void 0),(0,i._)([(0,V.w)("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],X.prototype,"readHFOV",null),(0,i._)([(0,_.MZ)({json:{write:!0},type:String})],X.prototype,"imagePath",void 0),(0,i._)([(0,V.w)("imagePath",["imagepath"])],X.prototype,"readImageURL",null),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"imageRotation",void 0),(0,i._)([(0,V.w)("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],X.prototype,"readImageRotation",null),(0,i._)([(0,_.MZ)()],X.prototype,"isHorizontal",null),(0,i._)([(0,_.MZ)()],X.prototype,"isInspection",null),(0,i._)([(0,_.MZ)()],X.prototype,"isNadir",null),(0,i._)([(0,_.MZ)()],X.prototype,"isOblique",null),(0,i._)([(0,_.MZ)()],X.prototype,"isSpherical",null),(0,i._)([(0,_.MZ)()],X.prototype,"location",null),(0,i._)([(0,_.MZ)(Q())],X.prototype,"matrix",null),(0,i._)([(0,_.MZ)({json:{write:!0},type:String})],X.prototype,"name",void 0),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"nearDistance",void 0),(0,i._)([(0,V.w)("nearDistance",["neardistance","neardist","layer.nearDistance"])],X.prototype,"readNearDistance",null),(0,i._)([(0,_.MZ)({json:{write:!0,name:"objectid"},type:Number})],X.prototype,"objectId",void 0),(0,i._)([(0,_.MZ)()],X.prototype,"orientationAccuracy",void 0),(0,i._)([(0,V.w)("orientationAccuracy",["accuracy","orientationaccuracy"])],X.prototype,"readOrientationAccuracy",null),(0,i._)([(0,j.K)("orientationAccuracy")],X.prototype,"writeOrientationAccuracy",null),(0,i._)([(0,G.e)(W.fs)],X.prototype,"orientedImageryType",void 0),(0,i._)([(0,V.w)("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],X.prototype,"readOIType",null),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0,read:{source:"principalx"}}})],X.prototype,"principalX",void 0),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0,read:{source:"principaly"}}})],X.prototype,"principalY",void 0),(0,i._)([(0,_.MZ)(Q([0,0,0]))],X.prototype,"radial",null),(0,i._)([(0,_.MZ)({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],X.prototype,"sortOrder",void 0),(0,i._)([(0,_.MZ)({type:Object})],X.prototype,"sourceMap",void 0),(0,i._)([(0,_.MZ)(Q([0,0]))],X.prototype,"tangential",null),(0,i._)([(0,_.MZ)({type:Number,json:{write:!0}})],X.prototype,"verticalFieldOfView",void 0),(0,i._)([(0,V.w)("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],X.prototype,"readVFOV",null),X=(0,i._)([(0,x.$)("esri.layers.orientedImagery.core.ExposurePoint")],X);const ee=X;var te=r(53512);const re={};async function ie(e,t){const{point:r,queryParams:i}=e;if(null==r)return null;const n={};let a=e.layerInstanceOrURL;const o=r.spatialReference.isGeographic?(0,E.geographicToWebMercator)(r.clone()):r.clone();if(n.outSpatialReference=o.spatialReference,i&&(n.maxRecordCountFactor=i.maxRecordCountFactor??5,n.outFields=i.outFields??["*"],n.where=i.where??"1=1",n.returnGeometry=i.returnGeometry??!0,n.outSpatialReference=i.outSpatialReference),"string"==typeof a&&(re.layer&&re.layer.url===a?a=re.layer:(re.layer?.destroy(),a=re.layer=new z.default({url:a}))),a)try{await a.load();const e=a,r=function(e,t){const r=e.x-t,i=e.x+t,n=e.y-t,a=e.y+t;return new Z.default({xmin:r,xmax:i,ymin:n,ymax:a,spatialReference:e.spatialReference})}(o,i?.maximumDistance??e.maximumDistance??1e3);n.returnZ=e.hasZ;const s=new te.default({geometry:r,...n}),l=await e.queryFeatures(s,t);return function(e){return t=>{const{features:r,spatialReference:i}=t;return r.forEach((t=>{t.geometry&&(t.geometry.spatialReference=i);const r=ee.fromJSON({...t.toJSON(),layer:e});r&&(t.attributes=r),t.layer=e,t.spatialReference=i})),t}}(e)(l)}catch(s){(0,y.throwIfNotAbortError)(s)}return null}var ne=r(23311),ae=r(76835);function oe(e){const{camera:t,features:r,selectedPoint:i}=e;if(!r.length)return[];e.currentImage??={attributes:{cameraHeading:0,cameraPitch:0}};const n=function(e,t,r){return t.z??=0,t.elevation??=0,i=>{const{hfovWeight:n,vfovWeight:a,distanceWeight:o}=se(i.attributes,e?"3d":"2d"),s=i.attributes,{cameraHeight:l,cameraHeading:c,cameraPitch:u,farDistance:d,horizontalFieldOfView:h,verticalFieldOfView:p,isOblique:f}=s,m=s.geometry,g=180*Math.atan2(m.y-t.y,m.x-t.x)/Math.PI,y=(0,ae.Io)(t,m);let v,w,b=h,M=p,_=!1;e?(v=e.heading,w=e.tilt,b=180,M=180,_=!0):!f||u<10?(v=c,w=u,_=!1):(v=r.attributes.cameraHeading,w=u,_=!0,b=180),v>180&&(v-=360);let x=1;m.spatialReference.isWebMercator&&(x=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*m.y/ne.$O.radius))));const S=Math.sqrt((Math.sqrt((t.x-m.x)**2+(t.y-m.y)**2)/x)**2+((t.z??0)-(t.elevation??0)-l)**2),T=90-180*Math.atan2(t.y-m.y,t.x-m.x)/Math.PI;let P=(Math.abs(T-v)>180?Math.abs(360-Math.abs(T-v)):Math.abs(T-v))/b;P=4*P+1;const A=180*Math.acos((s.cameraHeight-(t.z??0)+(t.elevation??0))/S)/Math.PI;let I=Math.abs(A-w)/M;I=4*I+1;let R=S/Math.sqrt(d**2+l**2);R=4*R+1;const C=n*P+a*I+o*R;let F;if(_){const e=c>180?c-360:c;F=n*((Math.abs(T-e)>180?Math.abs(360-Math.abs(T-e)):Math.abs(T-e))/h*4+1)+a*(Math.abs(A-u)/p*4+1)+o*R}else F=C;return{suitability:C,trueSuitability:F,feature:i,angle:g,distance:y,verticalAngle:Math.abs(180*Math.atan(y/l)/Math.PI)}}}(t,i,e.currentImage);return r.map(n)}function se(e,t){const r="isOblique"in e?e:new ee(e),{isOblique:i,isSpherical:n,isNadir:a}=r;return n?{hfovWeight:"2d"===t?0:1,vfovWeight:"2d"===t?0:.6,distanceWeight:"2d"===t?1:.5}:a?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:i?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}var le=r(7772),ce=r(48039),ue=r(90787),de=r(53890),he=r(74197),pe=r(24454),fe=r(83563),me=r(99071),ge=r(1217),ye=r(79984),ve=r(51232),we=r(29306),be=r(27811),Me=r(5606),_e=r(47848),xe=r(23060),Se=r(42761),Te=r(68312),Pe=r(41755),Ae=r(43879);let Ie=class extends(L.A.ClonableMixin(d.A)){constructor(e){super(e),this.maxFOV=0,this.minFOV=0,this.view=null,this.zoomFactor=5}get canZoomIn(){return!!this.view&&(0===this.minFOV||this.view.camera.fov>this.minFOV)}get canZoomOut(){return!!this.view&&(0===this.maxFOV||this.view.camera.fov<this.maxFOV)}};(0,i._)([(0,_.MZ)({type:Boolean,readOnly:!0})],Ie.prototype,"canZoomIn",null),(0,i._)([(0,_.MZ)({type:Boolean,readOnly:!0})],Ie.prototype,"canZoomOut",null),(0,i._)([(0,_.MZ)({type:Number})],Ie.prototype,"maxFOV",void 0),(0,i._)([(0,_.MZ)({type:Number})],Ie.prototype,"minFOV",void 0),(0,i._)([(0,_.MZ)()],Ie.prototype,"view",void 0),(0,i._)([(0,_.MZ)({type:Number})],Ie.prototype,"zoomFactor",void 0),Ie=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],Ie);const Re=Ie;var Ce=r(42813);let Fe=class extends Ce.default{constructor(e){super(e),this.panoramicZoomConditions=new Re,this.zoomTo=e=>{this.view.camera.fov=this.constrainFOV(e),this.view.camera=this.view.camera.clone()}}initialize(){this.addHandles([(0,w.watch)((()=>[this.view?.ready,this.panoramicZoomConditions]),(()=>{this.view?.ready&&(this.panoramicZoomConditions.view=this.view,this.zoomTo(this.view.camera.fov))}),w.syncAndInitial),(0,w.watch)((()=>[this.panoramicZoomConditions.maxFOV,this.panoramicZoomConditions.minFOV]),(e=>{let[t,r]=e;null!=t&&null!=r&&this.zoomTo(this.view.camera.fov)}),w.sync)])}get canZoomIn(){return this.panoramicZoomConditions.canZoomIn}get canZoomOut(){return this.panoramicZoomConditions.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._set("view",e)}constrainFOV(e){const{maxFOV:t,minFOV:r}=this.panoramicZoomConditions;return(0,f.qE)(e,r,t)}zoomIn(){if(!this.canZoomIn)return;const e=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}zoomOut(){if(!this.canZoomOut)return;const e=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}};(0,i._)([(0,_.MZ)()],Fe.prototype,"canZoomIn",null),(0,i._)([(0,_.MZ)()],Fe.prototype,"canZoomOut",null),(0,i._)([(0,_.MZ)({type:Re})],Fe.prototype,"panoramicZoomConditions",void 0),(0,i._)([(0,_.MZ)()],Fe.prototype,"state",null),(0,i._)([(0,_.MZ)()],Fe.prototype,"view",null),Fe=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Fe);const Oe=Fe;var Ne=r(26848),Ee=r(85016),De=r(81386),Ze=r(46144),ze=r(39677);function Le(e,t){return 2*(0,f.KJ)(Math.atan(Math.tan((0,f.kU)(e/2))*Math.sqrt(t**2+1)))}const ke="default",Ge="navigation",Ve="fov-constraint",je="image-click-action";let He=class extends u.A.EventedAccessor{constructor(e){super(e),this._startPosition=null,this._targetPosition=null,this._graphics=new D.default({elevationInfo:{mode:"relative-to-ground"}}),this._imageGraphic=null,this._loadController=null,this._map=new _e.default({ground:new Me.default({opacity:0,navigationConstraint:null}),layers:new s.default([this._graphics])}),this._zoomViewModel=null,this.autoLoad=!1,this.clickAction="none",this.imageSize=null,this.imageSource=null,this.pitch=90,this.state="ready",this.yaw=0,this._addNavigationHandles=()=>{this.imageRenderer.basemapTerrain.suspended=!0,this.imageRenderer.constraints.tilt.max=180,this.removeHandles(Ge),this.addHandles([this.imageRenderer.on("mouse-wheel",this._handleWheel),this.imageRenderer.on("double-click",this._handleDoubleClick),this.imageRenderer.on("drag",this._handleDrag),this.imageRenderer.on("key-down",(e=>{const t=e.key;["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t)&&e.stopPropagation()}))],Ge)},this._addHFOVHandles=()=>{this.removeHandles(Ve),this.addHandles((0,w.watch)((()=>[this.maxHFOV,this.minHFOV]),(()=>{this._zoomViewModel&&(this._zoomViewModel.panoramicZoomConditions=new Re({view:this.imageRenderer,maxFOV:this.maxHFOV,minFOV:this.minHFOV}))}),w.syncAndInitial),Ve)},this._addZoomHandles=()=>{this._zoomViewModel=new Oe({view:this.imageRenderer,panoramicZoomConditions:new Re({maxFOV:this.maxHFOV,minFOV:this.minHFOV})});const e=this.imageRenderer.ui.find("zoom");e&&(e.viewModel=this._zoomViewModel),this._addHFOVHandles()},this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._handleDoubleClick=e=>{e.stopPropagation(),e.native.ctrlKey?this._zoomOut():this._zoomIn()},this._handleDrag=e=>{e.stopPropagation();const{action:t,x:r,y:i}=e;switch(t){case"start":this._startPosition=this._targetPosition={x:r,y:i};break;case"update":this._targetPosition={x:r,y:i},this._updateCameraHeadingAndTilt()}},this._handleImageClick=e=>{if("image-loaded"===this.state&&this.imageRenderer.ready)switch(this.clickAction){case"emit":e.stopPropagation(),this.emit("click",e);break;case"hittest":e.stopPropagation(),e.async((async()=>{const t=await this.imageRenderer.hitTest(e.screenPoint,{include:this._graphics});this.emit("hittest-response",t)}));break;case"pixel-location":{if(e.stopPropagation(),!this.imageSize||!e.mapPoint)return void this.emit("pixel-location",null);const t=(0,Y.pq)(e.mapPoint,this.imageSize[0],this.imageSize[1]);this.emit("pixel-location",{...t,spatialReference:O.default.WebMercator});break}}},this._handleWheel=e=>{const t=e.deltaX??e.native.deltaX;e.stopPropagation(),t>0||e.deltaY>0?this._zoomOut():this._zoomIn()},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._zoomIn=()=>this._zoomViewModel?.zoomIn(),this._zoomOut=()=>this._zoomViewModel?.zoomOut(),this.addGraphic=(e,t)=>"image-loaded"===this.state&&!this._graphics.graphics.includes(e)&&(this._graphics.graphics.add(e,t),!0),this.addManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>!this._graphics.graphics.includes(e)));return this._graphics.graphics.addMany(t),!0},this.clearGraphics=()=>{this._graphics.graphics.removeAll()},this.clearImage=()=>{this.imageSize=null,this._removeImageSphere()},this.removeGraphic=e=>!("image-loaded"!==this.state||!this._graphics.graphics.includes(e))&&(this._graphics.remove(e),!0),this.removeManyGraphics=e=>{if("image-loaded"!==this.state)return!1;const t=e.filter((e=>this._graphics.graphics.includes(e)));return this._graphics.removeMany(t),!0},this._imageRenderer=new Te.default({map:this._map,viewingMode:"local",camera:{position:Ae.ZH},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:O.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,w.watch)((()=>this.imageSource),(()=>{this.imageSource&&this.autoLoad&&this._loadWithController()}),w.syncAndInitial),(0,w.watch)((()=>this.fov),(()=>{this._reloadCamera()}),w.syncAndInitial),(0,w.watch)((()=>this.yaw),(e=>{this.camera.heading=e,this._reloadCamera()}),w.syncAndInitial),(0,w.watch)((()=>this.pitch),(e=>{this.camera.tilt=e,this._reloadCamera()}),w.syncAndInitial),(0,w.when)((()=>this.imageRenderer.ready),(()=>{this._addNavigationHandles(),this._addZoomHandles()}),w.syncAndInitial),(0,w.watch)((()=>this.clickAction),(e=>{this.removeHandles(je),"none"!==e&&this.addHandles(this.imageRenderer.on("click",this._handleImageClick))}),w.syncAndInitial)],ke)}get camera(){return this.imageRenderer.camera}set camera(e){e&&(this.imageRenderer.camera=e.clone())}get fov(){return this.camera.fov}set fov(e){Number.isFinite(e)&&this._zoomViewModel?.zoomTo(e)}get hfov(){const{fov:e}=this.camera,{size:[t,r]}=this.imageRenderer,i=t/r,n=Math.atan(i);return 2*(0,f.KJ)(Math.atan(Math.tan((0,f.kU)(e/2))*Math.sin(n)))}get imageRenderer(){return this._imageRenderer}get maxHFOV(){const{size:[e,t]}=this.imageRenderer;return Le(Ae.EA,e/t)}get minHFOV(){const{size:[e,t]}=this.imageRenderer;return Le(Ae.li,e/t)}get vfov(){const{fov:e}=this.camera,{size:[t,r]}=this.imageRenderer,i=t/r,n=Math.atan(i);return 2*(0,f.KJ)(Math.atan(Math.tan((0,f.kU)(e/2))*Math.cos(n)))}async _loadImageInternal(e,t){let r;this.state="image-loading";try{r=(await(0,xe.default)(e,{responseType:"image",...t})).data}catch(i){throw(0,y.isAbortError)(i)?this.state="image-load-aborted":this.state="image-load-error",i}return this._updateImageSphere(r,t)}_reloadCamera(){this.camera=this.camera.clone()}_removeImageSphere(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=(0,m.pR)(this._imageGraphic)),this.state="ready",this.imageSize=null}_updateCameraHeadingAndTilt(){if(!this._startPosition||!this._targetPosition)return;const e=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(e+360)%360;const t=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,t)),this._startPosition=this._targetPosition}async _updateImageSphere(e,t){await(0,y.waitTick)(t);const{size:[r,i]}=this.imageRenderer;return this._imageGraphic=function(e){return new n.default({geometry:e,symbol:new ze.default({symbolLayers:new s.default([new Ze.default])})})}(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ae.ZH,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ae.vK;const i=t.clone();i.z=-500;const n=Ne.default.createSphere(i,{size:r,densificationFactor:2,vertexSpace:"georeferenced",material:new Ee.default({colorTexture:new De.default({data:e})})});if(n.components[0].trustSourceNormals=!0,n.vertexAttributes.uv){const e=n.vertexAttributes.uv.length??0;for(let t=0;t<e;t++)n.vertexAttributes.uv[2*t+0]=1-n.vertexAttributes.uv[2*t+0],n.vertexAttributes.uv[2*t+1]=n.vertexAttributes.uv[2*t+1]}return n.centerAt(i),n}(e)),this._graphics.add(this._imageGraphic),this.fov=Le(Ae.EF,r/i),this.state="image-loaded",this.imageSize=[e.width,e.height],this._imageGraphic.geometry}async loadImage(e){return this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,e):(0,Pe.EW)(this.declaredClass,new c.default((0,Pe.Fe)("panoramic-viewer"),(0,Pe.br)("PanoramicViewerViewModel","imageSource")))}};(0,i._)([(0,_.MZ)()],He.prototype,"_graphics",void 0),(0,i._)([(0,_.MZ)()],He.prototype,"_imageGraphic",void 0),(0,i._)([(0,_.MZ)()],He.prototype,"_imageRenderer",void 0),(0,i._)([(0,_.MZ)()],He.prototype,"_loadController",void 0),(0,i._)([(0,_.MZ)()],He.prototype,"_map",void 0),(0,i._)([(0,_.MZ)()],He.prototype,"_zoomViewModel",void 0),(0,i._)([(0,_.MZ)({type:Boolean})],He.prototype,"autoLoad",void 0),(0,i._)([(0,_.MZ)({type:we.default})],He.prototype,"camera",null),(0,i._)([(0,G.e)(new Se.J({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],He.prototype,"clickAction",void 0),(0,i._)([(0,_.MZ)({type:Number})],He.prototype,"fov",null),(0,i._)([(0,_.MZ)({readOnly:!0})],He.prototype,"hfov",null),(0,i._)([(0,_.MZ)({readOnly:!0})],He.prototype,"imageRenderer",null),(0,i._)([(0,_.MZ)()],He.prototype,"imageSize",void 0),(0,i._)([(0,_.MZ)()],He.prototype,"imageSource",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],He.prototype,"maxHFOV",null),(0,i._)([(0,_.MZ)({readOnly:!0})],He.prototype,"minHFOV",null),(0,i._)([(0,_.MZ)({type:Number})],He.prototype,"pitch",void 0),(0,i._)([(0,_.MZ)()],He.prototype,"state",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],He.prototype,"vfov",null),(0,i._)([(0,_.MZ)({type:Number})],He.prototype,"yaw",void 0),He=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],He);const Ue=He;var Be=r(50821),We=(r(17745),r(66201)),qe=r(87118);let $e=class extends be.default{constructor(e){super(e),this.viewModel=new Ue,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get camera(){return this.viewModel.camera}set camera(e){e&&(this.viewModel.camera=e)}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get fov(){return this.camera.fov}set fov(e){this.viewModel.fov=e}get hfov(){return this.viewModel.hfov}get icon(){return"i360-view"}set icon(e){this._overrideIfSome("icon",e)}get imageRenderer(){return this.viewModel.imageRenderer}get imageSize(){return this.viewModel.imageSize}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get pitch(){return this.viewModel.pitch}set pitch(e){this.viewModel.pitch=e}get state(){return this.viewModel.state}get vfov(){return this.viewModel.vfov}get yaw(){return this.viewModel.yaw}set yaw(e){this.viewModel.yaw=e}render(){return(0,qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(Be.D.widget,"esri-panoramic-viewer")})}};(0,i._)([(0,_.MZ)({type:Boolean})],$e.prototype,"autoLoad",null),(0,i._)([(0,_.MZ)({type:we.default})],$e.prototype,"camera",null),(0,i._)([(0,_.MZ)()],$e.prototype,"clickAction",null),(0,i._)([(0,_.MZ)({type:Number})],$e.prototype,"fov",null),(0,i._)([(0,_.MZ)({readOnly:!0,type:Number})],$e.prototype,"hfov",null),(0,i._)([(0,_.MZ)()],$e.prototype,"icon",null),(0,i._)([(0,_.MZ)({readOnly:!0})],$e.prototype,"imageRenderer",null),(0,i._)([(0,_.MZ)({readOnly:!0})],$e.prototype,"imageSize",null),(0,i._)([(0,_.MZ)()],$e.prototype,"imageSource",null),(0,i._)([(0,_.MZ)({type:Number})],$e.prototype,"pitch",null),(0,i._)([(0,_.MZ)({readOnly:!0})],$e.prototype,"state",null),(0,i._)([(0,_.MZ)({readOnly:!0,type:Number})],$e.prototype,"vfov",null),(0,i._)([(0,We.U)(["click","hittest-response","pixel-location"]),(0,_.MZ)({type:Ue})],$e.prototype,"viewModel",void 0),(0,i._)([(0,_.MZ)({type:Number})],$e.prototype,"yaw",null),$e=(0,i._)([(0,x.$)("esri.widgets.PanoramicViewer")],$e);const Je=$e;var Ye=r(15739),Ke=r(3835),Qe=r(59447),Xe=r(36338),et=r(57703),tt=r(12203),rt=r(60822),it=r(32203),nt=r(84766),at=r(75258),ot=r(4126),st=r(5077);const lt="click-handle",ct="enhancements-handle";let ut=class extends u.A.EventedAccessor{constructor(e){var t;super(e),t=this,this._imageChanged=!1,this._panConstraint=null,this._image=null,this._loadController=null,this._overlays=new D.default({blendMode:"source-atop"}),this._map=new _e.default,this.autoLoad=!1,this.clickAction="none",this.error=null,this.imageSource=null,this.imageRotation=0,this.state="ready",this._cancelLoadWithController=()=>{this._loadController?.abort(),this._loadController=null},this._createImageHandles=()=>{this.removeHandles(ct),this.addHandles((0,w.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(e=>{let[t,r,i]=e;this.image?.loaded&&(this.image.effect=`contrast(${10*(r+10)}%) brightness(${10*(t+10)}%)`,this.sharpenImage(this.image,i))}),w.syncAndInitial))},this._createPanConstraint=()=>{const{image:e,imageRenderer:t}=this,r=r=>{if(!(e&&t&&r.targetGeometry&&e.serviceRasterInfo))return r;const{extent:i}=e.serviceRasterInfo,{constraints:n,rotation:a,width:o,height:s}=t,{extent:l}=(0,rt.rotate)(R.default.fromExtent(i),a),{width:c,height:u}=l,d=r.targetGeometry.clone(),h=n.scaleToZoom(r.scale),p=1/2**h,f=o/s;let m=p*c,g=p*u;h&&(c/o>u/s?g=m/f:m=g*f);const y=l.clone();return y.xmin+=m/2,y.xmax-=m/2,y.ymin+=g/2,y.ymax-=g/2,r.targetGeometry=(0,rt.nearestCoordinate)(y,d).coordinate,this.state="image-loaded",r};return{constrain:r,applyPanConstraint:r}},this._createResizeHandles=e=>{e.removeHandles("resize"),e.addHandles((0,w.watch)((()=>{if(!this.imageRenderer.ready)return;const{extent:t}=e.serviceRasterInfo,{width:r,height:i,rotation:n}=this.imageRenderer,{extent:a}=(0,rt.rotate)(R.default.fromExtent(t),n),{width:o,height:s}=a;return Math.max(o/r,s/i)}),(e=>{if(!this.imageRenderer||null==e)return;const{constraints:t,scale:r,spatialReference:i}=this.imageRenderer,n=t.minScale,a=(0,st.fr)(i),o=.25*a,s=a*e;let l=s;const c=[];for(;l>o;)c.push(l),l/=2;c.push(l);const{lods:u}=ot.default.create({scales:c});if(t.set({minScale:s,lods:u}),this._imageChanged)return this.imageRenderer.scale=s,void(this._imageChanged=!1);this.imageRenderer.scale=Math.abs(r-n)<=1e-6?s:r}),w.syncAndInitial),"resize")},this._loadImageInternal=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.state="image-loading",t.clearImage(),t.error=null,t._imageChanged=!0;const i="string"==typeof e,n=i?void 0:e.datasetFormat,a=i?e:e.url,{customParameters:o,options:s}=r;return t._image=new it.default({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:n},url:a,customParameters:o}),t._image.when((async e=>{t._updatePanConstraint(),t._createResizeHandles(e),t._map.add(e),t.state="image-loaded"}),(r=>{(0,y.isAbortError)(r)?t.state="image-load-aborted":(t.state="image-load-error",t.error=r,p.A.getLogger(t).error(`error occurred while loading image ${i?e:JSON.stringify(e)}`,r),t.imageSource=null)})),t._image.load(s)},this._loadWithController=()=>{this._cancelLoadWithController(),this._loadController=new AbortController,this.loadImage(this._loadController)},this._updatePanConstraint=()=>{this._panConstraint&&this.imageRenderer.constraints.customConstraints.remove(this._panConstraint),this._panConstraint=this._createPanConstraint(),this.imageRenderer.constraints.customConstraints.add(this._panConstraint)},this.addGraphic=(e,t)=>{this._overlays.graphics.add(e,t)},this.addManyGraphics=e=>{this._overlays.addMany(e)},this.clearGraphics=()=>{this._overlays.graphics.removeAll()},this.clearImage=()=>{this.image&&(this._map.layers.remove(this.image),this._image=(0,m.pR)(this._image))},this.loadImage=e=>{const{customParameters:t,imageSource:r}=this;return r?this._loadImageInternal(r,{customParameters:t,options:e}):(0,Pe.EW)(this.declaredClass,new c.default((0,Pe.Fe)("image-viewer"),(0,Pe.br)("ImageViewerViewModel","imageSource")))},this.removeGraphic=e=>{this._overlays.remove(e)},this.removeManyGraphics=e=>{this._overlays.removeMany(e)},this._imageRenderer=new tt.default({constraints:{snapToZoom:!0,rotationEnabled:!1},map:this._map,popupEnabled:!1,spatialReference:O.default.WebMercator,ui:{components:["zoom"]}})}destroy(){this._imageRenderer.destroy()}initialize(){this.state="initialized",this.addHandles([(0,w.watch)((()=>this.imageSource),(e=>{e&&this.autoLoad&&this._loadWithController()}),w.syncAndInitial),(0,w.watch)((()=>this.image?.loaded),(()=>{this._createImageHandles()})),(0,w.watch)((()=>this.imageRotation),(()=>{this._rotateImage()})),(0,w.watch)((()=>this.imageRenderer.map),((e,t)=>{t?.layers.remove(this._overlays),e?.layers.add(this._overlays)}),w.initial),(0,w.watch)((()=>this.imageRenderer.map.allLayers.length),(e=>{e&&this.imageRenderer.map.layers.reorder(this._overlays,e-1)}),w.syncAndInitial),(0,w.watch)((()=>this.clickAction),(e=>{this.removeHandles(lt),"none"!==e&&this.addHandles(this.imageRenderer.on("click",(t=>{if(this.image?.loaded&&this.imageRenderer.ready)switch(e){case"emit":t.stopPropagation(),this.emit("click",t);break;case"hittest":t.stopPropagation(),t.async((async()=>{const e=await this.imageRenderer.hitTest(t.screenPoint,{include:this._overlays});this.emit("hittest-response",e)}));break;case"pixel-location":{if(t.stopPropagation(),!this.image?.serviceRasterInfo||!t.mapPoint)return void this.emit("pixel-location",null);const{extent:e,pixelSize:r}=this.image.serviceRasterInfo,i=(t.mapPoint.x-e.xmin)*r.x,n=(e.ymax-t.mapPoint.y)*r.y,a=new I.default({x:i,y:n,spatialReference:e.spatialReference});this.emit("pixel-location",a);break}}})))}),w.syncAndInitial)])}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",(0,f.qE)(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",(0,f.qE)(e,-10,10))}get image(){return this._image}get imagePointsInView(){const{extent:e,ready:t}=this.imageRenderer,r=this.imageRotation,i=this.image?.fullExtent,n=this.image?.serviceRasterInfo,a=!0===this._imageRenderer.allLayerViews.find((e=>{let{layer:t}=e;return t===this.image}))?.attached;if(!(t&&e&&i&&n&&a))return null;const o=(0,rt.rotate)(R.default.fromExtent(e),r),s=R.default.fromExtent(i),l=(0,rt.intersect)(o,s),{rings:c}=l;return c.flat().map((e=>{let[t,r]=e;return{x:(t-n.extent.xmin)*n.pixelSize.x,y:(n.extent.ymax-r)*n.pixelSize.y}}))}get imageSize(){const{image:e}=this;if(!e?.raster)return null;const{width:t,height:r}=e.raster.rasterInfo;return[t,r]}get imageRenderer(){return this._imageRenderer}get imageView(){return this.imageRenderer.allLayerViews.find((e=>e.layer===this.image))}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",(0,f.qE)(e,0,1))}_rotateImage(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}sharpenImage(e,t){if(!t)return void(e.rasterFunction=null);const r=[0,-1*t,0,-1*t,4*t+1,-1*t,0,-1*t,0],i=new nt.default({functionName:"Convolution",functionArguments:{type:at.convolutionKernel.userDefined,cols:3,rows:3,kernel:r,convolutionType:at.convolutionKernel.userDefined}});e.rasterFunction=i}};(0,i._)([(0,_.MZ)()],ut.prototype,"_image",void 0),(0,i._)([(0,_.MZ)()],ut.prototype,"_imageRenderer",void 0),(0,i._)([(0,_.MZ)()],ut.prototype,"_loadController",void 0),(0,i._)([(0,_.MZ)()],ut.prototype,"_overlays",void 0),(0,i._)([(0,_.MZ)()],ut.prototype,"_map",void 0),(0,i._)([(0,_.MZ)({type:Boolean})],ut.prototype,"autoLoad",void 0),(0,i._)([(0,_.MZ)({type:Number})],ut.prototype,"brightness",null),(0,i._)([(0,_.MZ)()],ut.prototype,"clickAction",void 0),(0,i._)([(0,_.MZ)({type:Number})],ut.prototype,"contrast",null),(0,i._)([(0,_.MZ)({type:Object})],ut.prototype,"customParameters",void 0),(0,i._)([(0,_.MZ)({type:c.default})],ut.prototype,"error",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"image",null),(0,i._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"imagePointsInView",null),(0,i._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"imageSize",null),(0,i._)([(0,_.MZ)({cast:Pe.mz})],ut.prototype,"imageSource",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],ut.prototype,"imageRenderer",null),(0,i._)([(0,_.MZ)({type:Number})],ut.prototype,"imageRotation",void 0),(0,i._)([(0,_.MZ)()],ut.prototype,"imageView",null),(0,i._)([(0,_.MZ)({type:Number})],ut.prototype,"sharpness",null),(0,i._)([(0,_.MZ)()],ut.prototype,"state",void 0),ut=(0,i._)([(0,x.$)("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],ut);const dt=ut;let ht=class extends be.default{constructor(){super(...arguments),this.viewModel=new dt,this._afterContainerCreate=e=>{this.imageRenderer.container=e},this.addGraphic=(e,t)=>{this.viewModel.addGraphic(e,t)},this.addManyGraphics=e=>{this.viewModel.addManyGraphics(e)},this.clearGraphics=()=>{this.viewModel.clearGraphics()},this.clearImage=()=>{this.viewModel.clearImage()},this.loadImage=async e=>this.viewModel.loadImage(e),this.removeGraphic=e=>{this.viewModel.removeGraphic(e)},this.removeManyGraphics=e=>{this.viewModel.removeManyGraphics(e)}}get autoLoad(){return this.viewModel.autoLoad}set autoLoad(e){this.viewModel.autoLoad=e}get brightness(){return this.viewModel.brightness}set brightness(e){this.viewModel.brightness=e}get clickAction(){return this.viewModel.clickAction}set clickAction(e){this.viewModel.clickAction=e}get contrast(){return this.viewModel.contrast}set contrast(e){this.viewModel.contrast=e}get customParameters(){return this.viewModel.customParameters}set customParameters(e){this.viewModel.customParameters=e}get error(){return this.viewModel.error}get imageSize(){const e=this.viewModel.image?.serviceRasterInfo;return e?[e.width,e.height]:[0,0]}get imagePointsInView(){return this.viewModel.imagePointsInView}get imageRenderer(){return this.viewModel.imageRenderer}get imageRotation(){return this.viewModel.imageRotation}set imageRotation(e){this.viewModel.imageRotation=e}get imageSource(){return this.viewModel.imageSource}set imageSource(e){this.viewModel.imageSource=e}get sharpness(){return this.viewModel.sharpness}set sharpness(e){this.viewModel.sharpness=e}get state(){return this.viewModel.state}render(){return(0,qe.K)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes(Be.D.widget,"esri-image-viewer")})}};(0,i._)([(0,_.MZ)({type:Boolean})],ht.prototype,"autoLoad",null),(0,i._)([(0,_.MZ)({type:Number}),(0,_.MZ)()],ht.prototype,"brightness",null),(0,i._)([(0,_.MZ)()],ht.prototype,"clickAction",null),(0,i._)([(0,_.MZ)({type:Number})],ht.prototype,"contrast",null),(0,i._)([(0,_.MZ)({type:Object})],ht.prototype,"customParameters",null),(0,i._)([(0,_.MZ)({readOnly:!0})],ht.prototype,"error",null),(0,i._)([(0,_.MZ)()],ht.prototype,"imageSize",null),(0,i._)([(0,_.MZ)({readOnly:!0})],ht.prototype,"imagePointsInView",null),(0,i._)([(0,_.MZ)({readOnly:!0,type:tt.default})],ht.prototype,"imageRenderer",null),(0,i._)([(0,_.MZ)()],ht.prototype,"imageRotation",null),(0,i._)([(0,_.MZ)()],ht.prototype,"imageSource",null),(0,i._)([(0,We.U)(["click","hittest-response","pixel-location"]),(0,_.MZ)({type:dt})],ht.prototype,"viewModel",void 0),(0,i._)([(0,_.MZ)({type:Number})],ht.prototype,"sharpness",null),(0,i._)([(0,_.MZ)({readOnly:!0})],ht.prototype,"state",null),ht=(0,i._)([(0,x.$)("esri.widgets.OrientedImageryViewer.components.ImageViewer")],ht);const pt=ht,ft="view-click",mt="image-click",gt="interaction-handles",yt=new Set(["JPG","JPEG"]),vt=/\.(\w+)$/,wt=()=>new c.default("orientedimageryviewer:sketch-not-initialized","Sketch property is not initialized, call loadSketch first");let bt=class extends(u.A.EventedMixin(g.A)){constructor(e){super(e),this.additionalFeatures=new s.default,this.additionalCameraLocations=new s.default,this.additionalFootprints=new s.default,this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.bestFeatureAngle=0,this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null,this.collectionId=null,this.conversionProps=null,this.coverageFrustums=new s.default,this.coveragePolygons=new s.default,this.currentBestFeature=null,this.currentBestFeatureLocation=null,this.currentCoverageVisible=!0,this.determineWorkflowForFeature=async(e,t,r)=>{const{currentBestFeature:i,selectedPoint:n,view:a}=this;if(a?.closePopup(),i&&n){this._initialCurrentCoverageUpdate=!0,this._updateGroundElevation=!0;try{await this._updatePointsAndPolygons(r),await this._loadImage(r)}catch(o){(0,y.isAbortError)(o)||(this.loadImageError(o),p.A.getLogger(this).error("#loadIImage()","error occured while loading image",o))}}},this.disabled=!1,this.displayMessage={key:"onLoadMessage",type:"info"},this.displayNewMeasurementButton=!0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.dataCaptureLayer=null,this.features=new s.default,this.groundCoordinates=null,this.heightMeasurementPixels=[],this.heightGraphic=null,this.heightMeasurementResult=0,this.heightMeasurementAccuracy=0,this.measurementAngle=null,this.tempDistance=null,this.imageGeometryField=null,this.imageLocationToolState=!1,this.isAdditionalCoverageVisible=!1,this.isAdditionalPointSourcesVisible=!1,this.layer=null,this.localPort=null,this.mapImageConversionToolState=!1,this.measureType=null,this.measurementGraphic=null,this.navigatorCurrentBestFeature=null,this.oiObjectIdField=null,this.overlayedCameraLocations=new s.default,this.overlayedMapFeatures=new v.A,this.pixelCoordinates=null,this.pointSources=new s.default,this.previousFeatureAngle=0,this.selectedPoint=null,this.shouldShowSelectedImage=!1,this.sketch=null,this.draw=null,this.sketchAdapter=null,this.updateFootprint=async(e,t)=>{"image-loaded"===this.state&&await(this._adapter?.updateFootprint(e,t))},this.updateFootprintPanorama=async(e,t)=>{await(this._adapter?.updateFootprintPanorama(e,t))},this._adapter=null,this._highlightedFeatureHandle=null,this._imageViewer=new pt,this._initialCurrentCoverageUpdate=!0,this._locationPointOnImage=null,this._overlays=new D.default({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"}}),this._panoramicViewer=new Je,this._previousCursor=null,this._referencePointOnGround=null,this._referencePointOnImage=null,this._sectorData=null,this._updatingHandles=new T.U,this._clickTask=null,this._crossSymbol=null,this.footprintExtent=null,this._featureChangedTask=null,this._openPopupTask=null,this._suitabilities=null,this._transformController=new AbortController,this._updateFootprintTask=null,this._updateGroundElevation=!1,this.hideImageGeometry=e=>{},this.highlight=e=>{if(!this._overlaysView)return;this.removeHighlight();const t=this.additionalFootprints.find((t=>{let{attributes:{imageID:r}}=t;return r===Number(e)}));this._highlightedFeatureHandle=t?this._overlaysView?.highlight(t):null},this.loadDataCaptureAdapter=async e=>{await this.loadSketch(e);const t=r.e(8671).then(r.bind(r,8671)),{default:i}=await t;return(0,y.throwIfAborted)(e),this.sketchAdapter=new i({viewModel:this}),this.sketchAdapter},this.loadImageFromSource=async(e,t)=>this._updatingHandles.addPromise(this._loadImageFromSourceInternal(e,t)),this.loadImageViewer=e=>{this._imageViewer.container=e},this.loadPanoramicViewer=e=>{this._panoramicViewer.container=e},this.removeHighlight=()=>this._highlightedFeatureHandle?.remove(),this.revealImageGeometry=e=>{},this.toggleImageAttributes=()=>{(0,m.DC)(this._openPopupTask),this._openPopupTask=(0,o.UT)((async e=>{const{currentBestFeature:t,popupEnabled:r,layer:i,view:a}=this;if(a?.closePopup(),!(a&&t&&r&&i))return;const{attributes:o,geometry:s}=t,l=new n.default({geometry:s,attributes:o.toJSON(),layer:i});(0,y.throwIfAborted)(e),await a.openPopup({features:[l],location:o.location.clone()})}))},this._createViewClickHandle=()=>{if(this.removeHandles(ft),"disabled"===this.state||null==this.view)return;const e=this.mapImageConversionToolState&&"image-loaded"===this.state?this._mapImageConversionToolViewClickHandler:this._viewClickHandler;this.addHandles(this.view.on("click",e,ve.o.WIDGET),ft)},this._createImageClickHandle=()=>{this.removeHandles(mt);const{mapImageConversionToolState:e,mode:t,activeViewer:r,currentBestFeature:i,footprintExtent:n}=this,a=r?.imageSize;if(!(e&&"none"!==t&&a&&n&&i))return;r.clickAction="pixel-location";let s=null;const l=(0,w.on)((()=>r),"pixel-location",(e=>{this.plotReferencePointOnImage(e),s?.abort(),s=(0,o.UT)((async r=>{if(!e)return;const n=await this.getMapPoint(e,{feature:i,imageSize:a,mode:t}).then((e=>{const t=this.view?.spatialReference;return(0,Y.or)(!t,e.spatialReference.equals(t))?e:(0,F.projectWithZConversion)(e,t)}));(0,y.throwIfAborted)(r),this.plotReferencePointOnGround(n)}))}));this.addHandles(l,mt)},this._createImageLocationHandle=()=>{this.removeHandles(mt);const{imageLocationToolState:e,mode:t,activeViewer:r,currentBestFeature:i,footprintExtent:n}=this,a=r?.imageSize;if(!(e&&"none"!==t&&a&&n&&i))return;r.clickAction="pixel-location";let s=null;const l=(0,w.on)((()=>r),"pixel-location",(e=>{this.pixelCoordinates=e,this.plotLocationPointOnImage(e),s?.abort(),s=(0,o.UT)((async r=>{if(!e)return;let n=await this.getMapPoint(e,{feature:i,imageSize:a,mode:t});(0,y.throwIfAborted)(r);const o=this.view?.spatialReference;o&&!n.spatialReference.equals(o)&&(n=await(0,F.projectWithZConversion)(n,o),(0,y.throwIfAborted)(r)),this.groundCoordinates=n}))}));this.addHandles(l,mt)},this._loadImage=async e=>{const{currentBestFeature:t,layer:r,mode:i}=this;if(this.clearGraphics(),!r||!t||"none"===i)return;const{attributes:n}=t,{imagePath:a,imageRotation:o,cameraHeading:s,cameraRoll:l,cameraPitch:c,objectId:u,cameraOrientation:d,location:h}=n,f=(l??0)+(o??0),m=h.spatialReference.isWGS84&&4!==d?.type?(0,E.geographicToWebMercator)(h):new I.default(h);let g=a;if((0,Qe.y0)(a))try{g=await(0,Qe.O_)(r,u,e)}catch(v){if((0,y.isAbortError)(v))return;return(0,Pe.NL)(v)?(p.A.getLogger(this).error(v),void this.setMessage("noAttachment","error",`${r.objectIdField}: ${u}`)):(p.A.getLogger(this).error(v,{[r.objectIdField]:u,layer:r}),void this.setMessage("imageLoadError","error",`query-attachments-failed:${r.objectIdField} ${u}`))}try{await this.loadImageFromSource(g,{imageRotation:f,options:e,pitch:c,yaw:s,mode:i,cameraLocation:m}),(0,y.throwIfAborted)(e),await this.transformAndPlotSelectedLocation(e)}catch(v){(0,y.isAbortError)(v)||this.loadImageError(v)}},this._loadImageFromSourceInternal=async(e,t)=>{const{mode:r,imageRotation:i,options:n}=t,a="string"==typeof e,o=a?e:e.url,{pathname:s,searchParams:l}=new URL(o);let c=a?s.match(vt)?.[1]:e.datasetFormat;if(!c)try{c=await(0,Pe.gt)(o,{...t.options})}catch(u){(0,y.isAbortError)(u)||p.A.getLogger(this).error("#getContentType()",u)}switch(c??="UNKNOWN FORMAT",r){case"default":this._imageViewer.imageSource={datasetFormat:c.toUpperCase(),url:o.split("?")[0]},this._imageViewer.customParameters=Object.fromEntries(l),this._imageViewer.imageRotation=i??0,await this._imageViewer.loadImage(n);break;case"panoramic":if(yt.has(c.toUpperCase())){const{selectedPoint:e}=this,{pitch:r,yaw:i,cameraLocation:a,viewAngle:s}=t;this._panoramicViewer.imageSource=o;let l=i??0;"number"==typeof s?l=s-l:a&&e&&(l=await(0,Y.ox)(a,e)-l),this._panoramicViewer.pitch=r??0,this._panoramicViewer.yaw=l,await this._panoramicViewer.loadImage(n)}else this.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:c})}},this._loadViewAdapter=async e=>{const{view:t}=this;if(t)switch(t.type){case"2d":{const{default:t}=await r.e(91191).then(r.bind(r,91191));(0,y.throwIfAborted)(e),this._adapter=new t(this);break}case"3d":{const{default:t}=await r.e(65393).then(r.bind(r,65393));(0,y.throwIfAborted)(e),this._adapter=new t(this);break}}else this._adapter=null},this._mapImageConversionToolViewClickHandler=e=>{e.stopPropagation(),e.preventDefault(),e.mapPoint&&this.plotMapPoint(e.mapPoint)},this._viewClickHandler=e=>{this._clickTask?.abort(),this._clickTask=(0,o.UT)((async t=>{const{pointerType:r,button:i,mapPoint:n}=e;if(("mouse"!==r||0===i)&&n)return e.stopPropagation(),e.preventDefault(),this._updatingHandles.addPromise(this.loadBestImage(n,{signal:t}))}))},this.plotSelectedPointOnImage=async(e,t)=>{if(await(0,y.waitTick)(t),!e)return;const r=new I.default({...d.A.isSerializable(e)?e.toJSON():e});if("default"===this.mode)r.x-=.5,r.y=.5-r.y,r.spatialReference=this._imageViewer.imageRenderer.spatialReference.clone(),this._crossSymbol=new n.default({geometry:r,symbol:et.pB}),this._imageViewer.addGraphic(this._crossSymbol,0);else if("panoramic"===this.mode){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[r,i]=t,{heading:a,pitch:o}=(0,Y.dM)(e,r,i),s=(0,Y.id)(a,o);this._crossSymbol=new n.default({geometry:new I.default(s,O.default.WebMercator),symbol:et.ov}),this._panoramicViewer.addGraphic(this._crossSymbol,0)}},this.handleSectorClick=this.handleSectorClick.bind(this),this.searchBestImage=this.searchBestImage.bind(this),this.transformAndPlotReferencePointOnImage=this.transformAndPlotReferencePointOnImage.bind(this),this.updateSuitabilities=this.updateSuitabilities.bind(this),this.selectBestFeature=this.selectBestFeature.bind(this)}initialize(){this.addHandles([(0,w.watch)((()=>this.view),(()=>{this.load()}),w.syncAndInitial),(0,w.watch)((()=>this.view?.map),((e,t)=>{t?.layers.remove(this._overlays),e?.layers.add(this._overlays)}),w.initial),(0,w.watch)((()=>this.view?.map?.allLayers?.length),(e=>{e&&this.view?.map?.layers.reorder(this._overlays,e-1)}),w.initial),(0,w.watch)((()=>[this.state,this.mapImageConversionToolState,this.view]),(()=>{this._createViewClickHandle(),this._createImageClickHandle()}),w.syncAndInitial),(0,w.watch)((()=>[this.state,this.imageLocationToolState,this.view]),(()=>{if(this._createImageLocationHandle(),!this.imageLocationToolState)return this.clearPreviousGroundLocation(),void this._resetCursor();this._setMeasurementCursor()}),w.syncAndInitial),(0,w.watch)((()=>this.measureType),(()=>{this.clearPreviousMeasurements()}),w.syncAndInitial),(0,w.watch)((()=>this.bestFeatureAngle),((e,t)=>{this.previousFeatureAngle=t??0}),w.syncAndInitial),(0,w.watch)((()=>this.currentBestFeature),(async(e,t)=>{(0,m.DC)(this._featureChangedTask),this._featureChangedTask=(0,o.UT)((async r=>this.determineWorkflowForFeature.apply(this,[e,t,{signal:r}]))),await this._featureChangedTask.promise}),{sync:!0}),(0,w.watch)((()=>this.mode),(e=>{switch(this.removeHandles(gt),e){case"default":this.addHandles((0,w.watch)((()=>{const{state:e}=this;return"image-loaded"===e?this._imageViewer.imagePointsInView:null}),(e=>{e&&((0,m.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,o.UT)((async t=>{await this.updateFootprint(e,{signal:t})})))}),{...w.syncAndInitial,equals:(e,t)=>(0,a.aI)(e,t,h.equalsShallow)}),gt);break;case"panoramic":this.addHandles((0,w.watch)((()=>{const{currentBestFeature:e,state:t}=this,{imageSize:r,vfov:i,hfov:n,pitch:a,yaw:o}=this._panoramicViewer;return e&&r&&!t.includes("loading")?[i,n,o,a]:null}),(e=>{if(!e||this.state.includes("loading"))return;const[t,r,i,n]=e;(0,m.DC)(this._updateFootprintTask),this._updateFootprintTask=(0,o.UT)((async e=>{await this.updateFootprintPanorama({verticalFieldOfView:t,horizontalFieldOfView:r,yaw:i,pitch:n},{signal:e})}))}),{...w.syncAndInitial,equals:(e,t)=>(0,a.aI)(e,t,h.equalsShallow)}),gt)}}),w.syncAndInitial),(0,w.watch)((()=>[this.brightness,this.contrast,this.sharpness]),(()=>{const{_imageViewer:e,brightness:t,contrast:r,mode:i,sharpness:n}=this;"default"===i&&(e.brightness=t,e.contrast=r,e.sharpness=n)}),w.syncAndInitial),(0,w.watch)((()=>this.activeViewer?.imageRenderer),(()=>{this.sketch&&(this.sketch.view=this.activeViewer?.imageRenderer)}))]),this.when().finally((()=>{this.notifyChange("state")}))}destroy(){this._updateFootprintTask=(0,m.DC)(this._updateFootprintTask),this._clickTask=(0,m.DC)(this._clickTask),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=(0,m.pR)(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint),this._crossSymbol=(0,m.pR)(this._crossSymbol),this._referencePointOnGround=(0,m.pR)(this._referencePointOnGround),this._referencePointOnImage=(0,m.pR)(this._referencePointOnImage),this._locationPointOnImage=(0,m.pR)(this._locationPointOnImage),this._overlays&&this.view?.map?.remove(this._overlays),this._overlays.destroy(),this._imageViewer.destroy(),this._panoramicViewer.destroy()}get activeLayer(){return(0,l.Lx)(p.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer}set activeLayer(e){(0,l.Lx)(p.A.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}get activeViewer(){const{_imageViewer:e,_panoramicViewer:t,mode:r}=this;switch(r){case"default":return e;case"panoramic":return t;default:return null}}get accuracyParametersMissing(){return this.layer?.orientationAccuracy?.every((e=>0===e))??!0}get brightness(){return this._get("brightness")??0}set brightness(e){this._set("brightness",(0,f.qE)(e,-10,10))}get contrast(){return this._get("contrast")??0}set contrast(e){this._set("contrast",(0,f.qE)(e,-10,10))}get featureCount(){return this.features?.length??0}get imageGalleryEnabled(){const{currentBestFeature:e}=this;if(!e)return!1;const t=e.attributes.imagePath?.trim();return(0,Pe._U)(t)||(0,Qe.y0)(t)}get imageLoaded(){return(0,l.Lx)(p.A.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),"image-loaded"===this.state}get invalidCameraHeading(){return this.currentBestFeature?.attributes?.cameraHeading===Ye.BH}get imagePointsInView(){const{mode:e,_imageViewer:t}=this;return"default"===e?t.imagePointsInView:null}get layerView(){const{layer:e,view:t}=this;if(e&&t)return t.allLayerViews.find((0,Pe.FL)(e))}get layerFloorFilterClause(){const{layerView:e}=this;return e?(0,fe.E)(e):null}get mode(){const e=this.currentBestFeature?.attributes;if(!e)return"none";const{horizontalFieldOfView:t,isSpherical:r}=e;return 360===t||r?"panoramic":"default"}get popupEnabled(){return!0===this.layer?.popupEnabled}get referencePoint(){return this._referencePointOnGround?.geometry}get sectorData(){const{_sectorData:e}=this;return e?Ye.PD.map((t=>e[t])):null}get sharpness(){return this._get("sharpness")??0}set sharpness(e){this._set("sharpness",(0,f.qE)(e,0,1))}get sketchGraphicsLayer(){return this.sketch?.layer}get state(){const{mode:e,disabled:t,_updatingHandles:{updating:r},_featureChangedTask:i}=this;if(t)return"disabled";if(!this.isFulfilled()||r||!1===i?.finished)return"loading";if(this.isRejected())return"error";if("error"===this.displayMessage?.type)return"image-load-error";switch(e){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state}return"ready"}get thumbnails(){const{features:e}=this;return e?new s.default(e.map((e=>{let{attributes:{imagePath:t,objectId:r,cameraRoll:i,imageRotation:n}}=e;const a=t?.trim();return(0,Pe._U)(a)||(0,Qe.y0)(a)?{url:a,objectId:r,rotation:(i??0)+(n??0)}:null})).filter(a.Ru)):null}set view(e){this._set("view",e)}get _sketchGraphicsLayer(){const{mode:e}=this;switch(e){case"panoramic":return new D.default({elevationInfo:{mode:"absolute-height"}});case"default":return new D.default;case"none":return}}get _overlaysView(){return this.view?.layerViews.find((e=>{let{layer:t}=e;return t===this._overlays}))}async computeHeight(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{currentBestFeature:i,activeViewer:n,layer:a,footprintExtent:o}=this,s=n?.imageSize,l=i?.attributes,c=a?.orientationAccuracy;if(!l||!s||!e||e.length<2||!c)return;const u="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,Y.Mm)(l,s[0],s[1]),d=e.at(0),h=e.at(-1);if(!(u&&d&&h&&c&&o))return;const p=[h,d],f=(0,Xe.$0)(p,!1),m="panoramic"===t?await(0,Xe.QI)(p,u,c,i,!0,!1):await(0,Xe.AX)(p,u,c,!0,r);if(!m)return;const g="panoramic"===t?await(0,Xe.bO)(c,f,u,m,i,!0):await(0,Xe.jr)(c,f,u,m,!0);return g?{value:m,accuracy:g}:{value:m}}async calculateAreaMeasurement(e,t,r){if(e.length<3||!this.currentBestFeature||!this.activeViewer?.imageSize||"none"===t)return null;const i="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,y.throwIfAborted)(r),i?"default"===t?await(0,Xe.Md)(e,i,!0):await(0,Xe.yP)(e,i,!0,r):null}async calculateDistanceMeasurement(e,t,r){const{currentBestFeature:i,activeViewer:n}=this;if(e.length<2||!i||!n?.imageSize||"none"===t)return null;const a="default"===t?await this.getMeasurementProperties():await this.getMeasurementPropertiesPanoramic();return(0,y.throwIfAborted)(r),a?"default"===t?await(0,Xe.CN)([e.at(0),e.at(-1)],a,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],a,!0):null}async calculateAccuracy(e,t,r){const{layer:i,currentBestFeature:n,activeViewer:a}=this,o=i?.orientationAccuracy,s=o?.every((e=>0===e))||!o?.length;if("area"===t&&e.length<3||"distance"===t&&e.length<2||!n||!a?.imageSize||s)return null;const l=await this.getMeasurementProperties();if((0,y.throwIfAborted)(r),!l)return null;const c="area"===t?await(0,Xe.Md)(e,l,!0):await(0,Xe.CN)([e.at(0),e.at(-1)],l,!0);(0,y.throwIfAborted)(r);const{updateElevationProps:u,...d}=l,h=(0,Xe.gO)(d,o);if(!h?.length)return null;const p=h.map((e=>({...e,updateElevationProps:u}))).map((async i=>{const n="area"===t?await(0,Xe.Md)(e,i,!0):await(0,Xe.CN)([e.at(0),e.at(-1)],i,!0);if((0,y.throwIfAborted)(r),n&&c){if("area"===t){const e="number"!=typeof n?n.area:null;return e?Math.abs(e-c.area):null}return Math.abs(n-c)}return null})),f=await Promise.all(p);(0,y.throwIfAborted)(r);const m=f.filter((e=>null!==e));return 0===m.length?null:(0,Xe.WB)(m)}async calculateAccuracyPanoramic(e,t,r){const{layer:i,currentBestFeature:n,activeViewer:a,mode:o}=this,s=i?.orientationAccuracy,l=s?.every((e=>0===e))||!s?.length;if("area"===t&&e.length<3||"distance"===t&&e.length<2||!n||!a?.imageSize||l||"panoramic"!==o)return null;const c=await this.getMeasurementPropertiesPanoramic();if((0,y.throwIfAborted)(r),!c)return null;const u="area"===t?await(0,Xe.yP)(e,c,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],c,!0);(0,y.throwIfAborted)(r);const{updateElevationProps:d,...h}=c,p=(0,Xe.cG)(h,s);if(!p?.length)return null;const f=p.map((e=>({...e,updateElevationProps:d}))).map((async i=>{const n="area"===t?await(0,Xe.yP)(e,i,!0):await(0,Xe.QV)([e.at(0),e.at(-1)],i,!0);if((0,y.throwIfAborted)(r),n&&u){if("area"===t){const e="number"!=typeof n?n.area:null;return e?Math.abs(e-u.area):null}return Math.abs(n-u)}return null})),m=await Promise.all(f);(0,y.throwIfAborted)(r);const g=m.filter((e=>null!==e));return 0===g.length?null:(0,Xe.WB)(g)}async calculateHeightMeasurementInfo(e,t,r){const{currentBestFeature:i,activeViewer:n}=this,a=n?.imageSize;if(!i||!n||!a?.length||"none"===t)return;const{attributes:o}=i,[s]=(0,Xe.$0)([e],"panoramic"!==t),l="panoramic"===t?await this.getMeasurementPropertiesPanoramic():(0,Y.Mm)(o,a[0],a[1]);if("panoramic"===t){if(!l)return;const e=await(0,Xe.Z9)(s,l,i,r);if(!e)return;e?.heading>180&&(e.heading-=360);const t=(0,Xe.mf)(s,e),n=(0,S.Io)([s.x,s.y],[e.x,e.y]);if(!t||!n)return;return{measurementAngle:t,tempDistance:n}}const c=await(0,Xe._I)(s,l,r);if(!c)return;const u=(0,Xe.Qu)(s,c),d=(0,S.Io)([s.x,s.y],[c.x,c.y]);return u&&d?{measurementAngle:u,tempDistance:d}:void 0}clearPreviousMeasurements(){this.clearMeasurementGraphics(),this.resetMeasurementData(),this.stopMeasurement()}clearPreviousGroundLocation(){this.groundCoordinates=null,this.pixelCoordinates=null,this.clearLocationPointOnImage()}clearMeasurementGraphics(){this.measurementGraphic&&(this.activeViewer?.removeGraphic(this.measurementGraphic),this.measurementGraphic=null),this.heightGraphic&&(this.activeViewer?.removeGraphic(this.heightGraphic),this.heightGraphic=null)}digitizeCancel(){return this.sketch?.cancel()}digitizeCanRedo(){return this.sketch?.canRedo()??!1}digitizeCanUndo(){return this.sketch?.canUndo()??!1}digitizeComplete(){return this.sketch?.complete()}async digitizeCreate(e,t){const{sketch:r,dataCaptureLayer:i}=this;if(!r)throw wt();(0,Ke.DV)(i,e,r),await r.create(e,{...t,defaultZ:0})}async digitizeDelete(){if(!this.sketch)throw wt();return this.sketch.delete()}digitizeDuplicate(){if(!this.sketch)throw wt();return this.sketch.duplicate()}digitizePlace(e,t){if(!this.sketch)throw wt();return this.sketch.place(e,t)}digitizeRedo(){if(!this.sketch)throw wt();return this.sketch.redo()}digitizeUndo(){if(!this.sketch)throw wt();return this.sketch.undo()}digitizeUpdate(e,t){if(!this.sketch)throw wt();return this.sketch.update(e,t)}async displayHeightResults(){const{currentBestFeature:e,activeViewer:t,heightMeasurementPixels:r,mode:i}=this,n=t?.imageSize,a=e?.attributes;if(!a||!n)return;const o=await this.computeHeight(r,i);o?.value&&o?.accuracy&&(this.heightMeasurementResult=o.value,this.heightMeasurementAccuracy=o.accuracy)}filterByFootprints(e,t){const r=[],i=[],n=[];return e.forEach((e=>{const{layer:{coveragePercent:a},attributes:o}=e;let s;const l=(0,M.GA)(e.geometry.spatialReference);o.cameraHeight/=l,o.farDistance/=l,o.nearDistance/=l,(0,ce.E1)(o.elevationSource)&&(o.elevationSource.constantElevation/=l);const{polygon:c,frustum:u}=(0,le.ns)(o);if(s=c.clone(),o.isInspection&&(s=(0,le.nt)(o)),a&&(s=(0,le.v3)(s,a)),(0,le.Eh)(s,t)){n.push(e);const{geometry:t,objectId:a,cameraHeight:s,cameraHeading:l}=o,d=t.clone();d.z=s,d.imageID=a,this.pointSources.push(d),l!==Ye.BH&&(r.push(c),u&&i.push(u))}})),{features:n,polygons:r,frustums:i}}getMeasurementProperties(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!t?.imageSize)return;const{elevationSample:r,attributes:i}=e,{elevationSource:n,cameraHeight:a}=i,o=(0,Y.Mm)(i,t.imageSize[0],t.imageSize[1]);let s=o.cameraLocation;return(s.spatialReference.isGeographic?(0,F.projectWithZConversion)(s,O.default.WebMercator):Promise.resolve(s)).then((e=>(s=e,(0,Y.Ns)((s.z??0)-a,{elevationSample:r,elevationSource:n,extent:this.footprintExtent})))).then((t=>("elevationSample"in t&&(0,Y.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),{...o,cameraLocation:s,updateElevationProps:t})))}getMeasurementPropertiesPanoramic(){const{currentBestFeature:e,activeViewer:t}=this;if(!e||!t?.imageSize)return;const{elevationSample:r,attributes:i}=e,{elevationSource:n,cameraHeight:a}=i,o=(0,Y.m0)(i,t.imageSize[0],t.imageSize[1]);let s=o.cameraLocation;return(s.spatialReference.isGeographic?(0,F.projectWithZConversion)(s,O.default.WebMercator):Promise.resolve(s)).then((e=>(s=e,(0,Y.Ns)((s.z??0)-a,{elevationSample:r,elevationSource:n,extent:this.footprintExtent})))).then((t=>("elevationSample"in t&&(0,Y.sp)(t.elevationSample)&&(e.elevationSample=t.elevationSample),{...o,cameraLocation:s,updateElevationProps:t})))}async deleteDataCaptureFeatures(e){const{dataCaptureLayer:t}=this;if(!t)throw new c.default("Data capture layer is not available");return t.queryFeatures({objectIds:e}).then((e=>{let{features:r}=e;return t.applyEdits({deleteFeatures:r})}))}handleSectorClick(e){if(isNaN(e))return;const t=this._sectorData?.[Ye.PD[e]];t?.length&&this._updateCurrentBestFeature(t.at(0))}handleFeatureClick(e){const{sector:t,featureIndexInSector:r}=e;if(isNaN(r))return;const i=this._sectorData?.[t];i?.length&&this._updateCurrentBestFeature(i.at(r))}handleDrawCursorUpdateEvents(e){const{measurementAngle:t,tempDistance:r,heightMeasurementPixels:i,mode:n,activeViewer:a}=this,o=a?.imageSize;if(!e.vertices||!o)return;const s=(0,Xe.Fj)(e.vertices.at(-1),n,o);if(i.length<1||!s||!r||!t||"none"===n)return;const l=(0,Xe.AG)(i[0],s,t);if(!l?.length)return;this.heightMeasurementPixels.push(l),"panoramic"===n?this.createPolylineGraphicPano():this.createPolylineGraphic();const c=(0,Xe.eY)(this.heightMeasurementPixels,r);c&&(this.heightMeasurementResult=c)}async handleDrawVertexAddEvents(e,t){const{currentBestFeature:r,activeViewer:i,heightMeasurementPixels:n,mode:a}=this;if(!r||!i||!e.vertices?.length||"none"===a)return;const o=i?.imageSize;if(!n.length&&o){const r=(0,Xe.Fj)(e.vertices.at(-1),a,o);this.heightMeasurementPixels.push(r);const i=await this.calculateHeightMeasurementInfo(r,a,t);if(!i?.measurementAngle||!i?.tempDistance)return;this.measurementAngle=i.measurementAngle,this.tempDistance=i.tempDistance}}async load(e){return this.addResolvingPromise(this._loadViewAdapter(e).catch((e=>{if(!(0,y.isAbortError)(e))throw e}))),this}async loadBestImage(e,t){return this.view?.closePopup(),this.displayMessage=null,this.clearPreviousGroundLocation(),this.imageLocationToolState=!1,this.selectedPoint=e.spatialReference.isGeographic?(0,E.geographicToWebMercator)(e):e.clone(),this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint),this._overlays?.removeAll(),this._fetchFeaturesWithController(e,t)}loadImageError(e){p.A.getLogger(this).error("oriented-imagery-viewer:load-image",e),this.setMessage("imageLoadError","error",e.message)}async loadSketch(e){if(!this.sketch){const t=Promise.all([r.e(62791),r.e(17577)]).then(r.bind(r,17577)),{default:i}=await t;(0,y.throwIfAborted)(e),this.sketch=new i({layer:this._sketchGraphicsLayer,view:this.activeViewer?.imageRenderer,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{edgeOperation:"none",shapeOperation:"none",vertexOperation:void 0},enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"transform"}})}return this.sketch}async loadMeasurementAdapter(e){if(!this.sketchAdapter){const t=r.e(69445).then(r.bind(r,69445)),{default:i}=await t;if((0,y.throwIfAborted)(e),this.sketchAdapter=new i({viewModel:this}),!this.sketchAdapter.viewModel.isResolved())return}return this.sketchAdapter}async startMeasurement(e,t){await this.loadSketch(t),await this.loadMeasurementAdapter(t);const{sketch:r,sketchAdapter:i,activeViewer:n,mode:a}=this;if(!r||!i||!n||"none"===a)return;if(this.displayNewMeasurementButton=!1,"panoramic"===a&&(r.defaultCreateOptions.defaultZ=0),await r.create(e),"panoramic"===a){const{drawOperation:e}=r.view.activeTool;e.constraintsEnabled=!1,e._set("elevationDrawSurface",null)}const o=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;o&&this.sketch&&(this.sketch.polygonSymbol=(0,et.fg)(o),this.sketch.polylineSymbol="panoramic"===a?et.Tu:(0,et.Jb)(o))}startHeightMeasurement(){this.heightMeasurementPixels=[],this.displayNewMeasurementButton=!1,this.draw??=new ge.default({view:this.activeViewer?.imageRenderer}),this.draw.create("polyline").on(["cursor-update","vertex-add","draw-complete"],(e=>this.handleDrawEvents(e)))}createPolylineGraphic(){const e=[this.heightMeasurementPixels[0],this.heightMeasurementPixels.at(-1)],t=this.activeViewer?.imageRenderer.spatialReference;if(this.heightGraphic)this.heightGraphic.geometry=new C.default({paths:[e],spatialReference:t});else{const r=new C.default({paths:[e],spatialReference:t}),i=this.activeViewer?.imageRenderer.effectiveTheme.accentColor;this.heightGraphic=new n.default({geometry:r,symbol:(0,et.Jb)(i,2.5)}),this.activeViewer?.addGraphic(this.heightGraphic)}}createPolylineGraphicPano(){const e=this.activeViewer?.imageRenderer.spatialReference,t=this.activeViewer?.imageSize;if(!t)return;const r={x:this.heightMeasurementPixels[0][0],y:this.heightMeasurementPixels[0][1]},i={x:this.heightMeasurementPixels.at(-1)[0],y:this.heightMeasurementPixels.at(-1)[1]},{heading:a,pitch:o}=(0,Y.dM)(r,t[0],t[1]),{heading:s,pitch:l}=(0,Y.dM)(i,t[0],t[1]),c=[[...(0,Y.id)(a,o)],[...(0,Y.id)(s,l)]];if(this.heightGraphic)this.heightGraphic.geometry=new C.default({paths:[c],spatialReference:e});else{const t=new C.default({paths:[c],spatialReference:e});this.heightGraphic=new n.default({geometry:t,symbol:et.Tu}),this._panoramicViewer.addGraphic(this.heightGraphic,0)}}async handleDrawEvents(e,t){if(this.draw)switch(e.type){case"cursor-update":this.handleDrawCursorUpdateEvents(e);break;case"vertex-add":this.handleDrawVertexAddEvents(e,t);break;case"draw-complete":await this.displayHeightResults()}}initializeMeasurement(e){switch(this.clearMeasurementGraphics(),this.resetMeasurementData(),e){case"distance":this.startMeasurement("polyline");break;case"area":this.startMeasurement("polygon");break;case"height":this.startHeightMeasurement()}}async overlayCameraLocations(e){const{activeViewer:t,currentBestFeature:r,overlayedCameraLocations:i,layer:a,mode:o,state:s}=this,l=t?.imageSize;if(!l||!r||!a||"none"===o||s.includes("loading"))return;const{polygon:c}=(0,le.ns)(r.attributes);if(t.removeManyGraphics(i.toArray()),i.removeAll(),e){const{features:e}=await a.queryFeatures({where:`${a.objectIdField} <> ${r.attributes.objectId}`,geometry:c,returnGeometry:!0,outFields:[a.objectIdField]}),s=await Promise.all(e.map((async e=>{const{attributes:t,geometry:i}=e,a=await this.getPixels(i,{feature:r,imageSize:l,mode:o}),s=et.at.clone();return s.outline=new me.default({color:[0,0,0],width:1}),new n.default({attributes:t,symbol:s,geometry:a})})));i.addMany(s),t.addManyGraphics(i.toArray())}}overlayGraphicsOnImage(e,t){this.removeOverlayedGraphicsOnImage(e),this.overlayedMapFeatures.set(e,t),this.activeViewer?.addManyGraphics(t.toArray())}async overlayMapFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{activeViewer:r,currentBestFeature:i,mode:o,state:l,layer:c}=this,u=r?.imageSize;if(!u||!i||"none"===o||l.includes("loading")||!c)return;const{polygon:d}=(0,le.ns)(i.attributes);try{const{imageGeometryField:t,oiObjectIdField:r}=(0,Ke.Qv)(e,c.imageGeometryField,c.imageReferenceField);this.imageGeometryField=t.name,this.oiObjectIdField=r.name}catch(m){p.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features",m)}const{features:h}=await e.queryFeatures({geometry:d,returnGeometry:!0,outFields:["*"]}),f=new s.default((await Promise.all(h.map((async r=>{const a=r.symbol?.clone()??e.renderer?.getSymbol(r)?.clone(),{attributes:s,geometry:l}=r,c=l,{imageGeometryField:d,oiObjectIdField:h}=this;if(d&&h&&(0,Ke.gE)(e,d,h)&&`${s[h]}`==`${i.attributes.objectId}`)try{return(0,Ke.jQ)(s,d,e,t,u,o,a)}catch(m){p.A.getLogger(this).warn("oriented-imagery-viewer:overlay-map-features","couldn't create graphic from attributes, geometry will be used",{error:m,feature:r,layer:e,imageGeometryField:this.imageGeometryField,imageReferenceField:this.oiObjectIdField})}switch(c?.type){case"point":{const r=await this.getPixels(c,{feature:i,imageSize:u,mode:o});return new n.default({attributes:s,layer:e,symbol:a,geometry:r,visible:e.visible&&t})}case"polygon":{const{rings:r,spatialReference:l}=c,d=r.map((e=>e.map((e=>{let[t,r,i]=e;return new I.default({x:t,y:r,z:i,spatialReference:l})})))),h=await Promise.all(d.map((async e=>this.getPixels(e,{feature:i,imageSize:u,mode:o}).then((e=>e.map(Y.n3))))));return new n.default({attributes:s,layer:e,symbol:a,geometry:new R.default({rings:h,spatialReference:O.default.WebMercator}),visible:e.visible&&t})}case"polyline":{const{paths:r,spatialReference:l}=c,d=r.map((e=>e.map((e=>{let[t,r,i]=e;return new I.default({x:t,y:r,z:i,spatialReference:l})})))),h=await Promise.all(d.map((async e=>this.getPixels(e,{feature:i,imageSize:u,mode:o}).then((e=>e.map(Y.n3))))));return new n.default({attributes:s,layer:e,symbol:a,geometry:new C.default({paths:h,spatialReference:O.default.WebMercator}),visible:e.visible&&t})}case"multipoint":{const{points:r,spatialReference:l}=c,d=r.map((e=>{let[t,r,i]=e;return new I.default({x:t,y:r,z:i,spatialReference:l})})),h=await this.getPixels(d,{feature:i,imageSize:u,mode:o}).then((e=>e.map(Y.n3)));return new n.default({attributes:s,layer:e,symbol:a,geometry:new A.default({points:h,spatialReference:O.default.WebMercator}),visible:e.visible&&t})}}return null})))).filter(a.Ru));this.overlayGraphicsOnImage(`${e.id}`,f)}async getPixels(e,t){const{imageSize:r,mode:i}=t,n=(await this.worldToImage(Array.isArray(e)?e:[e])).map((e=>{if("default"===i)return new I.default({x:e.x-.5,y:.5-e.y,spatialReference:O.default.WebMercator});const[t,n]=r,{heading:a,pitch:o}=(0,Y.dM)(e,t,n),s=(0,Y.id)(a,o);return new I.default(s,O.default.WebMercator)}));return Array.isArray(e)?n:n[0]}async getMapPoint(e,t){const{feature:r,mode:i,imageSize:n}=t,{elevationSample:a,attributes:o}=r,{elevationSource:s,location:l,elevation:c,cameraHeight:u}=o;let d=l.clone();d.spatialReference.isGeographic&&(d=await(0,F.projectWithZConversion)(d,O.default.WebMercator));const h=await(0,Y.Ns)(c??(l.z??0)-u,{elevationSample:a,elevationSource:s,extent:this.footprintExtent});let p;if("elevationSample"in h&&(0,Y.sp)(h.elevationSample)&&(r.elevationSample=h.elevationSample),"default"===i){const t=(0,Y.Mm)(o,n[0],n[1]);p=await(0,ue.imageToWorld)(Array.isArray(e)?e:[e],{...t,cameraLocation:d},h)}else{const t=(0,Y.m0)(o,n[0],n[1]);p=await(0,ue.imageToWorldPanoramic)(Array.isArray(e)?e:[e],{...t,cameraLocation:d},h)}return Array.isArray(e)?p:p[0]}async plotMapPoint(e){return this.plotReferencePoint(e),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:e,options:{signal:this._transformController?.signal}})}plotReferencePointOnGround(e){this._referencePointOnGround&&(this._overlays?.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),null!=e&&(this._referencePointOnGround=new n.default({geometry:new I.default({...e.toJSON()}),symbol:et.FT}),this.view?this._overlays?.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:this._referencePointOnGround?.geometry}}))}plotReferencePointOnImage(e){if("image-loaded"===this.state)switch(this.clearReferencePointOnImage(),this.mode){case"default":{const t=d.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._referencePointOnImage=new n.default({geometry:new I.default({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:et.FT}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break}case"panoramic":{const{imageSize:t}=this._panoramicViewer;if(!t)return;const[r,i]=t,{heading:a,pitch:o}=(0,Y.dM)(e,r,i),s=(0,Y.id)(a,o);this._referencePointOnImage=new n.default({geometry:new I.default(s,O.default.WebMercator),symbol:et.IL}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0);break}}}plotLocationPointOnImage(e){if("image-loaded"===this.state)switch(this.clearLocationPointOnImage(),this.mode){case"default":this._plotLocationPointOnDefaultImage(e);break;case"panoramic":this._plotLocationPointOnPanoramicImage(e)}}removeAllOverlayMapFeatures(){this.overlayedMapFeatures.forEach((e=>{this._imageViewer.removeManyGraphics(e.toArray())})),this.overlayedMapFeatures.clear()}removeOverlayedGraphicsOnImage(e){const t=this.overlayedMapFeatures.get(e);t?.length&&(this.activeViewer?.removeManyGraphics(t.toArray()),this.overlayedMapFeatures.delete(e))}resetImage(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._clickTask=(0,m.DC)(this._clickTask)}resetMeasurementData(){this.areaMeasurementResult=0,this.areaMeasurementAccuracy=0,this.distanceMeasurementResult=0,this.distanceAccuracyArray=[],this.heightMeasurementPixels=[],this.heightMeasurementResult=0,this.tempDistance=null,this.measurementAngle=null,this.heightMeasurementAccuracy=0,this.heightGraphic=null}async saveDrawing(){const{dataCaptureLayer:e,sketchAdapter:t}=this;if(!e||"data-capture"!==t?.type)return;const{pendingGraphics:r,savedGraphics:i}=t,n=r.get(e.id),a=n?.toArray();if(!n||!a?.length)return;const{addFeatureResults:o}=await this.saveDataCaptureFeatures(a),s=o.reduce(((t,r,i)=>{let{objectId:n,globalId:o,error:s}=r;const l=a[i],{attributes:c}=l;return s?t.error.push(l):(n&&(c[e.objectIdField]=n),o&&e.globalIdField&&(c[e.globalIdField]=o),t.success.push(l)),t}),{success:[],error:[]});i.addMany(s.success),n.removeAll(),n.addMany(s.error)}async saveDataCaptureFeatures(e){const{activeViewer:t,currentBestFeature:i,dataCaptureLayer:n,mode:o}=this,s=t?.imageSize;if(!s||!i||"none"===o)throw new c.default("Image size, current best feature and mode are required to save data capture features");if(!n)throw new c.default("Data capture layer is not available");const l=await Promise.all(e.map((async e=>{const t=e.clone(),{geometry:a}=t;if(!a)return;const l=a.type,c=n.hasZ,u=n.geometryType,d=l!==u,h=d?await r.e(28148).then(r.bind(r,28148)):null,p=h?.default[u],f=d?p?.(a):a;if(f)switch(f.type){case"point":return t.geometry=await this.getMapPoint((0,Y.Dy)(o,f,s),{feature:i,imageSize:s,mode:o}),c||(delete t.geometry.z,t.geometry.hasZ=!1),t.geometry.hasM=!1,t;case"polygon":{const e=await Promise.all(f.rings.map((async e=>this.getMapPoint(e.map((e=>{let[t,r,i]=e;return(0,Y.Dy)(o,{x:t,y:r,z:i},s)})),{feature:i,imageSize:s,mode:o}))));return t.geometry=new R.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,rings:e.map((e=>e.map(Y.n3)))}),t}case"polyline":{const e=await Promise.all(f.paths.map((async e=>this.getMapPoint(e.map((e=>{let[t,r,i]=e;return(0,Y.Dy)(o,{x:t,y:r,z:i},s)})),{feature:i,imageSize:s,mode:o}))));return t.geometry=new C.default({spatialReference:e[0][0].spatialReference,hasZ:c,hasM:!1,paths:e.map((e=>e.map(Y.n3)))}),t}}}))),u=l.filter(a.Ru);return n.applyEdits({addFeatures:u}).then((e=>{const{addFeatureResults:t}=e;let r=0;const i=l.map((e=>{const i=t[r++];return e?i:{error:new c.default("Error in saving data capture features"),objectId:null,globalId:null}}));return{...e,addFeatureResults:i}}))}async searchBestImage(e,t){try{const r=await ie(e,t);r&&await this._processFeatureResponse(r,e.point,{signal:t?.signal})}catch(r){(0,y.isAbortError)(r)||(this.setMessage("imageLoadError","error",r.message),p.A.getLogger(this).error("error occurred while finding best image",r))}}selectBestFeature(e){this.currentBestFeature=this.features?.find((t=>{let{attributes:r}=t;return r.objectId===Number(e)}))}setAdditionalCameraLocationsVisibility(e){this.additionalCameraLocations.forEach((t=>{t.visible=e}))}setAdditionalCoverageVisibility(e){this.additionalFootprints.forEach((t=>{t.visible=e}))}setCurrentCoverageVisibility(e){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=e),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=e)}setMapImageConversionToolState(e){this.mapImageConversionToolState=e}async startDataCapture(e,t){const r=this.activeViewer?.imageRenderer,{oiObjectIdField:i,currentBestFeature:n}=this;if(!r||!n||!i)return;const{attributes:{objectId:a}}=n,o=this.overlayedMapFeatures.get(e.id)?.toArray()??[],l=[],c=[];for(const s of o)`${s.getAttribute(i)}`==`${a}`?l.push(s):c.push(s);this.overlayGraphicsOnImage(e.id,new s.default(c)),this.collectionId=e.id;const u=await this.loadSketch(t),d=await this.loadDataCaptureAdapter(t);(0,y.throwIfAborted)(t),u.layer.addMany(l),u.layer.blendMode="source-atop",d.savedGraphics.addMany(l),r.ui.find("zoom").visible=!1,r.map.layers.add(this.sketchGraphicsLayer)}async stopDataCapture(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.sketch?.cancel(),this.sketchGraphicsLayer?.removeAll(),this.sketchAdapter=(0,m.pR)(this.sketchAdapter),this.sketch=(0,m.pR)(this.sketch),this.collectionId=null;const{dataCaptureLayer:t}=this,r=this.activeViewer?.imageRenderer;if(!r||r.destroyed)return;r.map.layers.remove(this.sketchGraphicsLayer),e&&t&&await this.overlayMapFeatures(t,!0);const i=r.ui.find("zoom");i&&(i.visible=!0)}stopMeasurement(){this.heightMeasurementPixels=[],this.draw?.reset(),this.sketch?.cancel()}toggleAllOverlayMapFeatures(e){this.overlayedMapFeatures.forEach((t=>{this._toggleVisiblity(t,e)}))}toggleOverlayMapFeatures(e,t){const r=this.overlayedMapFeatures.get(e);r&&this._toggleVisiblity(r,t)}toggleSelection(e){const{sketch:t}=this;t&&(t.updateOnGraphicClick=e,t.cancel())}async transformAndPlotReferencePointOnImage(e){const{selectedLocation:t,options:r}=e;let i=!1,n=!1;const a=this.bestFeatureFootprint?.geometry;switch(a?.type){case"polygon":{const e=t.spatialReference.equals(a.spatialReference)?t:await(0,F.projectWithZConversion)(t,a.spatialReference);i=a.contains(e);break}case"mesh":{const e=t.spatialReference.equals(a.spatialReference)?t:await(0,F.projectWithZConversion)(t,a.spatialReference);n=a.extent.contains(e);break}}if(!i&&!n)return void this.clearReferencePointOnImage();const o=await this.worldToImage(t,r);if(o)return(0,y.throwIfAborted)(r),this.plotReferencePointOnImage(o),{x:o.x,y:o.y};this.clearReferencePointOnImage()}updateSuitabilities(e){e.sort(((e,t)=>e.suitability-t.suitability)),this._suitabilities=e;const t=this._suitabilities.map((e=>{let{feature:t}=e;return t}));this._initialCurrentCoverageUpdate=!0,this._updateFeatures(t),this._groupFeaturesBySectors()}async _fetchFeatures(e,t){if(!this.view)return;const r=this.layer;if(r){const i={include:r},n=this.view.toScreen(e);if(!n)return;const a=await this.view.hitTest(n,i);return this._processHitTestResults(r,a,t)}}async _fetchFeaturesWithController(e,t){try{await this._fetchFeatures(e,t)}catch(r){if((0,y.isAbortError)(r))return;this.setMessage("imageLoadError","error"),p.A.getLogger(this).error("error occurred while fetching features",r)}}_groupFeaturesBySectors(){const{_suitabilities:e,additionalFeatures:t,currentBestFeature:r,features:i,invalidCameraHeading:n}=this;if(!e||!t||!r||!i||n)return void(this._sectorData=null);this._sectorData={};for(const c of Ye.PD)this._sectorData[c]=new s.default;const a=e.map(((e,t)=>({...e,featureIndex:t})));a.sort(((e,t)=>e.trueSuitability-t.trueSuitability));const o=a.map((e=>{let{distance:t}=e;return t})),l=Math.max(...o);a.forEach((e=>{const{distance:t,angle:r,featureIndex:n}=e,a=t/l*Ye.rV[2],o=(0,Pe.Cg)(t,l),s=(0,Pe.wB)(r);if(!this._sectorData)return;const c=Ye.rV[3]+a*Math.sin(r*Math.PI/180),u=Ye.rV[3]+a*Math.cos(r*Math.PI/180);let d;const h=i.at(n),p=h===this.currentBestFeature,f=this.currentBestFeature?.attributes.cameraPitch&&this.currentBestFeature?.attributes.cameraPitch<5;if(p&&f)d=-90;else{const e=c-Ye.rV[3],t=u-Ye.rV[3],r=t/Math.sqrt(e**2+t**2);let i=180*Math.acos(r)/Math.PI;(e<0&&t<0||e<0&&t>0)&&(i*=-1),d=i}const m=""===o?s:`${o}_${s}`;p&&(d===this.bestFeatureAngle?this.previousFeatureAngle=d:this.bestFeatureAngle=d,this.navigatorCurrentBestFeature=f?null:{x:c,y:u,direction:s});const g=this._sectorData[m];g.add({angle:r,featureIndex:n,x:c,y:u,objectID:h.attributes.objectId,sector:m,featureIndexInSector:g.length})}))}_plotLocationPointOnDefaultImage(e){const t=d.A.isSerializable(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._locationPointOnImage=new n.default({geometry:new I.default({spatialReference:this._imageViewer.imageRenderer.spatialReference,...t}),symbol:et.C1}),this._imageViewer.addGraphic(this._locationPointOnImage,0)}_plotLocationPointOnPanoramicImage(e){const{imageSize:t}=this._panoramicViewer;if(!t)return;const[r,i]=t,{heading:a,pitch:o}=(0,Y.dM)(e,r,i),s=(0,Y.id)(a,o);this._locationPointOnImage=new n.default({geometry:new I.default(s,O.default.WebMercator),symbol:et.PR}),this._panoramicViewer.addGraphic(this._locationPointOnImage,0)}async _processFeatureResponse(e,t,r){const{features:i}=e;if(!i?.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll();const{features:n,polygons:a,frustums:o}=this.filterByFootprints(i,t);if(!n.length)return this.setMessage("noImageError","error"),void(this.currentBestFeature=null);let s;if(this.coveragePolygons.addMany(a),this.coverageFrustums.addMany(o),a[0]){let e=new R.default({spatialReference:a[0].spatialReference});for(const r of a)e=await(0,P.union)(e,r);const t=[];for(const{geometry:r}of n)e.contains(r)||t.push([r.x,r.y]);if(t.sort(((e,t)=>+(0,N.$3)([e,t]))),e.addRing(t),this.footprintExtent=(0,ye.hs)(e.extent,2,2),this.view?.supportsGround)try{s=await this.view.map.ground.createElevationSampler(this.footprintExtent,r)}catch(l){(0,y.isAbortError)(l)||p.A.getLogger(this).error(l)}}if((s||n[0].attributes.elevationSource)&&this.footprintExtent){const e=n[0].attributes.elevationSource;(0,ce.jV)(e)&&!s&&(s=await(0,he.gm)({extent:this.footprintExtent,lod:e.lod,url:e.url,rasterFunction:e.rasterFunction}));const r=await(0,Y.Ns)((n[0].attributes.location.z??0)-n[0].attributes.cameraHeight,{elevationSample:s,elevationSource:e,extent:this.footprintExtent}),[i,...a]=await(0,de.A)([t,...n.map((e=>e.attributes.geometry.clone()))],r);n[0].elevationSample=s??r.elevationSample,t.elevation=i.z,n.forEach(((e,t)=>{e.attributes.elevation=a[t].z}))}n[0].elevationSample&&n.forEach((e=>{e.elevationSample=n[0].elevationSample})),this._suitabilities=oe({features:n,selectedPoint:t,camera:(0,Pe.Gd)(this.view)?this.view.camera:null,currentImage:this.currentBestFeature}),this.updateSuitabilities(this._suitabilities)}async _processHitTestResults(e,t,r){const{screenPoint:i,results:[n]}=t,a="graphic"===n?.type&&this.shouldShowSelectedImage,o=n?.mapPoint??this.view?.toMap(i);if(!o)return;const{layerFloorFilterClause:s}=this,l=e.spatialReference.equals(o.spatialReference)?o:await(0,F.projectWithZConversion)(o,e.spatialReference),c=(0,b.sqlAnd)("1=1",(0,b.sqlAnd)(e.definitionExpression,s)),u=l.spatialReference.isGeographic?1:(0,M.GA)(l.spatialReference),d={layerInstanceOrURL:e,point:l,queryParams:{where:c,maximumDistance:e.maximumDistance?e.maximumDistance/u:void 0,objectIds:a?[n.graphic.getAttribute(e.objectIdField)]:void 0}};await this.searchBestImage(d,r)}_resetCursor(){const{activeViewer:e}=this;e&&(e.imageRenderer.cursor=this._previousCursor)}_setMeasurementCursor(){const{activeViewer:e}=this;e&&(this._previousCursor=e.imageRenderer.cursor,e.imageRenderer.cursor="crosshair")}_toggleVisiblity(e,t){e.forEach((e=>{e.visible=t}))}_updateFeatures(e){if(!e.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(e),e.length>1?this.additionalFeatures.addMany(e.slice(1)):this.additionalFeatures.removeAll(),this._updateGroundElevation=!0,this.currentBestFeature=e[0]}async _updatePointsAndPolygons(e){const{pointSources:t,currentBestFeature:r,currentCoverageVisible:i,isAdditionalPointSourcesVisible:a}=this;if(r&&(this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),!this.invalidCameraHeading)){await(this._adapter?.createFootprints(e)),(0,y.throwIfAborted)(e);for(const e of t)e.imageID===r.attributes.objectId?this.currentBestFeatureLocation=new n.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:et.OO,visible:i}):this.additionalCameraLocations.push(new n.default({attributes:{imageID:e.imageID},geometry:e.clone(),symbol:et.at,visible:a}))}}_updateCurrentBestFeature(e){if(!e)return;this.currentBestFeature=this.features?.at(e.featureIndex);const t=this.currentBestFeature?.attributes.cameraPitch&&this.currentBestFeature?.attributes.cameraPitch<5;let r;if(t)r=-90;else{const t=e.x-Ye.rV[3],i=e.y-Ye.rV[3],n=i/Math.sqrt(t**2+i**2);let a=180*Math.acos(n)/Math.PI;(t<0&&i<0||t<0&&i>0)&&(a*=-1),r=a}r===this.bestFeatureAngle?this.previousFeatureAngle=r:this.bestFeatureAngle=r,this.navigatorCurrentBestFeature=t?null:{x:e.x,y:e.y,direction:e.sector.includes("_")?e.sector.split("_")[1]:e.sector}}clearGraphics(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics()}clearReferencePointOnImage(){this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage=(0,m.pR)(this._referencePointOnImage))}clearLocationPointOnImage(){this._locationPointOnImage&&(this._imageViewer.removeGraphic(this._locationPointOnImage),this._panoramicViewer.removeGraphic(this._locationPointOnImage),this._locationPointOnImage=(0,m.pR)(this._locationPointOnImage))}plotReferencePoint(e){"mapPoint"in e?this.plotReferencePointOnGround(e.mapPoint):this.plotReferencePointOnGround(e)}setMessage(e,t,r,i){this.displayMessage={key:e,type:t,data:r,map:i}}async transformAndPlotSelectedLocation(e){const{currentBestFeature:t,invalidCameraHeading:r,selectedPoint:i,activeViewer:n}=this;if(this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=(0,m.pR)(this._crossSymbol)),!i||!t||"image-loaded"!==n?.state||r)return;let a;try{a=await this.worldToImage(i,e),(0,y.throwIfAborted)(e),await this.plotSelectedPointOnImage(a,e)}catch(o){(0,y.isAbortError)(o)||p.A.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:o,selectedPoint:i,feature:t})}}async worldToImage(e,t){const{footprintExtent:r}=this,{imageSize:i}=this.activeViewer;if("none"===this.mode||!this.currentBestFeature||!i||!r)return;const{attributes:{location:n,elevationSource:a,cameraHeading:o,elevation:s,cameraHeight:l},elevationSample:c}=this.currentBestFeature;let u=n.clone();const d=await(0,Y.Ns)(s??(n.z??0)-l,{elevationSample:c,elevationSource:a});this.currentBestFeature.elevationSample=d.elevationSample;const h=Array.isArray(e)?e:[e];let p,f=await Promise.all(h.map((e=>new Promise((t=>{if(!e.hasZ)return t((0,de.A)(e,d));t(e)})))));if(n.spatialReference.isGeographic&&(u=await(0,F.projectWithZConversion)(u,O.default.WebMercator,t)),f=await Promise.all(f.map((async e=>u.spatialReference.equals(e.spatialReference)?e:await(0,F.projectWithZConversion)(e,u.spatialReference,t)))),(0,y.throwIfAborted)(t),"panoramic"===this.mode)p=(0,pe.worldToImagePanoramic)(f,{imageHeight:i[1],imageWidth:i[0],cameraHeading:o,cameraLocation:u});else{const e=(0,Y.cb)(this.currentBestFeature.attributes,i[0],i[1]);p=(0,pe.worldToImage)(f,{...e,cameraLocation:u})}return Array.isArray(e)?p:p[0]}updateCurrentCoveragePolygon(e){const{additionalFootprints:t,additionalCameraLocations:r,currentBestFeature:i,currentBestFeatureLocation:a,currentCoverageVisible:o,selectedPoint:s,view:l,_adapter:c,mode:u}=this,{attributes:{objectId:d},elevationSample:h}=i;if(this._initialCurrentCoverageUpdate){if(this._overlays?.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint),e&&!this.invalidCameraHeading&&(e.visible=o,this.bestFeatureCurrentFootprint=e),l){const e=[...t,...r,a].filter(Pe.DU);l.supportsGround&&h&&c?.updateGroundElevation&&(this._updateGroundElevation&&c.updateGroundElevation(e,h),"panoramic"===u&&c.updateGroundElevation([this.bestFeatureCurrentFootprint],h)),this._updateGroundElevation=!1,s&&(e.splice(-2,0,this.bestFeatureCurrentFootprint),e.push(new n.default({geometry:s.clone(),symbol:et.pB.clone(),attributes:{imageID:d}}))),this._overlays.graphics.addMany(e)}}else if(l){if(this.invalidCameraHeading)return;this.bestFeatureCurrentFootprint&&(this._overlays?.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=(0,m.pR)(this.bestFeatureCurrentFootprint));const t=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;e&&(this.bestFeatureCurrentFootprint=e,l?.supportsGround&&h&&c?.updateGroundElevation&&"panoramic"===u&&c.updateGroundElevation([e],h),e.visible=this.currentCoverageVisible,this._overlays?.graphics.add(this.bestFeatureCurrentFootprint,t>=0?t:this._overlays.graphics.length-1))}}};(0,i._)([(0,_.MZ)()],bt.prototype,"activeLayer",null),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"activeViewer",null),(0,i._)([(0,_.MZ)()],bt.prototype,"accuracyParametersMissing",null),(0,i._)([(0,_.MZ)()],bt.prototype,"additionalFeatures",void 0),(0,i._)([(0,_.MZ)({type:s.default.ofType(n.default)})],bt.prototype,"additionalCameraLocations",void 0),(0,i._)([(0,_.MZ)({type:s.default.ofType(n.default)})],bt.prototype,"additionalFootprints",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"areaMeasurementResult",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"areaMeasurementAccuracy",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"bestFeatureAngle",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"bestFeatureCurrentFootprint",void 0),(0,i._)([(0,_.MZ)({type:n.default})],bt.prototype,"bestFeatureFootprint",void 0),(0,i._)([(0,_.MZ)({type:Number})],bt.prototype,"brightness",null),(0,i._)([(0,_.MZ)()],bt.prototype,"collectionId",void 0),(0,i._)([(0,_.MZ)({type:Number})],bt.prototype,"contrast",null),(0,i._)([(0,_.MZ)()],bt.prototype,"conversionProps",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"coverageFrustums",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"coveragePolygons",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"currentBestFeature",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"currentBestFeatureLocation",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"currentCoverageVisible",void 0),(0,i._)([(0,_.MZ)({json:{write:!1}})],bt.prototype,"determineWorkflowForFeature",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"disabled",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"displayMessage",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"displayNewMeasurementButton",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"distanceMeasurementResult",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"distanceAccuracyArray",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"dataCaptureLayer",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"featureCount",null),(0,i._)([(0,_.MZ)()],bt.prototype,"features",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"groundCoordinates",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"heightMeasurementPixels",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"heightGraphic",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"heightMeasurementResult",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"heightMeasurementAccuracy",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"measurementAngle",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"tempDistance",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"imageGalleryEnabled",null),(0,i._)([(0,_.MZ)()],bt.prototype,"imageGeometryField",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"imageLoaded",null),(0,i._)([(0,_.MZ)()],bt.prototype,"imageLocationToolState",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"invalidCameraHeading",null),(0,i._)([(0,_.MZ)()],bt.prototype,"imagePointsInView",null),(0,i._)([(0,_.MZ)()],bt.prototype,"isAdditionalCoverageVisible",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"isAdditionalPointSourcesVisible",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"layer",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"layerView",null),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"layerFloorFilterClause",null),(0,i._)([(0,_.MZ)({type:Number})],bt.prototype,"localPort",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"mapImageConversionToolState",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"measureType",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"measurementGraphic",void 0),(0,i._)([(0,_.MZ)({readOnly:!0,value:"none"})],bt.prototype,"mode",null),(0,i._)([(0,_.MZ)()],bt.prototype,"navigatorCurrentBestFeature",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"oiObjectIdField",void 0),(0,i._)([(0,_.MZ)({type:s.default.ofType(n.default)})],bt.prototype,"overlayedCameraLocations",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"overlayedMapFeatures",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"pixelCoordinates",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"pointSources",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"popupEnabled",null),(0,i._)([(0,_.MZ)()],bt.prototype,"previousFeatureAngle",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"referencePoint",null),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"sectorData",null),(0,i._)([(0,_.MZ)()],bt.prototype,"selectedPoint",void 0),(0,i._)([(0,_.MZ)({type:Number})],bt.prototype,"sharpness",null),(0,i._)([(0,_.MZ)()],bt.prototype,"shouldShowSelectedImage",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"sketch",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"draw",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"sketchAdapter",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"sketchGraphicsLayer",null),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"state",null),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"thumbnails",null),(0,i._)([(0,_.MZ)()],bt.prototype,"updateFootprint",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"updateFootprintPanorama",void 0),(0,i._)([(0,_.MZ)({value:null})],bt.prototype,"view",null),(0,i._)([(0,_.MZ)()],bt.prototype,"_adapter",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_sketchGraphicsLayer",null),(0,i._)([(0,_.MZ)()],bt.prototype,"_highlightedFeatureHandle",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_imageViewer",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_initialCurrentCoverageUpdate",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_locationPointOnImage",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_overlays",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"_overlaysView",null),(0,i._)([(0,_.MZ)()],bt.prototype,"_panoramicViewer",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_previousCursor",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_referencePointOnGround",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_referencePointOnImage",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_sectorData",void 0),(0,i._)([(0,_.MZ)({readOnly:!0})],bt.prototype,"_updatingHandles",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"footprintExtent",void 0),(0,i._)([(0,_.MZ)()],bt.prototype,"_featureChangedTask",void 0),bt=(0,i._)([(0,x.$)("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],bt);const Mt=bt},31183:(e,t,r)=>{r.d(t,{W:()=>s,g:()=>o});var i=r(28473),n=r(96913),a=r(67093);function o(e,t,r,i){if((0,n.canProjectWithoutEngine)(e.spatialReference,r)){l[0]=e.x,l[1]=e.y;const n=e.z;return l[2]=n??i??0,(0,a.projectBuffer)(l,e.spatialReference,0,t,r,0)}const o=(0,n.tryProjectWithZConversion)(e,r);return!!o&&(t[0]=o?.x,t[1]=o?.y,t[2]=o?.z??i??0,!0)}async function s(e,t,r,i,a){return await(0,n.initializeProjection)(e.spatialReference,r,null,a),o(e,t,r,i)}const l=(0,i.vt)()},35527:(e,t,r)=>{r.d(t,{k:()=>l});var i=r(3481),n=r(12711),a=r(51536);function o(e){if(!e)return"";const t=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let r="";for(const i of e.match(t)||[])switch(i){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":r+=i;break;case"A":case"a":r+="a";break;default:r+=`'${i}'`}return r}const s="esri.core.sql.timeonly";class l{constructor(e,t,r,i){this._hour=e,this._minute=t,this._second=r,this._millisecond=i,this.declaredRootClass=s}static isTimeOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===s}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return l.isTimeOnly(e)&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new l(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,i.Fq)(this.hour)&&(0,i.Fq)(this.minute)&&(0,i.Fq)(this.second)&&(0,i.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e||""===e?this.toString():(e=o(e))?a.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:(0,n.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,t,r,i){const n=new l(e,t,r,i);return n.isValid()?n:null}static fromReader(e){if(!e)return null;const t=e.split(":");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const t=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),i=Math.floor(e/36e5%24),n=Math.floor(e%1e3);return new l(i,r,t,n)}static fromDateJS(e){return new l(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new l(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const r=[];t?(t=o(t))&&r.push(t):null!==t&&""!==t||(r.push("HH:mm:ss"),r.push("HH:mm:ss.SSS"),r.push("hh:mm:ss a"),r.push("hh:mm:ss.SSS a"),r.push("HH:mm"),r.push("hh:mm a"),r.push("H:mm"),r.push("h:mm a"),r.push("H:mm:ss"),r.push("h:mm:ss a"),r.push("H:mm:ss.SSS"),r.push("h:mm:ss.SSS a"));for(const i of r){const t=a.c9.fromFormat(e,i);if(t.isValid)return new l(t.hour,t.minute,t.second,t.millisecond)}return null}plus(e,t){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}return null}toUTCDateTime(){return a.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}}},36338:(e,t,r)=>{r.d(t,{$0:()=>Z,AG:()=>b,AX:()=>U,CN:()=>$,EH:()=>G,Fj:()=>H,Md:()=>W,QI:()=>B,QV:()=>J,Qu:()=>v,WB:()=>j,Z9:()=>R,_I:()=>I,bO:()=>x,cG:()=>k,eY:()=>S,gO:()=>L,jr:()=>_,lW:()=>E,mf:()=>w,uH:()=>V,wv:()=>z,yP:()=>q});var i=r(49959),n=r(1278),a=r(92143),o=r(32006),s=r(60822),l=r(75400),c=r(65920),u=r(54824),d=r(96913),h=r(93321),p=r(26266),f=r(90787),m=r(58507),g=r(24454);const y=1e5;function v(e,t){let r=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return r<0&&(r+=180),r*Math.PI/180}function w(e,t){let r=180*Math.atan2(-e.y+t.y,e.x-t.x)/Math.PI;return r<0&&(r+=180),r*Math.PI/180}function b(e,t,r){if(!e?.length||!t?.length||!r)return;const[i,n]=e,[,a]=t,o=a-n;return[i+o*Math.cos(r),n+o*Math.sin(r)]}function M(e,t,r){if((0,p.isSupported)(e)){const e=(0,p.geodesicLengths)([t],"meters")[0];return{area:(0,p.geodesicAreas)([r],"square-meters")[0],perimeter:e}}const i=h.default.WGS84,n=(0,d.project)(t,i),a=(0,d.project)(r,i);let o=(0,s.geodesicDensify)(a,y);if(o=(0,s.simplify)(o),!o)return null;const l=(0,p.geodesicLengths)([n],"meters")[0];return{area:(0,p.geodesicAreas)([o],"square-meters")[0],perimeter:l}}async function _(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;if(t.length<2||!n||!r||!e)return null;const s=L(r,e);if(!s)return null;const l=t.map((e=>[e.x,e.y])),c=l.at(0),u=l.at(-1);if(!c||!u)return null;const d=s.map((t=>U([c,u],t,e,a,!1))),h=await Promise.all(d);(0,i.throwIfAborted)(o);let p=0;for(const i of h){if(!i)return null;const e=Math.abs(i-n);p=Math.max(e,p)}return p}async function x(e,t,r,n,a){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0;if(t.length<2||!n||!r||!e)throw new Error("Missing parameters");const l=k(r,e),c=t.map((e=>[e.x,e.y])),u=c.at(0),d=c.at(-1),h=l.map((t=>B([u,d],t,e,a,o,!1))),p=await Promise.all(h);(0,i.throwIfAborted)(s);let f=0;for(const i of p){if(!i)return 0;const e=Math.abs(i-n);f=Math.max(e,f)}return f}function S(e,t){const r=Z(e,!1);if(r?.length)return 20*(0,o.Io)([r[0].x,r[0].y],[r.at(-1).x,r.at(-1).y])/t}function T(e){const t=e.spatialReference;if(t.isGeographic){if((0,p.isSupported)(t))return(0,p.geodesicLengths)([e],"meters")[0];const r=(0,d.project)(e,h.default.WGS84);return(0,p.geodesicLengths)([r],"meters")[0]}return t.isWebMercator?(0,s.geodesicLength)(e,"meters"):(0,s.planarLength)(e,"meters")}function P(e,t){const r=(0,s.simplify)(t);if(!r)return null;const i=(0,s.planarLength)(e,"meters");return{area:(0,s.planarArea)(r,"square-meters"),perimeter:i}}function A(e,t){let r=(0,s.geodesicDensify)(t,y,"meters");if(r=(0,s.simplify)(r),!r)return null;const i=(0,s.geodesicLength)(e,"meters");return{area:(0,s.geodesicArea)(r,"square-meters"),perimeter:i}}async function I(e,t,r){if(!t||!e)throw new Error("Missing required parameters");const n=await(0,f.imageToWorld)(e,t);(0,i.throwIfAborted)(r);const a=n.clone();a.z?a.z+=20:a.z=20;const{averageElevation:o,cameraPitch:s,cameraRoll:l,farDistance:c,...u}=t;return(0,g.worldToImage)(a,u)}async function R(e,t,r,n){const{attributes:a}=r,{location:o}=a,{updateElevationProps:s,...l}=t;if(!e||!t)throw new Error("Missing parameters");let c=o.clone();c.spatialReference.isGeographic&&(c=await(0,d.projectWithZConversion)(c,h.default.WebMercator));const u=await(0,f.imageToWorldPanoramic)(e,{...l,cameraLocation:c},s);(0,i.throwIfAborted)(n);const p=u.clone();return p.z?p.z+=20:p.z=20,(0,g.worldToImagePanoramic)(p,l)}function C(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,cameraPitch:c,cameraRoll:u,farDistance:d,...h}=i;if(n>=5||a<=.1)return{value:e};const p=new l.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),f=(0,g.worldToImage)(p,h),m=(0,o.Io)([r[0].x,r[0].y],[f.x,f.y]),y=r.at(0),v=r.at(-1);if(!y||!v)return null;const w=(0,o.Io)([y.x,y.y],[v.x,v.y])*e/m;return C(w,t,r,i,n+1,Math.abs(e-w))}function F(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const{averageElevation:s,horizontalFieldOfView:c,verticalFieldOfView:u,farDistance:d,...h}=i;if(n>=5||a<=.1)return{value:e};const p=new l.default({x:t.x,y:t.y,z:t.z?t.z+e:e,spatialReference:i.cameraLocation.spatialReference}),f=(0,g.worldToImagePanoramic)(p,h),m=(0,o.Io)([r[0].x,r[0].y],[f.x,f.y]),y=r.at(0),v=r.at(-1);if(!y||!v)return null;const w=(0,o.Io)([y.x,y.y],[v.x,v.y])*e/m;return F(w,t,r,i,n+1,Math.abs(e-w))}async function O(e,t){const{updateElevationProps:r,...i}=t;return await(0,f.imageToWorld)(e,i,r)}async function N(e,t){const{updateElevationProps:r,...i}=t;return(0,f.imageToWorldPanoramic)(e,i,r)}function E(e){navigator.clipboard.writeText(e).catch((e=>{throw e}))}function D(e){const t=e.map((e=>[e.x,e.y])),r=e[0].spatialReference;return new u.default({paths:[t],spatialReference:r})}function Z(e,t){return e.map((e=>({x:t?.5+e[0]:e[0],y:t?.5-e[1]:e[1]})))}function z(e,t,r,i,o){const s="measurement"===e?t:r;if(o&&s)return(0,n.ix)(i,(0,a.d_)(s,"meters"),o,3)||null}function L(e,t){const{cameraPitch:r,cameraRoll:i,cameraLocation:n}=e,{x:a,y:o,z:s,spatialReference:c}=n;if(t.every((e=>0===e))||!t||!t.length)return null;const[u,d,,h,p]=t,f=[-h,0,h],m=[-p,0,p],g=[-u,0,u],y=[-d,0,d],v=[];for(const w of f)for(const t of m)for(const n of g)for(const u of g)for(const d of y){const h={...e};h.cameraPitch=r+w,h.cameraRoll=i+t,h.cameraLocation=new l.default({x:a+n,y:o+u,z:s?s+d:0,spatialReference:{wkid:c.wkid}}),v.push(h)}return v}function k(e,t){const{cameraHeading:r,cameraLocation:i}=e,{x:n,y:a,z:o,spatialReference:s}=i;if(t.every((e=>0===e))||!t||!t.length)throw new Error("Invalid parameters");const[c,u,d]=t,h=d>0?[-d,0,d]:[],p=c>0?[-c,0,c]:[],f=u>0?[-u,0,u]:[],m=[];for(const g of h)for(const t of p)for(const i of p)for(const c of f){const u={...e};u.cameraHeading=r+g,u.cameraLocation=new l.default({x:n+t,y:a+i,z:o?o+c:0,spatialReference:{wkid:s.wkid}}),m.push(u)}return m}function G(e,t,r,i,o){const s="measurement"===e?t:j(r);if(o&&s)return(0,n.ix)(i,(0,a.d_)(s,"meters"),o,3)||null}function V(e,t,r,i,o){const s="measurement"===e?t:r;if(o&&s)return(0,n.Jd)(i,(0,a.gT)(s,"square-meters"),o,3)||null}function j(e){return Math.sqrt(e.reduce(((e,t)=>e+t**2),0))}function H(e,t,r){if("default"===t)return e;const i={x:e[0],y:e[1],z:e[2]},n=(0,m.pq)(i,r[0],r[1]);return[n.x,n.y]}async function U(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;if(!e||!t||e.length<2)return null;const l=Z(e,n);if(!l||l.length<2)return null;const[c,u]=[l[0],l.at(-1)];if(!u)return null;const d=[c],h=await(0,f.imageToWorld)(c,t);(0,i.throwIfAborted)(s);const p=h.clone();p.z?p.z+=20:p.z=20;const{averageElevation:m,cameraPitch:y,cameraRoll:w,farDistance:M,..._}=t,x=(0,g.worldToImage)(p,_),S=(0,o.Io)([c.x,c.y],[x.x,x.y]),T=v(c,x);if(!T)return;const P=b([c.x,c.y],[u.x,u.y],T);if(!P?.length)return;d.push({x:P[0],y:P[1]});const A=20*(0,o.Io)([d[0].x,d[0].y],[d[1].x,d[1].y])/S;if(!a)return A;const I=C(A,h,d,t,0,1);return I?.value}async function B(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0;const{attributes:c}=n,{location:u}=c,{updateElevationProps:p,...m}=t;if(!e||!t||e.length<2)throw new Error("Invalid parameters");const y=Z(e,a),[w,M]=[y[0],y.at(-1)],_=[w];let x=u.clone();x.spatialReference.isGeographic&&(x=await(0,d.projectWithZConversion)(x,h.default.WebMercator));const S=await(0,f.imageToWorldPanoramic)(w,{...m,cameraLocation:x},p);(0,i.throwIfAborted)(l);const T=S.clone();T.z?T.z+=20:T.z=20;const P=(0,g.worldToImagePanoramic)(T,m),A=(0,o.Io)([w.x,w.y],[P.x,P.y]),I=v(w,P);if(!I)return;const R=b([w.x,w.y],[M.x,M.y],I);if(!R?.length)return;_.push({x:R[0],y:R[1]});const C=20*(0,o.Io)([_[0].x,_[0].y],[_[1].x,_[1].y])/A;if(!s)return C;const O=F(C,S,_,t,0,1);return O?.value}async function W(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<3)return null;const i=Z(e,r),n=await O(i,t),a=n.map((e=>{let{x:t,y:r}=e;return[t,r]}));e.push(e[0]),a.push(a[0]);const o=n[0].spatialReference,s=new u.default({paths:[a],spatialReference:o}),l=new c.default({rings:[a],spatialReference:o});return o.isGeographic?M(o,s,l):o.isWebMercator?A(s,l):P(s,l)}async function q(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;if(e.length<3)return null;const a=Z(e,r),o=await N(a,t);(0,i.throwIfAborted)(n);const s=o.map((e=>{let{x:t,y:r}=e;return[t,r]}));e.push(e[0]),s.push(s[0]);const l=o[0].spatialReference,d=new u.default({paths:[s],spatialReference:l}),h=new c.default({rings:[s],spatialReference:l});return l.isGeographic?M(l,d,h):l.isWebMercator?A(d,h):P(d,h)}async function $(e,t){const r=Z(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]);return T(D(await O(r,t)))}async function J(e,t){let r=arguments.length>3?arguments[3]:void 0;const n=Z(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),a=await N(n,t);return(0,i.throwIfAborted)(r),T(D(a))}},46314:(e,t,r)=>{r.d(t,{D:()=>i});class i{constructor(){this.factor=new n,this.factorAlignment=new n}}class n{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}},47160:(e,t,r)=>{r.d(t,{T:()=>o});var i=r(64682),n=r(89227),a=r(28473);function o(e,t,r){e.worldUpAtPosition(t,s),(0,n.d)(l,r,t);const a=(0,n.l)(l);return 0===a?0:(0,i.XM)((0,n.f)(l,s)/a)}const s=(0,a.vt)(),l=(0,a.vt)()},47696:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(68661),n=r(90273);class a extends i.A{constructor(e,t,r,i,n){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=i,this._spRef=t,this._cacheId=n}get(e){if(void 0===this._lazyPath[e]){const t=this._elements[e];if(void 0===t)return;this._lazyPath[e]=new n.A(t,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||null!==e&&e instanceof a!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}},53409:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var i,n=r(93800),a=r(19455),o=r(48602),s=(r(21265),r(50925),r(14746),r(75269)),l=r(87752),c=r(10382),u=r(21369),d=r(66509),h=r(28473),p=r(21465);let f=i=class extends a.A{constructor(e){super(e),this.translation=(0,h.vt)(),this.rotationAxis=(0,h.ci)(p.up),this.rotationAngle=0,this.scale=(0,h.fA)(1,1,1)}get rotation(){return(0,p.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,h.o8)((0,p.yo)(e)),this.rotationAngle=(0,p.g7)(e)}get localMatrix(){const e=(0,c.vt)();return(0,u.x8)(m,(0,p.yo)(this.rotation),(0,p.$I)(this.rotation)),(0,l.o1)(e,m,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.B8)((0,c.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,l.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,h.o8)(this.translation),rotationAxis:(0,h.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,h.o8)(this.scale)};return new i(e)}};(0,n._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),(0,n._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAxis",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAngle",void 0),(0,n._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),(0,n._)([(0,o.MZ)()],f.prototype,"rotation",null),(0,n._)([(0,o.MZ)()],f.prototype,"localMatrix",null),(0,n._)([(0,o.MZ)()],f.prototype,"localMatrixInverse",null),f=i=(0,n._)([(0,s.$)("esri.geometry.support.MeshTransform")],f);const m=(0,d.vt)(),g=f},53890:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(74197),n=r(58507);async function a(e,t,r){const a=Array.isArray(e)?e:[e];let o;if((0,n.SP)(t))o=await(0,i.h)(a,t.elevationSample,r);else if((0,n.tB)(t)){const{elevationSource:e,extent:n}=t,{url:s,lod:l,rasterFunction:c}=e;o=await(0,i.Ys)(a,{url:s,lod:l,rasterFunction:c,extent:n},r)}else o=await(0,i.kV)(a,t.elevationSource.constantElevation,r);return Array.isArray(e)?o:o[0]}},57703:(e,t,r)=>{r.d(t,{C1:()=>A,FT:()=>M,Fz:()=>b,IL:()=>x,Jb:()=>R,Mi:()=>P,OO:()=>y,P1:()=>w,PR:()=>I,Tu:()=>C,Xg:()=>T,at:()=>v,dg:()=>O,fg:()=>F,ov:()=>_,pB:()=>S,ph:()=>D});var i=r(88102),n=r(89129),a=r(2925),o=r(14360),s=r(46144),l=r(35727),c=r(62666),u=r(39677),d=r(30879),h=r(47874),p=r(85102),f=r(92744),m=r(99071),g=r(83031);const y=new g.default({size:15,style:"circle",color:[255,102,102,.5],outline:null}),v=new g.default({size:10,style:"circle",color:[0,128,192,.5],outline:null}),w=new f.default({style:"solid",color:[0,128,192,.5],outline:null}),b=new f.default({style:"solid",color:[255,102,102,.5],outline:null}),M=new g.default({size:10,style:"diamond",color:[255,102,102],outline:null}),_=new p.default({symbolLayers:new n.default([new l.default({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),x=new p.default({symbolLayers:new n.default([new d.default({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),S=new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),T=new u.default({symbolLayers:new n.default([new s.default({material:{color:[255,102,102,.5]},edges:null})])}),P=new u.default({symbolLayers:new n.default([new s.default({material:{color:[0,128,192,.25]},edges:null})])}),A=new g.default({size:8,style:"triangle",color:[255,165,0],outline:{color:[0,0,0],width:.5}}),I=new p.default({symbolLayers:new n.default([new d.default({width:12,height:12,depth:12,material:{color:[255,165,0]},resource:{primitive:"tetrahedron"},outline:{color:"black",size:1},castShadows:!1})])}),R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3.5;return new o.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:(0,a.bJ)(e).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:t,color:e.toArray()}]}}})},C=new c.default({symbolLayers:new n.default([new h.default({profile:"circle",width:7,material:{color:"orange"},cap:"round"})])}),F=e=>new f.default({color:(0,a._L)(e,.3),outline:{color:e,width:2}});function O(e){switch(e){case"point":return e=>new g.default({size:10,style:"circle",color:e??N(),outline:new m.default({color:[0,0,0],width:2})});case"polygon":return e=>new f.default({color:null,outline:E(e),style:"none"});case"polyline":return e=>E(e)}}function N(){return new i.default([255,0,0])}function E(e){return new m.default({color:e??N(),width:2})}function D(e,t,r){return e===t?r:"polyline"===e?E(r?.color):function(e){return new f.default({color:null,outline:E(e),style:"none"})}(r?.color)}},58057:(e,t,r)=>{r.d(t,{G:()=>l,y:()=>o});var i=r(95820),n=r(95927),a=r(69943);function o(e){s=e}let s;function l(e){return null===e?null:(0,n.g)(e)?e.clone():(0,n.d)(e)?e:(0,n.l)(e)?e.clone():(0,n.m)(e)?e.toArray().map((e=>l(e))):(0,a.cy)(e)?e.map((e=>l(e))):(0,n.n)(e)?s.createFromArcadeFeature(e):(0,n.o)(e)||(0,n.p)(e)?e:(0,n.q)(e)||"esri.arcade.Attachment"===e?.declaredClass?e.deepClone():("esri.arcade.Portal"===e?.declaredClass||(0,n.r)(e)||e instanceof i.x||(0,n.i)(e),e)}},59447:(e,t,r)=>{r.d(t,{Ad:()=>m,O_:()=>h,m6:()=>f,wF:()=>p,y0:()=>d});var i=r(23060),n=r(74719),a=r(64682),o=r(49959),s=r(43103),l=r(58507),c=r(15739),u=r(41755);const d=e=>"FA"===e,h=async(e,t,i)=>{const a=new(await Promise.resolve().then(r.bind(r,85379)).then((e=>e.default)))({objectIds:[t]}),o=await e.queryAttachments(a,i),s=o[`${t}`]?.[0],l=s?.url;if(!l)throw new n.default("NoAttachmentError","no attachments found",{[e.objectIdField]:t,layer:e});return{datasetFormat:s.contentType.split("/")[1].toUpperCase(),url:l}};async function p(e,t){const i="string"==typeof e,n=i?e:e.url,{pathname:a,searchParams:l,origin:c}=new URL(n);let d=i?(0,s.getPathExtension)(a):e.datasetFormat;d||(d=await(0,u.gt)(n));const h=await Promise.resolve().then(r.bind(r,11951)).then((e=>e.default)),p=await h.open({ioConfig:{customFetchParameters:Object.fromEntries(l),skipMapInfo:!0},datasetFormat:d?.toUpperCase(),url:`${c}${a}`,signal:t?.signal});return p?async function(e,t){const{level:r,offset:i,size:n}=function(e){const{storageInfo:t,width:r,height:i}=e.rasterInfo,{maximumPyramidLevel:n,pyramidScalingFactor:a}=t,o=a??2;return{level:n,offset:{x:0,y:0},size:{width:Math.ceil(r/o**n),height:Math.ceil(i/o**n)}}}(e),{pixelBlock:a}=await e.fetchRawPixels(r,i,n,t);return(0,o.throwIfAborted)(t),a}(p,{signal:t?.signal}):null}async function f(e,t,r){if(!e)throw new n.default("NoLayerError","No layer provided, cannot load image from attachment",{layer:e,objectId:t});const{datasetFormat:a,url:o}=await h(e,+t,r);return(0,u.RP)(a)?await p({datasetFormat:a,url:o},r):(await(0,i.default)(o,{...r,useRequestQueue:!0,responseType:"image",query:{w:c.RK}})).data}function m(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{height:i,width:n}=e;t.width=n,t.height=i;const o=t.getContext("2d");if(!o)return;const s=function(e,t,r){const i=document.createElement("canvas"),n=i.getContext("2d");if(e instanceof HTMLImageElement)i.width=e.width,i.height=e.height,n?.drawImage(e,0,0);else{const a=r.createImageData(t.width,t.height);a&&(a.data.set(e.getAsRGBA()),i.width=a.width,i.height=a.height,n?.putImageData(a,0,0))}return i}(e,t,o);s.getContext("2d")&&(r>0?function(e,t,r,i,n){const o=(0,a.kU)(n),s=[(0,l.cC)(0,0,o),(0,l.cC)(r,0,o),(0,l.cC)(r,i,o),(0,l.cC)(0,i,o)],c=Math.max(...s.map((e=>e[0])))-Math.min(...s.map((e=>e[0]))),u=Math.max(...s.map((e=>e[1])))-Math.min(...s.map((e=>e[1]))),d=Math.min(r/c,i/u);e.save(),e.clearRect(0,0,r,i),e.translate(r/2,i/2),e.rotate(o),e.scale(d,d),e.drawImage(t,-r/2,-i/2,r,i),e.restore()}(o,s,n,i,r):o.drawImage(s,0,0))}},60064:(e,t,r)=>{r.d(t,{B:()=>c,GP:()=>s,ZY:()=>o,qg:()=>u});var i=r(56612),n=r(12711);const a={ar:[".",","],bg:[",","\xa0"],bs:[",","."],ca:[",","."],cs:[",","\xa0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xa0"],fi:[",","\xa0"],fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xa0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xa0"],lv:[",","\xa0"],mk:[",","."],nb:[",","\xa0"],nl:[",","."],no:[",","\xa0"],pl:[",","\xa0"],pt:[",","."],"pt-pt":[",","\xa0"],ro:[",","."],ru:[",","\xa0"],sk:[",","\xa0"],sl:[",","."],sr:[",","."],sv:[",","\xa0"],th:[".",","],tr:[",","."],uk:[",","\xa0"],vi:[",","."],zh:[".",","]};function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.JK)(),t=(e=e.toLowerCase())in a;if(!t){const r=e.split("-");r.length>1&&r[0]in a&&(e=r[0],t=!0),t||(e="en")}const[r,i,o="#,##0.###"]=a[e];return{decimal:r,group:i,pattern:o}}function s(e,t){const r=o((t={...t}).locale);t.customs=r;const i=t.pattern||r.pattern;return isNaN(e)||Math.abs(e)===1/0?null:function(e,t,r){const i=(r=r||{}).customs.group,n=r.customs.decimal,a=t.split(";"),o=a[0];if((t=a[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xa4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const s=l,c=o.match(s);if(!c)throw new Error("unable to find a number expression in pattern: "+t);return!1===r.fractional&&(r.places=0),t.replace(s,function(e,t,r){!0===(r=r||{}).places&&(r.places=0),r.places===1/0&&(r.places=6);const i=t.split("."),n="string"==typeof r.places&&r.places.indexOf(",");let a=r.places;n?a=r.places.slice(n+1):+a>=0||(a=(i[1]||[]).length),r.round<0||(e=Number(e.toFixed(Number(a))));const o=String(Math.abs(e)).split("."),s=o[1]||"";if(i[1]||r.places){n&&(r.places=r.places.slice(0,Math.max(0,n)));const e=void 0!==r.places?r.places:i[1]&&i[1].lastIndexOf("0")+1;+e>s.length&&(o[1]=s.padEnd(Number(e),"0")),+a<s.length&&(o[1]=s.slice(0,Math.max(0,Number(a))))}else o[1]&&o.pop();const l=i[0].replace(",","");let c=l.indexOf("0");-1!==c&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].slice(-c)));let u,d,h=i[0].lastIndexOf(",");if(-1!==h){u=i[0].length-h-1;const e=i[0].slice(0,h);h=e.lastIndexOf(","),-1!==h&&(d=e.length-h-1)}const p=[];for(let f=o[0];f;){const e=f.length-u;p.push(e>0?f.slice(Math.max(0,e)):f),f=e>0?f.slice(0,e):"",d&&(u=d,d=void 0)}return o[0]=p.reverse().join(r.group||","),o.join(r.decimal||".")}(e,c[0],{decimal:n,group:i,places:r.places,round:r.round}))}(e,i,t)}const l=/[#0,]*[#0](?:\.0*#*)?/;function c(e){const t=o((e=e||{}).locale),r=e.pattern||t.pattern,n=t.group,a=t.decimal;let s=1;if(r.includes("%"))s/=100;else if(r.includes("\u2030"))s/=1e3;else if(r.includes("\xa4"))throw new Error("currency notation not supported");const c=r.split(";");1===c.length&&c.push("-"+c[0]);const u=h(c,(t=>(t="(?:"+(0,i.Cj)(t,".")+")").replace(l,(t=>{const r={signed:!1,separator:e.strict?n:[n,""],fractional:e.fractional,decimal:a,exponent:!1},i=t.split(".");let o=e.places;1===i.length&&1!==s&&(i[1]="###"),1===i.length||0===o?r.fractional=!1:(void 0===o&&(o=e.pattern?i[1].lastIndexOf("0")+1:1/0),o&&null==e.fractional&&(r.fractional=!0),!e.places&&+o<i[1].length&&(o+=","+i[1].length),r.places=o);const l=i[0].split(",");return l.length>1&&(r.groupSize=l.pop().length,l.length>1&&(r.groupSize2=l.pop().length)),"("+function(e){"places"in(e=e||{})||(e.places=1/0),"string"!=typeof e.decimal&&(e.decimal="."),"fractional"in e&&!String(e.places).startsWith("0")||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=d(e),r=h(e.fractional,(t=>{let r="";return t&&0!==e.places&&(r="\\"+e.decimal,e.places===1/0?r="(?:"+r+"\\d+)?":r+="\\d{"+e.places+"}"),r}),!0);let i=t+r;return r&&(i="(?:(?:"+i+")|(?:"+r+"))"),i+h(e.exponent,(t=>t?"([eE]"+d({signed:e.eSigned})+")":""))}(r)+")"}))),!0);return{regexp:u.replaceAll(/[\xa0 ]/g,"[\\s\\xa0]"),group:n,decimal:a,factor:s}}function u(e,t){const r=c(t),i=new RegExp("^"+r.regexp+"$").exec(e);if(!i)return NaN;let n=i[1];if(!i[1]){if(!i[2])return NaN;n=i[2],r.factor*=-1}return n=n.replaceAll(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,"."),Number(n)*r.factor}function d(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",h(e.signed,(e=>e?"[-+]":""),!0)+h(e.separator,(t=>{if(!t)return"(?:\\d+)";" "===(t=(0,i.Cj)(t))?t="\\s":"\xa0"===t&&(t="\\s\\xa0");const r=e.groupSize,n=e.groupSize2;if(n){const e="(?:0|[1-9]\\d{0,"+(n-1)+"}(?:["+t+"]\\d{"+n+"})*["+t+"]\\d{"+r+"})";return r-n>0?"(?:"+e+"|(?:0|[1-9]\\d{0,"+(r-1)+"}))":e}return"(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*)"}),!0)}const h=(e,t,r)=>{if(!Array.isArray(e))return t(e);const i=[];for(let n=0;n<e.length;n++)i.push(t(e[n]));return p(i.join("|"),Boolean(r))},p=(e,t)=>"("+(t?"?:":"")+e+")"},60652:(e,t,r)=>{r.r(t),r.d(t,{buffer:()=>E,changeDefaultSpatialReferenceTolerance:()=>K,clearDefaultSpatialReferenceTolerance:()=>Q,clip:()=>f,contains:()=>g,convexHull:()=>I,crosses:()=>y,cut:()=>m,densify:()=>U,difference:()=>R,disjoint:()=>x,distance:()=>v,equals:()=>w,extendedSpatialReferenceInfo:()=>p,flipHorizontal:()=>V,flipVertical:()=>j,generalize:()=>H,geodesicArea:()=>$,geodesicBuffer:()=>D,geodesicDensify:()=>B,geodesicLength:()=>J,intersect:()=>F,intersectLinesToPoints:()=>Y,intersects:()=>b,isSimple:()=>P,nearestCoordinate:()=>Z,nearestVertex:()=>z,nearestVertices:()=>L,offset:()=>N,overlaps:()=>S,planarArea:()=>W,planarLength:()=>q,relate:()=>T,rotate:()=>G,simplify:()=>A,symmetricDifference:()=>C,touches:()=>M,union:()=>O,within:()=>_});var i=r(34037),n=r(75400),a=r(78629);function o(e){return Array.isArray(e)?e[0]?.spatialReference:e?.spatialReference}function s(e){return e?Array.isArray(e)?e.map(s):e.toJSON?e.toJSON():e:e}function l(e){return Array.isArray(e)?e.map((e=>(0,a.fromJSON)(e))):(0,a.fromJSON)(e)}let c;async function u(){return c||(c=(0,i.ho)("geometryEngineWorker",{strategy:"distributed"})),c}async function d(e,t){return(await u()).invoke("executeGEOperation",{operation:e,parameters:s(t)})}async function h(e,t){const r=await u();return Promise.all(r.broadcast("executeGEOperation",{operation:e,parameters:s(t)}))}function p(e){return d("extendedSpatialReferenceInfo",[e])}async function f(e,t){return l(await d("clip",[o(e),e,t]))}async function m(e,t){return l(await d("cut",[o(e),e,t]))}function g(e,t){return d("contains",[o(e),e,t])}function y(e,t){return d("crosses",[o(e),e,t])}function v(e,t,r){return d("distance",[o(e),e,t,r])}function w(e,t){return d("equals",[o(e),e,t])}function b(e,t){return d("intersects",[o(e),e,t])}function M(e,t){return d("touches",[o(e),e,t])}function _(e,t){return d("within",[o(e),e,t])}function x(e,t){return d("disjoint",[o(e),e,t])}function S(e,t){return d("overlaps",[o(e),e,t])}function T(e,t,r){return d("relate",[o(e),e,t,r])}function P(e){return d("isSimple",[o(e),e])}async function A(e){return l(await d("simplify",[o(e),e]))}async function I(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l(await d("convexHull",[o(e),e,t]))}async function R(e,t){return l(await d("difference",[o(e),e,t]))}async function C(e,t){return l(await d("symmetricDifference",[o(e),e,t]))}async function F(e,t){return l(await d("intersect",[o(e),e,t]))}async function O(e){const t=function(e,t){let r;return Array.isArray(e)?r=e:(r=[],r.push(e),null!=t&&r.push(t)),r}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null);return l(await d("union",[o(t),t]))}async function N(e,t,r,i,n,a){return l(await d("offset",[o(e),e,t,r,i,n,a]))}async function E(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=[o(e),e,t,r,i];return l(await d("buffer",n))}async function D(e,t,r,i,n,a){const s=[o(e),e,t,r,i,n,a];return l(await d("geodesicBuffer",s))}async function Z(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=await d("nearestCoordinate",[o(e),e,t,r]);return{...i,coordinate:n.default.fromJSON(i.coordinate)}}async function z(e,t){const r=await d("nearestVertex",[o(e),e,t]);return{...r,coordinate:n.default.fromJSON(r.coordinate)}}async function L(e,t,r,i){return(await d("nearestVertices",[o(e),e,t,r,i])).map((e=>({...e,coordinate:n.default.fromJSON(e.coordinate)})))}function k(e){return"xmin"in e?e.center:"x"in e?e:e.extent?.center}async function G(e,t,r){if(null==e)throw new X;const i=e.spatialReference;if(null==(r=r??k(e)))throw new X;const n=e.constructor.fromJSON(await d("rotate",[i,e,t,r]));return n.spatialReference=i,n}async function V(e,t){if(null==e)throw new X;const r=e.spatialReference;if(null==(t=t??k(e)))throw new X;const i=e.constructor.fromJSON(await d("flipHorizontal",[r,e,t]));return i.spatialReference=r,i}async function j(e,t){if(null==e)throw new X;const r=e.spatialReference;if(null==(t=t??k(e)))throw new X;const i=e.constructor.fromJSON(await d("flipVertical",[r,e,t]));return i.spatialReference=r,i}async function H(e,t,r,i){return l(await d("generalize",[o(e),e,t,r,i]))}async function U(e,t,r){return l(await d("densify",[o(e),e,t,r]))}async function B(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return l(await d("geodesicDensify",[o(e),e,t,r,i]))}function W(e,t){return d("planarArea",[o(e),e,t])}function q(e,t){return d("planarLength",[o(e),e,t])}function $(e,t,r){return d("geodesicArea",[o(e),e,t,r])}function J(e,t,r){return d("geodesicLength",[o(e),e,t,r])}async function Y(e,t){return l(await d("intersectLinesToPoints",[o(e),e,t]))}async function K(e,t){await h("changeDefaultSpatialReferenceTolerance",[e,t])}async function Q(e){await h("clearDefaultSpatialReferenceTolerance",[e])}class X extends Error{constructor(){super("Illegal Argument Exception")}}},60822:(e,t,r)=>{r.r(t),r.d(t,{buffer:()=>C,changeDefaultSpatialReferenceTolerance:()=>q,clearDefaultSpatialReferenceTolerance:()=>$,clip:()=>u,contains:()=>h,convexHull:()=>S,crosses:()=>p,cut:()=>d,densify:()=>G,difference:()=>T,disjoint:()=>w,distance:()=>f,equals:()=>m,extendedSpatialReferenceInfo:()=>c,flipHorizontal:()=>z,flipVertical:()=>L,generalize:()=>k,geodesicArea:()=>U,geodesicBuffer:()=>F,geodesicDensify:()=>V,geodesicLength:()=>B,intersect:()=>A,intersectLinesToPoints:()=>W,intersects:()=>g,isSimple:()=>_,nearestCoordinate:()=>O,nearestVertex:()=>N,nearestVertices:()=>E,offset:()=>R,overlaps:()=>b,planarArea:()=>j,planarLength:()=>H,relate:()=>M,rotate:()=>Z,simplify:()=>x,symmetricDifference:()=>P,touches:()=>y,union:()=>I,within:()=>v});var i=r(80556),n=r(97653),a=r(31329),o=r(93321),s=r(85022);function l(e){const t=Array.isArray(e)?e[0].spatialReference:e.spatialReference;return t?(0,i.PZ)(o.default,t):o.default.WGS84}function c(e){return a.G.extendedSpatialReferenceInfo(e)}function u(e,t){return(0,n.f)(e),a.G.clip(s.hydratedAdapter,l(e),e,t)}function d(e,t){return(0,n.f)(e),a.G.cut(s.hydratedAdapter,l(e),e,t)}function h(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.contains(s.hydratedAdapter,l(e),e,t)}function p(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.crosses(s.hydratedAdapter,l(e),e,t)}function f(e,t,r){return(0,n.f)(e),(0,n.f)(t),a.G.distance(s.hydratedAdapter,l(e),e,t,r)}function m(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.equals(s.hydratedAdapter,l(e),e,t)}function g(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.intersects(s.hydratedAdapter,l(e),e,t)}function y(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.touches(s.hydratedAdapter,l(e),e,t)}function v(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.within(s.hydratedAdapter,l(e),e,t)}function w(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.disjoint(s.hydratedAdapter,l(e),e,t)}function b(e,t){return(0,n.f)(e),(0,n.f)(t),a.G.overlaps(s.hydratedAdapter,l(e),e,t)}function M(e,t,r){return(0,n.f)(e),(0,n.f)(t),a.G.relate(s.hydratedAdapter,l(e),e,t,r)}function _(e){return(0,n.f)(e),a.G.isSimple(s.hydratedAdapter,l(e),e)}function x(e){return(0,n.f)(e),a.G.simplify(s.hydratedAdapter,l(e),e)}function S(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.G.convexHull(s.hydratedAdapter,l(e),e,t)}function T(e,t){return(0,n.f)(t),a.G.difference(s.hydratedAdapter,l(e),e,t)}function P(e,t){return(0,n.f)(t),a.G.symmetricDifference(s.hydratedAdapter,l(e),e,t)}function A(e,t){return(0,n.f)(t),a.G.intersect(s.hydratedAdapter,l(e),e,t)}function I(e){return a.G.union(s.hydratedAdapter,l(e),e)}function R(e,t,r,i,n,o){return a.G.offset(s.hydratedAdapter,l(e),e,t,r,i,n,o)}function C(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return a.G.buffer(s.hydratedAdapter,l(e),e,t,r,i)}function F(e,t,r,i,n,o){return a.G.geodesicBuffer(s.hydratedAdapter,l(e),e,t,r,i,n,o)}function O(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,n.f)(e),a.G.nearestCoordinate(s.hydratedAdapter,l(e),e,t,r)}function N(e,t){return(0,n.f)(e),a.G.nearestVertex(s.hydratedAdapter,l(e),e,t)}function E(e,t,r,i){return(0,n.f)(e),a.G.nearestVertices(s.hydratedAdapter,l(e),e,t,r,i)}function D(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent?.center??null:null}function Z(e,t,r){if(null==e)throw new J;const i=e.spatialReference;if(null==(r=r??D(e)))throw new J;const n=e.constructor.fromJSON(a.G.rotate(e,t,r));return n.spatialReference=i,n}function z(e,t){if(null==e)throw new J;const r=e.spatialReference;if(null==(t=t??D(e)))throw new J;const i=e.constructor.fromJSON(a.G.flipHorizontal(e,t));return i.spatialReference=r,i}function L(e,t){if(null==e)throw new J;const r=e.spatialReference;if(null==(t=t??D(e)))throw new J;const i=e.constructor.fromJSON(a.G.flipVertical(e,t));return i.spatialReference=r,i}function k(e,t,r,i){return(0,n.f)(e),a.G.generalize(s.hydratedAdapter,l(e),e,t,r,i)}function G(e,t,r){return(0,n.f)(e),a.G.densify(s.hydratedAdapter,l(e),e,t,r)}function V(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.f)(e),a.G.geodesicDensify(s.hydratedAdapter,l(e),e,t,r,i)}function j(e,t){return(0,n.f)(e),a.G.planarArea(s.hydratedAdapter,l(e),e,t)}function H(e,t){return(0,n.f)(e),a.G.planarLength(s.hydratedAdapter,l(e),e,t)}function U(e,t,r){return(0,n.f)(e),a.G.geodesicArea(s.hydratedAdapter,l(e),e,t,r)}function B(e,t,r){return(0,n.f)(e),a.G.geodesicLength(s.hydratedAdapter,l(e),e,t,r)}function W(e,t){return a.G.intersectLinesToPoints(s.hydratedAdapter,l(e),e,t)}function q(e,t){a.G.changeDefaultSpatialReferenceTolerance(e,t)}function $(e){a.G.clearDefaultSpatialReferenceTolerance(e)}class J extends Error{constructor(){super("Illegal Argument Exception")}}},62433:(e,t,r)=>{r.d(t,{CU:()=>s,UQ:()=>o,fF:()=>n,o6:()=>a});var i=r(49959);class n{constructor(){}}function a(e,t,r){if(e instanceof n&&!(e instanceof s)){const i=new s;return i.fn=e,i.parameterEvaluator=r,i.context=t,i}return e}class o extends n{constructor(e){super(),this.fn=e}createFunction(e){var t=this;return function(){for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return t.fn(e,{preparsed:!0,arguments:i})}}call(e,t){return this.fn(e,t)}marshalledCall(e,t,r,o){return o(e,t,((t,l,c)=>{c=c.map((t=>t instanceof n&&!(t instanceof s)?a(t,e,o):t));const u=this.call(r,{args:c});return(0,i.isPromiseLike)(u)?u.then((e=>a(e,r,o))):u}))}}class s extends n{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,t){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}marshalledCall(e,t,r){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}}},62776:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var i,n=r(93800),a=r(84190),o=r(48602),s=(r(21265),r(50925),r(14746),r(75269)),l=r(30142),c=r(75400),u=r(65920),d=r(93321),h=r(26266),p=r(5616),f=r(12921);let m=i=class extends u.default{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const r=(0,a.oU)(this.radius,this.radiusUnit,"meters"),i=e.spatialReference;let n,o="geographic";if(i.isWebMercator?o="webMercator":(null!=(i.wkid&&f.A[i.wkid])||(i.wkt2||i.wkt)&&(0,a.x1)(i.wkt2||i.wkt))&&(o="projected"),this.geodesic){let i;switch(o){case"webMercator":i=(0,p.webMercatorToGeographic)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":i=e}n=this._createGeodesicCircle(i,r,t),"webMercator"===o&&(n=(0,p.geographicToWebMercator)(n))}else{let i;"webMercator"===o||"projected"===o?i=r/(0,a.Ao)(e.spatialReference):"geographic"===o&&(i=(0,a.vl)(r,"meters",(0,l.tO)(e.spatialReference).radius)),n=this._createPlanarCircle(e,i,t)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:r,radiusUnit:n,geodesic:a}=this;return new i({center:e?.clone(),numberOfPoints:t,radius:r,radiusUnit:n,geodesic:a})}_createGeodesicCircle(e,t,r){const i=[],n=[e.x,e.y];for(let a=0;a<360;a+=360/r){const r=this.hasZ?[0,0,e.z??0]:[0,0];(0,h.directGeodeticSolver)(r,n,a,t,d.default.WGS84),i.push(r)}return i.push(i[0]),new u.default({rings:[i]})}_createPlanarCircle(e,t,r){const i=[],n=2*Math.PI/r;for(let a=0;a<r;++a){const r=n*a,o=[e.x+Math.cos(-r)*t,e.y+Math.sin(-r)*t];this.hasZ&&o.push(e.z??0),i.push(o)}return i.push(i[0]),new u.default({spatialReference:e.spatialReference,rings:[i]})}};(0,n._)([(0,o.MZ)({type:c.default})],m.prototype,"center",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"geodesic",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"numberOfPoints",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"radius",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"radiusUnit",void 0),m=i=(0,n._)([(0,s.$)("esri.geometry.Circle")],m);const g=m},64566:(e,t,r)=>{r.d(t,{AO:()=>De,WE:()=>Ue,gn:()=>et,Fj:()=>He,Cz:()=>ke,V2:()=>Xe,CA:()=>Qe,gU:()=>Ke,F3:()=>ht,wI:()=>pt,rW:()=>rt,v2:()=>Ze,ZC:()=>Le,dl:()=>Ve,tv:()=>je,J9:()=>Mt,Dd:()=>mt,w1:()=>ft,lr:()=>Ye,XM:()=>_t});var i,n,a,o=r(29306),s=r(5839),l=r(50925),c=r(64682),u=r(49959),d=r(89227),h=r(28473),p=r(30142),f=r(75400),m=r(96913),g=r(93321),y=r(31183),v=r(70075),w=r(18162),b=r(51064),M=r(68662),_=r(87752),x=r(10382),S=r(98080),T=r(12560),P=r(65920),A=r(53053),I=r(12096),R=r(32006);function C(e,t){const r=[],i=[];return F(r,e,t,a.LEFT),F(i,r,t,a.BOTTOM),F(r,i,t,a.RIGHT),F(i,r,t,a.TOP),i}function F(e,t,r,i){const a=N(r,i);if(e.length=0,t.length){a(E,t[0],t[0])===n.INSIDE&&O(e,t[0]);for(let r=0;r<t.length;r++){const i=t[r===t.length-1?0:r+1];switch(a(E,t[r],i)){case n.INSIDE:O(e,i);break;case n.INSIDE_OUT:O(e,(0,S.o8)(E));break;case n.OUTSIDE_IN:O(e,(0,S.o8)(E)),O(e,i);case n.OUTSIDE:}}}}function O(e,t){0!==e.length&&(0,R.aI)(e.at(-1),t)||e.push(t)}function N(e,t){const r=t===a.LEFT||t===a.RIGHT?0:1,o=e[t],s=t===a.LEFT||t===a.BOTTOM?i.MIN:i.MAX,l=0===r?1:0;return(e,t,a)=>{if(t[r]<o&&a[r]<o)return s===i.MIN?n.OUTSIDE:n.INSIDE;if(t[r]>o&&a[r]>o)return s===i.MIN?n.INSIDE:n.OUTSIDE;const c=(a[l]-t[l])/(a[r]-t[r]),u=t[l]+c*(o-t[r]);return e[r]=o,e[l]=u,(t[r]<o?1:-1)*s>0?n.OUTSIDE_IN:n.INSIDE_OUT}}!function(e){e[e.MIN=1]="MIN",e[e.MAX=-1]="MAX"}(i||(i={})),function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE_IN=2]="OUTSIDE_IN",e[e.INSIDE_OUT=3]="INSIDE_OUT"}(n||(n={})),function(e){e[e.LEFT=0]="LEFT",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP"}(a||(a={}));const E=(0,S.vt)();var D=r(91102),Z=r(15390),z=r(86767);const L=(0,h.fA)(0,1,0),k=(0,h.fA)(0,0,1),G=(0,x.vt)(),V=(0,h.vt)(),j=(0,h.vt)();function H(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,z.NP)();const{direction:n,up:a}=i;return(0,_.N9)(G,-(0,c.kU)(t)),(0,_.eL)(G,G,(0,c.kU)(r)),(0,d.t)(n,k,G),(0,d.h)(n,n,-1),(0,d.t)(a,L,G),i}function U(e,t,r,i,n){const a=t.lines[Z.r.FAR_LEFT].direction,o=(n-r.getAltitude(i))/a[2];(0,d.b)(e,i,a,o)}const B=(0,h.vt)(),W=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,r,i){return(0,z.gn)(t,r,i,k,L)},eyeForCenterWithHeadingTilt:function(e,t,r,i){const n=H(e,r,i),a=(0,h.vt)();return(0,d.h)(a,n.direction,-t),(0,d.g)(a,a,e),{up:n.up,eye:a,heading:r,tilt:i}},eyeTiltToLookAtTilt:function(e){return(0,c.kU)(e)},headingTiltToDirectionUp:H,lookAtTiltToEyeTilt:function(e){return(0,c.KJ)(e)},toArea:function(e,t){const r=e.frustum,{renderCoordsHelper:i}=e,n=i.getAltitude(t),a=e.spatialReference,o=e.state.camera.eye,s=[],l=r.planes[I.FB.FAR];for(let c=0;c<4;c++){const e=r.lines[c];i.intersectInfiniteManifold((0,D.LV)(e.origin,e.direction),n,B)||U(B,r,i,e.endpoint,n),(0,z.gz)(B,o,B,l),s.push((0,S.fA)(B[0],B[1]))}return function(e,t,r){const i=e.map((e=>((0,d.i)(B,e[0],e[1],0),t.fromRenderCoords(B,B,r),[B[0],B[1]])));return i.length<=2?new P.default({spatialReference:r}):(i.push(i[0].slice()),(0,A.$3)(i)||i.reverse(),new P.default({rings:[i],spatialReference:r}))}(C(s,i.extent),i,a)},toExtent:function(e,t,r,i,n){const a=e.renderSpatialReference,o=e.spatialReference??t.spatialReference;return(0,y.g)(t,V,a),(0,y.g)(t,j,a),V[0]-=r/2,j[0]+=r/2,V[1]-=i/2,j[1]+=i/2,(0,w.F)(V,a,V,o),(0,w.F)(j,a,j,o),n?(n.xmin=V[0],n.ymin=V[1],n.xmax=j[0],n.ymax=j[1],n.spatialReference=o):n=new T.default(V[0],V[1],j[0],j[1],o),n}},Symbol.toStringTag,{value:"Module"}));var q=r(60548),$=r(24646),J=r(12147),Y=r(1277),K=r(10872),Q=r(89476),X=r(5616),ee=r(47160),te=r(66797),re=r(11741);const ie=(0,h.fA)(0,0,1),ne=(0,d.n)((0,h.vt)(),(0,h.fA)(1,1,1)),ae=new s.hr(-180,180),oe=(0,x.vt)(),se=(0,h.vt)(),le=(0,h.vt)();function ce(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,z.NP)();(0,d.e)(se,e,ie),0===(0,d.f)(se,se)&&(0,d.e)(se,e,ne),(0,_.$0)(oe,-(0,c.kU)(t),e),(0,_.e$)(oe,oe,-(0,c.kU)(r),se);const{up:n,direction:a}=i;return(0,d.e)(n,se,e),(0,d.n)(n,n),(0,d.t)(n,n,oe),(0,d.n)(a,e),(0,d.v)(a,a),(0,d.t)(a,a,oe),i}function ue(e){const t=e[1];e[1]=-e[2],e[2]=t}function de(e,t){const r=ce(t,e.heading,e.tilt);return e.up=r.up,e}function he(e,t){const r=[],i=[],n=(0,J.FD)();for(let o=0;o<e.length;o++){const a=e[o],s=o===e.length-1?e[0]:e[o+1],l=(0,Y.Cr)(a,s,be),c=(0,K.vE)(t,l.origin,l.vector,K.v1.NONE,ve);switch(c){case K.Nj.INSIDE:r.push(a);break;case K.Nj.OUTSIDE:i.push(a);break;case K.Nj.INTERSECTS_INSIDE_OUT:case K.Nj.INTERSECTS_OUTSIDE_IN:{const[e,o,s]=c===K.Nj.INTERSECTS_INSIDE_OUT?[1,r,i]:[-1,i,r],l=(0,K.Qj)(t),u=(0,d.b)((0,h.vt)(),ve,l,e*n),p=(0,d.b)((0,h.vt)(),ve,l,e*-n);o.push(a),o.push(u),s.push(p)}}}const a=[];return r.length&&a.push(r),i.length&&a.push(i),a}const pe={minCurvature:(0,c.kU)(5),maxCurvature:(0,c.kU)(50),minSamples:1,maxSamples:6},fe=(0,h.fA)(1,0,0),me=(0,h.fA)(0,1,0),ge=(0,h.vt)(),ye=(0,h.vt)(),ve=(0,h.vt)(),we=(0,Q.c)(),be=(0,Y.vt)(),Me=(0,$.vt)(),_e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,r,i){const n=se,a=le;return(0,d.n)(n,e),(0,d.e)(le,n,ie),0===(0,d.f)(le,le)&&(0,d.e)(le,n,ne),(0,d.e)(a,le,n),(0,z.gn)(t,r,i,n,a)},eyeForCenterWithHeadingTilt:function(e,t,r,i){const n={eye:(0,h.vt)(),up:null,tilt:i,heading:r},a=se;a[0]=e[0],a[1]=e[2],a[2]=-e[1];const o=t,s=(0,c.kU)(r),l=(0,c.kU)(i),u=Math.sin(s),p=Math.cos(s),f=Math.sin(l),m=Math.cos(l),g=(0,d.l)(a);let y;if(Math.abs(l)<1e-8)y=o+g;else{const e=g/f,t=(0,c.YN)(o/e),r=Math.PI-l-t;y=e*Math.sin(r)}const v=m*o,w=o*o*(f*f),b=p*p*w,M=y-v,_=M*M,x=b*(b+_-a[1]*a[1]);if(x<0)return(0,d.h)(n.eye,a,y/g),n.tilt=0,de(n,e);const S=Math.sqrt(x),T=a[1]*M,P=b+_;let A;if(A=p>0?-S+T:S+T,Math.abs(P)<1e-8)return g<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):(0,d.h)(n.eye,a,y/g),n.tilt=0,ue(n.eye),de(n,e);n.eye[1]=A/P;const I=u*u*w,R=f*o,C=p*R*n.eye[1],F=n.eye[1]*n.eye[1],O=1-F,N=Math.sqrt(O),E=b*F+I-2*C*N*M+O*_;return Math.abs(E)<1e-8?((0,d.h)(n.eye,a,y/g),n.tilt=0,ue(n.eye),de(n,e)):(n.eye[0]=(O*(y*a[0]-v*a[0])-R*N*(a[0]*n.eye[1]*p+a[2]*u))/E,n.eye[2]=(O*(y*a[2]-v*a[2])-R*N*(a[2]*n.eye[1]*p-a[0]*u))/E,(0,d.h)(n.eye,n.eye,y),ue(n.eye),de(n,e))},eyeTiltToLookAtTilt:function(e,t,r){const i=(0,c.kU)(e),n=(0,d.l)(t);return(0,c.YN)(r/(n/Math.sin(i)))+i},headingTiltToDirectionUp:ce,lookAtTiltToEyeTilt:function(e,t,r){const i=(0,d.l)(t),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),a=(0,c.YN)(r/(n/Math.sin(e)));return(0,c.KJ)(e-a)},toArea:function(e,t){const r=e.frustum,{renderCoordsHelper:i}=e,n=i.getAltitude(t),a=e.spatialReference,o=i.referenceEllipsoid.radius,s=e.state.camera,l=s.eye,u=1+(0,d.j)(l,t)/(o+n),p=Math.sqrt(u*u-1),{minCurvature:f,maxCurvature:m,minSamples:g,maxSamples:y}=pe,v=function(e){const{renderCoordsHelper:t,state:{camera:r}}=e,{center:i,eye:n}=r,a=Math.abs(t.getAltitude(i)),o=Math.abs(Math.PI/2-(0,ee.T)(t,i,n));return(0,Q.b)(we,t.referenceEllipsoid.radius+a),(0,Q.d)(we,o,r.distance,r.fovY)}(e),w=(0,c.qE)((p-f)/(m-f),0,1),b=Math.round((0,c.Cc)(g,y,w)),M=s.aboveGround,_=r.planes[I.FB.FAR],x=[],S=(0,K.O_)(h.uY,fe,(0,K.vt)()),T=(0,K.O_)(h.uY,me,(0,K.vt)());(0,q.s)(Me,0,0,0,0);for(let P=0;P<4;P++){const e=P===Z.r.NEAR_FAR_BOTTOM_RIGHT&&!M||P===Z.r.NEAR_FAR_TOP_LEFT&&M?1-v:0,t=P===Z.r.NEAR_FAR_BOTTOM_RIGHT&&M||P===Z.r.NEAR_FAR_TOP_LEFT&&!M?v:1,a=r.lines[P],o=r.lines[3===P?0:P+1];for(let r=0;r<b;r++){const s=r/b,u=P===Z.r.NEAR_FAR_BOTTOM_RIGHT?1-(1-s)**2:P===Z.r.NEAR_FAR_TOP_LEFT?s**2:s,p=0===r?0:(0,c.Cc)(e,t,u),f=(0,d.m)(ye,a.origin,o.origin,p),m=(0,re.nu)(a.direction,o.direction,p,ge);i.intersectManifoldClosestSilhouette((0,D.LV)(f,m),n,ve),(0,z.gz)(ve,l,ve,_),x.push((0,h.o8)(ve)),0!==x.length&&(0,d.y)(x.at(-1),ve);const g=((0,K.Tj)(S,ve)?1:0)|((0,K.Tj)(T,ve)?2:0);Me[g]=1}}x.length>2&&(0,d.y)(x[0],x.at(-1));const R=function(e,t,r){const i=2*(0,J.FD)();return e.map((e=>{const n=[];let a=!1;for(const o of e)t.fromRenderCoords(o,ve,r),Math.abs(o[0])<i&&Math.abs(o[1])<i?(n.push([null,ve[1]]),n.push([null,ve[1]]),a=!0):n.push([ve[0],ve[1]]);if(a)for(let t=0;t<n.length;t++){const e=n[t];if(null!=e[0])continue;const r=n[t+1],i=n.at(0===t?-1:t-1);e[0]=i[0],t++;const a=n.at(t===n.length-1?0:t+1);r[0]=a[0]}return n.push(n[0]),(0,A.$3)(n)||n.reverse(),n}))}((0,q.f)(Me)>1?function(e,t){const r=[];for(const i of e)r.push(...he(i,t));return r}(he(x,S),T):[x],i,a);return new P.default({rings:R,spatialReference:a})},toExtent:function(e,t,r,i,n){let a,o,l,u;const d=t.latitude,h=(0,p.tO)(e.spatialReference).radius,f=t.longitude,m=(0,te.cq)(d,r,h)/2;a=f-m,o=f+m;const y=(0,c.kU)(d),v=(1+Math.sin(y))/(1-Math.sin(y)),w=(v+1)*Math.tan(i/h/2),b=w*w;function M(e){const t=Math.PI/2;return(e=s.uC.normalize(e,-t))>t&&(e=Math.PI-e),e}if(l=1.5*Math.PI-2*Math.atan(.5*(w+Math.sqrt(4*v+b))),u=l+i/h,l=M(l),u=M(u),u<l){const e=u;u=l,l=e}if(l=Math.max((0,c.KJ)(l),-90),u=Math.min((0,c.KJ)(u),90),o=ae.monotonic(a,o),o-a>180){const e=(o-a-180)/2;a+=e,o-=e}const _=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:g.default.WGS84;return n?(n.xmin=a,n.ymin=l,n.xmax=o,n.ymax=u,n.spatialReference=_):n=new T.default(a,l,o,u,_),e.spatialReference&&e.spatialReference.isWebMercator&&(0,X.geographicToWebMercator)(n,!1,n),n}},Symbol.toStringTag,{value:"Module"}));var xe=r(96504),Se=r(66380);const Te=()=>l.A.getLogger("esri.views.3d.support.cameraUtils"),Pe=96*39.37,Ae=1,Ie=8,Re=5,Ce=1,Fe={heading:0,tilt:0},Oe=(0,h.vt)(),Ne=new s.hr(-20037508.342788905,20037508.342788905),Ee=new s.hr(-180,180);var De;function Ze(e){return e.spatialReference??g.default.WGS84}function ze(e){let{state:t}=e;return t.isGlobal?_e:W}function Le(e,t,r,i,n){return ze(e).headingTiltToDirectionUp(t,r,i,n)}function ke(e,t){if(null==t)return null;const r=e.renderSpatialReference,i=ze(e).headingTiltToDirectionUp,n=(0,h.vt)();if(!(0,y.g)(t.position,n,r))return null;const a=i(n,t.heading,t.tilt);(0,d.h)(a.direction,a.direction,e.state.camera.distance),(0,d.g)(a.direction,a.direction,n);const o=(0,M.bZ)(e,n,a.direction,a.up);return o.fov=(0,c.kU)(t.fov),o.row=t.layout.row,o.rows=t.layout.rows,o.column=t.layout.column,o.columns=t.layout.columns,o}!function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"}(De||(De={}));const Ge=(0,h.vt)();function Ve(e,t,r){const i=e.renderSpatialReference,n=et(e,t.eye,t.viewForward,t.up,Fe);let a=Ze(e);return(0,w.F)(t.eye,i,Ge,a)||(a=g.default.WGS84,(0,w.F)(t.eye,i,Ge,a)),null==r?r=new o.default(new f.default(Ge,a),n.heading,n.tilt,(0,c.KJ)(t.fov)):(r.position.x=Ge[0],r.position.y=Ge[1],r.position.z=Ge[2],r.position.spatialReference=a,r.heading=n.heading,r.tilt=n.tilt,r.fov=(0,c.KJ)(t.fov)),r.layout.row=t.row,r.layout.rows=t.rows,r.layout.column=t.column,r.layout.columns=t.columns,r}function je(e,t){const{camera:r}=e.state,{unitInMeters:i}=e.renderCoordsHelper;return t/=i,r.width/2/r.pixelRatio/(Pe/t)/Math.tan(r.fovX/2)}function He(e,t){const{camera:r}=e.state,{unitInMeters:i}=e.renderCoordsHelper,n=t*Math.tan(r.fovX/2),a=r.width/2/r.pixelRatio;return Pe/(a/n)*i}function Ue(e,t,r,i){const n=i.levelAtScale(t),a=We(et(e,r.eye,r.viewForward,r.up).tilt),o=Math.max(n-a,0);return i.scaleAtLevel(o)}function Be(e,t,r){const i=r.levelAtScale(e),n=We(t);return r.scaleAtLevel(i+n)}function We(e){return 2*((e>90?180-e:e)/90)**2}function qe(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=ke(e,t);return i?function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e.basemapTerrain?.tilingScheme;if(!i)return 0;const n=(0,p.tO)(e.spatialReference).radius,a=e.state.viewingMode===b.RT.Local?t.eye[2]:(0,d.l)(t.eye)-n;return Ue(e,He(e,Math.abs(a-r)),t,i)}(e,i,r):0}const $e=1,Je=100;function Ye(e,t,r,i,n){if(0===t)return 0;const a=(0,d.j)(r.eye,i),o=e.basemapTerrain?.tilingScheme;if(!o)return Te().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),a;let s=a;const l=et(e,r.eye,r.viewForward,r.up),u=l.tilt>90;if(e.state.isLocal){const i=(je(e,Be(t,l.tilt,o))-Math.abs(r.eye[2]-n[2]))/Math.cos((0,c.kU)(l.tilt));return s=u?s-i:s+i,s}let h=1/0,f=0,m=rt(e,l.heading,l.tilt,i,a,De.ADJUST);if(!m)return s;const g=(0,d.l)(n);for(;h>$e&&f<Je;){const n=(0,d.l)(m.eye),a=u?180-m.tilt:m.tilt,y=(0,c.kU)(a),v=Math.sin(y)*n,w=Math.cos(y)*n,b=je(e,Be(t,m.tilt,o)),M=u?g-b:g+b,_=(0,c.YN)(v/M),x=Math.cos(_)*M-w,S=(0,d.j)(m.eye,i);s=u?S-x:S+x,m=rt(e,l.heading,l.tilt,i,s,De.ADJUST);const T=wt(e,m,(0,c.KJ)(r.fov));if(!m||!T)return s;const P=qe(e,T,g-(0,p.tO)(e.spatialReference).radius);h=Math.abs(t-P),++f}return s}async function Ke(e,t,r,i,n,a){return Xe(e,t,je(e,r),i,n,a)}function Qe(e,t,r,i,n,a){return wt(e,rt(e,i.heading,i.tilt,t,r,n),i.fov,a)}async function Xe(e,t,r,i,n,a){const o=await it(e,i.heading,i.tilt,t,r,n,a);return(0,u.throwIfAborted)(a),bt(e,o,i.fov,a)}function et(e,t,r,i,n){return ze(e).directionToHeadingTilt(t,r,i,n)}function tt(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Oe,e.spatialReference)&&e.elevationProvider&&((0,xe.R1)(e.elevationProvider,Oe)??0)>Oe[2]-Ce)}function rt(e,t,r,i,n,a){return nt(e,t,r,i instanceof f.default?i:null,function(e,t){const r=(0,h.vt)();if(null==t)return(0,d.c)(r,e.state.camera.center);if(t instanceof f.default){if(!(0,y.g)(t,r,e.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:n}=e;if(null==t.z&&null!=i&&null!=n){const i=(0,xe.R1)(n,t);null!=i&&e.renderCoordsHelper.setAltitude(r,i)}return r}return(0,d.c)(r,t)}(e,i),n,a)}async function it(e,t,r,i,n,a,o){const s=i instanceof f.default?i:null,l=await async function(e,t,r){const i=(0,h.vt)();if(null==t)return(0,d.c)(i,e.state.camera.center);if(t instanceof f.default){const{renderSpatialReference:n,basemapTerrain:a,elevationProvider:o}=e,s=t.spatialReference;if(await(0,y.W)(t,i,n,0,{signal:r}),(0,u.throwIfAborted)(r),null==t.z&&null!=a&&null!=o){const n=await o.queryElevation(t.x,t.y,t.z??0,s,"ground",r);(0,u.throwIfAborted)(r),null!=n&&e.renderCoordsHelper.setAltitude(i,n)}return i}return(0,d.c)(i,t)}(e,i,o);return(0,u.throwIfAborted)(o),at(e,t,r,s,l,n,a,o)}function nt(e,t,r,i,n,a,o){if(null==n)return null;if(!i&&(i=new f.default({spatialReference:Ze(e)}),!(0,v.E)(n,e.renderSpatialReference,i)))return null;const s=ot(e,t,r,n,a,o);if(st(e,r,o)&&tt(e,s.eye)){const{tilt:o,mode:s}=lt(e,r,n,a);return nt(e,t,o,i,n,a,s)}return ct(s,n)}async function at(e,t,r,i,n,a,o,s){i||(i=new f.default({spatialReference:Ze(e)}),await(0,v.C)(n,e.renderSpatialReference,i,{signal:s})||(i=null)),(0,u.throwIfAborted)(s);const l=ot(e,t,r,n,a,o);if(st(e,r,o)&&await async function(e,t,r){if(tt(e,t))return!0;const{elevationProvider:i,spatialReference:n,renderCoordsHelper:a}=e;if(null==i||!a.fromRenderCoords(t,Oe,n))return!1;const[o,s,l]=Oe,c=await i.queryElevation(o,s,l,n,"ground",r)??0;return(0,u.throwIfAborted)(r),c>l-Ce}(e,l.eye,s)){(0,u.throwIfAborted)(s);const{tilt:o,mode:l}=lt(e,r,n,a);return at(e,t,o,i,n,a,l,s)}return ct(l,n)}function ot(e,t,r,i,n,a){const o=function(e,t,r,i,n,a){let o=0;return a===De.ADJUST&&function(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>Ie)return!0;const n=t,a=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return(0,d.j)(n,a)/(Math.tan(.5*e.state.camera.fov)*i)>Re}(e,i,n)?(t=0,o=function(e,t,r,i){const n=vt(e,i,t,r);if(!e.state.constraints.tilt)return n;const a=e.state.constraints.tilt(t);a.max=Math.min(a.max,.5*Math.PI);const o=a.min*(1-gt)+a.max*gt;return Math.min(n,o)}(e,n,r,i)):o=vt(e,i,n,r),o=e.state.constraints.clampTilt(n,o),{heading:t,tilt:r=yt(e,i,n,o)}}(e,t,r,i,n=Math.max(n,e.state.constraints.minimumPoiDistance),a);return(0,ze(e).eyeForCenterWithHeadingTilt)(i,n,o.heading,o.tilt)}function st(e,t,r){const i=e.map.ground.navigationConstraint;return r===De.ADJUST&&e.state.isGlobal&&t>0&&(null==i||"stay-above"===i.type)}function lt(e,t,r,i){const n=yt(e,r,i,function(e,t,r,i){let n=vt(e,i,t,r);if(!e.state.constraints.tilt)return n;const a=e.state.constraints.tilt(t);return n=Math.min(n,.5*Math.PI),a.min*(1-gt)+n*gt}(e,i,t,r));return{tilt:n,mode:t-n<1?De.LOCKED:De.ADJUST}}function ct(e,t){return{...e,center:(0,h.o8)(t)}}function ut(e,t){const{state:r,spatialReference:i}=e,n=t.spatialReference;return r.isGlobal&&(0,Se.M)(n,b.RT.Global)||r.isLocal&&i.equals(n)}function dt(e,t){let r,i,n;if(e.state.isGlobal){const e=new f.default(t.xmin,t.ymin,t.spatialReference),a=new f.default(t.xmax,t.ymax,t.spatialReference),o=t.spatialReference.isGeographic?Ee:Ne;r=new f.default({x:o.center(e.x,a.x),y:(a.y+e.y)/2,z:null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});const s=(0,p.tO)(t.spatialReference),l=(0,te.J_)(r,e,a);i=l.lon,n=l.lat,o.diff(e.x,a.x)>o.range/2&&(i+=s.halfCircumference),i=Math.min(i,s.halfCircumference),n=Math.min(n,s.halfCircumference)}else{const a=e.renderSpatialReference??t.spatialReference;a.equals(t.spatialReference)||(t=(0,m.project)(t,a)),i=t.xmax-t.xmin,n=t.ymax-t.ymin;const o=null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0;r=new f.default({x:t.xmin+.5*i,y:t.ymin+.5*n,z:o,spatialReference:a})}const a=null!=t.zmax&&null!=t.zmin?t.zmax-t.zmin:0,o=e.state.camera,s=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:r,distance:Math.max(.5*i*s,.5*n*l,.5*a*c)/Ae}}async function ht(e,t,r,i,n,a){const o=ut(e,t)?t:await(0,m.projectWithZConversion)(t,e.spatialReference,{signal:a});(0,u.throwIfAborted)(a);const{center:s,distance:l}=dt(e,o),c=await it(e,r,i,s,l,n,a);return(0,u.throwIfAborted)(a),bt(e,c,e.camera.fov,a)}function pt(e,t,r,i,n,a){let o;try{o=ut(e,t)?t:(0,m.project)(t,e.spatialReference)}catch(u){return null}const{center:s,distance:l}=dt(e,o),c=rt(e,r,i,s,l,n);return null==c?null:wt(e,c,e.camera.fov,a)}function ft(e,t,r){const i=e.renderSpatialReference,n=new f.default({spatialReference:Ze(e)});if(!(0,v.E)(r,i,n))return null;const a=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),s=(0,d.G)(t.eye,r),l=2*s*a*Ae,c=2*s*o*Ae;return ze(e).toExtent(e,n,l,c)}function mt(e,t){return ze(e).toArea(e,t)}const gt=.7;function yt(e,t,r,i){return ze(e).lookAtTiltToEyeTilt(i,t,r)}function vt(e,t,r,i){return ze(e).eyeTiltToLookAtTilt(i,t,r)}function wt(e,t,r,i){if(null==t)return null;const n=e.renderSpatialReference,a=new f.default({spatialReference:Ze(e)});return(0,v.E)(t.eye,n,a)?(i??=new o.default,i.position=a,i.heading=t.heading,i.tilt=t.tilt,i.fov=r,i):null}async function bt(e,t,r,i){const n=e.renderSpatialReference,a=new f.default({spatialReference:Ze(e)});return await(0,v.C)(t.eye,n,a,{signal:i}),(0,u.throwIfAborted)(i),new o.default(a,t.heading,t.tilt,r)}function Mt(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.levelAtScale(t);Te().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function _t(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.scaleAtLevel(t);Te().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}},66201:(e,t,r)=>{function i(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const r=t._delegatedEventNames,i=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);r.push(...i)}}r.d(t,{U:()=>i})},66380:(e,t,r)=>{r.d(t,{M:()=>a});var i=r(78757),n=r(51064);function a(e,t){return null!=e&&(null==t||(t===n.RT.Local?!e.isGeographic||e.isWGS84||e.wkid===i.Y.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===i.Y.CGCS2000||e.wkid===i.Y.GCSMARS2000||e.wkid===i.Y.GCSMARS2000_SPHERE||e.wkid===i.Y.GCSMOON2000))}},66458:(e,t,r)=>{r.d(t,{U:()=>a});var i=r(92156),n=r(605);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=e.stride;return Array.from(e.fields.keys()).map((i=>{const a=e.fields.get(i),s=a.constructor.ElementCount,l=o(a.constructor.ElementType),c=a.offset,u=a.optional?.glNormalized??!1;return new n._(i,s,l,c,r,u,t)}))}function o(e){const t=s[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const s={u8:i.pe.UNSIGNED_BYTE,u16:i.pe.UNSIGNED_SHORT,u32:i.pe.UNSIGNED_INT,i8:i.pe.BYTE,i16:i.pe.SHORT,i32:i.pe.INT,f32:i.pe.FLOAT}},66797:(e,t,r)=>{r.d(t,{J_:()=>s,aE:()=>u,cq:()=>l,uu:()=>c});var i=r(64682),n=r(30142),a=r(75400);function o(e,t,r){if(null==t.longitude||null==t.latitude||null==r.longitude||null==r.latitude)throw new Error("Invalid points: no lon/lat");return function(e,t,r,n,a){const o=(0,i.kU)(r),s=(0,i.kU)(a),l=o-s,c=(0,i.kU)(t)-(0,i.kU)(n),u=Math.sin(l/2),d=Math.sin(c/2),h=2*(0,i.YN)(Math.sqrt(u*u+Math.cos(o)*Math.cos(s)*d*d))*e;return Math.round(1e4*h)/1e4}(e,t.longitude,t.latitude,r.longitude,r.latitude)}function s(e,t,r){const i=t.spatialReference,s=(0,n.tO)(i),l=new a.default(t.x,e.y,i),c=new a.default(r.x,e.y,i),u=new a.default(e.x,t.y,i),d=new a.default(e.x,r.y,i);return{lon:o(s.radius,l,c),lat:o(s.radius,u,d)}}function l(e,t,r){const n=t/r,a=(0,i.kU)(e),o=Math.sin(n/2),s=Math.cos(a),l=2*(0,i.YN)(Math.sqrt(o*o/(s*s)));return(0,i.KJ)(l)}function c(e,t){let r=e/15;return t||(r=Math.round(r)),r}function u(e,t){const r=e?.[0];if(null==r)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=c(r,!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const n=t.minutes%1;return t.minutes-=n,t.seconds=Math.round(60*n),t}},68661:(e,t,r)=>{r.d(t,{A:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._elements=e}length(){return this._elements.length}get(e){return this._elements[e]}toArray(){return this.slice()}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length();const r=[];for(let i=e;i<t;i++)r.push(this.get(i));return r}}},68662:(e,t,r)=>{r.d(t,{HD:()=>l,Rt:()=>c,bZ:()=>u});var i=r(89227),n=r(28473),a=r(30142),o=r(90772),s=r(8609);function l(e,t,r,i){return null!=e.renderCoordsHelper.fromRenderCoords(t.eye,p,i)&&(0,o.Uc)(r,p)}function c(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function u(e,t,r,n){const o=e.state.camera.clone();t&&r&&n&&(o.eye=t,o.center=r,o.up=n),function(e,t,r){let n=h[e.viewingMode];n||(n=(0,s.hz)(e.state.viewingMode),n.options.backfacesTerrain=!e.state.isGlobal,n.options.invisibleTerrain=!0,h[e.viewingMode]=n);const{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,n,r)||d(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||d(e,t.origin,r))||!!o&&function(e,t,r){const n=(0,i.f)(e.origin,e.origin)-r*r,a=n>0?Math.sqrt(n)/3:1;return(0,i.h)(t,e.direction,a/(0,i.l)(e.direction)),(0,i.g)(t,t,e.origin),!0}(t,r,(0,a.tO)(e.spatialReference).radius)}(e,o.ray,f)||(0,i.c)(f,o.center);const l=e.state.constraints,c=l.minimumPoiDistance;if((0,i.s)(o.eye,f)<c){const t=l.collision.enabled;(0,i.c)(m,o.viewForward),(0,i.h)(m,m,c),t?o.eye=(0,i.d)(p,f,m):(0,i.g)(f,o.eye,m);const r=e.renderCoordsHelper,n=r.getAltitude(o.eye),a=l.collision.elevationMargin;t&&n<a&&((0,i.d)(m,f,o.eye),o.eye=r.setAltitude(p,a,o.eye),(0,i.g)(f,o.eye,m))}return o.center=f,o}function d(e,t,r){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const n=c(e,t),a=e.stateManager.constraintsManager.nearFarHeuristic,{far:o}=a.compute(t,r,e.renderDataExtent,n,g),s=o*o;return(0,i.s)(t,r)>s}const h={},p=(0,n.vt)(),f=(0,n.vt)(),m=(0,n.vt)(),g={near:0,far:0}},70075:(e,t,r)=>{r.d(t,{C:()=>s,E:()=>o});var i=r(28473),n=r(96913),a=r(18162);function o(e,t,r){return!!(0,a.F)(e,t,l,r.spatialReference)&&(r.x=l[0],r.y=l[1],r.z=l[2],!0)}async function s(e,t,r,i){return await(0,n.initializeProjection)(t,r.spatialReference,null,i),o(e,t,r)}const l=(0,i.vt)()},70612:(e,t,r)=>{r.d(t,{$P:()=>h,At:()=>b,J6:()=>n,JB:()=>_,Lk:()=>p,NI:()=>x,Qi:()=>M,eB:()=>S,eg:()=>g,f0:()=>m,gO:()=>y,ik:()=>v,ke:()=>u,nE:()=>d,rX:()=>f,yT:()=>w,zl:()=>i});var i,n,a=r(10844),o=r(73974),s=r(35527),l=r(50616),c=r(51536);function u(e){return l.default.fromJSON(e.toJSON())}function d(e){return e.toJSON?e.toJSON():e}function h(e){return e instanceof Date}function p(e){return e instanceof c.c9}function f(e){return e instanceof a.lY}function m(e){return e instanceof o.n}function g(e){return e instanceof s.k}!function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"}(i||(i={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(n||(n={}));const y=1e3;const v={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},w={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},b={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};function M(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function _(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){const i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}});var n;const a=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(a.includes(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const s=a.push(t)-1,l=Object.keys(t).sort(i?.(t));for(o="",n=0;n<l.length;n++){const r=l[n],i=e(t[r]);i&&(o&&(o+=","),o+=JSON.stringify(r)+":"+i)}return a.splice(s,1),"{"+o+"}"}(e)}function x(e){switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"knowledge-graph-sublayer":case"oriented-imagery":case"subtype-group":case"wfs":return!0;default:return!1}}function S(e){switch(e.type){case"catalog-footprint":case"subtype-sublayer":return!0;default:return x(e)}}},72172:(e,t,r)=>{r.d(t,{B:()=>p,D$:()=>l,Nh:()=>h,O$:()=>d,TX:()=>i,mT:()=>u,ps:()=>m});var i,n=r(56612);!function(e){e.AsyncNotEnabled="AsyncNotEnabled",e.ModulesNotSupported="ModulesNotSupported",e.CircularModules="CircularModules",e.CannotCompareDateAndTime="CannotCompareDateAndTime",e.NeverReach="NeverReach",e.UnsupportedHashType="UnsupportedHashType",e.InvalidParameter="InvalidParameter",e.FeatureSetDoesNotHaveSubtypes="FeatureSetDoesNotHaveSubtypes",e.UnexpectedToken="UnexpectedToken",e.Unrecognized="Unrecognized",e.UnrecognizedType="UnrecognizedType",e.MaximumCallDepth="MaximumCallDepth",e.BooleanConditionRequired="BooleanConditionRequired",e.TypeNotAllowedInFeature="TypeNotAllowedInFeature",e.KeyMustBeString="KeyMustBeString",e.WrongNumberOfParameters="WrongNumberOfParameters",e.CallNonFunction="CallNonFunction",e.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",e.NoFunctionInDictionary="NoFunctionInDictionary",e.NoFunctionInArray="NoFunctionInArray",e.AssignModuleFunction="AssignModuleFunction",e.LogicExpressionOrAnd="LogicExpressionOrAnd",e.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",e.FunctionNotFound="FunctionNotFound",e.InvalidMemberAccessKey="InvalidMemberAccessKey",e.UnsupportedUnaryOperator="UnsupportUnaryOperator",e.InvalidIdentifier="InvalidIdentifier",e.MemberOfNull="MemberOfNull",e.UnsupportedOperator="UnsupportedOperator",e.Cancelled="Cancelled",e.ModuleAccessorMustBeString="ModuleAccessorMustBeString",e.ModuleExportNotFound="ModuleExportNotFound",e.Immutable="Immutable",e.OutOfBounds="OutOfBounds",e.IllegalResult="IllegalResult",e.FieldNotFound="FieldNotFound",e.PortalRequired="PortalRequired",e.LogicError="LogicError",e.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",e.KeyAccessorMustBeString="KeyAccessorMustBeString",e.WrongSpatialReference="WrongSpatialReference",e.CannotChangeTimeZoneTime="CannotChangeTimeZoneTime",e.CannotChangeTimeZoneDateOnly="CannotChangeTimeZoneDateOnly"}(i||(i={}));const a={[i.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[i.LogicError]:"Logic error - {reason}",[i.CannotCompareDateAndTime]:"Cannot compare date or dateonly with timeonly types",[i.NeverReach]:"Encountered unreachable logic",[i.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[i.ModuleAccessorMustBeString]:"Module accessor must be a string",[i.ModuleExportNotFound]:"Module has no export with provided identifier",[i.ModulesNotSupported]:"Current profile does not support modules",[i.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[i.FunctionNotFound]:"Function not found",[i.FieldNotFound]:"Key not found - {key}",[i.CircularModules]:"Circular module dependencies are not allowed",[i.Cancelled]:"Execution cancelled",[i.UnsupportedHashType]:"Type not supported in hash function",[i.IllegalResult]:"Value is not a supported return type",[i.PortalRequired]:"Portal is required",[i.InvalidParameter]:"Invalid parameter",[i.WrongNumberOfParameters]:"Call with wrong number of parameters",[i.Unrecognized]:"Unrecognized code structure",[i.UnrecognizedType]:"Unrecognized type",[i.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[i.BooleanConditionRequired]:"Conditions must use booleans",[i.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[i.NoFunctionInArray]:"Arrays cannot contain functions.",[i.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[i.KeyAccessorMustBeString]:"Accessor must be a string",[i.KeyMustBeString]:"Object keys must be a string",[i.Immutable]:"Object is immutable",[i.UnexpectedToken]:"Unexpected token",[i.MemberOfNull]:"Cannot access property of null object",[i.MaximumCallDepth]:"Exceeded maximum function depth",[i.OutOfBounds]:"Out of bounds",[i.InvalidIdentifier]:"Identifier not recognized",[i.CallNonFunction]:"Expression is not a function",[i.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[i.AssignModuleFunction]:"Cannot assign function to module variable",[i.UnsupportedUnaryOperator]:"Unsupported unary operator",[i.UnsupportedOperator]:"Unsupported operator",[i.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[i.LogicExpressionOrAnd]:"Logical expression can only be combined with || or &&",[i.CannotChangeTimeZoneTime]:"Cannot change the timezone of a Time",[i.CannotChangeTimeZoneDateOnly]:"Cannot change the timezone of a DateOnly",[i.FeatureSetDoesNotHaveSubtypes]:"FeatureSet does not have subtypes"};class o extends Error{constructor(){super(...arguments)}}class s extends o{constructor(e,t){super(c(t)+e.message,{cause:e}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,s),t?.loc&&(this.loc=t.loc)}}class l extends Error{constructor(e,t,r,i){super("Execution error - "+c(r)+(0,n.HC)(a[t],i)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,l),r?.loc&&(this.loc=r.loc)}}function c(e){return e&&e.loc?`Line : ${e.loc.start?.line}, ${e.loc.start?.column}: `:""}class u extends Error{constructor(e,t,r,i){super("Compilation error - "+c(r)+(0,n.HC)(a[t],i)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,u),r?.loc&&(this.loc=r.loc)}}class d extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,d)}}function h(e,t,r){return"esri.arcade.arcadeexecutionerror"===r.declaredRootClass||"esri.arcade.arcadecompilationerror"===r.declaredRootClass?null===r.loc&&t?.loc?new s(r,{cause:r}):r:("esri.arcade.featureset.support.featureseterror"===r.declaredRootClass||"esri.arcade.featureset.support.sqlerror"===r.declaredRootClass||r.declaredRootClass,t?.loc?new s(r,{cause:r}):r)}var p;!function(e){e.UnrecognizedUri="UnrecognizedUri",e.UnsupportedUriProtocol="UnsupportedUriProtocol"}(p||(p={}));const f={[p.UnrecognizedUri]:"Unrecognized uri - {uri}",[p.UnsupportedUriProtocol]:"Unrecognized uri protocol"};class m extends Error{constructor(e,t){super((0,n.HC)(f[e],t)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,m)}}},73974:(e,t,r)=>{r.d(t,{n:()=>l});var i=r(10844),n=r(12711),a=r(51536);function o(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let t="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const i of e.match(r)||[])switch(i){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"X":case"x":t+=i;break;default:i.length>=2&&"["===i.slice(0,1)&&"]"===i.slice(-1)?t+=`'${i.slice(1,-1)}'`:t+=`'${i}'`}return t}const s="esri.core.sql.dateonly";class l{constructor(e,t,r){this._year=e,this._month=t,this._day=r,this.declaredRootClass=s}static isDateOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===s}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return l.isDateOnly(e)&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new l(this._year,this._month,this._day)}toDateTime(e){return a.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,i.mT)(e)})}toDateTimeLuxon(e){return a.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,i.mT)(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e||""===e)return this.toString();if(t&&(e=o(e)),!e)return"";const r=this.toDateTime("unknown");return i.lY.dateTimeToArcadeDate(r).toFormat(e,{locale:(0,n.JK)(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return i.lY.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,t){return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}toUTCDateTime(){return a.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const t=a.c9.fromMillis(e,{zone:a.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromSeconds(e){const t=a.c9.fromSeconds(e,{zone:a.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromReader(e){if(!e)return null;const t=e.split("-");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}static fromParts(e,t,r){const i=new l(e,t,r);return!1===i.isValid?null:i}static fromDateJS(e){return l.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return l.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const r=[];if(t)(t=o(t))&&r.push(t);else if(null===t||""===t){const t=a.c9.fromISO(e,{setZone:!0});return t.isValid?l.fromParts(t.year,t.month,t.day):null}for(const i of r){const r=a.c9.fromFormat(e,t??i);if(r.isValid)return new l(r.year,r.month,r.day)}return null}static fromNow(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"system";const t=a.c9.fromJSDate(new Date).setZone((0,i.mT)(e));return new l(t.year,t.month,t.day)}}},79984:(e,t,r)=>{r.d(t,{Cy:()=>s,UT:()=>d,hs:()=>c,lR:()=>l,wW:()=>u});var i=r(64682),n=r(90772),a=r(41896),o=r(53053);function s(e,t,r,i){if(null==i||e.hasZ||(i=void 0),"point"===e.type)return e.x+=t,e.y+=r,e.hasZ&&null!=i&&(e.z+=i),e;if("multipoint"===e.type){const n=e.points;for(let e=0;e<n.length;e++)n[e]=h(n[e],t,r,i);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=r,e.ymax+=r,null!=i&&(e.zmin??=0,e.zmin+=i,e.zmax??=0,e.zmax+=i),e;const n=(0,o.$K)(e),a="polyline"===e.type?e.paths:e.rings;for(let o=0;o<n.length;o++){const e=n[o];for(let n=0;n<e.length;n++)e[n]=h(e[n],t,r,i)}return"paths"in e?e.paths=a:e.rings=a,e}function l(e,t,r,i,n){const a=e.clone(),l=i.resolution;if("point"===a.type){if(n)s(a,t*l,-r*l);else{const e=i.state.transform,n=i.state.inverseTransform,o=e[0]*a.x+e[2]*a.y+e[4],s=e[1]*a.x+e[3]*a.y+e[5];a.x=n[0]*(o+t)+n[2]*(s+r)+n[4],a.y=n[1]*(o+t)+n[3]*(s+r)+n[5]}return a}if("multipoint"===a.type){if(n)s(a,t*l,-r*l);else{const e=a.points,n=i.state.transform,o=i.state.inverseTransform;for(let i=0;i<e.length;i++){const a=e[i],s=n[0]*a[0]+n[2]*a[1]+n[4],l=n[1]*a[0]+n[3]*a[1]+n[5],c=o[0]*(s+t)+o[2]*(l+r)+o[4],u=o[1]*(s+t)+o[3]*(l+r)+o[5];e[i]=p(a,c,u,void 0)}}return a}if("extent"===a.type){if(n)s(a,t*l,-r*l);else{const e=i.state.transform,n=i.state.inverseTransform,o=e[0]*a.xmin+e[2]*a.ymin+e[4],s=e[1]*a.xmin+e[3]*a.ymin+e[5],l=e[0]*a.xmax+e[2]*a.ymax+e[4],c=e[1]*a.xmax+e[3]*a.ymax+e[5];a.xmin=n[0]*(o+t)+n[2]*(s+r)+n[4],a.ymin=n[1]*(o+t)+n[3]*(s+r)+n[5],a.xmax=n[0]*(l+t)+n[2]*(c+r)+n[4],a.ymax=n[1]*(l+t)+n[3]*(c+r)+n[5]}return a}if(n)s(a,t*l,-r*l);else{const e=(0,o.$K)(a),n="polyline"===a.type?a.paths:a.rings,s=i.state.transform,l=i.state.inverseTransform;for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++){const i=n[e],a=s[0]*i[0]+s[2]*i[1]+s[4],o=s[1]*i[0]+s[3]*i[1]+s[5],c=l[0]*(a+t)+l[2]*(o+r)+l[4],u=l[1]*(a+t)+l[3]*(o+r)+l[5];n[e]=p(i,c,u,void 0)}}"paths"in a?a.paths=n:a.rings=n}return a}function c(e,t,r,i){if("point"===e.type){const{x:n,y:a}=e,o=i?i[0]:n,s=i?i[1]:a,l=e.clone(),c=(n-o)*t+o,u=(a-s)*r+s;return l.x=c,l.y=u,l}if("multipoint"===e.type){const s=(0,o.$K)(e),l=(0,n.vt)(),[c,u,d,h]=(0,a.Yz)(l,[s]),f=i?i[0]:(c+d)/2,m=i?i[1]:(h+u)/2,g=e.clone(),y=g.points;for(let e=0;e<y.length;e++){const i=y[e],[n,a]=i,o=(n-f)*t+f,s=(a-m)*r+m;y[e]=p(i,o,s,void 0)}return g}if("extent"===e.type){const{xmin:n,xmax:a,ymin:o,ymax:s}=e,l=i?i[0]:(n+a)/2,c=i?i[1]:(s+o)/2,u=e.clone();if(u.xmin=(n-l)*t+l,u.ymax=(s-c)*r+c,u.xmax=(a-l)*t+l,u.ymin=(o-c)*r+c,u.xmin>u.xmax){const e=u.xmin,t=u.xmax;u.xmin=t,u.xmax=e}if(u.ymin>u.ymax){const e=u.ymin,t=u.ymax;u.ymin=t,u.ymax=e}return u}const s=(0,o.$K)(e),l=(0,n.vt)(),[c,u,d,h]=(0,a.Yz)(l,s),f=i?i[0]:(c+d)/2,m=i?i[1]:(h+u)/2,g=e.clone(),y="polyline"===g.type?g.paths:g.rings;for(let n=0;n<s.length;n++){const e=s[n];for(let i=0;i<e.length;i++){const a=e[i],[o,s]=a,l=(o-f)*t+f,c=(s-m)*r+m;y[n][i]=p(a,l,c,void 0)}}return"paths"in g?g.paths=y:g.rings=y,g}function u(e,t,r,i,n,a){const o=Math.sqrt((r-e)*(r-e)+(i-t)*(i-t));return Math.sqrt((n-e)*(n-e)+(a-t)*(a-t))/o}function d(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=Math.atan2(t.y-r.y,t.x-r.x)-Math.atan2(e.y-r.y,e.x-r.x),o=Math.atan2(Math.sin(a),Math.cos(a));return n?o:(0,i.KJ)(o)}function h(e,t,r,i){return p(e,e[0]+t,e[1]+r,null!=e[2]&&null!=i?e[2]+i:void 0)}function p(e,t,r,i){const n=[t,r];return e.length>2&&n.push(null!=i?i:e[2]),e.length>3&&n.push(e[3]),n}},82053:(e,t,r)=>{var i;r.d(t,{g:()=>i}),function(e){e[e.HPR=1]="HPR",e[e.OPK=2]="OPK",e[e.YPR=3]="YPR",e[e.LTP=4]="LTP"}(i||(i={}))},83563:(e,t,r)=>{function i(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?a(e.view.floors,t.floorInfo.floorField):null}function n(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(!e?.length)return null;const r=e.filter((e=>""!==e)).map((e=>`'${e}'`));return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}r.d(t,{E:()=>i,f:()=>n})},85022:(e,t,r)=>{r.r(t),r.d(t,{hydratedAdapter:()=>l});var i=r(12560),n=r(76493),a=r(75400),o=r(65920),s=r(54824);const l={convertToGEGeometry:function(e,t){if(null==t)return null;let r="cache"in t?t.cache._geVersion:void 0;return null==r&&(r=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=r)),r},exportPoint:function(e,t,r){const i=e.hasZ(t),n=e.hasM(t),o=new a.default({x:e.getPointX(t),y:e.getPointY(t),spatialReference:r});return i&&(o.z=e.getPointZ(t)),n&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o},exportPolygon:function(e,t,r){const i=new o.default({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:r});return i.cache._geVersion=t,i},exportPolyline:function(e,t,r){const i=new s.default({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:r});return i.cache._geVersion=t,i},exportMultipoint:function(e,t,r){const i=new n.default({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:r});return i.cache._geVersion=t,i},exportExtent:function(e,t,r){const n=e.hasZ(t),a=e.hasM(t),o=new i.default({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:r});if(n){const r=e.getZExtent(t);o.zmin=r.vmin,o.zmax=r.vmax}if(a){const r=e.getMExtent(t);o.mmin=r.vmin,o.mmax=r.vmax}return o.cache._geVersion=t,o}}},86767:(e,t,r)=>{r.d(t,{NP:()=>u,gn:()=>d,gz:()=>h});var i=r(64682),n=r(89227),a=r(28473),o=r(1277),s=r(10872);const l=(0,a.vt)(),c=(0,a.vt)();function u(){return{direction:(0,a.vt)(),up:(0,a.vt)()}}function d(e,t,r,a,o){let s=(0,n.n)(l,e),u=(0,n.f)(s,a);const d=u>0;u=Math.abs(u),u>.99&&(u=Math.abs((0,n.f)(t,a)),u<.99?((0,n.c)(s,t),d&&(0,n.h)(s,s,-1)):s=null);let h=0;if(s){(0,n.h)(c,a,(0,n.f)(a,s)),(0,n.d)(s,s,c);const e=(0,n.f)(s,o)/((0,n.l)(s)*(0,n.l)(o));(0,n.e)(c,s,o),h=((0,n.f)(c,a)>0?1:-1)*(0,i.KJ)((0,i.XM)(e))}const p=(0,i.KJ)((0,i.XM)(-(0,n.f)(a,e)/(0,n.l)(e)));return r?(r.heading=h,r.tilt=p,r):{heading:h,tilt:p}}function h(e,t,r,i){(0,n.d)(p,r,t),(0,s.T7)(i,(0,o.LV)(t,p),e)||e===r||(0,n.c)(e,r)}const p=(0,a.vt)()},88455:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var i=r(93800),n=r(74719),a=r(82301),o=r(93670),s=r(48602),l=(r(21265),r(50925),r(75269)),c=r(77969),u=r(39936),d=r(9934),h=r(32474),p=r(53756);const f=new Set(["demPathPrefix","demPathSuffix","depthImagePathPrefix","depthImagePathSuffix","elevationSource","horizontalMeasurementUnit","imageGeometryField","imageReferenceField","verticalMeasurementUnit","videoPathPrefix","videoPathSuffix","timeAnimation","visibilityTimeExtent"]),m=(e,t)=>!f.has(t)&&e;function g(e,t,r,i){const{name:n,write:a,read:o}=((e,t,r)=>{const i=`orientedImageryProperties.${e}`;return{name:i,write:t?{ignoreOrigin:!0,target:i,writer:t}:{ignoreOrigin:!0},read:r?{ignoreOrigin:!0,source:i,reader:r}:{ignoreOrigin:!0}}})(e,t,r),s={name:n,write:a,read:o,origins:{service:{name:`orientedImageryInfo.${n}`,write:t,read:r},"web-scene":{name:n,write:m(a,e),read:m(o,e)},"web-map":{name:n,write:a,read:o}}};return i&&s.origins?(s.type=i,s.origins["web-map"].type=i,s.origins["web-scene"].type=i,s):s}let y=class extends c.default{constructor(){super(...arguments),this.cameraHeading=null,this.cameraHeight=null,this.cameraPitch=null,this.cameraRoll=null,this.coveragePercent=null,this.demPathPrefix=null,this.demPathSuffix=null,this.depthImagePathPrefix=null,this.depthImagePathSuffix=null,this.elevationSource=null,this.farDistance=null,this.geometryType="point",this.horizontalFieldOfView=null,this.horizontalMeasurementUnit=null,this.imageGeometryField="ImageGeometry",this.imagePathPrefix=null,this.imagePathSuffix=null,this.imageReferenceField="OIObjectID",this.imageRotation=null,this.maximumDistance=null,this.nearDistance=null,this.operationalLayerType="OrientedImageryLayer",this.orientationAccuracy=null,this.orientedImageryType=null,this.supportedSourceTypes=new Set(["Oriented Imagery Layer"]),this.type="oriented-imagery",this.timeIntervalUnit="days",this.useViewTime=!0,this.verticalFieldOfView=null,this.verticalMeasurementUnit=null,this.videoPathPrefix=null,this.videoPathSuffix=null,this.visibilityTimeExtent=null}get effectiveElevationSource(){const{elevationSource:e,demPathPrefix:t,demPathSuffix:r}=this;return(0,d.eR)(e,t,r)}async save(e){return this._debouncedSaveOperations(p.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(p.X.SAVE_AS,t,e)}findFirstValidLayerId(e){return e.layers?.find((e=>this.supportedSourceTypes.has(e.type)))?.id}_verifySource(){if(super._verifySource(),"point"!==this.geometryType)throw new n.default("oriented-imagery-layer:invalid-geometry-type","OrientedImageryLayer only supports point geometry type")}};(0,i._)([(0,s.MZ)({type:Number,json:g("cameraHeading")})],y.prototype,"cameraHeading",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("cameraHeight")})],y.prototype,"cameraHeight",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("cameraPitch")})],y.prototype,"cameraPitch",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("cameraRoll")})],y.prototype,"cameraRoll",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("coveragePercent")})],y.prototype,"coveragePercent",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("demPathPrefix")})],y.prototype,"demPathPrefix",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("demPathSuffix")})],y.prototype,"demPathSuffix",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("depthImagePathPrefix")})],y.prototype,"depthImagePathPrefix",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("depthImagePathSuffix")})],y.prototype,"depthImagePathSuffix",void 0),(0,i._)([(0,s.MZ)({type:Object,json:g("elevationSource")})],y.prototype,"elevationSource",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],y.prototype,"effectiveElevationSource",null),(0,i._)([(0,s.MZ)({type:Number,json:g("farDistance")})],y.prototype,"farDistance",void 0),(0,i._)([(0,s.MZ)()],y.prototype,"geometryType",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("horizontalFieldOfView")})],y.prototype,"horizontalFieldOfView",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("horizontalMeasurementUnit")})],y.prototype,"horizontalMeasurementUnit",void 0),(0,i._)([(0,s.MZ)({type:String,json:{...g("imageGeometryField"),default:"ImageGeometry"}})],y.prototype,"imageGeometryField",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("imagePathPrefix")})],y.prototype,"imagePathPrefix",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("imagePathSuffix")})],y.prototype,"imagePathSuffix",void 0),(0,i._)([(0,s.MZ)({type:String,json:{...g("imageReferenceField"),default:"OIObjectID"}})],y.prototype,"imageReferenceField",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("imageRotation")})],y.prototype,"imageRotation",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("maximumDistance")})],y.prototype,"maximumDistance",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("nearDistance")})],y.prototype,"nearDistance",void 0),(0,i._)([(0,s.MZ)({type:["OrientedImageryLayer"],json:{origins:{"portal-item":{name:"layerType",write:{enabled:!0,ignoreOrigin:!0}}}}})],y.prototype,"operationalLayerType",void 0),(0,i._)([(0,s.MZ)({json:{...g("orientationAccuracy",((e,t,r)=>{(0,o.sM)(r,e.join(";"),t)}),(e=>{const t=e?.split(";")?.map(Number);return(0,d.Qv)(t)?t:[0,0,0,0,0,0,0,0,0]}),String)}})],y.prototype,"orientationAccuracy",void 0),(0,i._)([(0,s.MZ)({json:{...g("orientedImageryType",d.fs.write,d.fs.read,d.fs.jsonValues.slice(1))}})],y.prototype,"orientedImageryType",void 0),(0,i._)([(0,s.MZ)({json:{read:!1},value:"oriented-imagery",readOnly:!0})],y.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:d.RR.apiValues,json:{...g("timeIntervalUnit",d.RR.write,d.RR.read,d.RR.jsonValues)}})],y.prototype,"timeIntervalUnit",void 0),(0,i._)([(0,s.MZ)(function(e){return e.json?(e.json.origins=e.json.origins??{},e.json.origins["web-scene"]={write:!1,read:!1},e):e}((0,a.clone)(u.B)))],y.prototype,"useViewTime",void 0),(0,i._)([(0,s.MZ)({type:Number,json:g("verticalFieldOfView")})],y.prototype,"verticalFieldOfView",void 0),(0,i._)([(0,s.MZ)({type:d.l6.apiValues,json:{...g("verticalMeasurementUnit",d.l6.write,d.l6.read,d.l6.jsonValues)}})],y.prototype,"verticalMeasurementUnit",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("videoPathPrefix")})],y.prototype,"videoPathPrefix",void 0),(0,i._)([(0,s.MZ)({type:String,json:g("videoPathSuffix")})],y.prototype,"videoPathSuffix",void 0),(0,i._)([(0,s.MZ)({type:h.default,json:{origins:{"web-scene":{write:!1,read:!1}}}})],y.prototype,"visibilityTimeExtent",void 0),y=(0,i._)([(0,l.$)("esri.layers.OrientedImageryLayer")],y);const v=y},90273:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(68661),n=r(75400);class a extends i.A{constructor(e,t,r,i,n,a){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=t,this._hasZ=r,this._hasM=i,this._cacheId=n,this._partId=a}get(e){if(void 0===this._lazyPt[e]){const t=this._elements[e];if(void 0===t)return;const r=new n.default(t[0],t[1],this._spRef);this._hasZ&&(r.z=t[2]),this._hasM&&(r.m=this._hasZ?t[3]:t[2]),r.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=r}return this._lazyPt[e]}equalityTest(e){return e===this||null!==e&&e instanceof a!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}},90787:(e,t,r)=>{r.r(t),r.d(t,{imageToWorld:()=>I,imageToWorldPanoramic:()=>D});var i=r(62631),n=r(28473),a=r(89227),o=r(75400),s=r(91102),l=r(89476),c=r(48039),u=r(58057),d=(r(74719),r(21265),r(50925),r(65920)),h=r(10872),p=r(53890),f=r(58507),m=r(24454);async function g(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;const{cameraLocation:a,farPlaneVertices:s}=r,l=(0,f.n3)(a),c=new Array;await M(s,r,c);let u=(0,h.Cr)(c[0],c[1],c[2]),d=e.clone();for(let p=0;p<i;p++){const i=(0,n.vt)();if(!(0,h.U5)(u,l,(0,f.n3)(e),i))break;let s=0,p=null;if(({error:s,imagePoint:p,pointWithZ:d}=await _(t,new o.default(i,a.spatialReference),r)),s<=1)break;const[m,g]=b(a.spatialReference,c);if((0,f.or)(m<=1,g<=1))break;c.splice(0,c.length,...await P(m,g,new o.default(i,a.spatialReference),r)),u=(0,h.Cr)(c[0],c[1],c[2])}return(0,f.n3)(d)}async function y(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;const{cameraLocation:a,farPlaneVertices:s}=r,l=(0,f.n3)(a),c=new Array;await M(s,r,c);let u=(0,h.Cr)(c[0],c[1],c[2]),d=e.clone();for(let p=0;p<i;p++){const i=(0,n.vt)();if(!(0,h.U5)(u,l,(0,f.n3)(e),i))break;let s,p=0;if(({error:p,imagePoint:s,pointWithZ:d}=await x(t,new o.default(i,a.spatialReference),r)),p<=1)break;const[m,g]=b(a.spatialReference,c);if((0,f.or)(m<=1,g<=1))break;c.splice(0,c.length,...await P(m,g,new o.default(i,a.spatialReference),r)),u=(0,h.Cr)(c[0],c[1],c[2])}return(0,f.n3)(d)}const v=10,w=10;function b(e,t){const r=new d.default({spatialReference:e});return r.addRing(t),[r.extent?.width?r.extent.width/w:1,r.extent?.height?r.extent.height/w:1]}async function M(e,t,r){const i=(0,u.G)(e),n=await(0,p.A)(i,t);r.push(...n.map(f.n3))}async function _(e,t,r){const i=await(0,p.A)(t,r),n=(0,m.worldToImage)(i,r);return{error:S(n,e),imagePoint:n,pointWithZ:i}}async function x(e,t,r){const i=await(0,p.A)(t,r),n=(0,m.worldToImagePanoramic)(i,r);return{error:T(n,e),imagePoint:n,pointWithZ:i}}const S=(e,t)=>Math.abs(e.x-t.x)+Math.abs(e.y-t.y),T=(e,t)=>Math.abs(e.heading-t.heading)+Math.abs(e.pitch-t.pitch);async function P(e,t,r,i){const n=[[-e,-t],[e,-t],[e,t],[-e,t]].map((e=>{let[t,i]=e;return new o.default([r.x+t,r.y+i],r.spatialReference)}));return(0,p.A)(n,i).then((e=>e.map((e=>e.toArray()))))}var A=r(43879);async function I(e,t,r){const{verticalFieldOfView:n,imageBoundaries:a,scalingFactor:s,farPlaneVertices:l,cameraLocation:c,pixelsToTransform:u,vecToPoint:d}=function(e,t){const r=(0,i.Xj)(e)||"items"in e?e:[e],{cameraLocation:n,rotationMatrix:a}=t;if((0,f.ZA)(r,n),(0,f._)(a),9!==a?.length)throw new Error("Rotation matrix is not provided or is not a valid 3x3 matrix");const s=(0,f.i2)(n.y,n.spatialReference),l=(0,f.eM)({...t,scalingFactor:s}),c=(0,m.worldToImage)(l.map((e=>new o.default(e,n.spatialReference))),t),{vfov:u}=(0,f.x1)(t.horizontalFieldOfView,t.verticalFieldOfView,t.cameraRoll);return{cameraLocation:n.toArray(),imageBoundaries:c.map((e=>{let{x:t,y:r}=e;return[t,r,1]})),verticalFieldOfView:u,farPlaneVertices:l,scalingFactor:s,pixelsToTransform:r.map((e=>[e.x,e.y,1])),vecToPoint:(0,f.Yc)(n.spatialReference)}}(e,t),h=new Array;return await R(u,l,a,d,t,h,c,s,n,r),Array.isArray(e)?h:h[0]}async function R(e,t,r,i,n,a,o,s,l,c){let u=n.averageElevation;for(const d of e){const e=F(t,r,d,i,n);c&&(0,f.or)((0,f.sp)(c.elevationSample),(0,f.tB)(c))&&(u=(await g(i(e),{x:d[0],y:d[1]},{...n,...c,farPlaneVertices:t.map(i)}))[2]),a.push(i(C(e,o,s,u,n.cameraPitch,l)))}}function C(e,t,r,i,o,s){let l=(0,n.o8)(e);const c=Math.sqrt((e[2]-t[2])**2+(Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)/r)**2)*r,u=(0,f.Qu)((0,a.a)((0,n.Ul)(),e,t),1/c,1/r);if(function(e,t,r,i){return e<t||r+i/2<90}(e[2],i,o,s)){const e=Math.abs((t[2]-i)/-u[2])*r;l=(0,f.MY)(t,u,e,r)}else l[2]=i;return l}function F(e,t,r,i,n){let a=null;let o,s=0,l=e,c=t;for(;s<=9;){const e=N(r,c,l,n);if(o=e.error,a=e.transformedPoint,(0,f.or)(o<=1,9===s))break;l=(0,f.cV)(l,o,r,t),c=O(l,i,n),s++}return a}function O(e,t,r){return(0,m.worldToImage)(e.map(t),r).map((e=>{let{x:t,y:r}=e;return[t,r,1]}))}function N(e,t,r,i){const{cameraLocation:n}=i,a=(0,f.cL)(e,t,r),{x:s,y:l}=(0,m.worldToImage)(new o.default(a,n.spatialReference),i);return{transformedPoint:a,error:E(e,[s,l,1])}}function E(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}async function D(e,t,r){const{cameraHeading:i,cameraLocation:a,farDistance:u,imageHeight:d,imageWidth:h,verticalFieldOfView:p}=t,m=(0,f.i2)(a.y,a.spatialReference),g=new Array,[v,w,b]=a.toArray(),M=(0,l.l)([v,w,b??0],u*m),_=A.ZH.toArray(),x=Array.isArray(e)?e:[e];for(const S of x){let e,x;if((0,f.L2)(S))e=S.heading,x=S.pitch;else{const t=(0,f.dM)({x:S.x,y:S.y},h,d);e=t.heading,x=t.pitch}e=(e+i)%360;const T=(0,s.Cr)([_[0],_[1],_[2]],(0,f.id)(e,x)),P=(0,s.fA)([v,w,b??0],T.direction),A=(0,n.Ul)();(0,l.j)(M,P,A);let I=t.averageElevation;r&&((0,c.jV)(r)||(0,f.sp)(r.elevationSample))&&x+p/2<90&&(I=(await y(new o.default(A,a.spatialReference),{heading:e,pitch:x},{...t,...r,farPlaneVertices:(0,f.Hk)(u,u).map((e=>{let[t,r]=e;return new o.default([a.x+t,a.y+r],a.spatialReference)}))}))[2]),g.push(new o.default(C(A,a.toArray(),m,I,x,p),a.spatialReference))}return Array.isArray(e)?g:g[0]}},90801:(e,t,r)=>{r.d(t,{DO:()=>Y,FT:()=>W,Hh:()=>A,OM:()=>J,OO:()=>N,Ps:()=>ee,Wo:()=>R,_I:()=>D,_l:()=>H,dK:()=>ie,eh:()=>re,l0:()=>K,t$:()=>te,uk:()=>U,vI:()=>I,xh:()=>f});var i,n=r(62631),a=r(74719),o=r(84190),s=r(12560),l=r(93205),c=r(75400),u=r(65920),d=r(96913),h=r(93321),p=r(70576);function f(e,t,r){return!(0,d.canProjectWithoutEngine)(e,t,r)}function m(e,t,r){const i=f(e,t,r);if(i&&!(0,d.isLoaded)())throw new a.default("rasterprojectionhelper-project","projection engine is not loaded");return i}!function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"}(i||(i={}));const g=function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(1===r[0])return[0,0];let n=1,a=-1,o=1,s=-1;for(let g=0;g<e.length;g+=2)isNaN(e[g])||(n=n>e[g]?e[g]:n,a=a>e[g]?a:e[g],o=o>e[g+1]?e[g+1]:o,s=s>e[g+1]?s:e[g+1]);const{cols:l,rows:c}=t,u=(a-n)/l/r[0],d=(s-o)/c/r[1],h=2*i;let p=0,f=!1,m=[0,0];for(let g=0;g<l-3;g++){for(let t=0;t<c-3;t++){const r=g*c*2+2*t,i=(e[r]+e[r+4]+e[r+4*c]+e[r+4*c+4])/4,n=(e[r+1]+e[r+5]+e[r+4*c+1]+e[r+4*c+5])/4,a=Math.abs((i-e[r+2*c+2])/u),o=Math.abs((n-e[r+2*c+3])/d);if(a+o>p&&(p=a+o,m=[a,o]),h&&p>h){f=!0;break}}if(f)break}return m},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},v=32,w=4,b=w,M=new Map,_=new Map,x=500,S=39.37,T=96;let P=null;async function A(){P&&(0,d.isLoaded)()||((0,d.isLoaded)()||await(0,d.load)(),P=await Promise.all([r.e(31329),r.e(73959)]).then(r.bind(r,60822)))}function I(e,t,r){return m(e.spatialReference,t),r?(0,d.getTransformation)(t,e.spatialReference,e):(0,d.getTransformation)(e.spatialReference,t,e)}function R(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=e.spatialReference;if(!n||!t||n.equals(t))return e;m(n,t,i);const a=r.center,o=new s.default({xmin:a.x-e.x/2,xmax:a.x+e.x/2,ymin:a.y-e.y/2,ymax:a.y+e.y/2,spatialReference:n}),l=(0,d.project)(o,t,i),c=W(t);return null==l||null!=c&&l.width>=c?C(e,n,t):{x:l.width,y:l.height}}function C(e,t,r){const i=(0,o.GA)(t)/(0,o.GA)(r);return{x:e.x*i,y:e.y*i}}function F(e,t,r){const{spatialReference:i}=r;if(!i||!t||i.equals(t))return e;if(i.isGeographic&&t.isGeographic)return C(e,i,t);if(m(i,t),!P)throw new a.default("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:n,y:s}=e;const l=(n+s)/2*(0,o.GA)(i);let c=1;l>30&&(c=30/l,n*=c,s*=c);const h=256,p=n*h/2,f=s*h/2,{x:g,y:y}=r.center,v=[];for(let a=0;a<=h;a++)v.push([g-p,y-f+a*s]);for(let a=1;a<=h;a++)v.push([g-p+a*n,y+f]);for(let a=1;a<=h;a++)v.push([g+p,y+f-a*s]);for(let a=1;a<h;a++)v.push([g+p-a*n,y-f]);v.push(v[0]);const w=new u.default({rings:[v],spatialReference:i}),b=(0,d.project)(w,t);if(!b)return C(e,i,t);const M=b.extent,_=W(t);if(null==M||null!=_&&M.width>=_)return C(e,i,t);const x=P.planarArea(b),S=n*s*h*h,T=Math.sqrt(x/S)/c,A={x:M.width/c/h,y:M.height/c/h},I={x:n*T,y:s*T},R=A.x*A.y;return Math.abs(R-I.x*I.y)/R<.1?A:I}function O(e,t){return("number"==typeof e?e:(e.x+e.y)/2)*(0,o.GA)(t)*T*S}function N(e,t){const{pixelSize:r,extent:i}=e;return O(F(r,t,i),t)}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return(0,o.GA)(e)?t/(0,o.GA)(e):0}function D(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=e.spatialReference;if(n.equals(t))return e;m(n,t,r);const a=(0,d.project)(e,t,r);return i&&a?(Z([e],[a],n,t),a):a}function Z(e,t,r,i){const n=q(r,!0),a=q(i,!0),o=E(r,x),s=E(i,x);if(o&&null!=n&&null!=a)for(let l=0;l<e.length;l++){const r=t[l];if(!r)continue;const{x:i}=e[l],{x:c}=r;c>=a[1]-s&&Math.abs(i-n[0])<o?r.x-=a[1]-a[0]:c<=a[0]+s&&Math.abs(i-n[1])<o&&(r.x+=a[1]-a[0])}}function z(e){const{inSR:t,outSR:r,datumTransformation:i,preferPE:n}=e;if(t.equals(r)){const{points:t}=V(e,null);return t}if(t.isWebMercator&&r.isWGS84||t.isWGS84&&r.isWebMercator)return function(e){const{cols:t,rows:r,xres:i,yres:n,usePixelCenter:a,inSR:o,outSR:s}=e;let{xmin:l,ymax:u}=e;a&&(l+=i/2,u-=n/2);const h=[],p=[],f=Math.max(t,r);for(let g=0;g<f;g++){const e=l+i*Math.min(t,g),a=u-n*Math.min(r,g),f=(0,d.project)(new c.default({x:e,y:a,spatialReference:o}),s);g<=t&&h.push(f.x),g<=r&&p.push(f.y)}const m=[];for(let c=0;c<t;c++)for(let e=0;e<r;e++)m.push([h[c],p[e]]);return m}(e);if(m(t,r,i)&&n){if(t.isGeographic)return L(e);if(null!=k(t))return L(e)}return function(e){const{points:t}=V(e,null),{inSR:r,outSR:i,datumTransformation:n}=e,a=t.map((e=>new c.default(e[0],e[1],r))),o=(0,d.project)(a,i,n);return n&&Z(a,o,r,i),o.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function L(e){const{inSR:t,outSR:r,datumTransformation:i}=e,n=k(t),{points:a,mask:o}=V(e,n);if(!t.isGeographic){const e=t.wkid?l.P.coordsys(t.wkid):l.P.fromString(t.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,t.wkt2||t.wkt);l.g.projToGeog(e,a.length,a)}if(null!=i&&i.steps.length){let e;const t=179.9955;if(r.isGeographic&&(e=a.map((e=>{let[r]=e;return r>t?1:r<-179.9955?-1:0}))),i.steps.forEach((e=>{const t=e.wkid?l.P.geogtran(e.wkid):l.P.fromString(l.a.PE_TYPE_GEOGTRAN,e.wkt);l.h.geogToGeog(t,a.length,a,null,e.isInverse?l.a.PE_TRANSFORM_2_TO_1:l.a.PE_TRANSFORM_1_TO_2)})),e)for(let r=0;r<a.length;r++){const i=e[r],n=a[r][0],o=n>t?1:n<-179.9955?-1:0;i&&o&&i!==o&&(a[r][0]=i>0?n+360:n-360)}}if(!r.isGeographic){const e=k(r,!0),t=null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[r,i]=t;for(let n=0;n<e.length;n++){const t=e[n][1];(t<r||t>i)&&(e[n]=[NaN,NaN])}}(a,t);const i=r.wkid?l.P.coordsys(r.wkid):l.P.fromString(r.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,r.wkt2||r.wkt);l.g.geogToProj(i,a.length,a)}let s=a;if(o&&a.length!==o.length){s=[];for(let e=0,t=0;e<o.length;e++)o[e]?s.push(a[t++]):s.push([NaN,NaN])}return s}function k(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.wkid||e.wkt2||e.wkt;if(!r||e.isGeographic)return null;if(r=String(r),M.has(r)){const e=M.get(r);return t?e?.gcs:e?.pcs}const i=e.wkid?l.P.coordsys(e.wkid):l.P.fromString(e.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt),n=G(i,E(e,1e-4)),a=G(i,0,!0);return M.set(r,{pcs:n,gcs:a}),t?a:n}function G(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=l.j.generate(e),n=r?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!i||!n?.length)return null;let a=!1,o=n.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!o){if(o=n.find((e=>1===e.getInclusive()&&0===e.getKind())),!o)return null;a=!0}const s=r?0:(2===i.getNorthPoleLocation()?1:0)|(2===i.getSouthPoleLocation()?2:0),c=i.isPannableRectangle(),u=o.getCoord();if(a)return{isEnvelope:a,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-t,u[0][1]-t,u[1][0]+t,u[1][1]+t],poleLocation:s};let d=0;const h=[];let[p,f]=u[0],[m,g]=u[0];for(let l=0,y=u.length;l<y;l++){d++,d===y&&(d=0);const[e,t]=u[l],[r,i]=u[d];if(i===t)h.push([e,r,t,i,2]);else{const n=(r-e)/(i-t||1e-4),a=e-n*t;t<i?h.push([n,a,t,i,0]):h.push([n,a,i,t,1])}p=p<e?p:e,f=f<t?f:t,m=m>e?m:e,g=g>t?g:t}return{isEnvelope:!1,isPannable:c,vertices:u,coef:h,bbox:[p,f,m,g],poleLocation:s}}function V(e,t){const r=[],{cols:i,rows:n,xres:a,yres:o,usePixelCenter:s}=e;let{xmin:l,ymax:c}=e;if(s&&(l+=a/2,c-=o/2),null==t){for(let e=0;e<i;e++)for(let t=0;t<n;t++)r.push([l+a*e,c-o*t]);return{points:r}}const u=new Uint8Array(i*n);if(t.isEnvelope){const{bbox:[e,s,d,h]}=t;for(let p=0,f=0;p<i;p++){const i=l+a*p,m=t.isPannable||i>=e&&i<=d;for(let e=0;e<n;e++,f++){const t=c-o*e;m&&t>=s&&t<=h&&(r.push([i,t]),u[f]=1)}}return{points:r,mask:u}}const d=t.coef,h=[];for(let p=0;p<n;p++){const e=c-o*p,t=[],r=[];for(let n=0;n<d.length;n++){const[i,a,o,s,l]=d[n];if(e===o&&o===s)t.push(i),t.push(a),r.push(2),r.push(2);else if(e>=o&&e<=s){const n=i*e+a;t.push(n),r.push(l)}}let i=t;if(t.length>2){let e=2===r[0]?0:r[0],n=t[0];i=[];for(let a=1;a<r.length;a++)2===r[a]&&a!==r.length-1||(r[a]!==e&&(i.push(0===e?Math.min(n,t[a-1]):Math.max(n,t[a-1])),e=r[a],n=t[a]),a===r.length-1&&i.push(0===r[a]?Math.min(n,t[a]):Math.max(n,t[a])));i.sort(((e,t)=>e-t))}else t[0]>t[1]&&(i=[t[1],t[0]]);h.push(i)}for(let p=0,f=0;p<i;p++){const e=l+a*p;for(let t=0;t<n;t++,f++){const i=c-o*t,n=h[t];if(2===n.length)e>=n[0]&&e<=n[1]&&(r.push([e,i]),u[f]=1);else if(n.length>2){let t=!1;for(let r=0;r<n.length;r+=2)if(e>=n[r]&&e<=n[r+1]){t=!0;break}t&&(r.push([e,i]),u[f]=1)}}}return{points:r,mask:u}}function j(e,t){const r=W(e[0].spatialReference);if(e.length<2||null==r)return e[0];if(t=t??E(e[0].spatialReference),1===(e=e.filter((e=>e.width>t))).length)return e[0];let{xmin:i,xmax:n,ymin:a,ymax:o}=e[0];for(let s=1;s<e.length;s++){const t=e[s];n=t.xmax+r*s,a=Math.min(a,t.ymin),o=Math.max(o,t.ymax)}return new s.default({xmin:i,xmax:n,ymin:a,ymax:o,spatialReference:e[0].spatialReference})}function H(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=e.spatialReference;if(o.equals(t))return e;const l=J(e),c=W(o,!0),h=W(t);if(0===l||null==c||null==h){const n=B(e,t,r,a);if(null==c&&null!=h&&Math.abs(n.width-h)<E(t)&&(0,d.isLoaded)()){const r=k(o);if(null!=r&&r.poleLocation===i.None&&e.width<(r.bbox[2]-r.bbox[0])/2)return function(e,t){const r=W(t);if(null==r)return null;let{xmin:i,ymin:n,xmax:a,ymax:o}=e;const l=e.spatialReference,c=new u.default({spatialReference:l,rings:[[[i,n],[a,n],[a,o],[i,o],[i,n]]]}),h=(0,d.project)(c,t);if(2!==h.rings.length||!h.rings[0].length||!h.rings[1].length)return null;const{rings:p}=h,f=E(l),m=new s.default({spatialReference:t});for(let s=0;s<2;s++){i=a=p[s][0][0],n=o=p[s][0][1];for(let e=0;e<p[s].length;e++)i=i>p[s][e][0]?p[s][e][0]:i,a=a<p[s][e][0]?p[s][e][0]:a,n=n>p[s][e][1]?p[s][e][1]:n,o=o<p[s][e][1]?p[s][e][1]:o;if(0===s)m.ymin=n,m.ymax=o,m.xmin=i,m.xmax=a;else if(m.ymin=Math.min(m.ymin,n),m.ymax=Math.max(m.ymax,o),Math.abs(a-r/2)<f)m.xmin=i,m.xmax=m.xmax+r;else{if(!(Math.abs(i+r/2)<f))return null;m.xmax=a+r}}return m}(e,t)||n}return n}const p=e.clone().normalize();if(1===p.length&&e.xmax<c&&e.xmax-c/2>E(o)){const{xmin:t,xmax:r}=e;for(let i=0;i<=l;i++){const n=0===i?t:-c/2,a=i===l?r-c*i:c/2;p[i]=new s.default({xmin:n,xmax:a,ymin:e.ymin,ymax:e.ymax,spatialReference:o})}}return j(p.map((e=>B(e,t,r,a))).filter(n.Ru))}function U(e,t,r){if("extent"===e.type){const{xmin:t,ymin:r,xmax:i,ymax:n,spatialReference:a}=e;e=new u.default({rings:[[[t,n],[i,n],[i,r],[t,r],[t,n]]],spatialReference:a})}return e.spatialReference.equals(t)?e:(m(e.spatialReference,t,r),(0,d.project)(e,t,r))}function B(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=e.spatialReference;if(a.equals(t)||!t)return e;m(a,t,r);const o=(0,d.project)(e,t,r);if(n&&t.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!i||!o)return o;const s=q(a,!0),l=q(t,!0);if(null==s||null==l)return o;const u=E(a,.001),h=E(a,x),p=E(t,.001);if(Math.abs(o.xmin-l[0])<p&&Math.abs(o.xmax-l[1])<p){const i=Math.abs(e.xmin-s[0]),n=Math.abs(s[1]-e.xmax);if(i<u&&n>h){o.xmin=l[0];const i=[];i.push(new c.default(e.xmax,e.ymin,a)),i.push(new c.default(e.xmax,(e.ymin+e.ymax)/2,a)),i.push(new c.default(e.xmax,e.ymax,a));const n=i.map((e=>D(e,t,r))).filter((e=>!isNaN(e?.x))).map((e=>e.x));o.xmax=Math.max.apply(null,n)}if(n<u&&i>h){o.xmax=l[1];const i=[];i.push(new c.default(e.xmin,e.ymin,a)),i.push(new c.default(e.xmin,(e.ymin+e.ymax)/2,a)),i.push(new c.default(e.xmin,e.ymax,a));const n=i.map((e=>D(e,t,r))).filter((e=>!isNaN(e?.x))).map((e=>e.x));o.xmin=Math.min.apply(null,n)}}else{const e=E(t,.001);Math.abs(o.xmin-l[0])<e&&(o.xmin=l[0]),Math.abs(o.xmax-l[1])<e&&(o.xmax=l[1])}return o}function W(e){if(!e)return null;const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?20037508.342787:20037508.342788905;return e.isWebMercator?2*t:e.wkid&&e.isGeographic?360:2*y[e.wkid]||null}function q(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.isGeographic)return[-180,180];const r=W(e,t);return null!=r?[-r/2,r/2]:null}function $(e,t,r,i){let n=(e-t)/r;return n-Math.floor(n)!=0?n=Math.floor(n):i&&(n-=1),n}function J(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=W(e.spatialReference);if(null==r)return 0;const i=t?0:-r/2,n=E(e.spatialReference),a=!t&&Math.abs(e.xmax-r/2)<n?r/2:e.xmax,o=!t&&Math.abs(e.xmin+r/2)<n?-r/2:e.xmin;return $(a,i,r,!0)-$(o,i,r,!1)}function Y(e){const t=e.storageInfo.origin.x,r=W(e.spatialReference,!0);if(null==r)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const i=r/2,{nativePixelSize:n,storageInfo:a,extent:o}=e,{maximumPyramidLevel:s,blockWidth:l,pyramidScalingFactor:c}=a;let u=n.x;const d=[],h=null!=e.transform&&"gcs-shift"===e.transform.type,p=t+(h?0:i),f=h?r-t:i-t;for(let m=0;m<=s;m++){const e=(o.xmax-t)/u/l,r=e-Math.floor(e)==0?e:Math.ceil(e),i=f/u/l,n=i-Math.floor(i)==0?i:Math.ceil(i),a=Math.floor(p/u/l),s=Math.round(p/u)%l,h=(l-Math.round(f/u)%l)%l;d.push({resolutionX:u,blockWidth:l,datasetColumnCount:r,worldColumnCountFromOrigin:n,leftMargin:s,rightPadding:h,originColumnOffset:a}),u*=c}return{originX:t,halfWorldWidth:i,pyramidsInfo:d,hasGCSSShiftTransform:h}}function K(e){const t=e.isAdaptive&&null==e.spacing;let r=e.spacing||[v,v],i=Q(e),n={cols:i.size[0]+1,rows:i.size[1]+1};const a=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;let o=i.outofBoundPointCount===i.offsets.length/2||t&&a?[0,0]:g(i.offsets,n,r,b);const s=(o[0]+o[1])/2,c=e.projectedExtent.spatialReference,u=e.srcBufferExtent.spatialReference;if(t&&(a||s>b)&&(f(c,u,e.datumTransformation)&&(c.isGeographic||k(c)),r=[w,w],i=Q({...e,spacing:r}),n={cols:i.size[0]+1,rows:i.size[1]+1},o=g(i.offsets,n,r,b)),i.error=o,r[0]>1&&(i.coefficients=X(i.offsets,n,a)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(u.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:r};else{const t=k(c);if(null!=t&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let r;return _.has(t)?r=_.get(t):(r=(e.wkid?l.P.coordsys(e.wkid):l.P.fromString(l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),_.set(t,r)),new h.default({wkid:r})}(c),o=H(e.projectedExtent,t),{offsets:s}=Q({...e,srcBufferExtent:o,spacing:r}),u=X(s,n,a);i.gcsGrid={offsets:s,coefficients:u,spacing:r}}}return i}function Q(e){const{projectedExtent:t,srcBufferExtent:r,pixelSize:i,datumTransformation:n,rasterTransform:a}=e,o=t.spatialReference,s=r.spatialReference,l=m(o,s),{xmin:u,ymin:d,xmax:h,ymax:p}=t,f=W(s),g=null!=f&&(e.hasWrapAround||"gcs-shift"===a?.type),y=e.spacing||[v,v],b=y[0]*i.x,M=y[1]*i.y,_=1===y[0],S=Math.ceil((h-u)/b-.1/y[0])+(_?0:1),T=Math.ceil((p-d)/M-.1/y[1])+(_?0:1),P=z({cols:S,rows:T,xmin:u,ymax:p,xres:b,yres:M,inSR:o,outSR:s,datumTransformation:n,preferPE:y[0]<=w,usePixelCenter:_}),A=[];let I,R=0;const C=_?-1:NaN,{xmin:F,xmax:O,ymax:N,width:D,height:Z}=r,L=E(s,x),G=null!=f&&F>0&&O>f/2;let V=!1;if(l){const e=k(o);V=null!=e&&e.poleLocation>0}for(let m=0;m<S;m++){const e=[];for(let t=0;t<T;t++){let r=P[m*T+t];if(g&&r[0]>O&&r[0]>f/2-L?r[0]-=f:g&&0===m&&r[0]<0&&G&&!a&&(r[0]+=f),!r||isNaN(r[0])||isNaN(r[1]))A.push(C),A.push(C),e.push(null),R++;else{if(a){const e=a.inverseTransform(new c.default({x:r[0],y:r[1],spatialReference:s}));r=[e.x,e.y]}e.push(r),m>0&&g&&I[t]&&r[0]<I[t][0]&&(r[0]+=f,V&&r[0]>O&&r[0]>f&&(r[0]-=f)),A.push((r[0]-F)/D),A.push((N-r[1])/Z)}}I=e}return{offsets:A,error:null,coefficients:null,outofBoundPointCount:R,spacing:y,size:_?[S,T]:[S-1,T-1]}}function X(e,t,r){const{cols:i,rows:n}=t,a=new Float32Array((i-1)*(n-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),s=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<i-1;l++){for(let t=0;t<n-1;t++){let r=l*n*2+2*t;const c=e[r],u=e[r+1],d=e[r+2],h=e[r+3];r+=2*n;const p=e[r],f=e[r+1],m=e[r+2],g=e[r+3];let y=0,v=12*(t*(i-1)+l);for(let e=0;e<3;e++)a[v++]=o[y++]*c+o[y++]*d+o[y++]*m;y=0;for(let e=0;e<3;e++)a[v++]=o[y++]*u+o[y++]*h+o[y++]*g;y=0;for(let e=0;e<3;e++)a[v++]=s[y++]*c+s[y++]*p+s[y++]*m;y=0;for(let e=0;e<3;e++)a[v++]=s[y++]*u+s[y++]*f+s[y++]*g}if(r)for(let e=0;e<a.length;e++)isNaN(a[e])&&(a[e]=-1)}return a}function ee(e){const{spatialReference:t}=e,r=(0,p.Vp)(t);if(!r)return e;const[i,n]=r.valid,a=n-i;let o=0;if(e.xmin<i){const t=i-e.xmin;o=Math.ceil(t/a)}else if(e.xmin>n){const t=e.xmin-n;o=-Math.ceil(t/a)}return new s.default({spatialReference:e.spatialReference,xmin:e.xmin+o*a,ymin:e.ymin,xmax:e.xmax+o*a,ymax:e.ymax})}function te(e,t,r){const{storageInfo:i,pixelSize:n}=t;let a=0,s=!1;const{pyramidResolutions:l}=i,u="mixed"===i.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,i.tileInfo.dpi/96)):1,d=(e.x+e.y)/2/u;if(null!=l&&l.length){const e=l[l.length-1],i=(e.x+e.y)/2,u=(n.x+n.y)/2;if(d<=u)a=0;else if(d>=i)a=l.length,s=d/i>8;else{let e,t=u;for(let i=1;i<=l.length;i++){if(e=(l[i-1].x+l[i-1].y)/2,d<=e){d===e?a=i:"down"===r?(a=i-1,s=d/t>8):a="up"===r||d-t>e-d||d/t>2?i:i-1;break}t=e}}const h=0===a?n:l[a-1];return s&&Math.min(h.x,h.y)*(0,o.GA)(t.spatialReference)>19567&&(s=!1),{pyramidLevel:a,pyramidResolution:new c.default({x:h.x,y:h.y,spatialReference:t.spatialReference}),excessiveReading:s}}const h=Math.log(e.x/n.x)/Math.LN2,p=Math.log(e.y/n.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;a="down"===r?Math.floor(Math.min(h,p)):"up"===r?Math.ceil(Math.max(h,p)):Math.round((h+p)/2),a<0?a=0:a>f&&(s=a>f+3,a=f);const m=2**a;return{pyramidLevel:a,pyramidResolution:new c.default({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function re(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{pixelSize:i,extent:n}=e,a=I(n,t,!1),o=H(function(e,t){const r=e.clone().normalize();return 1===r.length?r[0]:j(r,t)}(n,(i.x+i.y)/16),t,a);return r||0===J(o)?o:B(n,t,a)}function ie(e,t,r){const i=r?.tileSize??512,n=r?.alignGlobalDatasetWithAGOL??!0,a=!!r?.limitToSrcResolution,{extent:o,spatialReference:s,pixelSize:l}=e,c=F(l,t,o);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,d=O(u,t),p=t.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let f="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const m=re(e,t,!0),g=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(p/2/d)/Math.LN2));if(!f&&n&&(t.isGeographic||t.isWebMercator)){const r=W(t);if(f=J(m)>0||null!=r&&m.width>r/4,!f&&null!=r){let t=-1;if(g<3)t=2**g*u*i;else if(e.storageInfo){const{maximumPyramidLevel:r=0,pyramidScalingFactor:n=2}=e.storageInfo;t=n**r*u*i}const n=Math.ceil(r/t);f=1===n||2===n&&r/2-m.xmax<t}}let y,v=d;const w=1.001,b=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(f){v=p;const r=t.isGeographic?1341104507446289e-21:.29858214164761665,i=O(r,t),n=t.isGeographic?4326:3857;y=F({x:r,y:r},s,re(e,new h.default({wkid:n}),!0)),y.x*=v/i,y.y*=v/i}else{y={x:l.x,y:l.y};let e=0;for(;v<p*(w/2)&&e<g;)e++,v*=b,y.x*=b,y.y*=b;Math.max(v,p)/Math.min(v,p)<=w&&(v=p)}const M=[v],_=[{x:y.x,y:y.y}],x=Math.min(70.5310735,d)/w;for(;v>=x;)v/=b,y.x/=b,y.y/=b,M.push(v),_.push({x:y.x,y:y.y});if(a){const e=.001*l.x;let t=_.findIndex((t=>t.x>=l.x-e&&t.x<=l.x+e));t>-1?(_.length=t+1,M.length=t+1):(t=_.findIndex((t=>t.x<=l.x+e)),t>0&&(_.length=t,M.length=t))}return{projectedPixelSize:c,scales:M,srcResolutions:_,isCustomTilingScheme:!f}}},95820:(e,t,r)=>{r.d(t,{x:()=>i});class i{}},95927:(e,t,r)=>{r.d(t,{$:()=>Ae,A:()=>ne,B:()=>ae,C:()=>Ce,D:()=>Q,E:()=>_e,F:()=>Se,G:()=>Te,H:()=>Pe,I:()=>R,J:()=>z,K:()=>Ve,L:()=>L,M:()=>re,N:()=>X,O:()=>ze,P:()=>Ge,Q:()=>ke,R:()=>I,S:()=>je,T:()=>Le,U:()=>ge,V:()=>V,W:()=>N,X:()=>He,Y:()=>le,Z:()=>De,_:()=>Re,a:()=>Fe,a0:()=>we,a1:()=>ye,a2:()=>ve,a3:()=>D,a4:()=>K,a5:()=>ee,a6:()=>te,a7:()=>fe,a8:()=>Me,a9:()=>Ze,aa:()=>Ue,b:()=>Ne,c:()=>oe,d:()=>Z,e:()=>pe,f:()=>se,g:()=>$,h:()=>he,i:()=>E,j:()=>J,k:()=>Y,l:()=>k,m:()=>q,n:()=>G,o:()=>B,p:()=>j,q:()=>H,r:()=>W,s:()=>ce,t:()=>de,u:()=>me,v:()=>Be,w:()=>C,x:()=>F,y:()=>O,z:()=>U});var i=r(32195),n=r(13248),a=r(10844),o=r(95820),s=r(72172),l=r(62433),c=r(68661),u=r(47696),d=r(90273),h=r(70612),p=r(60064),f=r(73974),m=r(35527),g=r(12560),y=r(47800),v=r(76493),w=r(75400),b=r(65920),M=r(54824),_=r(93321),x=r(53053),S=r(78629),T=r(12711),P=r(69943),A=r(51536);class I{constructor(e){this.value=e}}class R{constructor(e){this.value=e}}const C={type:"VOID"},F=Symbol("BREAK"),O=Symbol("CONTINUE");function N(e,t,r){return""===t||null==t||t===r||t===r?e:e=e.split(t).join(r)}function E(e){return e instanceof l.fF}function D(e){return e instanceof o.x}function Z(e){return!!(0,P.Kg)(e)||!!(0,P.Et)(e)||!!$(e)||!!J(e)||!!Y(e)||!!(0,P.Lm)(e)||null===e||e===C||"number"==typeof e}function z(e,t){return void 0===e?t:e}function L(e){return null==e?"":(0,P.cy)(e)||q(e)?"Array":$(e)?"Date":Y(e)?"Time":J(e)?"DateOnly":(0,P.Kg)(e)?"String":(0,P.Lm)(e)?"Boolean":(0,P.Et)(e)?"Number":"esri.arcade.Attachment"===e?.declaredClass?"Attachment":"esri.arcade.Portal"===e?.declaredClass?"Portal":"esri.arcade.Dictionary"===e?.declaredClass?"Dictionary":W(e)?"KnowledgeGraph":e instanceof o.x?"Module":G(e)?"Feature":e instanceof w.default?"Point":e instanceof b.default?"Polygon":e instanceof M.default?"Polyline":e instanceof v.default?"Multipoint":e instanceof g.default?"Extent":E(e)?"Function":j(e)?"FeatureSet":B(e)?"FeatureSetCollection":V(e)?"Voxel":e===C?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognized Type"}function k(e){return e instanceof y.default}function G(e){return"esri.arcade.Feature"===e?.arcadeDeclaredClass}function V(e){return"esri.arcade.Voxel"===e?.arcadeDeclaredClass}function j(e){return"esri.arcade.featureset.support.FeatureSet"===e?.declaredRootClass}function H(e){return"esri.arcade.Dictionary"===e?.declaredClass}function U(e){return H(e)||G(e)||V(e)}function B(e){return"esri.arcade.featureSetCollection"===e?.declaredRootClass}function W(e){return"esri.rest.knowledgeGraph.KnowledgeGraph"===e?.declaredClass}function q(e){return e instanceof c.A}function $(e){return e instanceof a.lY}function J(e){return e instanceof f.n}function Y(e){return e instanceof m.k}function K(e){return null!=e&&"object"==typeof e}function Q(e,t,r,i,n){if(e.length<t||e.length>r)throw new s.D$(i,s.TX.WrongNumberOfParameters,n)}function X(e){return e<0?-Math.round(-e):Math.round(e)}function ee(e,t){return isNaN(e)||null==t||""===t?e.toString():(t=N(t,"\u2030",""),t=N(t,"\xa4",""),(0,p.GP)(e,{pattern:t}))}function te(e,t){return null==t||""===t?e.toISOString(!0):e.toFormat(re(t),{locale:(0,T.JK)(),numberingSystem:"latn"})}function re(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let r="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const n of e.match(i)||[])switch(n){case"D":r+="d";break;case"DD":r+="dd";break;case"DDD":r+="o";break;case"d":r+="c";break;case"ddd":r+="ccc";break;case"dddd":r+="cccc";break;case"M":r+="L";break;case"MM":r+="LL";break;case"MMM":r+="LLL";break;case"MMMM":r+="LLLL";break;case"YY":r+="yy";break;case"Y":case"YYYY":r+="yyyy";break;case"Q":r+="q";break;case"Z":r+="Z";break;case"ZZ":r+="ZZ";break;case"ZZZ":r+="ZZZ";break;case"ZZZZ":r+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":r+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":r+="'S'";break;case"SS":r+="'SS'";break;case"SSS":r+="u";break;case"A":case"a":r+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":r+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?r+=`'${n.slice(1,-1)}'`:r+=`'${n}'`}return r}function ie(e,t,r){switch(r){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function ne(e,t,r){if(null===e){if(null===t||t===C)return ie(null,null,r);if((0,P.Et)(t))return ie(0,t,r);if((0,P.Kg)(t))return ie(0,de(t),r);if((0,P.Lm)(t))return ie(0,de(t),r);if($(t))return ie(0,t.toNumber(),r);if(Y(t))return ie(e,t.toNumber(),r);if(J(t))return ie(e,t.toNumber(),r)}if(e===C){if(null===t||t===C)return ie(null,null,r);if((0,P.Et)(t))return ie(0,t,r);if((0,P.Kg)(t))return ie(0,de(t),r);if((0,P.Lm)(t))return ie(0,de(t),r);if($(t))return ie(0,t.toNumber(),r);if(Y(t))return ie(e,t.toNumber(),r);if(J(t))return ie(e,t.toNumber(),r)}else if((0,P.Et)(e)){if((0,P.Et)(t))return ie(e,t,r);if((0,P.Lm)(t))return ie(e,de(t),r);if(null===t||t===C)return ie(e,0,r);if((0,P.Kg)(t))return ie(e,de(t),r);if($(t))return ie(e,t.toNumber(),r);if(Y(t))return ie(e,t.toNumber(),r);if(J(t))return ie(e,t.toNumber(),r)}else if((0,P.Kg)(e)){if((0,P.Kg)(t))return ie(se(e),se(t),r);if($(t))return ie(de(e),t.toNumber(),r);if(Y(t))return ie(de(e),t.toNumber(),r);if(J(t))return ie(de(e),t.toNumber(),r);if((0,P.Et)(t))return ie(de(e),t,r);if(null===t||t===C)return ie(de(e),0,r);if((0,P.Lm)(t))return ie(de(e),de(t),r)}else if($(e)){if($(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=a.lY.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=a.lY.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),ie(e.toNumber(),t.toNumber(),r);if(null===t||t===C)return ie(e.toNumber(),0,r);if((0,P.Et)(t))return ie(e.toNumber(),t,r);if((0,P.Lm)(t))return ie(e.toNumber(),de(t),r);if((0,P.Kg)(t))return ie(e.toNumber(),de(t),r);if(Y(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null);if(J(t))return ie(e.toNumber(),t.toNumber(),r)}else if((0,P.Lm)(e)){if((0,P.Lm)(t))return ie(e,t,r);if((0,P.Et)(t))return ie(de(e),de(t),r);if($(t))return ie(de(e),t.toNumber(),r);if(Y(t))return ie(de(e),t.toNumber(),r);if(J(t))return ie(de(e),t.toNumber(),r);if(null===t||t===C)return ie(de(e),0,r);if((0,P.Kg)(t))return ie(de(e),de(t),r)}else if(J(e)){if($(t))return ie(e.toNumber(),t.toNumber(),r);if(null===t||t===C)return ie(e.toNumber(),0,r);if((0,P.Et)(t))return ie(e.toNumber(),t,r);if((0,P.Lm)(t))return ie(e.toNumber(),de(t),r);if((0,P.Kg)(t))return ie(e.toNumber(),de(t),r);if(Y(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null);if(J(t))return ie(e.toNumber(),t.toNumber(),r)}else if(Y(e)){if($(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null);if(null===t||t===C)return ie(e.toNumber(),0,r);if((0,P.Et)(t))return ie(e.toNumber(),t,r);if((0,P.Lm)(t))return ie(e.toNumber(),de(t),r);if((0,P.Kg)(t))return ie(e.toNumber(),de(t),r);if(Y(t))return ie(e.toNumber(),t.toNumber(),r);if(J(t))throw new s.D$(null,s.TX.CannotCompareDateAndTime,null)}return!!ae(e,t)&&("<="===r||">="===r)}function ae(e,t){if(e===t)return!0;if(null===e&&t===C||null===t&&e===C)return!0;if($(e)&&$(t))return e.equals(t);if(Y(e)&&Y(t))return e.equals(t);if(J(e)&&J(t))return e.equals(t);if(e instanceof u.A)return e.equalityTest(t);if(e instanceof d.A)return e.equalityTest(t);if(e instanceof w.default&&t instanceof w.default){const r=e.cache._arcadeCacheId,i=t.cache._arcadeCacheId;if(null!=r)return r===i}if(K(e)&&K(t)){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function oe(e,t){let{useNumbersForDates:r}=t,i="";for(const n in e){""!==i&&(i+=",");const t=e[n];null==t?i+=JSON.stringify(n)+":null":(0,P.Lm)(t)||(0,P.Et)(t)||(0,P.Kg)(t)?i+=JSON.stringify(n)+":"+JSON.stringify(t):k(t)?i+=JSON.stringify(n)+":"+ce(t):Y(t)||J(t)?i+=`${JSON.stringify(n)}:${JSON.stringify(t.toString())}`:q(t)||Array.isArray(t)?i+=JSON.stringify(n)+":"+ce(t,null,r):$(t)?i+=r?JSON.stringify(n)+":"+JSON.stringify(t.getTime()):JSON.stringify(n)+":"+t.stringify():null!==t&&"object"==typeof t&&"castToText"in t&&(i+=JSON.stringify(n)+":"+t.castToText(r))}return"{"+i+"}"}function se(e,t){if((0,P.Kg)(e))return e;if(null===e)return"";if((0,P.Et)(e))return ee(e,t);if((0,P.Lm)(e))return e.toString();if($(e))return te(e,t);if(Y(e))return e.toFormat(t);if(J(e))return e.toFormat(t);if(e instanceof y.default)return JSON.stringify(e.toJSON());if((0,P.cy)(e)){const t=[];for(let r=0;r<e.length;r++)t[r]=ue(e[r]);return"["+t.join(",")+"]"}if(e instanceof c.A){const t=[];for(let r=0;r<e.length();r++)t[r]=ue(e.get(r));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText():E(e)?"object, Function":e===C?"":D(e)?"object, Module":""}function le(e){const t=[];if(e instanceof c.A){for(let r=0;r<e.length();r++)t[r]=de(e.get(r));return t}if(!(0,P.cy)(e))return null;for(let r=0;r<e.length;r++)t[r]=de(e[r]);return t}function ce(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,P.Kg)(e))return e;if(null===e)return"";if((0,P.Et)(e))return ee(e,t);if((0,P.Lm)(e))return e.toString();if($(e))return te(e,t);if(Y(e))return e.toFormat(t);if(J(e))return e.toFormat(t);if(e instanceof y.default)return e instanceof g.default?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+Me(e.spatialReference)+"}":Me(e.toJSON(),((e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0));if((0,P.cy)(e)){const t=[];for(let i=0;i<e.length;i++)t[i]=ue(e[i],r);return"["+t.join(",")+"]"}if(e instanceof c.A){const t=[];for(let i=0;i<e.length();i++)t[i]=ue(e.get(i),r);return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText(r):E(e)?"object, Function":e===C?"":D(e)?"object, Module":""}function ue(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===e)return"null";if((0,P.Lm)(e)||(0,P.Et)(e)||(0,P.Kg)(e))return JSON.stringify(e);if(e instanceof y.default)return ce(e,null,t);if(e instanceof c.A)return ce(e,null,t);if(Array.isArray(e))return ce(e,null,t);if($(e))return t?JSON.stringify(e.getTime()):JSON.stringify(te(e,""));if(Y(e))return JSON.stringify(e.toString());if(J(e))return JSON.stringify(e.toString());if(null!==e&&"object"==typeof e){if("castToText"in e)return e.castToText(t)}else if(e===C)return"null";return"null"}function de(e,t){return(0,P.Et)(e)?e:null===e||""===e?0:$(e)||J(e)||Y(e)?NaN:(0,P.Lm)(e)?e?1:0:(0,P.cy)(e)||""===e||void 0===e?NaN:void 0!==t&&(0,P.Kg)(e)?(t=N(t,"\u2030",""),t=N(t,"\xa4",""),(0,p.qg)(e,{pattern:t})):e===C?0:Number(e)}function he(e,t){if($(e))return e;if((0,P.Kg)(e)){const r=function(e,t){const r=/ (\d\d)/,i=(0,a.mT)(t);let n=A.c9.fromISO(e,{zone:i});return n.isValid||r.test(e)&&(e=e.replace(r,"T$1"),n=A.c9.fromISO(e,{zone:t}),n.isValid)?n:null}(e,t);if(r)return a.lY.dateTimeToArcadeDate(r)}return null}function pe(e){return(0,P.Lm)(e)?e:(0,P.Kg)(e)?"true"===(e=e.toLowerCase()):!!(0,P.Et)(e)&&0!==e&&!isNaN(e)}function fe(e,t){const r=JSON.parse(e);return r&&!r.spatialReference&&(r.spatialReference=t),(0,S.fromJSON)(r)}function me(e,t){return null==e?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=t),e)}function ge(e){if(null===e)return null;if(e instanceof w.default)return"NaN"===e.x||null===e.x||isNaN(e.x)?null:e;if(e instanceof b.default){if(0===e.rings.length)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof M.default){if(0===e.paths.length)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof v.default?0===e.points.length?null:e:e instanceof g.default?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function ye(e,t){if(!e)return t;if(!e.domain)return t;let r=null,i=null;if($(t))r=t.toNumber();else if(J(t))r=t.toString();else if(Y(t))r=t.toStorageString();else if("string"===e.field.type||"esriFieldTypeString"===e.field.type)r=se(t);else{if(null==t)return null;if(""===t)return t;r=de(t)}for(let n=0;n<e.domain.codedValues.length;n++){const t=e.domain.codedValues[n];t.code===r&&(i=t)}return null===i?se(t):i.name}function ve(e,t){if(!e)return t;if(!e.domain)return t;let r=null;const i=se(t);for(let n=0;n<e.domain.codedValues.length;n++){const t=e.domain.codedValues[n];t.name===i&&(r=t)}return null===r?t:r.code}function we(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!t)return null;if(!t.fields)return null;let n,a,o=null;for(let s=0;s<t.fields.length;s++){const r=t.fields[s];r.name.toLowerCase()===e.toString().toLowerCase()&&(o=r)}if(null===o)throw new s.D$(null,s.TX.FieldNotFound,null,{key:e});let l=t.typeIdField,c="id",u=t.types;if(t.subtypeField&&(l=t.subtypeField,c="code",u=t.subtypes??[]),null===i&&r&&l)i=r.hasField(l)?r.field(l):null;else if(l&&null!==i){let e=!1;for(const t of u||[])if(i===t[c]){e=!0;break}if(!e)for(const t of u||[])if(i===t.name){i=t[c],e=!0;break}e||(i=null,r&&l&&(i=r.hasField(l)?r.field(l):null))}return null!=i&&u.some((e=>e[c]===i&&(n=e.domains?.[o.name],n&&"inherited"===n.type&&(n=be(o.name,t),a=!0),!0))),a||n||(n=be(e,t)),{field:o,domain:n}}function be(e,t){let r;return t.fields.some((t=>(t.name.toLowerCase()===e.toLowerCase()&&(r=t.domain),!!r))),r}function Me(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){const i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}});var n;const a=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(a.includes(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const s=a.push(t)-1,l=Object.keys(t).sort(i?.(t));for(o="",n=0;n<l.length;n++){const r=l[n],i=e(t[r]);i&&(o&&(o+=","),o+=JSON.stringify(r)+":"+i)}return a.splice(s,1),"{"+o+"}"}(e)}function _e(e){if(null===e)return null;const t=[];for(const r of e)G(r)?t.push(r.geometry()):t.push(r);return t}function xe(e,t){if(!(t instanceof w.default))throw new s.D$(null,s.TX.InvalidParameter,null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Se(e,t){if((0,P.cy)(e)||q(e)){let r=!1,i=!1,n=[],a=t;if((0,P.cy)(e)){for(const t of e)xe(n,t);n.length>0&&(a=e[0].spatialReference,r=e[0].hasZ,i=e[0].hasM)}else if(e instanceof d.A)n=e._elements,n.length>0&&(r=e._hasZ,i=e._hasM,a=e.get(0).spatialReference);else{if(!q(e))throw new s.D$(null,s.TX.InvalidParameter,null);for(const t of e.toArray())xe(n,t);n.length>0&&(a=e.get(0).spatialReference,r=!0===e.get(0).hasZ,i=!0===e.get(0).hasM)}return 0===n.length?null:((0,x.$3)(n)||(n=n.slice().reverse()),new b.default({rings:[n],spatialReference:a,hasZ:r,hasM:i}))}return e}function Te(e,t){if((0,P.cy)(e)||q(e)){let r=!1,i=!1,n=[],a=t;if((0,P.cy)(e)){for(const t of e)xe(n,t);n.length>0&&(a=e[0].spatialReference,r=!0===e[0].hasZ,i=!0===e[0].hasM)}else if(e instanceof d.A)n=e._elements,n.length>0&&(r=e._hasZ,i=e._hasM,a=e.get(0).spatialReference);else if(q(e)){for(const t of e.toArray())xe(n,t);n.length>0&&(a=e.get(0).spatialReference,r=!0===e.get(0).hasZ,i=!0===e.get(0).hasM)}return 0===n.length?null:new M.default({paths:[n],spatialReference:a,hasZ:r,hasM:i})}return e}function Pe(e,t){if((0,P.cy)(e)||q(e)){let r=!1,i=!1,n=[],a=t;if((0,P.cy)(e)){for(const t of e)xe(n,t);n.length>0&&(a=e[0].spatialReference,r=!0===e[0].hasZ,i=!0===e[0].hasM)}else if(e instanceof d.A)n=e._elements,n.length>0&&(r=e._hasZ,i=e._hasM,a=e.get(0).spatialReference);else if(q(e)){for(const t of e.toArray())xe(n,t);n.length>0&&(a=e.get(0).spatialReference,r=!0===e.get(0).hasZ,i=!0===e.get(0).hasM)}return 0===n.length?null:new v.default({points:n,spatialReference:a,hasZ:r,hasM:i})}return e}function Ae(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=[];if(null===e)return r;if(!0===(0,P.cy)(e)){for(let i=0;i<e.length;i++){const n=se(e[i]);""===n&&!0!==t||r.push(n)}return r}if(e instanceof c.A){for(let i=0;i<e.length();i++){const n=se(e.get(i));""===n&&!0!==t||r.push(n)}return r}if(Z(e)){const i=se(e);return""===i&&!0!==t||r.push(i),r}return[]}let Ie=0;function Re(e){return Ie++,Ie%100==0?(Ie=0,new Promise((t=>{setTimeout((()=>{t(e)}),0)}))):e}function Ce(e,t,r){switch(r){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function Fe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null==e?null:(0,P.Lm)(e)||(0,P.Et)(e)||(0,P.Kg)(e)?e:e instanceof y.default?!0===t?.keepGeometryType?e:e.toJSON():e instanceof c.A?e.toArray().map((e=>Fe(e,t))):Array.isArray(e)?e.map((e=>Fe(e,t))):(0,P.$P)(e)?e:$(e)?e.toJSDate():Y(e)?e.toString():J(e)?e.toJSDate():null!==e&&"object"==typeof e&&void 0!==e.castAsJson?e.castAsJson(t):null}async function Oe(e,t,r,i,n){const a=await Ne(e,t,r);n[i]=a}async function Ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e instanceof c.A&&(e=e.toArray()),null==e)return null;if(Z(e)||e instanceof y.default||(0,P.$P)(e)||$(e))return Fe(e,r);if(Array.isArray(e)){const i=[],n=[];for(const a of e)null===a||Z(a)||a instanceof y.default||(0,P.$P)(a)||$(a)?n.push(Fe(a,r)):(n.push(null),i.push(Oe(a,t,r,n.length-1,n)));return i.length>0&&await Promise.all(i),n}return null!==e&&"object"==typeof e&&void 0!==e.castAsJsonAsync?e.castAsJsonAsync(t,r):null}function Ee(e){return De(e)?e.parent:e}function De(e){return e&&"declaredClass"in e&&"esri.layers.support.SubtypeSublayer"===e.declaredClass}function Ze(e){return e&&"declaredClass"in e&&"esri.layers.SubtypeGroupLayer"===e.declaredClass}function ze(e,t,r){const i=Ee(e.fullSchema());return null===i?null:i.fields?we(t,i,e,r):null}function Le(e){const t=Ee(e.fullSchema());return null===t?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map((e=>({name:e.name,code:e.code}))):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map((e=>({name:e.name,code:e.id}))):[]}:null:null}function ke(e,t,r,i){const n=Ee(e.fullSchema());if(null===n)return null;if(!n.fields)return null;const a=we(t,n,e,i);if(void 0===r)try{r=e.field(t)}catch(o){return null}return ye(a,r)}function Ge(e,t,r,i){const n=Ee(e.fullSchema());if(null===n)return null;if(!n.fields)return null;if(void 0===r){try{r=e.field(t)}catch(a){return null}return r}return ve(we(t,n,e,i),r)}function Ve(e){return e?.timeZone??"system"}function je(e){const t=Ee(e.fullSchema());if(null===t)return null;if(!t.fields)return null;const r=[];for(const i of t.fields)r.push((0,h.nE)(i));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:void 0===h.yT[t.geometryType]?"":h.yT[t.geometryType],fields:r}}function He(e,t){const r=a.lY.systemTimeZoneCanonicalName;return"system"===e&&(e=r),{version:Ue,engineVersion:n.version,timeZone:e,userTimeZone:r,spatialReference:t instanceof _.default?t.toJSON():t,application:i.default.applicationName??"",engine:"web",locale:(0,T.JK)()}}const Ue="1.30",Be=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:R,ReturnResult:I,absRound:X,arcadeVersion:Ue,autoCastArrayOfPointsToMultiPoint:Pe,autoCastArrayOfPointsToPolygon:Se,autoCastArrayOfPointsToPolyline:Te,autoCastFeatureToGeometry:_e,binaryOperator:Ce,breakResult:F,castAsJson:Fe,castAsJsonAsync:Ne,castRecordToText:oe,continueResult:O,defaultExecutingContext:He,defaultTimeZone:Ve,defaultUndefined:z,equalityTest:ae,featureDomainCodeLookup:Ge,featureDomainValueLookup:ke,featureFullDomain:ze,featureSchema:je,featureSubtypes:Le,fixNullGeometry:ge,fixSpatialReference:me,formatDate:te,formatNumber:ee,getDomain:we,getDomainCode:ve,getDomainValue:ye,getType:L,greaterThanLessThan:ne,isArray:P.cy,isBoolean:P.Lm,isDate:$,isDateOnly:J,isDictionary:H,isDictionaryLike:U,isFeature:G,isFeatureSet:j,isFeatureSetCollection:B,isFunctionParameter:E,isGeometry:k,isGraphic:P.DU,isImmutableArray:q,isInteger:P.Fq,isJsDate:P.$P,isKnowledgeGraph:W,isModule:D,isNumber:P.Et,isObject:K,isSimpleType:Z,isString:P.Kg,isSubtypeGrouplayer:Ze,isSubtypeSublayer:De,isTime:Y,isVoxel:V,multiReplace:N,parseGeometryFromJson:fe,pcCheck:Q,stableStringify:Me,standardiseDateFormat:re,tick:Re,toBoolean:pe,toDate:he,toNumber:de,toNumberArray:le,toString:se,toStringArray:Ae,toStringExplicit:ce,voidOperation:C},Symbol.toStringTag,{value:"Module"}))},96504:(e,t,r)=>{r.d(t,{R1:()=>o,aY:()=>n,cN:()=>a});var i=r(49807);class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=r}}function a(e){return"array"in e}function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,i.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(a(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},99254:(e,t,r)=>{r.d(t,{R:()=>q});var i=r(64682),n=r(67965),a=r(13473),o=r(87752),s=r(10382),l=r(32006),c=r(98080),u=r(89227),d=r(28473),h=r(24646);function p(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var f=r(90772),m=r(76517),g=r(82501),y=r(4794),v=r(98876),w=r(96236),b=r(66195),M=r(96122),_=r(35694),x=r(60984),S=r(53801),T=r(44375),P=r(89893),A=r(22131),I=r(46314),R=r(33050),C=r(64003),F=r(7972),O=r(93003),N=r(16434),E=r(86836),D=r(85645),Z=r(92156),z=r(12723);class L extends N.w{constructor(e,t){super(e,t,new O.$(F.H,(()=>r.e(28612).then(r.bind(r,28612))))),this.primitiveType=t.occlusionPass?Z.WR.POINTS:Z.WR.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:r,draped:i,output:n,depthTestEnabled:a,occlusionPass:o}=e,s=t===E.Y.NONE,l=t===E.Y.ColorAlpha,c=n===w.V.Highlight,u=a&&!i&&!l&&!o&&!c;return(0,z.Ey)({blending:(0,w.RN)(n)?s?z.Os:(0,D.ez)(t):null,depthTest:a&&!i?{func:Z.MT.LEQUAL}:null,depthWrite:u?z.Uy:null,drawBuffers:(0,D.m6)(t,n),colorWrite:z.kn,polygonOffset:r?k:null})}}const k={factor:0,units:-4};var G=r(93800),V=r(69261),j=r(82606),H=r(21484),U=r(51448);class B extends U.E{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.textureCoordinateType=V.I.None,this.emissionSource=j.ZX.None,this.discardInvisibleFragments=!0,this.hasVvInstancing=!1}}(0,G._)([(0,H.W)()],B.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,G._)([(0,H.W)()],B.prototype,"occlusionTestEnabled",void 0),(0,G._)([(0,H.W)()],B.prototype,"signedDistanceFieldEnabled",void 0),(0,G._)([(0,H.W)()],B.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,G._)([(0,H.W)()],B.prototype,"vvSize",void 0),(0,G._)([(0,H.W)()],B.prototype,"vvColor",void 0),(0,G._)([(0,H.W)()],B.prototype,"hasVerticalOffset",void 0),(0,G._)([(0,H.W)()],B.prototype,"hasScreenSizePerspective",void 0),(0,G._)([(0,H.W)()],B.prototype,"hasRotation",void 0),(0,G._)([(0,H.W)()],B.prototype,"debugDrawLabelBorder",void 0),(0,G._)([(0,H.W)()],B.prototype,"hasPolygonOffset",void 0),(0,G._)([(0,H.W)()],B.prototype,"depthTestEnabled",void 0),(0,G._)([(0,H.W)()],B.prototype,"pixelSnappingEnabled",void 0),(0,G._)([(0,H.W)()],B.prototype,"draped",void 0),(0,G._)([(0,H.W)()],B.prototype,"terrainDepthTest",void 0),(0,G._)([(0,H.W)()],B.prototype,"cullAboveTerrain",void 0),(0,G._)([(0,H.W)()],B.prototype,"occlusionPass",void 0),(0,G._)([(0,H.W)()],B.prototype,"occludedFragmentFade",void 0),(0,G._)([(0,H.W)()],B.prototype,"objectAndLayerIdColorInstanced",void 0),(0,G._)([(0,H.W)()],B.prototype,"horizonCullingEnabled",void 0),(0,G._)([(0,H.W)()],B.prototype,"isFocused",void 0);var W=r(12621);class q extends x.im{constructor(e,t){super(e,ge),this.produces=new Map([[S.N.HUD_MATERIAL,e=>(0,w.Mb)(e)&&!this.parameters.drawAsLabel],[S.N.LABEL_MATERIAL,e=>(0,w.Mb)(e)&&this.parameters.drawAsLabel],[S.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[S.N.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,w.Mb)(e)]]),this._visible=!0,this._configuration=new B(t)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===S.N.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===S.N.OCCLUSION_PIXELS,(0,w.RN)(e)&&(this._configuration.debugDrawLabelBorder=!!y.b.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,r,i,a,s){const{options:{selectionMode:l,hud:c,excludeLabels:h},point:p,camera:f}=r,{parameters:m}=this;if(!l||!c||h&&m.isLabel||!e.visible||!p)return;const{scaleX:g,scaleY:y}=this._getScreenScale(e,f.pixelRatio);(0,n.z0)(ae,t),e.attributes.has(A.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(n*n+a*a+o*o),h=1/Math.sqrt(s*s+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*d,e[4]=a*d,e[5]=o*d,e[6]=s*h,e[7]=l*h,e[8]=c*h}(ae);const v=e.attributes.get(A.r.POSITION),w=e.attributes.get(A.r.SIZE),b=e.attributes.get(A.r.NORMAL),M=e.attributes.get(A.r.ROTATION),_=e.attributes.get(A.r.CENTEROFFSETANDDISTANCE);(0,P.vA)(v.size>=3);const x=(0,F.c)(m),S="screen"===this.parameters.centerOffsetUnits;for(let n=0;n<v.data.length/v.size;n++){const e=n*v.size;(0,u.i)(Q,v.data[e],v.data[e+1],v.data[e+2]),(0,u.t)(Q,Q,t),(0,u.t)(Q,Q,f.viewMatrix);const i=n*_.size;if((0,u.i)(le,_.data[i],_.data[i+1],_.data[i+2]),!S&&(Q[0]+=le[0],Q[1]+=le[1],0!==le[2])){const e=le[2];(0,u.n)(le,Q),(0,u.d)(Q,Q,(0,u.h)(le,le,e))}const a=n*b.size;if((0,u.i)(X,b.data[a],b.data[a+1],b.data[a+2]),J(X,ae,f,de),this._applyVerticalOffsetTransformationView(Q,de,f,K),f.applyProjection(Q,ee),ee[0]>-1){S&&(le[0]||le[1])&&(ee[0]+=le[0]*f.pixelRatio,0!==le[1]&&(ee[1]+=(0,T.m0)(le[1],K.factorAlignment)*f.pixelRatio),f.unapplyProjection(ee,Q)),ee[0]+=this.parameters.screenOffset[0]*f.pixelRatio,ee[1]+=this.parameters.screenOffset[1]*f.pixelRatio,ee[0]=Math.floor(ee[0]),ee[1]=Math.floor(ee[1]);const e=n*w.size;fe[0]=w.data[e],fe[1]=w.data[e+1],(0,T.MD)(fe,K.factor,fe);const t=he*f.pixelRatio;let i=0;m.textureIsSignedDistanceField&&(i=Math.min(m.outlineSize,.5*fe[0])*f.pixelRatio/2),fe[0]*=g,fe[1]*=y;const a=n*M.size,l=m.rotation+M.data[a];if(Y(p,ee[0],ee[1],fe,t,i,l,m,x)){const e=r.ray;if((0,u.t)(re,Q,(0,o.B8)(se,f.viewMatrix)),ee[0]=p[0],ee[1]=p[1],f.unprojectFromRenderScreen(ee,Q)){const t=(0,d.vt)();(0,u.c)(t,e.direction);const r=1/(0,u.l)(t);(0,u.h)(t,t,r),s((0,u.j)(e.origin,Q)*r,t,-1,!0,1,re)}}}}}intersectDraped(e,t,r,i,n,a){const o=e.attributes.get(A.r.POSITION),s=e.attributes.get(A.r.SIZE),l=e.attributes.get(A.r.ROTATION),c=this.parameters,u=(0,F.c)(c),{scaleX:d,scaleY:h}=this._getScreenScale(e,e.screenToWorldRatio),p=pe*e.screenToWorldRatio;for(let f=0;f<o.data.length/o.size;f++){const t=f*o.size,r=o.data[t],m=o.data[t+1],g=f*s.size;fe[0]=s.data[g],fe[1]=s.data[g+1];let y=0;c.textureIsSignedDistanceField&&(y=Math.min(c.outlineSize,.5*fe[0])*e.screenToWorldRatio/2),fe[0]*=d,fe[1]*=h;const v=f*l.size,w=c.rotation+l.data[v];Y(i,r,m,fe,p,y,w,c,u)&&n(a.dist,a.normal,-1,!1)}}createBufferWriter(){return new we}_updateScaleInfo(e,t,r){const i=this.parameters;null!=i.screenSizePerspective?(0,T.cJ)(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=i.screenSizePerspectiveAlignment?(0,T.cJ)(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,r,i,n,a,o){const s=J(t,r,n,de);return this._applyVerticalGroundOffsetView(e,s,n,o),this._applyVerticalOffsetTransformationView(o,s,n,a),this._applyPolygonOffsetView(o,s,i[3],n,o),this._applyCenterOffsetView(o,i,o),o}applyShaderOffsetsNDC(e,t,r,i,n){return this._applyCenterOffsetNDC(e,t,r,i),null!=n&&(0,u.c)(n,i),this._applyPolygonOffsetNDC(i,t,r,i),i}_applyPolygonOffsetView(e,t,r,n,a){const o=n.aboveGround?1:-1;let s=Math.sign(r);0===s&&(s=o);const l=o*s;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(a,e);const c=(0,i.qE)(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-c*c)/c/n.viewport[2];return(0,u.h)(a,e,l>0?d:1/d),a}_applyVerticalGroundOffsetView(e,t,r,i){const n=(0,u.l)(e),a=r.aboveGround?1:-1,o=r.computeRenderPixelSizeAtDist(n)*b.R,s=(0,u.h)(Q,t.normal,a*o);return(0,u.g)(i,e,s),i}_applyVerticalOffsetTransformationView(e,t,r,i){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const r=(0,u.l)(e);this._updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const a=(0,u.l)(e),o=n.screenSizePerspectiveAlignment??n.screenSizePerspective,s=(0,C.kE)(r,a,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(i,a,t.cosAngle),(0,u.h)(t.normal,t.normal,s),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,u.n)(X,r),(0,u.g)(r,r,(0,u.h)(X,X,t[2])))),r}_applyCenterOffsetNDC(e,t,r,i){const n="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,r,i){const n=this.parameters.shaderPolygonOffset;if(e!==i&&(0,u.c)(i,e),n){const e=r.aboveGround?1:-1,a=e*Math.sign(t[3]);i[2]-=(a||e)*n}return i}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:r}=this.parameters,i=e[3]>=W.Q||t>=W.Q&&r[3]>=W.Q;return this._visible&&i}createGLMaterial(e){return new $(e)}calculateRelativeScreenBounds(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,f.vt)();return function(e,t,r,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,t){const r=e.attributes.get(A.r.FEATUREATTRIBUTE);if(null==r)return{scaleX:t,scaleY:t};const i=(0,h.ci)(r.data,ue);return(0,g.VC)(ce,this.parameters,i),{scaleX:ce[0]*t,scaleY:ce[1]*t}}}class $ extends _.m8{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(L,e)}}function J(e,t,r,i){return p(t)&&(t=(0,n.z0)(oe,t)),(0,u.q)(i.normal,e,t),(0,u.t)(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=(0,u.f)(te,me),i}function Y(e,t,r,n,a,o,s,c,u){let d=t-a-n[0]*u[0],h=d+n[0]+2*a,p=r-a-n[1]*u[1],f=p+n[1]+2*a;const m=c.distanceFieldBoundingBox;return c.textureIsSignedDistanceField&&null!=m&&(d+=n[0]*m[0],p+=n[1]*m[1],h-=n[0]*(1-m[2]),f-=n[1]*(1-m[3]),d-=o,h+=o,p-=o,f+=o),(0,l.hZ)(ne,t,r),(0,l.e$)(ie,e,ne,(0,i.kU)(s)),ie[0]>d&&ie[0]<h&&ie[1]>p&&ie[1]<f}const K=new I.D,Q=(0,d.vt)(),X=(0,d.vt)(),ee=(0,h.vt)(),te=(0,d.vt)(),re=(0,d.vt)(),ie=(0,c.vt)(),ne=(0,c.vt)(),ae=(0,a.vt)(),oe=(0,a.vt)(),se=(0,s.vt)(),le=(0,d.vt)(),ce=(0,d.vt)(),ue=(0,h.vt)(),de={normal:te,cosAngle:0},he=1,pe=2,fe=[0,0],me=(0,d.fA)(0,0,1);class ge extends _.NV{constructor(){super(...arguments),this.renderOccluded=x.m$.Occlude,this.isDecoration=!1,this.color=(0,h.CN)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,c.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,h.CN)(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=(0,h.vt)(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusEffect="none",this.draped=!1,this.isLabel=!1}}const ye=(0,v.BP)().vec3f(A.r.POSITION).vec3f(A.r.NORMAL).vec2f(A.r.UV0).vec4u8(A.r.COLOR).vec2f(A.r.SIZE).f32(A.r.ROTATION).vec4f(A.r.CENTEROFFSETANDDISTANCE).vec4f(A.r.FEATUREATTRIBUTE),ve=ye.clone().vec4u8(A.r.OBJECTANDLAYERIDCOLOR);class we{constructor(){this.vertexBufferLayout=(0,M.E)()?ve:ye}elementCount(e){return 6*e.get(A.r.POSITION).indices.length}write(e,t,r,i,n,a){(0,R.Hk)(r.get(A.r.POSITION),e,n.position,a,6),(0,R.p1)(r.get(A.r.NORMAL),t,n.normal,a,6);const o=r.get(A.r.UV0)?.data;let s=0,l=0,c=1,u=1;o&&o.length>=4&&(s=o[0],l=o[1],c=o[2],u=o[3]),c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=r.get(A.r.POSITION).indices.length,h=a;const p=n.uv0;for(let m=0;m<d;++m)p.set(h,0,s),p.set(h,1,l),h++,p.set(h,0,c),p.set(h,1,l),h++,p.set(h,0,c),p.set(h,1,u),h++,p.set(h,0,c),p.set(h,1,u),h++,p.set(h,0,s),p.set(h,1,u),h++,p.set(h,0,s),p.set(h,1,l),h++;(0,R.tb)(r.get(A.r.COLOR),4,n.color,a,6);const{data:f,indices:g}=r.get(A.r.SIZE);d=g.length;const y=n.size;h=a;for(let m=0;m<d;++m){const e=f[2*g[m]],t=f[2*g[m]+1];for(let r=0;r<6;++r)y.set(h,0,e),y.set(h,1,t),h++}if((0,R.uO)(r.get(A.r.ROTATION),n.rotation,a,6),r.get(A.r.CENTEROFFSETANDDISTANCE)?(0,R.Ut)(r.get(A.r.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,a,6):(0,R.Pq)(n.centerOffsetAndDistance,a,6*d),r.get(A.r.FEATUREATTRIBUTE)?(0,R.Ut)(r.get(A.r.FEATUREATTRIBUTE),n.featureAttribute,a,6):(0,R.Pq)(n.featureAttribute,a,6*d),null!=i){const e=r.get(A.r.POSITION)?.indices;if(e){const t=e.length,r=n.getField(A.r.OBJECTANDLAYERIDCOLOR,m.XP);(0,R.tH)(i,r,t,a,6)}}}}},99480:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(93800),n=r(6946),a=r(48602),o=(r(21265),r(50925),r(14746),r(75269)),s=r(70576);let l=class extends n.default{set horizontalWKID(e){e?(0,s.fn)({wkid:+e})?this._set("horizontalWKID",+e):this._set("horizontalWKID",e):this._set("horizontalWKID",null)}set verticalWKID(e){e?this._set("verticalWKID",isFinite(e)&&(0,s.fn)({wkid:+e})?+e:null):this._set("verticalWKID",null)}get isAdvanced(){const{affineTransformations:e,focalLength:t,principalOffsetPoint:r,radialDistortionCoefficients:i,tangentialDistortionCoefficients:n}=this;return e?.length>1&&!Number.isNaN(t)&&r?.length>1&&i?.length>1&&n?.length>1}};(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"affineTransformations",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"focalLength",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"principalOffsetPoint",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"radialDistortionCoefficients",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"tangentialDistortionCoefficients",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"horizontalWKID",null),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"verticalWKID",null),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"x",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"y",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"z",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],l.prototype,"type",void 0),l=(0,i._)([(0,o.$)("esri.layers.orientedImagery.core.CameraOrientation")],l);const c=l}}]);