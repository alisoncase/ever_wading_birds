"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[33737],{39652:(e,t,n)=>{function r(e){const{attributes:t,sourceLayer:n}=e??{},r=n&&"displayField"in n?n.displayField:null,i=r?t?.[r]:null,l=null!=i?JSON.stringify(i):null,o=e?.getObjectId()?.toString();return l||o||""}n.d(t,{R:()=>r})},41327:(e,t,n)=>{n.d(t,{Au:()=>F,CU:()=>D,Et:()=>b,Gq:()=>A,H1:()=>q,HG:()=>L,Iy:()=>w,Kl:()=>Q,Kn:()=>z,LZ:()=>C,TN:()=>O,U3:()=>K,Ve:()=>_,XI:()=>E,bx:()=>v,cU:()=>x,k_:()=>I,lB:()=>P,l_:()=>G,n4:()=>H,nT:()=>T,oc:()=>U,qG:()=>k,rf:()=>h,s9:()=>j,t6:()=>V,tM:()=>$,vp:()=>Z,wr:()=>N});n(88677);var r=n(62631),i=n(7951),l=n(82301),o=n(50925),a=n(56612),u=n(96299),s=n(7249),f=n(95011),c=n(78076),d=n(79538),m=n(53826),p=n(82368),y=n(39652),g=n(99961);const h=e=>"field"===e?.type,b=e=>"group"===e?.type,T=e=>"relationship"===e?.type,I=e=>"text"===e.type,F=e=>"utilityNetworkAssociations"===e.type,v=e=>!b(e)&&null!=e.group,N=e=>e.reduce(((e,t)=>b(t)?[...e,...t.inputs]:[...e,t]),[]),w=e=>N(e).filter(h),x=e=>N(e).filter(T),O=e=>N(e).filter(F),E=e=>null!=e&&(L(e,"combo-box")||L(e,"radio-buttons")),L=(e,t)=>null!=e&&e.input?.type===t,A=e=>{let{domain:t,inputType:n="text-box",dataType:r}=e;return"number"===r&&"text-box"===n&&(!t||"coded-value"!==t.type)};function Z(e,t){const{title:n,feature:r}=e??{};return n||(r?(0,y.R)(r):null)||t||""}function C(e){const{attributes:t,fieldsIndex:n,label:i,timeZone:l}=e;if(!t||"object"!=typeof t)return i;const o=Object.keys(t).filter((e=>(0,a.mk)(i,e))),u=o.map((e=>t[e])),s=o.map((e=>n.get(e))).filter(r.Ru);return function(e,t){return(0,a.HC)((0,a.HC)(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[t.toLowerCase(),n]}))))}(i,_({values:u,fields:s,timeZone:l}))}const R="expression/",M="expr/",S="field/";function U(e){const[t,n]=e.split(R);return""===t&&n?n:(o.A.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${R}/expressionName'`),"")}function V(e){return`${R}${e}`}function q(e){return`${S}${e}`}function j(e){return e.startsWith(R)}function k(e){return e.startsWith(M)}function _(e){const{fields:t,values:n}=e,r=e.timeZone??void 0,i=t.map(((e,t)=>{let i=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===i));t?.name&&(i=t.name)}return((0,d.fs)(e)||(0,f.isTimeOnlyField)(e))&&(i=(0,m.ZP)(e,i,{timeZone:r,...(0,m.ZT)(e)})),[e.name,i]}));return Object.fromEntries(i)}const D=e=>{const t={typeFieldName:null,types:[]};return e?((0,c.Sv)(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map((e=>{let{id:t,name:n,domains:r}=e;return{code:t,name:n,domains:r}}))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},$=(e,t,n)=>{const{dataType:r,error:i,minLength:l}=e,o=t?.validationErrors;if(!o||!i)return null;if(i===p.gK.CANNOT_BE_EMPTY)return o.cannotBeNull;if(i===s.Mh.VALUE_OUT_OF_RANGE||i===f.NumericRangeValidationError.OUT_OF_RANGE){const{field:t,range:i}=e,l={type:"date",intlOptions:{timeZone:"date"===t.type&&n?n:void 0,...(0,m.ZT)(t)}},a=(0,p.hQ)(i,o);return(0,g.V)(a,i,{format:{max:"date"===r?l:null!=i.max&&(0,p.qn)(i.max)?p.Qv:p.PA,min:"date"===r?l:null!=i.min&&(0,p.qn)(i.min)?p.Qv:p.PA}})}return i===s.Mh.INVALID_CODED_VALUE?o.invalidCodedValue:i===f.TypeValidationError.INVALID_TYPE?o.invalidType:i===p.gK.TOO_SHORT?(0,g.V)(o.tooShort,{min:l}):(p.gK.TOO_LONG,null)},G=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":"mesh"===r||"mesh"===n||"multipatch"===n?"cube":"multipoint"===r||"multipoint"===n?"point":r||n||"table"},H=e=>{const t=[];if(e.formTemplate){const{description:n,title:r}=e.formTemplate;e.fields?.forEach((e=>{const i=r&&(0,a.mk)(r,e.name),l=n&&(0,a.mk)(n,e.name);(i||l)&&t.push(e.name)}))}return t};function P(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(u.jt)??[]).some((t=>{let{fieldName:n}=t;return!e.fieldsIndex.get(n)}))}function z(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function Q(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return(0,i.Xb)(t.objectType),!1}}function K(e,t,n){const r=(0,c.fV)(e),i=r?.find((e=>e.code===n));if(!i)return!1;const o=r?.find((e=>e.code===t));return!(0,l.equalsShallow)(i.defaultValues,o?.defaultValues)&&Object.values(i.defaultValues).some((e=>null!=e))}},53826:(e,t,n)=>{n.d(t,{Ng:()=>N,OM:()=>h,Q0:()=>I,T8:()=>T,ZP:()=>v,ZT:()=>F,eX:()=>O,fD:()=>A,fb:()=>p,fl:()=>m,iP:()=>L,oh:()=>w,rX:()=>Z,sH:()=>y,yk:()=>C});n(88677),n(21265);var r=n(74719),i=n(64682),l=n(66845),o=n(72520),a=n(69943),u=n(73210),s=n(51536),f=n(12711);const c=u.n$,d={date:null,time:null,timeZoneOffset:null},m=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),p="latn",y=new Set(["date-only","time-only","timestamp-offset"]),g=e=>"valueAsDate"in e;function h(e){return{locale:(0,f.JK)(),numberingSystem:p,zone:e??c}}function b(e,t){return null==e?null:s.c9.fromMillis(e,h(t))}function T(e,t){if(null==e||!(0,a.Kg)(e)||""===e){if(t){const e=s.c9.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return d}const n=s.c9.fromISO(e,{setZone:!0});return{date:n.toFormat(o.mo,h()),time:n.toFormat(o.Uq.HMS_MS,h()),timeZoneOffset:n.offset.toString()}}function I(e,t){if(null==e||!(0,a.Et)(e)||isNaN(e))return d;const n=b(e,t);return n?{date:n.toFormat(o.mo,h(t)),time:n.toFormat(o.Fj,h(t))}:d}function F(e){switch(e.type){case"date":default:return(0,l.J2)("short-date-short-time");case"date-only":return(0,l.J2)("short-date");case"time-only":return(0,l.J2)("short-time");case"timestamp-offset":return{...(0,l.J2)("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function v(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return(0,l.Yq)(t,n);case"date-only":return(0,l.iS)(t,n);case"time-only":return(0,l.F8)(t,n);case"timestamp-offset":return(0,l.Ey)(t,n);default:return null}}function N(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:r,timeZoneComponent:i,oldValue:l}=e;if(!t?.value)return null;const{year:a,month:f,day:c}=s.c9.fromFormat(t.value,o.mo),{hour:d,minute:m,second:p,millisecond:y}=x(r,u.n$)??s.c9.now(),g=T(l,n),h=i?.value?parseInt(i.value,10):null!=g.timeZoneOffset?parseInt(g.timeZoneOffset,10):(new Date).getTimezoneOffset(),b=s.mQ.instance(h),I=s.c9.fromObject({year:a,month:f,day:c,hour:d,minute:m,second:p,millisecond:y},{zone:b});return I.isValid?I.toISO({includeOffset:!0}):null}function w(e){const{dateComponent:t,timeComponent:n,timeZone:r,max:i,min:l,oldValue:o}=e,a=x(t,r);let u=!!e.applyRange;if(!a)return null;let f=null;if(null!=n?.value){const e=x(n,r),t=Date.now(),l=null!=i&&i<t?i:t,o=s.c9.fromMillis(l,h(r)),u=a||o,{year:c,month:d,day:m}=u,{hour:p,minute:y,second:g,millisecond:b}=e||o;f=u.set({year:c,month:d,day:m,hour:p,minute:y,second:g,millisecond:b})}else{const e=b(E({value:o??Date.now(),max:i,min:l}),r),{year:t,month:n,day:s}=a,{hour:c,minute:d,second:m,millisecond:p}=e;u=!0,f=a.set({year:t,month:n,day:s,hour:c,minute:d,second:m,millisecond:p})}if(!f.isValid)return null;const c=f.toMillis();return u?E({value:c,max:i,min:l}):c}function x(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=g(e)?s.c9.fromFormat(e.value,o.mo,h(t)):(0,o.UE)(e.value),n?.isValid?n:null}function O(e){const{max:t,min:n,value:r}=e;return!isNaN(r)&&!(null!=t&&r>t)&&!(null!=n&&r<n)}function E(e){const{max:t,min:n,value:r}=e;return null!=t&&null!=n?(0,i.qE)(r,n,t):null!=t&&r>t?t:null!=n&&r<n?n:r}function L(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new r.default("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),i=new Array(3);for(let r=0;r<3;r++){const e=n.at(r)??"";i[r]=e.padStart(2,"0")}return i.join(":")}function A(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return L(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function Z(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function C(e){const{type:t,range:n,value:r}=e;if(null==r||!n||r===n.min||r===n.max)return!0;if("date"===t)return O({value:r,min:n.min,max:n.max});const{rawMax:i,rawMin:l}=n;let a=null,u=null,s=null;switch(t){case"date-only":a=(0,o.Xi)(i),u=(0,o.Xi)(l),s=(0,o.Xi)(r);break;case"time-only":a=(0,o.UE)(i),u=(0,o.UE)(l),s=(0,o.UE)(r);break;case"timestamp-offset":a=(0,o.gz)(i),u=(0,o.gz)(l),s=(0,o.gz)(r)}return!s||O({value:s.valueOf(),min:u?.valueOf(),max:a?.valueOf()})}},82368:(e,t,n)=>{n.d(t,{$$:()=>F,D_:()=>d,Gd:()=>c,Kx:()=>r,PA:()=>h,Po:()=>m,Qv:()=>b,gK:()=>i,hQ:()=>I,jl:()=>y,of:()=>f,qn:()=>T,zU:()=>p});var r,i,l,o=n(96299),a=n(7249),u=n(95011),s=n(53826);(l=r||(r={})).Text="text",l.Number="number",l.Date="date",l.Unsupported="unsupported",function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(i||(i={}));const f=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};function c(e,t){const{dataType:n,domain:r,field:l,maxLength:o,minLength:f,range:c,required:d}=t;if(null==e)return d?i.CANNOT_BE_EMPTY:null;if("text"===n&&"string"==typeof e){if(f>-1&&e.length<f)return i.TOO_SHORT;if(o>-1&&e.length>o)return i.TOO_LONG}return"date"!==n||(0,s.yk)({type:l.type,range:c,value:e})?r?(0,a.wb)(l,e,r):(0,u.validateFieldValue)(l,e)??(0,a.wb)(l,e):u.NumericRangeValidationError.OUT_OF_RANGE}function d(e,t){return!(!m(e)||!m(t))||e===t}function m(e){return null==e||""===e}function p(e){let{dataType:t,field:n,input:i}=e;if(t===r.Date)return-1;const l=g(n.length);if(!i||!(0,o.AI)(i))return l;const a=g(i.maxLength);return-1===a?l:-1===l?a:Math.min(l,a)}function y(e){let{dataType:t,field:n,input:i}=e;if(t===r.Date)return-1;if(!i||!(0,o.AI)(i))return-1;const l=g(i.minLength);if(l<0)return-1;const a=g(n.length);return a>-1&&a<l?-1:l}function g(e){return"number"==typeof e&&e>-1?e:-1}const h={type:"number"},b={type:"number",intlOptions:{notation:"scientific"}};function T(e){return e>=1e7||e<=-1e7}function I(e,t){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}const F=e=>e&&!Number.isNaN(e.valueOf())},92471:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>X,createFieldInfoMap:()=>Q,findRelatedLayer:()=>ae,findUtilityNetwork:()=>ue,fixTokens:()=>V,formatAttributes:()=>B,formatEditInfo:()=>z,formatValueToFieldInfo:()=>G,getAllFieldInfos:()=>K,getFieldInfo:()=>P,getFieldInfoLabel:()=>L,getFixedFieldName:()=>A,getFixedFieldNames:()=>Z,getHighlightKeyForFeature:()=>ce,getSourceLayer:()=>w,graphicCallback:()=>x,htmlEntities:()=>J,isAssociatedFeatureSupportedLayer:()=>D,isExpressionField:()=>E,isFeatureSupportedLayer:()=>j,isGraphicForRelatableFeatureSupportedLayer:()=>$,isRelatableFeatureSupportedLayer:()=>_,isRelatableLayer:()=>k,isRelatedField:()=>te,preLayerQueryCallback:()=>le,preRequestCallback:()=>oe,querySourceLayer:()=>W,queryUpdatedFeature:()=>ee,shouldOpenInNewTab:()=>O,substituteAttributes:()=>S,substituteFieldsInLinksAndAttributes:()=>M});var r=n(21265),i=n(50925),l=n(56612),o=n(66845),a=n(23224),u=n(95011),s=n(78076),f=n(79538),c=n(96247),d=n(40731);const m=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),p=/href=(""|'')/gi,y=/(\{([^{\r\n]+)\})/g,g=/'/g,h=/^\s*expression\//i,b=/(\n)/gi,T=/[\u00A0-\u9999<>&]/gim,I=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,F=/^(?:mailto:|tel:)/,v="relationships/",N=(0,o.J2)("short-date-short-time");function w(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function x(e){let{type:t,value:n,event:r}=e;try{return"function"==typeof n?n(r):await n}catch(i){return void m().error("error",`An error occurred when calling the "${t}" function`,{error:i,graphic:r.graphic,value:n})}}function O(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!F.test(e.trim().toLowerCase())}function E(e){return!!e&&h.test(e)}function L(e,t){const n=function(e,t){if(!t||!E(t)||!e)return;const n=t.replace(h,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===n}))}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function A(e,t){const n=C(t,e);return n?n.name:e}function Z(e,t){return e&&e.map((e=>A(e,t)))}function C(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function R(e){return`${e}`.trim()}function M(e){let{attributes:t,globalAttributes:n,layer:r,text:i,expressionAttributes:l,fieldInfoMap:o}=e;return i?S({formattedAttributes:n,template:q(i,{...n,...l,...t},r),fieldInfoMap:o}):""}function S(e){let{formattedAttributes:t,template:n,fieldInfoMap:r}=e;return R(function(e){return e.replaceAll(p,"")}((0,l.HC)((0,l.HC)(n,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,r))),t)))}function U(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t[e];if("string"==typeof r){const i="%27",l=(n?encodeURIComponent(r):r).replaceAll(g,i);t[e]=l}}(e,n,t))),n}function V(e,t){return e.replaceAll(y,((e,n,r)=>{const i=C(t,r);return i?`{${i.name}}`:n}))}function q(e,t,n){const r=V(e,n);return r?r.replaceAll(I,((e,n,r)=>function(e,t,n){const r=(t=R(t))&&"{"!==t[0];return(0,l.HC)(e,U(n,r||!1))}(e,n||r,t))):r}function j(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function k(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function _(e){return j(e)&&k(e)}function D(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function $(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&_(e.sourceLayer)}function G(e,t){const{fieldInfos:n,fieldName:r,preventPlacesFormatting:i,layer:l,timeZone:o}=t,s=P(n,r),c=C(l,r);if(s&&!(0,u.isRasterPixelValueField)(r)){const t=c?.type,n=s.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,f.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:l&&"preferredTimeZone"in l?l.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:!(!l||!("datesInUnknownTimezone"in l))&&!!l.datesInUnknownTimezone}})}const d=s?.format;return"string"==typeof e&&(0,u.isRasterPixelValueField)(r)&&d?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?H(e,",",", ",t):e.includes(";")?H(e,";","; ",t):e.includes(" ")?H(e," "," ",t):(0,a.ZV)(Number(e),(0,a.yx)(t))}(e,d):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,d))||null==e||null==d?X(e):(0,a.ZV)(e,i?{...(0,a.yx)(d),minimumFractionDigits:0,maximumFractionDigits:20}:(0,a.yx)(d))}function H(e,t,n,r){return e.trim().split(t).map((e=>(0,a.ZV)(Number(e),(0,a.yx)(r)))).join(n)}function P(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function z(e,t,n,r){const{creatorField:i,creationDateField:l,editorField:a,editDateField:u}=e;if(!t)return;const s=(0,d.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,n,N,"date"),f={...N,...s},c=t[u];if("number"==typeof c){const e=t[a];return{type:"edit",date:(0,o.Yq)(c,f),user:e}}const m=t[l];if("number"==typeof m){const e=t[i];return{type:"create",date:(0,o.Yq)(m,f),user:e}}return null}function Q(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=A(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function K(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}})),t):t}function J(e){return e.replaceAll(T,(e=>`&#${e.charCodeAt(0)};`))}function X(e){return"string"==typeof e?e.replaceAll(b,'<br class="esri-text-new-line" />'):e}function Y(e){const{value:t,fieldName:n,fieldInfos:i,fieldInfoMap:l,layer:o,graphic:a,timeZone:s}=e;if(null==t)return"";const c=function(e){let{fieldName:t,value:n,graphic:i,layer:l}=e;if(te(t))return null;if(!l||"function"!=typeof l.getFieldDomain)return null;const o=i&&l.getFieldDomain(t,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return o&&"coded-value"===o.type?o.getName(n):null}({fieldName:n,value:t,graphic:a,layer:o});if(c)return c;const d=function(e){let{fieldName:t,graphic:n,layer:r}=e;if(te(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const l=r.getFeatureType(n);return l?l.name:null}({fieldName:n,graphic:a,layer:o});if(d)return d;if(l.get(n.toLowerCase()))return G(t,{fieldInfos:i||Array.from(l.values()),fieldName:n,layer:o,timeZone:s});const m=o?.fieldsIndex?.get(n);return m&&((0,f.fs)(m)||(0,u.isTimeOnlyField)(m))?(0,f.i0)(t,{fieldType:m.type,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}}):X(t)}function B(e){let{fieldInfos:t,attributes:n,layer:r,graphic:i,fieldInfoMap:l,relatedInfos:o,timeZone:a}=e;const u={};return o?.forEach((e=>function(e){let{attributes:t,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:o}=e;t&&n&&(n.relatedFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:o}))),n.relatedStatsFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:l,timeZone:o}))))}({attributes:u,relatedInfo:e,fieldInfoMap:l,fieldInfos:t,layer:r,timeZone:a}))),n&&Object.keys(n).forEach((e=>{const o=n[e];u[e]=Y({fieldName:e,fieldInfos:t,fieldInfoMap:l,layer:r,value:o,graphic:i,timeZone:a})})),u}async function W(e,t){const{layer:n,graphic:r,outFields:i,objectIds:l,returnGeometry:o,spatialReference:a}=e,u=l[0];if("number"!=typeof u&&"string"!=typeof u){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:r,objectId:u,requiredFields:i};return m().warn(e,t),null}if(!(0,s.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:r,requiredFields:i,returnGeometry:o};return m().warn(e,t),null}const f=n.createQuery();return f.objectIds=l,f.outFields=i?.length?i:[n.objectIdField],f.returnGeometry=!!o,f.returnZ=!!o,f.returnM=!!o,f.outSpatialReference=a,(await n.queryFeatures(f,t)).features[0]}async function ee(e,t){let{graphic:n,popupTemplate:r,layer:i,spatialReference:l}=e;if(!i||!r)return;if("function"==typeof i.load&&await i.load(t),!n.attributes)return;const o=i.objectIdField,a=n.attributes[o];if(null==a)return;const s=[a],f=await r.getRequiredFields(i.fieldsIndex),d=(0,u.featureHasFields)(f,n),m=d?[]:f.includes(o)?f:[...f,o],p=r.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(r);if(d&&!p)return;const y=await W({layer:i,graphic:n,outFields:m,objectIds:s,returnGeometry:p,spatialReference:l},t);y&&(y.geometry&&(n.geometry=y.geometry),y.attributes&&(n.attributes={...n.attributes,...y.attributes}))}function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(v)}function ne(e){let{attributes:t,graphic:n,relatedInfo:r,fieldInfos:i,fieldInfoMap:l,layer:o,timeZone:a}=e;t&&n&&r&&Object.keys(n.attributes).forEach((e=>{const u=function(e){return`${v}${e.layerId}/${e.fieldName}`}({layerId:r.relation.id.toString(),fieldName:e}),s=n.attributes[e];t[u]=Y({fieldName:u,fieldInfos:i,fieldInfoMap:l,layer:o,value:s,graphic:n,timeZone:a})}))}const re=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ie=e=>{let{layer:t,method:n,query:r,definitionExpression:i}=e;if(!t.capabilities?.query?.supportsCacheHint||"attachments"===n)return;const l=null!=r.where?r.where:null,o=null!=r.geometry?r.geometry:null;re(i)||re(l)||"extent"===o?.type||"tile"===r.resultType||(r.cacheHint=!0)},le=e=>{let{query:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})},oe=e=>{let{queryPayload:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})};function ae(e,t,n){return e&&t&&n?"sublayer"===t.type?fe({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:n})||fe({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):fe({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||fe({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function ue(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function se(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function fe(e){let{map:t,relationship:n,relationship:{relatedTableId:r},relatedLayer:i,layers:l}=e;if(!l)return null;for(const o of l){if("map-image"===o.type){const e=fe({layers:o.sublayers,map:t,relatedLayer:i,relationship:n})||fe({layers:o.subtables,map:t,relatedLayer:i,relationship:n});if(e)return e;continue}if(!_(o))continue;if("sublayer"===i.type){if(o!==i&&o.id===r)return o.isTable?se(t,o):o;continue}const e="scene"===i.type&&i.associatedLayer?i.associatedLayer.url:i.url;if(!e)return null;if("sublayer"!==o.type){if(o!==i&&o.url===e&&o.layerId===r)return o}else if(o!==i&&o.layer?.url===e&&o.id===r)return o.isTable?se(t,o):o}return null}function ce(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}}}]);