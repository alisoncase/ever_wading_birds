"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[68127],{12305:(e,t,n)=>{n.d(t,{A:()=>f});var a=n(93800),r=n(42761),i=n(19455),l=n(48602),s=(n(21265),n(50925),n(14746),n(47332)),o=n(75269);const u=new r.J({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),c=new r.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let d=class extends i.A{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};(0,a._)([(0,s.e)({classBreaksDef:"class-breaks-definition"})],d.prototype,"type",void 0),(0,a._)([(0,l.MZ)({json:{write:!0}})],d.prototype,"breakCount",void 0),(0,a._)([(0,l.MZ)({json:{write:!0}})],d.prototype,"classificationField",void 0),(0,a._)([(0,l.MZ)({type:String,json:{read:u.read,write:u.write}})],d.prototype,"classificationMethod",void 0),(0,a._)([(0,l.MZ)({json:{write:!0}})],d.prototype,"normalizationField",void 0),(0,a._)([(0,l.MZ)({json:{read:c.read,write:c.write}})],d.prototype,"normalizationType",void 0),(0,a._)([(0,l.MZ)({value:null,json:{write:!0}})],d.prototype,"standardDeviationInterval",null),(0,a._)([(0,l.MZ)({value:null,json:{write:!0}})],d.prototype,"definedInterval",null),d=(0,a._)([(0,o.$)("esri.rest.support.ClassBreaksDefinition")],d);const f=d},17661:(e,t,n)=>{n.d(t,{_:()=>l,t:()=>s});var a=n(50925);const r=()=>a.A.getLogger("esri.rest.support.generateRendererUtils");function i(e,t){return Number(e.toFixed(t))}function l(e){const t=c(e),n=[],a=t.uniqueValues.length;for(let r=0;r<a;r++){const e=t.uniqueValues[r],a=t.valueFrequency[r],i=e.toString();n.push({value:e,count:a,label:i})}return{uniqueValues:n}}function s(e,t){const{normalizationTotal:n}=e;return{classBreaks:o(e,t),normalizationTotal:n}}function o(e,t){const n=e.definition,{classificationMethod:a,normalizationType:r,definedInterval:l}=n,s=n.breakCount??1,o=[];let f=e.values;if(0===f.length)return[];f=f.sort(((e,t)=>e-t));const[m,h]=t??[f.at(0),f.at(-1)];if("equal-interval"===a)if(f.length>=s){const e=(h-m)/s;let t=m;for(let n=1;n<s;n++){const a=i(m+n*e,6);o.push({minValue:t,maxValue:a,label:u(t,a,r)}),t=a}o.push({minValue:t,maxValue:h,label:u(t,h,r)})}else f.forEach((e=>{o.push({minValue:e,maxValue:e,label:u(e,e,r)})}));else if("natural-breaks"===a){const t=c(f),n=e.valueFrequency||t.valueFrequency,a=d(t.uniqueValues,n,s);let l=m;for(let e=1;e<s;e++)if(t.uniqueValues.length>e){const n=i(t.uniqueValues[a[e]],6);o.push({minValue:l,maxValue:n,label:u(l,n,r)}),l=n}o.push({minValue:l,maxValue:h,label:u(l,h,r)})}else if("quantile"===a)if(f.length>=s&&m!==h){let e=m,t=Math.ceil(f.length/s),n=0;for(let a=1;a<s;a++){let i=t+n-1;i>f.length&&(i=f.length-1),i<0&&(i=0),o.push({minValue:e,maxValue:f[i],label:u(e,f[i],r)}),e=f[i],n+=t,t=Math.ceil((f.length-n)/(s-a))}o.push({minValue:e,maxValue:h,label:u(e,h,r)})}else{let e=-1;for(let t=0;t<f.length;t++){const n=f[t];n!==e&&(e=n,o.push({minValue:e,maxValue:n,label:u(e,n,r)}),e=n)}}else if("standard-deviation"===a){const e=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/=e.length,t}(f),t=function(e,t){let n=0;for(let a=0;a<e.length;a++){const r=e[a];n+=(r-t)*(r-t)}return n/=e.length,Math.sqrt(n)}(f,e);if(0===t)o.push({minValue:f[0],maxValue:f[0],label:u(f[0],f[0],r)});else{const n=function(e,t,n,a,r){let i=Math.max(a-e,t-a)/r/n;return i=i>=1?1:i>=.5?.5:.25,i}(m,h,s,e,t)*t;let a=0,l=m;for(let t=s;t>=1;t--){const s=i(e-(t-.5)*n,6);o.push({minValue:l,maxValue:s,label:u(l,s,r)}),l=s,a++}let c=i(e+.5*n,6);o.push({minValue:l,maxValue:c,label:u(l,c,r)}),l=c,a++;for(let t=1;t<=s;t++)c=a===2*s?h:i(e+(t+.5)*n,6),o.push({minValue:l,maxValue:c,label:u(l,c,r)}),l=c,a++}}else if("defined-interval"===a){if(!l)return o;const[e,n]=t??[f.at(0),f.at(-1)],a=Math.ceil((n-e)/l);let s=e;for(let t=1;t<a;t++){const n=i(e+t*l,6);o.push({minValue:s,maxValue:n,label:u(s,n,r)}),s=n}o.push({minValue:s,maxValue:n,label:u(s,n,r)})}return o}function u(e,t,n){let a=null;return a=e===t?n&&"percent-of-total"===n?e+"%":e.toString():n&&"percent-of-total"===n?e+"% - "+t+"%":e+" - "+t,a}function c(e){const t=[],n=[];let a=Number.MIN_VALUE,r=1,i=-1;for(let l=0;l<e.length;l++){const s=e[l];s===a?(r++,n[i]=r):null!==s&&(t.push(s),a=s,r=1,n.push(r),i++)}return{uniqueValues:t,valueFrequency:n}}function d(e,t,n){const a=e.length,r=[];n>a&&(n=a);for(let l=0;l<n;l++)r.push(Math.round(l*a/n-1));r.push(a-1);let i=f(r,e,t,n);return function(e,t,n,a,r,i){let l=0,s=0,o=0,u=0,c=!0;for(let d=0;d<2&&c;d++){0===d&&(c=!1);for(let d=0;d<i-1;d++)for(;n[d+1]+1!==n[d+2];){n[d+1]=n[d+1]+1;const i=m(d,n,a,r);o=i.sbMean,l=i.sbSdcm;const f=m(d+1,n,a,r);if(u=f.sbMean,s=f.sbSdcm,!(l+s<t[d]+t[d+1])){n[d+1]=n[d+1]-1;break}t[d]=l,t[d+1]=s,e[d]=o,e[d+1]=u,c=!0}for(let d=i-1;d>0;d--)for(;n[d]!==n[d-1]+1;){n[d]=n[d]-1;const i=m(d-1,n,a,r);o=i.sbMean,l=i.sbSdcm;const f=m(d,n,a,r);if(u=f.sbMean,s=f.sbSdcm,!(l+s<t[d-1]+t[d])){n[d]=n[d]+1;break}t[d-1]=l,t[d]=s,e[d-1]=o,e[d]=u,c=!0}}return c}(i.mean,i.sdcm,r,e,t,n)&&(i=f(r,e,t,n)),r}function f(e,t,n,a){let r=[],i=[],l=[],s=0;const o=[],u=[];for(let h=0;h<a;h++){const a=m(h,e,t,n);o.push(a.sbMean),u.push(a.sbSdcm),s+=u[h]}let c,d=s,f=!0;for(;f||s<d;){f=!1,r=[];for(let t=0;t<a;t++)r.push(e[t]);for(let n=0;n<a;n++)for(let r=e[n]+1;r<=e[n+1];r++)if(c=t[r],n>0&&r!==e[n+1]&&Math.abs(c-o[n])>Math.abs(c-o[n-1]))e[n]=r;else if(n<a-1&&e[n]!==r-1&&Math.abs(c-o[n])>Math.abs(c-o[n+1])){e[n+1]=r-1;break}d=s,s=0,i=[],l=[];for(let r=0;r<a;r++){i.push(o[r]),l.push(u[r]);const a=m(r,e,t,n);o[r]=a.sbMean,u[r]=a.sbSdcm,s+=u[r]}}if(s>d){for(let t=0;t<a;t++)e[t]=r[t],o[t]=i[t],u[t]=l[t];s=d}return{mean:o,sdcm:u}}function m(e,t,n,a){let i=0,l=0;for(let r=t[e]+1;r<=t[e+1];r++){const e=a[r];i+=n[r]*e,l+=e}l<=0&&r().warn("Exception in Natural Breaks calculation");const s=i/l;let o=0;for(let r=t[e]+1;r<=t[e+1];r++)o+=a[r]*(n[r]-s)**2;return{sbMean:s,sbSdcm:o}}},21118:(e,t,n)=>{n.d(t,{AL:()=>w,DV:()=>p,ER:()=>r,F_:()=>s,Nd:()=>m,Oo:()=>i,dy:()=>f,eS:()=>x,h4:()=>S,jC:()=>b,nq:()=>h,rZ:()=>d,y6:()=>v});var a=n(50616);const r="Raster.",i="Raster.Dim.",l=".Max",s={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},o=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function u(e,t){return new a.default({name:e,alias:t,domain:null,editable:!1,length:50,type:"string"})}function c(e,t){return new a.default({name:e,alias:t,domain:null,editable:!1,type:"double"})}function d(e){return u(s.servicePixelValue,e??"Service Pixel Value")}function f(e){return u(s.rawServicePixelValue,e??"Raw Service Pixel Value")}function m(){return u(s.itemPixelValue,"Item Pixel Value")}function h(e){return u(`${s.servicePixelValue}.${e}`,e)}function p(e){return c(`${s.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function v(){return c(`${s.direction}`,"Direction (\xb0)")}function b(e){return e.fields.filter((e=>"oid"!==e.type&&"value"!==e.name.toLowerCase())).map((e=>{const t=e.clone();return t.name=`${r}${e.name}`,t}))}function w(e){const t=new Set,n=new Set,r=new Map;return e.variables.forEach((e=>{let{dimensions:a}=e;a.forEach((e=>{if(e.recurring)r.set(e.name,e.unit);else{const a="ISO8601"===e.unit?.trim()?t:n;a.add(e.name),e.hasRanges&&a.add(`${e.name}${l}`)}}))})),[u(s.variable,"Variable"),...[...t].map((e=>function(e,t){return new a.default({name:e,alias:t,domain:null,editable:!1,type:"date"})}(`${i}${e}`,g(e)))),...[...n].map((e=>c(`${i}${e}`,g(e)))),...[...r].map((e=>{let[t,n]=e;return c(`${i}${t}`,y(t,n))}))]}function y(e,t){return t=t?.toLowerCase(),t&&o.has(t)?o.get(t):g(e)}function g(e){const t=e.endsWith(l),n=t?e.slice(0,-4):e,a="StdTime"===n?"Standard Time":"StdZ"===n?"Standard Z":n;return t?`${a} Max`:a}function k(e,t){return t?new Date(e):e}function x(e,t,n){n?.length&&(t[s.variable]=n[0].variableName,n.forEach((n=>{let{dimensionName:a,values:r}=n;if(a&&r?.length){const n=`${i}${a}`,s=e.find((e=>{let{name:t}=e;return t===n}));if(!s)return;const o="date"===s.type,u=r[0];if(Array.isArray(u)){if(t[`${i}${a}`]=k(u[0],o),null!=u[1]){const n=`${i}${a}${l}`;if(e.some((e=>{let{name:t}=e;return t===n}))){const e=k(u[1],o);t[n]=e}}}else t[`${i}${a}`]=k(u,o)}})))}function S(e,t){if(t.pixelType.startsWith("f")&&e.forEach((e=>{let{format:t,fieldName:n}=e;t&&n&&/^raster\.(item|service)pixelvalue/i.test(n)&&(t.places=2)})),t.multidimensionalInfo){const n=t.multidimensionalInfo.variables.flatMap((e=>{let{dimensions:t}=e;return t}));e.forEach((e=>{let{format:t,fieldName:a}=e;if(t&&a?.startsWith(i)){const e=a.slice(i.length),r=`${e}${l}`,s=n.find((t=>{let{name:n}=t;return n===e||n===r}));s?.values?.every((e=>Number.isInteger(e)))&&(t.places=0)}}))}}},42080:(e,t,n)=>{n.d(t,{$B:()=>r,Qf:()=>u,Qh:()=>s,RS:()=>i,ez:()=>f,i5:()=>m,lM:()=>l,qK:()=>d,rq:()=>c});var a=n(25048);function r(e){return 32+e.length}const i=16;function l(e){if(!e)return 0;let t=d;for(const n in e)e.hasOwnProperty(n)&&(t+=o(e[n],!1));return t}function s(e){if(!e)return 0;if("number"==typeof e[0])return u(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return c(e,8);let n=f;for(let a=0;a<t;a++)n+=o(e[a]);return n}(e);let t=d;for(const n in e)e.hasOwnProperty(n)&&(t+=o(e[n]));return t}function o(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?s(e):d;case"string":return r(e);case"number":return i;case"boolean":return 4;default:return 8}}function u(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>e+(t?(0,a.iu)(t)?t.byteLength+m:Array.isArray(t)?c(t,i):0:0)),0)}function c(e,t){return f+e.length*t}const d=32,f=16,m=145},43922:(e,t,n)=>{n.d(t,{A:()=>l});var a=n(74719),r=n(34037),i=n(61531);class l{constructor(){this._workerThread=null,this._destroyed=!1}async initialize(){const e=await(0,r.ho)("RasterWorker");this._destroyed?e.close():this._workerThread=e}destroy(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)}async convertVectorFieldData(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");const n=await this._workerThread.invoke("convertVectorFieldData",{pixelBlock:e.pixelBlock.toJSON(),type:e.dataType},t);return n?new i.default(n):null}computeStatisticsHistograms(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");return this._workerThread.invoke("computeStatisticsHistograms",{pixelBlock:e.pixelBlock.toJSON()},t)}async decode(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");const n=await this._workerThread.invoke("decode",e,t);return n?new i.default(n):null}async symbolize(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");const n={extent:e.extent?.toJSON(),pixelBlock:e.pixelBlock?.toJSON(),simpleStretchParams:e.simpleStretchParams,bandIds:e.bandIds},r=await this._workerThread.invoke("symbolize",n,t);return r?new i.default(r):null}async updateSymbolizer(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");const n=e?.rendererJSON?.histograms;await Promise.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:n},t))}async updateRasterFunction(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");await Promise.all(this._workerThread.broadcast("updateRasterFunction",{rasterFunctionJSON:e.toJSON()},t))}async process(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");const n=await this._workerThread.invoke("process",{extent:e.extent?.toJSON(),primaryPixelSizes:e.primaryPixelSizes?.map((e=>null!=e?e.toJSON():null)),primaryPixelBlocks:e.primaryPixelBlocks.map((e=>null!=e?e.toJSON():null)),primaryRasterIds:e.primaryRasterIds},t);return n?new i.default(n):null}async stretch(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},r=await this._workerThread.invoke("stretch",n,t);return r?new i.default(r):null}async split(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={srcPixelBlock:e.pixelBlock.toJSON(),tileSize:e.tileSize,maximumPyramidLevel:e.maximumPyramidLevel,useBilinear:e.useBilinear},r=await this._workerThread.invoke("split",n,t);return r&&r.forEach(((e,t)=>{r.set(t,e?i.default.fromJSON(e):null)})),r}async clipTile(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={...e,pixelBlock:e.pixelBlock.toJSON()},r=await this._workerThread.invoke("clipTile",n,t);return r?i.default.fromJSON(r):null}async estimateStatisticsHistograms(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={srcPixelBlock:e.pixelBlock.toJSON()};return await this._workerThread.invoke("estimateStatisticsHistograms",n,t)}async mosaicAndTransform(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");if(!e?.srcPixelBlocks?.length)return{pixelBlock:null};const n={...e,srcPixelBlocks:e.srcPixelBlocks.map((e=>null!=e?e.toJSON():null))},r=await this._workerThread.invoke("mosaicAndTransform",n,t);return{pixelBlock:r.pixelBlock?new i.default(r.pixelBlock):null,localNorthDirections:r.localNorthDirections}}async createFlowMesh(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");const n={buffer:e.flowData.data.buffer,maskBuffer:e.flowData.mask.buffer,width:e.flowData.width,height:e.flowData.height},{meshType:r,simulationSettings:i}=e,l=await this._workerThread.invoke("createFlowMesh",{meshType:r,flowData:n,simulationSettings:i},{...t,transferList:[n.buffer,n.maskBuffer]});return{vertexData:new Float32Array(l.vertexBuffer),indexData:new Uint32Array(l.indexBuffer)}}getProjectionOffsetGrid(e,t){if(!this._workerThread)throw new a.default("raster-jobhandler:no-connection","no available worker connection");const n=null!=e.datumTransformation?e.datumTransformation.steps.map((e=>({wkid:e.wkid,wkt:e.wkt,isInverse:e.isInverse}))):null,r=null!=e.rasterTransform?e.rasterTransform.toJSON():null,i={projectedExtent:e.projectedExtent.toJSON(),srcBufferExtent:e.srcBufferExtent.toJSON(),pixelSize:e.pixelSize,hasWrapAround:e.hasWrapAround,spacing:e.spacing,datumTransformationSteps:n,rasterTransform:r,isAdaptive:e.isAdaptive,includeGCSGrid:e.includeGCSGrid};return this._workerThread.invoke("getProjectionOffsetGrid",i,t)}}},56908:(e,t,n)=>{n.d(t,{Gj:()=>f,LF:()=>h,uy:()=>d});var a=n(21965),r=n(99325),i=n(50751),l=n(1501),s=n(95740),o=n(88423),u=n(45581),c=n(31640);const d={key:"type",base:null,typeMap:{"unique-value":u.default,"class-breaks":r.default,"raster-colormap":l.default,"raster-stretch":o.default,"vector-field":c.default,"raster-shaded-relief":s.default,flow:i.default}},f={...d,typeMap:{...d.typeMap}};delete f.typeMap["vector-field"],delete f.typeMap.flow;const m={uniqueValue:u.default,classBreaks:r.default,rasterStretch:o.default,rasterColormap:l.default,vectorField:c.default,rasterShadedRelief:s.default,flowRenderer:i.default};function h(e,t){if(!e)return null;if("classBreaks"===e.type&&e.classificationMethod){const t=e.authoringInfo||{classificationMethod:""};t.classificationMethod=e.classificationMethod,e.authoringInfo=t}"vectorField"===e.type&&e.visualVariables&&!Array.isArray(e.visualVariables)&&(e.visualVariables=[e.visualVariables]);const n=(r=e)&&m[r.type]||null;var r;if(n){const a=new n;return a.read(e,t),a}return t?.messages&&e&&t.messages.push(new a.A("renderer:unsupported","Renderers of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:t})),null}},59718:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var a,r=n(93800),i=n(19455),l=n(48602),s=(n(21265),n(50925),n(14746),n(75269)),o=n(12560),u=n(47800),c=n(65920),d=n(78629),f=n(73848);const m={base:u.default,key:"type",typeMap:{extent:o.default,polygon:c.default}};let h=a=class extends i.A{constructor(e){super(e),this.areaOfInterest=null,this.subsetDefinitions=null}get dimensions(){const{subsetDefinitions:e}=this;if(null==e||0===e.length)return[];const t=new Map;e.forEach((e=>{if(!e.dimensionName)return;let n,a;if(Array.isArray(e.values[0])){const t=e.values;n=t[0][0],a=t[e.values.length-1][1]}else{const t=e.values;n=t[0],a=t[e.values.length-1]}if(t.has(e.dimensionName)){const r=t.get(e.dimensionName);r[0]=Math.min(n,r[0]),r[1]=Math.max(a,r[1])}else t.set(e.dimensionName,[n,a])}));const n=[];for(const a of t)n.push({name:a[0],extent:a[1]});return n}get variables(){const{subsetDefinitions:e}=this;if(null==e||0===e.length)return[];const t=new Set;return e.forEach((e=>{e.variableName&&t.add(e.variableName)})),[...t]}clone(){const e=this.subsetDefinitions?.map((e=>e.clone())),t=this.areaOfInterest?this.areaOfInterest.clone():this.areaOfInterest;return new a({areaOfInterest:t,subsetDefinitions:e})}};(0,r._)([(0,l.MZ)({types:m,json:{read:d.fromJSON,write:!0}})],h.prototype,"areaOfInterest",void 0),(0,r._)([(0,l.MZ)({readOnly:!0})],h.prototype,"dimensions",null),(0,r._)([(0,l.MZ)({readOnly:!0})],h.prototype,"variables",null),(0,r._)([(0,l.MZ)({type:[f.default],json:{write:!0}})],h.prototype,"subsetDefinitions",void 0),h=a=(0,r._)([(0,s.$)("esri.layers.support.MultidimensionalSubset")],h);const p=h},74706:(e,t,n)=>{n.d(t,{$E:()=>S,DY:()=>b,NG:()=>x,QW:()=>l,Rp:()=>m,XU:()=>h,Xg:()=>k,ct:()=>p,fy:()=>v,sx:()=>f,xx:()=>s,z2:()=>w});var a=n(62631),r=n(73848);function i(e,t,n){const a=t.shift();if(0===n.length){const e=[];n.push({sliceId:-1,multidimensionalDefinition:e})}const r=n.length;for(let i=0;i<r;i++){const t=n.shift().multidimensionalDefinition;a.values?.forEach((r=>{n.push({sliceId:-1,multidimensionalDefinition:[...t,{variableName:e,dimensionName:a.name,values:[r]}]})}))}t.length&&i(e,t,n)}function l(e,t){const n=[];let a=0;return(t?e.variables.filter((e=>e.name.toLowerCase()===t.toLowerCase())):[...e.variables].sort(((e,t)=>e.name>t.name?1:-1))).forEach((e=>{const t=[],r=[...e.dimensions].sort(((e,t)=>e.name>t.name?-1:1));i(e.name,r,t),t.forEach((e=>{n.push({...e,sliceId:a++})}))})),n}function s(e,t,n){let a=e;if(t&&(t=[...t].sort(((e,t)=>e.dimensionName<t.dimensionName?-1:1))).forEach((e=>{let{dimensionName:t,values:n,isSlice:r}=e;n.length&&(a=a.filter((e=>{const a=e.multidimensionalDefinition.find((e=>e.dimensionName===t));if(null==a)return!1;const i=a.values[0];return"number"==typeof i?"number"==typeof n[0]?n.includes(i):n.some((e=>e[0]<=i&&e[1]>=i)):"number"==typeof n[0]?n.some((e=>i[0]<=e&&i[1]>=e)):r?n.some((e=>e[0]===i[0]&&e[0]===i[1])):n.some((e=>e[0]>=i[0]&&e[0]<=i[1]||e[1]>=i[0]&&e[1]<=i[1]||e[0]<i[0]&&e[1]>i[1]))})))})),a.length&&null!=n?.start&&null!=n.end){const e=n.start.getTime(),t=n.end.getTime(),r=a[0].multidimensionalDefinition.findIndex((e=>"StdTime"===e.dimensionName));r>-1&&(a=a.filter((n=>{const a=n.multidimensionalDefinition[r].values[0];return e<=a&&t>=a})))}return a.map((e=>e.sliceId))}function o(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function u(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}function c(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function d(e,t,n){if(!t?.subsetDefinitions?.length)return e;let a;if(n){const{variables:r}=t;if(r.length&&!r.includes(n))return null;const i=t.subsetDefinitions.find((t=>t.dimensionName===e.name&&t.variableName===n));if(!i?.values?.length)return e;a=c(i.values)}else{const n=t.dimensions.find((t=>{let{name:n}=t;return n===e.name}));a=n?.extent}const r=a;if(!r?.length)return e;const i=e.values.filter((e=>o(e,r)));return{...e,extent:[...r],values:i}}function f(e,t,n){if(!t?.subsetDefinitions?.length)return!1;const{variables:a}=t;if(a.length&&e.some((e=>{let{variableName:t}=e;return t&&!a.includes(t)})))return!0;for(let r=0;r<e.length;r++){const a=e[r],i=t.subsetDefinitions.find((e=>(""===a.variableName||e.variableName===a.variableName)&&e.dimensionName===a.dimensionName));if(i?.values.length){const e=c(i.values);if(a.isSlice||2!==a.values.length||Array.isArray(a.values[0])||a.values[0]===a.values[1]||!n){if(a.values.some((t=>!o(t,e))))return!0}else if(!u(a.values,e))return!0}}return!1}function m(e,t){if(null==e)return{isOutside:!1};const{geometry:n,timeExtent:a,multidimensionalDefinition:i}=t;let l=null;if(null!=a&&(l=function(e,t){const n=e.dimensions.find((e=>{let{name:t}=e;return"StdTime"===t}));if(null==n||null==t.start&&null==t.end)return t;t=t.clone();const{start:a,end:i}=t.toJSON(),l=a===i?[a]:null!=a&&null!=i?[a,i]:[a??i];return 2===l.length&&n?.extent.length&&(l[0]=Math.max(l[0],n.extent[0]),l[1]=Math.min(l[1],n.extent[1]??n.extent[0]),l[1]<l[0])||f([new r.default({variableName:"",dimensionName:"StdTime",isSlice:1===l.length,values:l})],e,!0)?null:(t.start=new Date(l[0]),t.end=new Date(l[1]??l[0]),t)}(e,a),null==l))return{isOutside:!0};const{areaOfInterest:s}=e;if(s&&n){const e="point"===n.type?n:"extent"===n.type?n.center:"polygon"===n.type?n.centroid:null;if(e&&!s.contains(e))return{isOutside:!0}}return null!=i&&i.length&&f(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:n,timeExtent:l,multidimensionalDefinition:i}}}function h(e){const{rasterInfo:t,multidimensionalSubset:n}=e,{multidimensionalInfo:a}=t;if(null==a)return null;let r=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:v(t,{multidimensionalSubset:n});if(!r?.length)return null;if(r.some((e=>!e.dimensionName))){const{variableName:e}=r[0],a=v(t,{multidimensionalSubset:n,variableName:e});a?.forEach((e=>{const t=r?.find((t=>{let{dimensionName:n}=t;return n===e.dimensionName}));t?.values?.length&&(e.values=t.values,e.isSlice=t.isSlice)})),r=a}const{timeExtent:i}=e;if(null!=r&&null!=i&&(null!=i.start||null!=i.end)){r=r.map((e=>e.clone()));const e=a.variables.find((e=>{let{name:t}=e;return t===r[0].variableName}))?.dimensions?.find((e=>{let{name:t}=e;return"StdTime"===t})),t=r.find((e=>{let{dimensionName:t}=e;return"StdTime"===t}));if(!e||!t)return null;const{start:n,end:l}=i,s=null==n?null:n.getTime(),o=null==l?null:l.getTime(),u=s??o,c=o??s;if(null!=e.values){const n=e.values.filter((e=>{if(Array.isArray(e)){if(u===c)return e[0]<=u&&e[1]>=u;const t=e[0]<=u&&e[1]>u||e[0]<c&&e[1]>=c,n=e[0]>=u&&e[1]<=c||e[0]<u&&e[1]>c;return t||n}return u===c?e===u:e>=u&&e<=c}));if(n.length){const e=n.sort(((e,t)=>{const n=Array.isArray(e)?e[0]:e,a=Array.isArray(e)?e[1]:e,r=Array.isArray(t)?t[0]:t,i=Array.isArray(t)?t[1]:t;return u===c?n-r:Math.abs(a-c)-Math.abs(i-c)}))[0];t.values=[e]}else r=null}else if(e.hasRegularIntervals&&e.extent){const[n,a]=e.extent;u>a||c<n?r=null:t.values=u===c?[u]:[Math.max(n,u),Math.min(a,c)]}}return null!=r&&f(r,n)?null:r}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{multidimensionalInfo:n,keyProperties:a}=e;if(null==n)return null;const{variableName:r,multidimensionalSubset:i,multidimensionalDefinition:l}=t,s=null!=l?l[0]?.variableName:null,o=r||s||a?.DefaultVariable;let{variables:u}=n;return i?.variables?.length&&(u=u.filter((e=>{let{name:t}=e;return i.variables.includes(t)}))),o?u.find((e=>{let{name:t}=e;return t===o}))??u[0]:u[0]}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=p(e,t);if(!n)return null;const a=[],{dimensions:i,name:l}=n;if(0===i.length)return[new r.default({variableName:l,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<i.length;s++){const e=d(i[s],t.multidimensionalSubset,l);if(!e)return null;const{values:n,extent:o}=e;let u=n?.[0]??o?.[0];"stdz"===e.name.toLowerCase()&&!e.hasRanges&&o&&Math.abs(o[1])<=Math.abs(o[0])&&(u=n?.length?n[n.length-1]:o[1]),a.push(new r.default({variableName:l,dimensionName:e.name,values:[u],isSlice:!t.useRangeForRangedDimensionInfo||!!e.hasRanges}))}return a}function b(e){return!!e?.length&&e.some((e=>{if(null==e.values)return!0;const t=e.values.length;return 0===t||t>1||!e.isSlice&&Array.isArray(e.values[0])}))}function w(e,t){if(null==t||null==e)return null;let n=t.variables.map((e=>({...e})));return e?.variables?.length&&(n=n.filter((t=>{let{name:n}=t;return e.variables.includes(n)})),n.forEach((t=>{t.dimensions=t.dimensions.map((n=>d(n,e,t.name))).filter(a.Ru)}))),n}function y(e,t){const{values:n}=t;if(n?.length){const t=Array.isArray(n[0]),a=Array.isArray(e);return t!==a?-1:t&&a?n.findIndex((t=>t[0]===e[0]&&t[1]===e[1])):n.indexOf(e)}const{extent:a}=t;if(Array.isArray(e)||!a||e<a[0]||e>a[1])return-1;const r=t.interval||1;if("ISO8601"!==t.unit)return Math.round((e-a[0])/r);const i=a[0];let l=-1;switch(t.intervalUnit?.toLowerCase()||"days"){case"seconds":l=Math.round((e-i)/1e3/r);break;case"minutes":l=Math.round((e-i)/6e4/r);break;case"hours":l=Math.round((e-i)/36e5/r);break;case"days":l=Math.round((e-i)/864e5/r);break;case"months":{const t=new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear(),n=new Date(i).getUTCMonth(),a=new Date(e).getUTCMonth();l=0===t?a-n:a+11-n+12*(t-1)}break;case"years":l=Math.round((new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear())/r);break;case"decades":l=Math.round((new Date(e).getUTCFullYear()-new Date(i).getUTCFullYear())/10/r)}return l}function g(e){let t=e.values?.length;if(t)return t;const{extent:n,unit:a}=e,r=e.interval||1,i=n?n[1]-n[0]:0;if("ISO8601"!==a)return Math.round(i/r);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":t=Math.round(i/1e3/r);break;case"minutes":t=Math.round(i/6e4/r);break;case"hours":t=Math.round(i/36e5/r);break;case"days":t=Math.round(i/864e5/r);break;case"months":if(n){const e=new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear(),a=new Date(n[0]).getUTCMonth(),r=new Date(n[1]).getUTCMonth();t=0===e?r-a+1:r+11-a+12*(e-1)+1}else t=0;break;case"years":t=n?Math.round((new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear())/r):0;break;case"decades":t=n?Math.round((new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear())/10/r):0;break;default:t=0}return t}function k(e){if(2!==e.extent?.length||!e.interval)return[];const{extent:[t,n],interval:a}=e;if("ISO8601"===e.unit){const r=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(r)?function(e,t,n,a){const r=[];let i=e;const l=new Date(e);for(;i<=t;)switch(r.push(i),a){case"decades":l.setUTCFullYear(l.getUTCFullYear()+10*n),i=l.getTime();break;case"years":l.setUTCFullYear(l.getUTCFullYear()+n),i=l.getTime();break;case"months":l.setUTCMonth(l.getUTCMonth()+n),i=l.getTime();break;case"days":i+=864e5*n;break;case"hours":i+=36e5*n;break;case"minutes":i+=6e4*n;break;case"seconds":i+=1e3*n}return 1===r.length?r[1]=t:r[r.length-1]=t,r}(t,n,a,r):[]}const r=Math.round((n-t)/a);return Array.from({length:r},((e,i)=>i===r-1?n:t+i*a))}function x(e,t){let n=0;const a=e[0].variableName,r=[...t.variables].sort(((e,t)=>e.name>t.name?1:-1));for(let i=0;i<r.length;i++){const t=r[i],l=[...t.dimensions].sort(((e,t)=>e.name>t.name?-1:1));if(t.name!==a){n+=l.map((e=>g(e))).reduce(((e,t)=>e*t));continue}const s=l.map((e=>g(e))),o=l.length;for(let a=0;a<o;a++){const t=e.find((e=>e.dimensionName===l[a].name));if(null==t)return null;const r=y(t.values[0],l[a]);if(-1===r)return null;s.shift(),n+=a===o-1?r:r*s.reduce(((e,t)=>e*t))}break}return n}function S(e){return Math.round(24*(e-25569)*3600*1e3)}}}]);