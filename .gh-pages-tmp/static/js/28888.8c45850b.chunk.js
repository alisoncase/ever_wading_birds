"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[15576,28109,28888,57581],{15576:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var i,s=a(93800),r=a(6946),n=a(79953),o=a(48602),l=(a(21265),a(50925),a(14746),a(75269));let d=i=class extends r.default{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles((0,n.watch)((()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]}),(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)}),n.initial))}get description(){return this.template?.description}set description(e){this.template&&(this.template.description=e)}get disabled(){return this.disabledFunction?.(this)??!1}get label(){return this.template?.name}set label(e){this.template&&(this.template.name=e)}get id(){return`${this.label??""}\u2013${this.layer?.id}`}get supportsUpload(){return"scene"===this.layer?.type}clone(){const e=null!=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new i({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};(0,s._)([(0,o.MZ)()],d.prototype,"description",null),(0,s._)([(0,o.MZ)()],d.prototype,"disabled",null),(0,s._)([(0,o.MZ)()],d.prototype,"disabledFunction",void 0),(0,s._)([(0,o.MZ)()],d.prototype,"label",null),(0,s._)([(0,o.MZ)()],d.prototype,"layer",void 0),(0,s._)([(0,o.MZ)()],d.prototype,"template",void 0),(0,s._)([(0,o.MZ)()],d.prototype,"thumbnail",void 0),(0,s._)([(0,o.MZ)()],d.prototype,"id",null),(0,s._)([(0,o.MZ)()],d.prototype,"supportsUpload",null),d=i=(0,s._)([(0,l.$)("esri.widgets.FeatureTemplates.TemplateItem")],d);const p=d},21184:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var i=a(93800),s=a(79625),r=a(6946),n=a(89129),o=a(74719),l=a(79953),d=a(48602),p=a(32980),c=(a(21265),a(14746),a(75269)),u=a(2005),h=a(57581),f=a(85379),y=a(92471);const m={editing:!1,operations:{add:!0,update:!0,delete:!0}},w=n.default.ofType(h.default);let g=class extends r.default{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...m},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new w,this.fileInfos=new n.default,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles((0,l.watch)((()=>this.graphic),(()=>this._graphicChanged()),l.initial))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...m,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t,orderByFields:a}=this;if(!e||"function"!=typeof e.queryAttachments)throw new o.default("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getObjectId();if("number"!=typeof i)throw new o.default("invalid-object-id","getAttachments(): Numeric object id is required");const s=a?.map((e=>`${e.field} ${"descending"===e.order?"DESC":"ASC"}`)),r=new f.default({objectIds:[i],returnMetadata:!0,orderByFields:s}),n=[],l=e.queryAttachments(r).then((e=>e[i]||n)).catch((()=>n));this._getAttachmentsPromise=l,this.notifyChange("state");const d=await l;return t.destroyAll(),d.length&&t.addMany(d),this._getAttachmentsPromise=null,this.notifyChange("state"),d}async addAttachment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graphic;const{_attachmentLayer:a,attachmentInfos:i,capabilities:s}=this;if(!t)throw new o.default("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new o.default("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations?.add)throw new o.default("invalid-capabilities","addAttachment(): add capabilities are required.");if(!a||"function"!=typeof a.addAttachment)throw new o.default("invalid-layer","addAttachment(): A valid layer is required.");const r=a.addAttachment(t,e).then((e=>this._queryAttachment(e.objectId,t))),n=await r;return i.add(n),n}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:a,graphic:i,capabilities:s}=this;if(!e)throw new o.default("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations?.delete)throw new o.default("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new o.default("invalid-layer","deleteAttachment(): A valid layer is required.");if(!i)throw new o.default("invalid-graphic","deleteAttachment(): A graphic is required.");const r=t.deleteAttachments(i,[e.id]).then((()=>e)),n=await r;return a.remove(n),n.destroy(),n}async updateAttachment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeAttachmentInfo;const{_attachmentLayer:a,attachmentInfos:i,graphic:s,capabilities:r}=this;if(!e)throw new o.default("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new o.default("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!r.operations?.update)throw new o.default("invalid-capabilities","updateAttachment(): Update capabilities are required.");const n=i.indexOf(t);if(!a||"function"!=typeof a.updateAttachment)throw new o.default("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new o.default("invalid-graphic","updateAttachment(): A graphic is required.");const l=a.updateAttachment(s,t.id,e).then((e=>this._queryAttachment(e.objectId))),d=await l;return i.splice(n,1,d),d}async commitFiles(){return await Promise.all(this.fileInfos.items.map((e=>this.addAttachment(e.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const a={file:e,form:t};return this.fileInfos.add(a),a}updateFile(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!a)return null;const i=this.fileInfos.indexOf(a);return i>-1&&this.fileInfos.splice(i,1,{file:e,form:t}),this.fileInfos.items[i]}deleteFile(e){const t=this.fileInfos.find((t=>t.file===e));return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:a}=this;if(!e||!a?.queryAttachments)throw new o.default("invalid-attachment-id","Could not query attachment.");const i=this._getObjectId(t);if("number"!=typeof i)throw new o.default("invalid-object-id","getAttachments(): Numeric object id is required");const s=new f.default({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return a.queryAttachments(s).then((e=>e[i][0]))}_getObjectId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>this.attachmentInfos.destroyAll())))}_setAttachmentLayer(){const{graphic:e}=this,t=(0,y.getSourceLayer)(e);this._attachmentLayer=t?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}};(0,i._)([(0,d.MZ)()],g.prototype,"capabilities",void 0),(0,i._)([(0,p.w)("capabilities")],g.prototype,"castCapabilities",null),(0,i._)([(0,d.MZ)()],g.prototype,"activeAttachmentInfo",void 0),(0,i._)([(0,d.MZ)()],g.prototype,"activeFileInfo",void 0),(0,i._)([(0,d.MZ)({readOnly:!0,type:w})],g.prototype,"attachmentInfos",void 0),(0,i._)([(0,d.MZ)()],g.prototype,"fileInfos",void 0),(0,i._)([(0,d.MZ)({type:s.default})],g.prototype,"graphic",void 0),(0,i._)([(0,d.MZ)()],g.prototype,"mode",void 0),(0,i._)([(0,d.MZ)({type:[u.default]})],g.prototype,"orderByFields",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],g.prototype,"state",null),(0,i._)([(0,d.MZ)()],g.prototype,"filesEnabled",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],g.prototype,"supportsResizeAttachments",null),g=(0,i._)([(0,c.$)("esri.widgets.Attachments.AttachmentsViewModel")],g);const _=g},28109:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var i=a(93800),s=a(6946),r=a(93633),n=a(48602),o=(a(21265),a(50925),a(14746),a(75269));let l=class extends(r.A.IdentifiableMixin(s.default)){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return null==e||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find((t=>t.template===e))}};(0,i._)([(0,n.MZ)()],l.prototype,"allItems",void 0),(0,i._)([(0,n.MZ)()],l.prototype,"filterFunction",void 0),(0,i._)([(0,n.MZ)()],l.prototype,"items",null),(0,i._)([(0,n.MZ)()],l.prototype,"label",void 0),(0,i._)([(0,n.MZ)()],l.prototype,"id",null),l=(0,i._)([(0,o.$)("esri.widgets.FeatureTemplates.TemplateItemGroup")],l);const d=l},28888:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$});var i=a(93800),s=a(62631),r=a(58828),n=a(89129),o=a(74719),l=a(58448),d=a(42198),p=a(50925),c=a(17741),u=a(49959),h=a(79953),f=a(48602),y=(a(21265),a(75269)),m=a(15492),w=a(42985),g=a(70674),_=a(5172),v=a(78076),b=a(88272),k=a(91690),M=a(62791),I=a(35130),A=a(21184),F=a(72787),Z=a(87176),T=a(39262),E=a(79039),O=a(29831),W=a(75788),L=a(17577),C=a(73484);const V="esri.widgets.Editor.EditorViewModel";function U(e,t,a){p.A.getLogger(V).error(new o.default(e,t,a))}function S(e,t){return e?.find((e=>e.layer===t))}let P=class extends l.A.EventedAccessor{constructor(e){var t;super(e),t=this,this._templatesByLayer=new Map,this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new g.default({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updateTemplatesTask=null,this._updatingHandles=new m.U,this._featureTemplatesViewModelIsRestricted=!1,this.activeWorkflow=null,this._activityQueue=new n.default,this.editorItems=new n.default,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new A.default({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new W.default({disabledItemFunction:e=>{let{layer:t}=e;return this._itemIsSuspended(t)}}),this.layerInfos=null,this.ownSketchViewModel=new L.default({layer:this._sketchGraphicsLayer}),this.sketchOptions=new k.A,this.snappingOptions=new I.default({attributeRulesEnabled:!0}),this.spinnerViewModel=new C.A,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{this.canGoBack&&(this.activeWorkflow?.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{const{featureFormViewModel:e}=this;if(e&&"create-features"!==this.activeWorkflow?.type){if(e.submit(),!e.submittable||e.pendingSubtypeChoice)return;const t=e.getValues();if(e.validateContingencyConstraints(t,{includeIncompleteViolations:!0}).length>0)return}await(this.activeWorkflow?.save())},this.selectFeature=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t.activeWorkflow;t._candidateCommitted||"update"!==i?.type||(i.data.rootFeature=e,a&&(i.next(),t._candidateCommitted=!0))}}initialize(){this.addHandles([(0,h.watch)((()=>{const e=this.view,t=e?.map?.editableLayers.toArray(),a=e?.allLayerViews,i=a?.filter((e=>!!t?.includes(e.layer)));return[t,i,this.layerInfos]}),(()=>this._updateEditorItems()),h.syncAndInitial),(0,h.watch)((()=>this.hideTemplatesForInactiveLayers),(()=>this.syncFeatureTemplates())),(0,h.on)((()=>this.activeWorkflow),"cancel",(()=>this.emit("workflow-cancel"))),(0,h.on)((()=>this.activeWorkflow),"commit",(()=>this.emit("workflow-commit"))),(0,h.on)((()=>this.activeWorkflow),"complete",(()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)})),(0,h.when)((()=>this.view?.map),(e=>e.add(this._sketchGraphicsLayer)),h.initial),(0,h.on)((()=>this.editorItems),"change",(()=>this._afterEditorItemsChange())),(0,h.watch)((()=>[this.canCreate,this.canUpdateVisible]),(()=>this._afterEditorItemsChange())),(0,h.watch)((()=>this.page),((e,t)=>{const a=[...this.pageStack];if(-1===a.indexOf(e))a.push(e);else for(;a.length&&a.at(-1)!==e;)a.pop();this.pageStack=a}),h.syncAndInitial),(0,h.when)((()=>"awaiting-update-feature-candidate"===this.state),(()=>this._candidateCommitted=!1)),(0,h.on)((()=>this.featureTemplatesViewModel),"select",(async e=>{let{item:t,oldItem:a}=e;const{activeWorkflow:i}=this;if(i){if("update"===i.type&&"awaiting-feature-creation-info"===i.activeWorkflow?.stepId)return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(a,{emit:!1})}}if(!t)return;const s={layer:t.layer,template:t.template};if(t.supportsUpload)return this.featureTemplatesViewModel.select(a,{emit:!1}),this.startCreateFeaturesWorkflow(s);this.startCreateFeaturesWorkflowAtFeatureCreation(s)})),(0,h.watch)((()=>[this.view,this.featureTemplatesViewModel]),(e=>{let[t,a]=e;a.view=t}),h.syncAndInitial),(0,h.on)((()=>this.view),"key-down",(e=>{"Escape"===e.key&&this.activeWorkflow?.keyboardCancellationEnabled&&(e.stopPropagation(),this.back())})),(0,h.on)((()=>this.sketchViewModel),["create","delete","update"],(e=>{const{activeWorkflow:t}=this,a="update"===t?.type,i=a?t.activeWorkflow?.layer:t?.layer,s=a?t?.activeWorkflow?.parentLayer:void 0,r=`sketch-${e.type}`;this.emit(r,{type:r,detail:e,layer:i,parentLayer:s})}),h.sync),(0,h.watch)((()=>this.view),(e=>{if(this._snappingManager=(0,c.pR)(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new M.g({view:e,options:t}),this.ownSketchViewModel.snappingManager=this._snappingManager}),h.syncAndInitial),(0,h.watch)((()=>this.snappingOptions),(e=>{this._snappingManager&&(this._snappingManager.options=e)}),h.syncAndInitial)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then((()=>{this.view?.map?.remove(this._sketchGraphicsLayer),this.view=null})),this._updateItemsTask=(0,c.DC)(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=(0,c.xt)(this._sketchEventListenerHandle)}get _featureTemplatesLayersAndTables(){const e=new n.default;for(const t of this.editorItems){const a=this.hideTemplatesForInactiveLayers&&!t.visible;t.supportsCreateFeaturesWorkflow&&!a&&e.push(t.layer)}return e}get activeLeafWorkflow(){const e=this.activeWorkflow;return e&&(0,T.bl)(e)?e.activeWorkflow??e:e}get canCreate(){return this.editorItems.some((e=>e.supportsCreateFeaturesWorkflow))}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some((e=>e.supportsUpdateWorkflow))}get canUpdateVisible(){return this.editorItems.some((e=>e.supportsUpdateWorkflow&&e.visible))}get featureTemplatesLayers(){return this._featureTemplatesLayersAndTables.filter((e=>"scene"===e.type||!e.isTable))}get featureFormViewModel(){const{activeWorkflow:e}=this;return"update"===e?.type?e.activeFeatureFormViewModel:"create-features"===e?.type?e.featureFormViewModel:null}get utilityNetworkAssociationAddAssociationViewModel(){const{activeWorkflow:e}=this;return"update"===e?.type?e.activeUtilityNetworkAssociationAddAssociationViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get sketchViewModel(){const{activeWorkflow:e}=this;return"update"===e?.type?e.activeSketchViewModel:"create-features"===e?.type?e.sketchViewModel:this.ownSketchViewModel}get state(){if(!this.view?.ready)return"disabled";const e=this.attachmentsViewModel.mode;if("add"===e)return"adding-attachment";if("edit"===e)return"editing-attachment";const{activeWorkflow:t}=this;return t?.stepId?"update"===t.type&&t.activeWorkflow?.stepId?t.activeWorkflow.stepId:t.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){return this._updatingHandles.updating||!0===this.activeWorkflow?.updating}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get canZoomTo(){const e=this.sketchViewModel,t=e?.createGraphic?.geometry?.type;return!(!e?.updateGraphics?.length&&"multipoint"!==t)}get page(){const{activeWorkflow:e,state:t}=this;if("update"===e?.type&&null!=e?.activeWorkflow?.featureFormViewModel?.associatedLayer)return"viewing-associated-features";if("update"===e?.type&&null!=e?.activeWorkflow?.featureFormViewModel?.associationId)return"viewing-associated-layers";if("update"===e?.type&&"awaiting-feature-to-update"===e.stepId)return"ready";if("create-features"===e?.type&&0===e.numPendingFeatures){const t=e.data.upload;if(t)return"default"===t.state?"ready":"creating-features-upload-details"}return t??"disabled"}get featureFormDisabled(){const{activeWorkflow:e}=this;return"update"===e?.type&&!1===e.activeEditorItem?.capabilities.update.attributes}get featureFormHasAssociation(){return!!this.featureFormViewModel?.activeAssociation}get canGoBack(){return null!=this.activeWorkflow&&!this.syncing}get shouldShowDeleteButton(){const{activeWorkflow:e}=this;return!!e&&"update"===e.type&&!!e.activeEditorItem?.capabilities.delete.enabled}get hasPendingEdits(){return this.activeWorkflow?.hasPendingEdits??!1}get snappingManager(){return this._snappingManager}getTemplatesForLayer(e){return this._templatesByLayer.get(e)??[]}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";if(await(0,h.whenOnce)((()=>!this.updating)),!this.canCreate)throw new o.default("editing:unsupported-workflow","Creating features is unsupported or disabled.");const a=this._createUpdatingResolver();try{await this._cancelWorkflow();const a=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",a),await a.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{a.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(e){await(0,h.whenOnce)((()=>!this.updating));const t=this._createUpdatingResolver();try{const{initialFeature:t}=e,a=t.sourceLayer=t.layer,i=a?this.findEditorItemForLayer(a):void 0;if(!i?.supportsCreateFeaturesWorkflow)throw new o.default("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const s=this._createCreateFeaturesWorkflow({initialFeature:t,layer:i.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",s),await s.start()}catch(a){this._logErrorAndCancelWorkflow(a)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await(0,h.whenOnce)((()=>!this.updating)),!this.canUpdate)return void U("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const e=this._createUpdateWorkflow();this._set("activeWorkflow",e),await e.start()}catch(t){this._logErrorAndCancelWorkflow(t)}finally{e.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await(0,h.whenOnce)((()=>!this.updating)),!this.canUpdate)return void U("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("awaiting-update-feature-candidate");t.data.candidates=e,this._set("activeWorkflow",t),await t.start()}catch(a){this._logErrorAndCancelWorkflow(a)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureEdit(e){if(await(0,h.whenOnce)((()=>!this.updating)),!this.canUpdate)return void U("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("editing-existing-feature");t.data.rootFeature=e,this._set("activeWorkflow",t),await t.start()}catch(a){this._logErrorAndCancelWorkflow(a)}finally{t.resolve()}}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?await e.deleteActiveFeature():U("editing:unsupported-workflow","Deleting a feature requires an active update workflow.")}async deleteAssociationFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?await e.deleteActiveAssociation():U("editing:unsupported-workflow","Deleting an association requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditorItemForLayer(e){return this.editorItems.find((t=>t.layer===e))}itemHasInvalidFormTemplate(e){return null!=e&&!0===this.findEditorItemForLayer(e.layer)?.hasInvalidFormTemplate}syncFeatureTemplates(){this._featureTemplatesViewModelIsRestricted||this._updateTemplates()}zoomTo(e){const t=this.sketchViewModel,a=e?e.geometry:t?.updateGraphics.length?t?.updateGraphics.toArray().map((e=>e.geometry)).filter(s.Ru):t?.createGraphic?.geometry;a&&this.view?.goTo(a)}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&"awaiting-feature-to-update"===this.state?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}restrictFeatureTemplatesViewModelToLayer(e){return this._featureTemplatesViewModelIsRestricted=!0,this._setFeatureTemplatesViewModelLayers([e]),(0,d.hA)((()=>{this._featureTemplatesViewModelIsRestricted=!1,this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)}))}async _getEditorItemCandidates(e){const{view:t}=this;if(!t?.map)return[];const{map:a}=t,i=a.editableLayers.toArray(),s=a.allTables.toArray().filter((e=>(0,v.yZ)(e)||(0,v.F2)(e)));return await Promise.allSettled([...i.flatMap((e=>this._getLayerLoadPromise(e))),...s.flatMap((e=>this._getLayerLoadPromise(e)))]),(0,u.throwIfAborted)(e),[...i.reverse(),...s.reverse()].filter((e=>(0,_.S)(e)&&("mesh"!==e.geometryType||"3d"===t.type))).flatMap((e=>"subtype-group"===e.type?e.sublayers.toArray():e))}_getLayerLoadPromise(e){return(0,v.F2)(e)?e.loadAll():e.load()}_drainEditorItems(){this.editorItems.drain((e=>e.destroy()))}_updateEditorItems(){(0,c.DC)(this._updateItemsTask);const{view:e}=this,t=(0,r.UT)((async t=>{if(!e?.map||!e?.allLayerViews)return;const a=await this._getEditorItemCandidates(t);if(!a.length)return void this._drainEditorItems();const i=[],s=[],r=[],{layerInfos:n}=this;for(const l of a){const t=S(n,l),a=await(0,T.QZ)(e,l).catch((()=>null));(t?i:a?s:r).push(new E.default({layer:l,layerInfo:t,layerView:a}))}n?.length&&i.sort(((e,t)=>n.findIndex((t=>{let{layer:a}=t;return a===e.layer}))-n.findIndex((e=>{let{layer:a}=e;return a===t.layer}))));const o=[...i,...s,...r];t.aborted||(this._drainEditorItems(),this.editorItems.addMany(o))}));this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_updateTemplates(){(0,c.DC)(this._updateTemplatesTask);const e=(0,r.UT)((async e=>{const t=this._templatesByLayer,a=this._featureTemplatesLayersAndTables.filter((e=>!t.has(e)));if(a.length>0){const i=await(0,w.b)(a.toArray(),this.view,e);for(const{layer:e,templates:a}of i)t.set(e,a)}this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)}));this._updatingHandles.addPromise(e.promise),this._updateTemplatesTask=e}_setFeatureTemplatesViewModelLayers(e){const t=this._templatesByLayer,a=[];for(const i of e){const e=t.get(i);e&&e.length>0&&a.push((0,O.Ex)(i,e))}this.featureTemplatesViewModel.templateInfos=a}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;"create-features"!==e.type?"update"===e.type&&("awaiting-feature-to-update"===t&&!this.canUpdateVisible||"awaiting-update-feature-candidate"===t&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():"awaiting-feature-creation-info"!==t||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(t)if(e&&!1===e.force)try{await t.cancel(e),this._set("activeWorkflow",null),t.destroy()}catch(a){}else{this.emit("workflow-cancel"),this._set("activeWorkflow",null);try{await t.cancel(e)}finally{t.destroy()}}else e?.warnIfNoWorkflow&&U("editing:no-active-workflow","There is no active workflow to cancel.")}_createCreateFeaturesWorkflow(e,t){return F.default.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(e,t,a)=>this._applyEdits(e,t,a),applyEditsFeatureServiceCallback:(e,t,a)=>this._applyEditsFeatureService(e,t,a),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_createUpdateWorkflow(e){return Z.default.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(e,t,a)=>this._applyEdits(e,t,a),applyEditsFeatureServiceCallback:(e,t,a)=>this._applyEditsFeatureService(e,t,a),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_addAttachments(e,t){const a=t.map((t=>this._addAttachment(e,t.feature,t.attachment)))??[];return Promise.all(a)}async _addAttachment(e,t,a){let i=null;if(!("addAttachment"in e)||null==e.capabilities?.attachment)throw new o.default("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation((async()=>(i=await(e.addAttachment?.(t,a).catch((e=>{throw e?.error||e})))??null,i))),i}async _applyEdits(e,t,a){let i=null;const s=e.url?await(0,v.wI)(e.url):null,r={returnServiceEditsOption:s&&(0,b.py)(s)||RegExp("/hosted/","i").test(e.url)?void 0:"original-and-current-features",...a};return await this._queueOperation((async()=>{const{view:a}=this;if(!a)return null;const s=await(0,T.QZ)(a,e).catch((()=>null));return i=await e.applyEdits(t,r),s&&await(0,h.whenOnce)((()=>!s.updating)),i})),i}async _applyEditsFeatureService(e,t,a){let i=null;return await this._queueOperation((async()=>i=await e.applyEdits(t,a))),i}_queueOperation(e){this._activityQueue.push(e);const t=(e,t)=>{const a=t.indexOf(e);a>-1&&t.splice(a,1)};return e().then((e=>(Array.isArray(e)?e.forEach((e=>this._handleEditsResultError(e))):this._handleEditsResultError(e),e))).catch((a=>{U("editing:operation-error","An error occurred.",{error:a});const i={error:a,retry:()=>(t(i,this.failures),this._queueOperation(e)),cancel:()=>{t(i,this.failures)}};this._set("failures",[...this.failures,i])})).then((()=>{t(e,this._activityQueue)}))}_handleEditsResultError(e){if(null!=e&&"error"in e&&null!=e.error)throw e.error;if(null!=e&&"addFeatureResults"in e){const{addFeatureResults:t,deleteFeatureResults:a,updateFeatureResults:i}=e,s=t.find((e=>!!e.error))||i.find((e=>!!e.error))||a.find((e=>!!e.error));if(s)throw s.error}}_createUpdatingResolver(){const e=(0,u.createResolver)();return this._updatingHandles.addPromise(e.promise),e}_logErrorAndCancelWorkflow(e){const{name:t,message:a,details:i}=e;U(t??"editing:workflow-start-failed",a??void 0,i??e),this._cancelWorkflow({force:!0})}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return null!=t&&(!t.visible||t.disabled)}};(0,i._)([(0,f.MZ)()],P.prototype,"_featureTemplatesLayersAndTables",null),(0,i._)([(0,f.MZ)()],P.prototype,"_snappingManager",void 0),(0,i._)([(0,f.MZ)({readOnly:!0})],P.prototype,"activeWorkflow",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"activeLeafWorkflow",null),(0,i._)([(0,f.MZ)({readOnly:!0})],P.prototype,"_activityQueue",void 0),(0,i._)([(0,f.MZ)({readOnly:!0})],P.prototype,"canCreate",null),(0,i._)([(0,f.MZ)()],P.prototype,"canCreateVisible",null),(0,i._)([(0,f.MZ)({readOnly:!0})],P.prototype,"canUpdate",null),(0,i._)([(0,f.MZ)()],P.prototype,"canUpdateVisible",null),(0,i._)([(0,f.MZ)()],P.prototype,"featureTemplatesLayers",null),(0,i._)([(0,f.MZ)()],P.prototype,"editorItems",void 0),(0,i._)([(0,f.MZ)({readOnly:!0})],P.prototype,"failures",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"hideTemplatesForInactiveLayers",void 0),(0,i._)([(0,f.MZ)({type:A.default})],P.prototype,"attachmentsViewModel",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"featureFormViewModel",null),(0,i._)([(0,f.MZ)()],P.prototype,"utilityNetworkAssociationAddAssociationViewModel",null),(0,i._)([(0,f.MZ)({type:W.default})],P.prototype,"featureTemplatesViewModel",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"labelOptions",null),(0,i._)([(0,f.MZ)()],P.prototype,"layerInfos",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"ownSketchViewModel",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"sketchOptions",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"sketchViewModel",null),(0,i._)([(0,f.MZ)({type:I.default,nonNullable:!0})],P.prototype,"snappingOptions",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"spinnerViewModel",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"state",null),(0,i._)([(0,f.MZ)({readOnly:!0})],P.prototype,"syncing",null),(0,i._)([(0,f.MZ)()],P.prototype,"updating",null),(0,i._)([(0,f.MZ)()],P.prototype,"tooltipOptions",null),(0,i._)([(0,f.MZ)()],P.prototype,"valueOptions",null),(0,i._)([(0,f.MZ)()],P.prototype,"view",null),(0,i._)([(0,f.MZ)()],P.prototype,"canZoomTo",null),(0,i._)([(0,f.MZ)()],P.prototype,"pageStack",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"showDiscardEditsPrompt",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"_candidateCommitted",void 0),(0,i._)([(0,f.MZ)()],P.prototype,"page",null),(0,i._)([(0,f.MZ)()],P.prototype,"featureFormDisabled",null),(0,i._)([(0,f.MZ)()],P.prototype,"featureFormHasAssociation",null),(0,i._)([(0,f.MZ)()],P.prototype,"canGoBack",null),(0,i._)([(0,f.MZ)()],P.prototype,"shouldShowDeleteButton",null),(0,i._)([(0,f.MZ)()],P.prototype,"hasPendingEdits",null),(0,i._)([(0,f.MZ)()],P.prototype,"snappingManager",null),P=(0,i._)([(0,y.$)(V)],P);const $=P},29831:(e,t,a)=>{a.d(t,{AY:()=>o,Ex:()=>l,JS:()=>d,K_:()=>p,X6:()=>c,_t:()=>s,wu:()=>r,zA:()=>n});var i=a(45622);const s={key:Symbol(),label:"Other\u200b"};function r(e){return"templateInfos"in e}function n(e){const t=[];for(const{layer:a,templates:i}of e)for(const e of i)t.push({layer:a,template:e});return t}function o(e,t){const a=new Map;for(const r of e){const e=t(r),{key:n,label:o}=null!=e.key?e:s;(0,i.tE)(a,n,(()=>({label:o,templateInfos:[]}))).templateInfos.push(r)}return Array.from(a.values())}function l(e,t){return{label:e.title??"",templateInfos:t.map((t=>({layer:e,template:t})))}}async function d(e,t){return"subtype-sublayer"===e.type?await(e.parent?.load(t)):await e.load(t),e}function p(e){const t=new Map,a=[];for(const i of e)if(c(i)){a.push(i);for(const e of i.items)t.set(e.template,e)}else t.set(i.template,i);return[t,a]}const c=e=>"items"in e},57581:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var i,s=a(93800),r=a(19455),n=a(48602),o=a(80556),l=(a(21265),a(14746),a(75269));function d(e){const{exifInfo:t,exifName:a,tagName:i}=e;if(!t||!a||!i)return null;const s=t.find((e=>e.name===a));return s?function(e){const{tagName:t,tags:a}=e;if(!a||!t)return null;const i=a.find((e=>e.name===t));return i?.value||null}({tagName:i,tags:s.tags}):null}const p={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let c=i=class extends r.A{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=d({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return p[t]||null}clone(){return new i({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,s._)([(0,n.MZ)({type:String})],c.prototype,"contentType",void 0),(0,s._)([(0,n.MZ)()],c.prototype,"exifInfo",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],c.prototype,"orientationInfo",null),(0,s._)([(0,n.MZ)({type:o.jz})],c.prototype,"id",void 0),(0,s._)([(0,n.MZ)({type:String})],c.prototype,"globalId",void 0),(0,s._)([(0,n.MZ)({type:String})],c.prototype,"keywords",void 0),(0,s._)([(0,n.MZ)({type:String})],c.prototype,"name",void 0),(0,s._)([(0,n.MZ)({json:{read:!1}})],c.prototype,"parentGlobalId",void 0),(0,s._)([(0,n.MZ)({json:{read:!1}})],c.prototype,"parentObjectId",void 0),(0,s._)([(0,n.MZ)({type:o.jz})],c.prototype,"size",void 0),(0,s._)([(0,n.MZ)({json:{read:!1}})],c.prototype,"url",void 0),c=i=(0,s._)([(0,l.$)("esri.rest.query.support.AttachmentInfo")],c);const u=c},71456:(e,t,a)=>{a.d(t,{A:()=>p});var i=a(93800),s=a(58448),r=a(79953),n=a(48602),o=(a(21265),a(50925),a(14746),a(75269)),l=a(96913);let d=class extends s.A.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,r.when)((()=>{const e=this.screenLocationEnabled?this.view:null;return e?[e.size,"3d"===e.type?e.camera:e.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),(0,r.watch)((()=>this.screenLocation),((e,t)=>{null!=e&&null!=t&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:e,view:t,screenLocationEnabled:a}=this,i=t?.spatialReference,s=i?(0,l.projectOrLoad)(e,i).geometry:null;return a&&s&&t?.ready?t.toScreen(s):null}};(0,i._)([(0,n.MZ)()],d.prototype,"location",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"screenLocation",null),(0,i._)([(0,n.MZ)()],d.prototype,"screenLocationEnabled",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"view",void 0),d=(0,i._)([(0,o.$)("esri.widgets.support.AnchorElementViewModel")],d);const p=d},73484:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(93800),s=a(48602),r=(a(21265),a(50925),a(14746),a(75269)),n=a(71456);let o=class extends n.A{constructor(e){super(e),this.visible=!1}};(0,i._)([(0,s.MZ)()],o.prototype,"visible",void 0),o=(0,i._)([(0,r.$)("esri.widgets.Spinner.SpinnerViewModel")],o);const l=o},75788:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var i=a(93800),s=a(58828),r=a(58448),n=a(17741),o=a(49959),l=a(79953),d=a(48602),p=(a(21265),a(50925),a(14746),a(75269)),c=a(15492),u=a(42985),h=a(78076),f=a(29831),y=a(15576),m=a(28109);const w=e=>{let{layer:t}=e;return{key:t,label:t.title??""}},g=e=>{let{layer:t}=e;return{key:t.geometryType,label:t.geometryType??""}};let _=class extends r.A.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new c.U,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([(0,l.watch)((()=>[this.templateInfos,this.layers]),((e,t)=>{let[a]=e;a&&a===t?.at(0)||(this._updateTask=(0,n.DC)(this._updateTask),a?this._updateAllItems(a):this._getTemplatesAndUpdateAllItems())}),l.syncAndInitial),(0,l.watch)((()=>this._groupByFunction),(()=>{null==this.templateInfos&&(this._updateTask=(0,n.DC)(this._updateTask),this._getTemplatesAndUpdateAllItems())}),l.sync),(0,l.watch)((()=>this.filterFunction),(e=>{for(const t of this._allItems)(0,f.X6)(t)&&(t.filterFunction=e)}),l.sync)])}set groupBy(e){if(this._set("groupBy",e),"function"!=typeof e)switch(e){case"layer":this._groupByFunction=w;break;case"geometry":this._groupByFunction=g;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const a=()=>this.notifyChange("state");this.addHandles(e.map((e=>(0,l.when)((()=>e.loadStatus),a))),t)}this._set("layers",e)}get state(){return this.updating?"loading":0!==this.layers.length||this.templateInfos?.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce(((e,t)=>(0,f.X6)(t)?e+t.allItems.length:e+1),0)}get items(){const{filterFunction:e}=this;return null==e?this._allItems:this._allItems.filter((t=>(0,f.X6)(t)?t.items.length>0:e(t)))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)(0,f.X6)(e)&&e.reapplyFilter()}select(e){let{emit:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=this.selectedItem,i=e?.clone()||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:a,template:i?.template??null})}_createItem(e,t){return new y.default({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return"string"==typeof e?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(0===e.length)return function(e){for(const t of e){if((0,f.X6)(t))for(const e of t.items)e.destroy();t.destroy()}}(t),void(this._allItems=[]);const[a,i]=(0,f.K_)(t),s=e=>{const t=a.get(e.template);return t?(a.delete(e.template),t):this._createItem(e.template,e.layer)},{filterFunction:r}=this,n=e.filter(v).map((e=>(0,f.wu)(e)?new m.default({filterFunction:r,label:e.label,allItems:e.templateInfos.filter(v).map((e=>s(e)))}):s(e)));for(const o of[...a.values(),...i])o.destroy();this._allItems=n}async _getTemplatesFromLayers(e){const t=[],a={signal:e};await Promise.all(this.layers.map((async i=>{await(0,f.JS)(i,a),(0,o.throwIfAborted)(e);const s=(0,h.BR)(i)?.operations;s?.supportsEditing&&s?.supportsAdd&&((0,h.F2)(i)?t.push(...i.sublayers):t.push(i))})));const i=await(0,u.b)(t,this.view,e);(0,o.throwIfAborted)(e);const s=(0,f.zA)(i),r=this._groupByFunction;if(null==r)return s;const n=(0,f.AY)(s,r);return 1===n.length&&n[0].label===f._t.label?n[0].templateInfos:n}async _getTemplatesAndUpdateAllItems(){if(0===this.layers.length)return;const e=(0,s.UT)((async e=>{const t=await this._getTemplatesFromLayers(e);(0,o.throwIfAborted)(e),this._updateAllItems(t)}));this._updateTask=e,this._updatingHandles.addPromise(e.promise)}};function v(e){return(0,f.wu)(e)?e.templateInfos.some(v):!(0,u.w2)(e.template)||!1!==e.template.visible}(0,i._)([(0,d.MZ)()],_.prototype,"_allItems",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"_groupByFunction",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"_updatingHandles",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"disabled",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"disabledItemFunction",void 0),(0,i._)([(0,d.MZ)({value:null})],_.prototype,"filterFunction",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"groupBy",null),(0,i._)([(0,d.MZ)({value:[]})],_.prototype,"layers",null),(0,i._)([(0,d.MZ)()],_.prototype,"state",null),(0,i._)([(0,d.MZ)({readOnly:!0})],_.prototype,"numberOfFeatureTemplates",null),(0,i._)([(0,d.MZ)({readOnly:!0})],_.prototype,"items",null),(0,i._)([(0,d.MZ)({readOnly:!0})],_.prototype,"selectedItem",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"templateInfos",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"updating",null),(0,i._)([(0,d.MZ)()],_.prototype,"view",void 0),_=(0,i._)([(0,p.$)("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],_);const b=_},79039:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var i=a(93800),s=a(6946),r=a(48602),n=(a(21265),a(50925)),o=(a(14746),a(75269)),l=a(78076),d=a(41317);let p=class extends s.default{constructor(e){super(e),this.layer=null}get attachments(){return{enabled:this._effectiveEnabled&&!!this._effectiveCapabilities?.data.supportsAttachment}}get create(){const{_effectiveCapabilities:e,layer:t}=this,a=this._createEnabled,i=a,s=t.capabilities?.operations.supportsAdd,r=!!e?.operations.supportsAdd;return{attachments:{enabled:a&&this.attachments.enabled},attributes:a,enabled:a,geometry:i,reliesOnOwnerAdminPrivileges:!s&&r}}get delete(){const{_effectiveCapabilities:e,layer:t}=this,a=t.capabilities?.operations.supportsDelete,i=!!e?.operations.supportsDelete;return{enabled:this._effectiveEnabled&&!!e?.operations.supportsDelete,reliesOnOwnerAdminPrivileges:!a&&i}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){const{_effectiveCapabilities:e,layer:t}=this,a=this._updateEnabled,i=!(!a||!e?.editing.supportsGeometryUpdate),s=t.capabilities?.operations.supportsUpdate,r=!!e?.operations.supportsUpdate,n=this.attachments.enabled,o=n&&this._canCreateOrUpdate;return{attachments:{enabled:n,create:o,update:o},attributes:a,enabled:a,geometry:i,reliesOnOwnerAdminPrivileges:!s&&r}}get _createEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsAdd}get _updateEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsUpdate}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return(0,l.tk)(this.layer)}get _effectiveCapabilities(){return(0,l.BR)(this.layer)}};(0,i._)([(0,r.MZ)()],p.prototype,"attachments",null),(0,i._)([(0,r.MZ)()],p.prototype,"create",null),(0,i._)([(0,r.MZ)()],p.prototype,"delete",null),(0,i._)([(0,r.MZ)()],p.prototype,"layer",void 0),(0,i._)([(0,r.MZ)()],p.prototype,"reliesOnOwnerAdminPrivileges",null),(0,i._)([(0,r.MZ)()],p.prototype,"update",null),(0,i._)([(0,r.MZ)()],p.prototype,"_createEnabled",null),(0,i._)([(0,r.MZ)()],p.prototype,"_updateEnabled",null),(0,i._)([(0,r.MZ)()],p.prototype,"_canCreateOrUpdate",null),(0,i._)([(0,r.MZ)()],p.prototype,"_effectiveEnabled",null),(0,i._)([(0,r.MZ)()],p.prototype,"_effectiveCapabilities",null),p=(0,i._)([(0,o.$)("esri.layers.support.EditingCapabilities")],p);const c=p;var u=a(70576),h=a(26936),f=a(51064);const y="esri.views.layers.support.editableLayerViews";var m=a(92471);let w=class extends c{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==t?.enabled}}get create(){const{attachments:e,defaults:t,layerInfo:a,layer:i,layerView:s}=this,r=t.create,n=!1!==a?.enabled&&!1!==a?.addEnabled,o=r.enabled&&n;return{attributes:o&&r.attributes,enabled:o,geometry:o&&r.geometry&&g(i,s),attachments:{enabled:e.enabled&&o&&!1!==a?.attachmentsOnCreateEnabled},reliesOnOwnerAdminPrivileges:r.reliesOnOwnerAdminPrivileges}}get defaults(){return new c({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,a=e.delete,i=!1!==t?.enabled&&!1!==t?.deleteEnabled;return{enabled:a.enabled&&i,reliesOnOwnerAdminPrivileges:a.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return t?.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){const{layer:e}=this,t=!(!(0,m.isRelatableFeatureSupportedLayer)(e)||!e.relationships?.length),a=!!this.formTemplate?.elements?.some((e=>"relationship"===e.type));return{enabled:t&&a}}get update(){const{attachments:e,defaults:t,layerInfo:a,layer:i,layerView:s}=this,r=t.update,n=!1!==a?.enabled&&!1!==a?.updateEnabled,o=r.enabled&&n,l=o&&r.attributes&&!1!==a?.attributeUpdatesEnabled,d=o&&r.geometry&&!1!==a?.geometryUpdatesEnabled&&g(i,s),p=e.enabled&&!1!==a?.attachmentsOnUpdateEnabled;return{attributes:l,enabled:o,geometry:d,attachments:{enabled:p,create:p&&r.attachments.create,update:p&&r.attachments.update},reliesOnOwnerAdminPrivileges:r.reliesOnOwnerAdminPrivileges}}};function g(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&function(e,t){const{associatedLayer:a}=e,i=a?.infoFor3D;if(!i)return!1;const s=(0,h.U9)(i);if(null==s||!i.queryFormats.includes(s))return n.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const r=e.spatialReference,o=a.spatialReference;if(!(0,u.aI)(r,o))return n.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${r.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${o.wkid}).`),!1;const l=a.sourceJSON.sourceSpatialReference;if(null!=l&&!(0,u.aI)(l,o))return n.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${o.wkid}) is different from its source spatial reference (wkid:${l.wkid}).`),!1;const{view:d}=t;if(t.destroyed||null==d)return!1;const p=d.spatialReference,{viewingMode:c}=d.state,m=(0,u.EA)(r),w=c===f.RT.Global;return m&&!w?(n.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${r.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!m&&w?(n.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${r.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!((0,u.aI)(r,p)||w&&(0,u.K8)(p)&&(0,u.oT)(r))||(n.A.getLogger(y).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${r.wkid}) does not match the view spatial reference (wkid:${p.wkid}).`),!1)}(e,t)}(0,i._)([(0,r.MZ)()],w.prototype,"attachments",null),(0,i._)([(0,r.MZ)()],w.prototype,"create",null),(0,i._)([(0,r.MZ)()],w.prototype,"defaults",null),(0,i._)([(0,r.MZ)()],w.prototype,"delete",null),(0,i._)([(0,r.MZ)()],w.prototype,"formTemplate",null),(0,i._)([(0,r.MZ)()],w.prototype,"layerInfo",void 0),(0,i._)([(0,r.MZ)()],w.prototype,"layerView",void 0),(0,i._)([(0,r.MZ)()],w.prototype,"relationship",null),(0,i._)([(0,r.MZ)()],w.prototype,"update",null),w=(0,i._)([(0,o.$)("esri.widgets.Editor.support.EditorEditingCapabilities")],w);const _=w;var v=a(41327);let b=class extends s.default{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){return!!this.layerView?.suspended}get capabilities(){return new _({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:a,delete:{enabled:i}}=this.capabilities,s=e.attachments.enabled||a.attachments.enabled;return!this.disabled&&(e.enabled||a.enabled||s||i||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return(0,v.lB)(this.layer,this.formTemplate)}get isTable(){return(0,l.bI)(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;if("3d"===this.layerView?.view?.type&&(0,d.wz)(this.layer.elevationInfo))return!1;const{enabled:e,geometry:t}=this.capabilities.create;return this.isTable?e:e&&t}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};(0,i._)([(0,r.MZ)()],b.prototype,"_suspended",null),(0,i._)([(0,r.MZ)()],b.prototype,"capabilities",null),(0,i._)([(0,r.MZ)()],b.prototype,"disabled",void 0),(0,i._)([(0,r.MZ)()],b.prototype,"editable",null),(0,i._)([(0,r.MZ)()],b.prototype,"formTemplate",null),(0,i._)([(0,r.MZ)()],b.prototype,"hasInvalidFormTemplate",null),(0,i._)([(0,r.MZ)()],b.prototype,"isTable",null),(0,i._)([(0,r.MZ)()],b.prototype,"layer",void 0),(0,i._)([(0,r.MZ)()],b.prototype,"layerInfo",void 0),(0,i._)([(0,r.MZ)()],b.prototype,"layerView",void 0),(0,i._)([(0,r.MZ)()],b.prototype,"supportsCreateFeaturesWorkflow",null),(0,i._)([(0,r.MZ)()],b.prototype,"supportsUpdateWorkflow",null),(0,i._)([(0,r.MZ)()],b.prototype,"visible",null),b=(0,i._)([(0,o.$)("esri.widgets.Editor.support.EditorItem")],b);const k=b}}]);