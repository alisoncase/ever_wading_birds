"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[47846,79538],{36045:(e,t,n)=>{n.d(t,{IS:()=>b,In:()=>M,HJ:()=>I,ND:()=>E});n(88677);var i=n(7951),r=n(7249),s=n(95011),o=n(93800),a=n(6946),l=n(45622),u=n(5019),d=n(69601);const p=new WeakMap;class c{constructor(){this._observables=new Map}get(e,t,n){const i=(0,l.tE)(this._observables,t,(()=>new d.I));return(0,u.gc)(i),Reflect.get(e,t)}set(e,t,n,i){return Reflect.set(e,t,n),this._observables.get(t)?.notify(),!0}}function m(e){return!e||"object"!=typeof e||"__accessor__"in e?e:(0,l.tE)(p,e,(()=>new Proxy(e,new c)))}var f=n(48602),h=(n(21265),n(50925),n(14746),n(75269)),y=n(82368);let g=class extends a.default{constructor(e){super(e),this.userChangesHaveMadeInvalid=!1;const t=m({...e.original.attributes??{}});this.attributes=t;const n=e.original.cloneShallow();n.attributes=t,this.plainGraphic=n}get geometry(){return this.original.geometry}get layer(){return this.original.sourceLayer??this.original.layer}attributeHasChanged(e){return!(0,y.D_)(this.attributes[e],this.original.attributes?.[e])}getAttribute(e){return this.attributes[e]??null}setAttribute(e,t){this.attributes[e]=t}};(0,o._)([(0,f.MZ)()],g.prototype,"attributes",void 0),(0,o._)([(0,f.MZ)()],g.prototype,"geometry",null),(0,o._)([(0,f.MZ)()],g.prototype,"plainGraphic",void 0),(0,o._)([(0,f.MZ)()],g.prototype,"layer",null),(0,o._)([(0,f.MZ)({constructOnly:!0})],g.prototype,"original",void 0),(0,o._)([(0,f.MZ)()],g.prototype,"userChangesHaveMadeInvalid",void 0),g=(0,o._)([(0,h.$)("esri.widgets.BatchAttributeForm.ReactiveGraphic")],g);var _=n(36445),v=n(53826),x=n(99961);const E=(e,t)=>null!=e&&e.input?.type===t;function b(e){return new g({original:e})}function I(e,t,n,i){const{dataType:o,minLength:a}=e,l=n?.validationErrors;if(!l||!t)return null;if(t===_.uB.DIFFERENT_ERRORS)return l.invalidBatchFormType;if(t===y.gK.CANNOT_BE_EMPTY)return l.cannotBeNull;if(t===r.Mh.VALUE_OUT_OF_RANGE||t===s.NumericRangeValidationError.OUT_OF_RANGE){const{field:t,range:n}=e,r={type:"date",intlOptions:{timeZone:"date"===t.type&&i?i:void 0,...(0,v.ZT)(t)}},s=(0,y.hQ)(n,l);return(0,x.V)(s,n,{format:{max:"date"===o?r:null!=n.max&&(0,y.qn)(n.max)?y.Qv:y.PA,min:"date"===o?r:null!=n.min&&(0,y.qn)(n.min)?y.Qv:y.PA}})}return t===r.Mh.INVALID_CODED_VALUE?l.invalidCodedValue:t===s.TypeValidationError.INVALID_TYPE?l.invalidType:t===y.gK.TOO_SHORT?(0,x.V)(l.tooShort,{min:a}):(y.gK.TOO_LONG,null)}function M(e,t,n){const r=n?.validationErrors;if(!r)return null;let s=null;for(const o of e.invalidHiddenInputs)switch(o.effectiveVisibilityCode){case _.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL:case _.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL:case _.qp.HIDDEN_FIELD_DEFINITION:return"single"===t?r.nonVisibleError_changeValues:r.nonVisibleError_checkIndividualFeatures;case _.qp.HIDDEN_NO_DOMAIN_IN_COMMON:case _.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME:case _.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME:case _.qp.HIDDEN_NOT_IN_ALL_LAYERS:s=r.nonVisibleError_checkIndividualFeatures;break;case _.qp.VISIBLE:continue;default:(0,i.Xb)(o.effectiveVisibilityCode)}return s}},36445:(e,t,n)=>{n.d(t,{Et:()=>u,hJ:()=>p,n8:()=>a,ng:()=>d,pg:()=>i,qp:()=>o,rf:()=>l,sO:()=>s,uB:()=>r});const i="esri_BatchAttributeForm_different_values";var r,s,o;function a(e){return e===o.VISIBLE}function l(e){return"field"===e.type}function u(e){return"group"===e.type}function d(e,t){return`${e}:${t}`}!function(e){e.DIFFERENT_ERRORS="batch-attribute-form-validation::features-have-different-errors"}(r||(r={})),function(e){e.noElementsInCommon="noElementsInCommon",e.noElements="noElements",e.elementsHiddenInSome="elementsHiddenInSome",e.allElementsHidden="allElementsHidden"}(s||(s={})),function(e){e.HIDDEN_FIELD_DEFINITION="hidden:field-definition",e.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL="hidden:group-visibility-expression:all-features",e.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME="hidden:group-visibility-expression:some-features",e.HIDDEN_NO_DOMAIN_IN_COMMON="hidden:no-domain-in-common",e.HIDDEN_NOT_IN_ALL_LAYERS="hidden:not-in-all-layers",e.HIDDEN_VISIBILITY_EXPRESSION_ALL="hidden:visibility-expression:all-features",e.HIDDEN_VISIBILITY_EXPRESSION_SOME="hidden:visibility-expression:some-features",e.VISIBLE="visible"}(o||(o={}));const p=e=>null!=e&&(c(e,"combo-box")||c(e,"radio-buttons"));function c(e,t){return e?.type===t}},39652:(e,t,n)=>{function i(e){const{attributes:t,sourceLayer:n}=e??{},i=n&&"displayField"in n?n.displayField:null,r=i?t?.[i]:null,s=null!=r?JSON.stringify(r):null,o=e?.getObjectId()?.toString();return s||o||""}n.d(t,{R:()=>i})},41327:(e,t,n)=>{n.d(t,{Au:()=>E,CU:()=>P,Et:()=>_,Gq:()=>S,H1:()=>k,HG:()=>Z,Iy:()=>M,Kl:()=>W,Kn:()=>Y,LZ:()=>N,TN:()=>w,U3:()=>X,Ve:()=>H,XI:()=>T,bx:()=>b,cU:()=>F,k_:()=>x,lB:()=>G,l_:()=>q,n4:()=>U,nT:()=>v,oc:()=>D,qG:()=>$,rf:()=>g,s9:()=>R,t6:()=>C,tM:()=>B,vp:()=>V,wr:()=>I});n(88677);var i=n(62631),r=n(7951),s=n(82301),o=n(50925),a=n(56612),l=n(96299),u=n(7249),d=n(95011),p=n(78076),c=n(79538),m=n(53826),f=n(82368),h=n(39652),y=n(99961);const g=e=>"field"===e?.type,_=e=>"group"===e?.type,v=e=>"relationship"===e?.type,x=e=>"text"===e.type,E=e=>"utilityNetworkAssociations"===e.type,b=e=>!_(e)&&null!=e.group,I=e=>e.reduce(((e,t)=>_(t)?[...e,...t.inputs]:[...e,t]),[]),M=e=>I(e).filter(g),F=e=>I(e).filter(v),w=e=>I(e).filter(E),T=e=>null!=e&&(Z(e,"combo-box")||Z(e,"radio-buttons")),Z=(e,t)=>null!=e&&e.input?.type===t,S=e=>{let{domain:t,inputType:n="text-box",dataType:i}=e;return"number"===i&&"text-box"===n&&(!t||"coded-value"!==t.type)};function V(e,t){const{title:n,feature:i}=e??{};return n||(i?(0,h.R)(i):null)||t||""}function N(e){const{attributes:t,fieldsIndex:n,label:r,timeZone:s}=e;if(!t||"object"!=typeof t)return r;const o=Object.keys(t).filter((e=>(0,a.mk)(r,e))),l=o.map((e=>t[e])),u=o.map((e=>n.get(e))).filter(i.Ru);return function(e,t){return(0,a.HC)((0,a.HC)(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[t.toLowerCase(),n]}))))}(r,H({values:l,fields:u,timeZone:s}))}const O="expression/",L="expr/",A="field/";function D(e){const[t,n]=e.split(O);return""===t&&n?n:(o.A.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${O}/expressionName'`),"")}function C(e){return`${O}${e}`}function k(e){return`${A}${e}`}function R(e){return e.startsWith(O)}function $(e){return e.startsWith(L)}function H(e){const{fields:t,values:n}=e,i=e.timeZone??void 0,r=t.map(((e,t)=>{let r=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===r));t?.name&&(r=t.name)}return((0,c.fs)(e)||(0,d.isTimeOnlyField)(e))&&(r=(0,m.ZP)(e,r,{timeZone:i,...(0,m.ZT)(e)})),[e.name,r]}));return Object.fromEntries(r)}const P=e=>{const t={typeFieldName:null,types:[]};return e?((0,p.Sv)(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map((e=>{let{id:t,name:n,domains:i}=e;return{code:t,name:n,domains:i}}))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},B=(e,t,n)=>{const{dataType:i,error:r,minLength:s}=e,o=t?.validationErrors;if(!o||!r)return null;if(r===f.gK.CANNOT_BE_EMPTY)return o.cannotBeNull;if(r===u.Mh.VALUE_OUT_OF_RANGE||r===d.NumericRangeValidationError.OUT_OF_RANGE){const{field:t,range:r}=e,s={type:"date",intlOptions:{timeZone:"date"===t.type&&n?n:void 0,...(0,m.ZT)(t)}},a=(0,f.hQ)(r,o);return(0,y.V)(a,r,{format:{max:"date"===i?s:null!=r.max&&(0,f.qn)(r.max)?f.Qv:f.PA,min:"date"===i?s:null!=r.min&&(0,f.qn)(r.min)?f.Qv:f.PA}})}return r===u.Mh.INVALID_CODED_VALUE?o.invalidCodedValue:r===d.TypeValidationError.INVALID_TYPE?o.invalidType:r===f.gK.TOO_SHORT?(0,y.V)(o.tooShort,{min:s}):(f.gK.TOO_LONG,null)},q=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,i=e.geometry?.type;return"polyline"===i||"polyline"===n?"line":"mesh"===i||"mesh"===n||"multipatch"===n?"cube":"multipoint"===i||"multipoint"===n?"point":i||n||"table"},U=e=>{const t=[];if(e.formTemplate){const{description:n,title:i}=e.formTemplate;e.fields?.forEach((e=>{const r=i&&(0,a.mk)(i,e.name),s=n&&(0,a.mk)(n,e.name);(r||s)&&t.push(e.name)}))}return t};function G(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(l.jt)??[]).some((t=>{let{fieldName:n}=t;return!e.fieldsIndex.get(n)}))}function Y(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function W(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return(0,r.Xb)(t.objectType),!1}}function X(e,t,n){const i=(0,p.fV)(e),r=i?.find((e=>e.code===n));if(!r)return!1;const o=i?.find((e=>e.code===t));return!(0,s.equalsShallow)(r.defaultValues,o?.defaultValues)&&Object.values(r.defaultValues).some((e=>null!=e))}},53826:(e,t,n)=>{n.d(t,{Ng:()=>I,OM:()=>g,Q0:()=>x,T8:()=>v,ZP:()=>b,ZT:()=>E,eX:()=>w,fD:()=>S,fb:()=>f,fl:()=>m,iP:()=>Z,oh:()=>M,rX:()=>V,sH:()=>h,yk:()=>N});n(88677),n(21265);var i=n(74719),r=n(64682),s=n(66845),o=n(72520),a=n(69943),l=n(73210),u=n(51536),d=n(12711);const p=l.n$,c={date:null,time:null,timeZoneOffset:null},m=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),f="latn",h=new Set(["date-only","time-only","timestamp-offset"]),y=e=>"valueAsDate"in e;function g(e){return{locale:(0,d.JK)(),numberingSystem:f,zone:e??p}}function _(e,t){return null==e?null:u.c9.fromMillis(e,g(t))}function v(e,t){if(null==e||!(0,a.Kg)(e)||""===e){if(t){const e=u.c9.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return c}const n=u.c9.fromISO(e,{setZone:!0});return{date:n.toFormat(o.mo,g()),time:n.toFormat(o.Uq.HMS_MS,g()),timeZoneOffset:n.offset.toString()}}function x(e,t){if(null==e||!(0,a.Et)(e)||isNaN(e))return c;const n=_(e,t);return n?{date:n.toFormat(o.mo,g(t)),time:n.toFormat(o.Fj,g(t))}:c}function E(e){switch(e.type){case"date":default:return(0,s.J2)("short-date-short-time");case"date-only":return(0,s.J2)("short-date");case"time-only":return(0,s.J2)("short-time");case"timestamp-offset":return{...(0,s.J2)("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function b(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return(0,s.Yq)(t,n);case"date-only":return(0,s.iS)(t,n);case"time-only":return(0,s.F8)(t,n);case"timestamp-offset":return(0,s.Ey)(t,n);default:return null}}function I(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:i,timeZoneComponent:r,oldValue:s}=e;if(!t?.value)return null;const{year:a,month:d,day:p}=u.c9.fromFormat(t.value,o.mo),{hour:c,minute:m,second:f,millisecond:h}=F(i,l.n$)??u.c9.now(),y=v(s,n),g=r?.value?parseInt(r.value,10):null!=y.timeZoneOffset?parseInt(y.timeZoneOffset,10):(new Date).getTimezoneOffset(),_=u.mQ.instance(g),x=u.c9.fromObject({year:a,month:d,day:p,hour:c,minute:m,second:f,millisecond:h},{zone:_});return x.isValid?x.toISO({includeOffset:!0}):null}function M(e){const{dateComponent:t,timeComponent:n,timeZone:i,max:r,min:s,oldValue:o}=e,a=F(t,i);let l=!!e.applyRange;if(!a)return null;let d=null;if(null!=n?.value){const e=F(n,i),t=Date.now(),s=null!=r&&r<t?r:t,o=u.c9.fromMillis(s,g(i)),l=a||o,{year:p,month:c,day:m}=l,{hour:f,minute:h,second:y,millisecond:_}=e||o;d=l.set({year:p,month:c,day:m,hour:f,minute:h,second:y,millisecond:_})}else{const e=_(T({value:o??Date.now(),max:r,min:s}),i),{year:t,month:n,day:u}=a,{hour:p,minute:c,second:m,millisecond:f}=e;l=!0,d=a.set({year:t,month:n,day:u,hour:p,minute:c,second:m,millisecond:f})}if(!d.isValid)return null;const p=d.toMillis();return l?T({value:p,max:r,min:s}):p}function F(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=y(e)?u.c9.fromFormat(e.value,o.mo,g(t)):(0,o.UE)(e.value),n?.isValid?n:null}function w(e){const{max:t,min:n,value:i}=e;return!isNaN(i)&&!(null!=t&&i>t)&&!(null!=n&&i<n)}function T(e){const{max:t,min:n,value:i}=e;return null!=t&&null!=n?(0,r.qE)(i,n,t):null!=t&&i>t?t:null!=n&&i<n?n:i}function Z(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new i.default("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),r=new Array(3);for(let i=0;i<3;i++){const e=n.at(i)??"";r[i]=e.padStart(2,"0")}return r.join(":")}function S(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return Z(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function V(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function N(e){const{type:t,range:n,value:i}=e;if(null==i||!n||i===n.min||i===n.max)return!0;if("date"===t)return w({value:i,min:n.min,max:n.max});const{rawMax:r,rawMin:s}=n;let a=null,l=null,u=null;switch(t){case"date-only":a=(0,o.Xi)(r),l=(0,o.Xi)(s),u=(0,o.Xi)(i);break;case"time-only":a=(0,o.UE)(r),l=(0,o.UE)(s),u=(0,o.UE)(i);break;case"timestamp-offset":a=(0,o.gz)(r),l=(0,o.gz)(s),u=(0,o.gz)(i)}return!u||w({value:u.valueOf(),min:l?.valueOf(),max:a?.valueOf()})}},79538:(e,t,n)=>{n.d(t,{BV:()=>F,EG:()=>v,Lk:()=>M,Ll:()=>Z,Np:()=>d,R3:()=>T,SO:()=>f,T1:()=>w,UH:()=>u,Wy:()=>x,XR:()=>m,aM:()=>I,fs:()=>_,i0:()=>S,i3:()=>g});var i=n(66845),r=n(95011),s=n(96247),o=n(76983),a=n(73210),l=n(40731);const u=",",d={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},p="percent-of-total",c="field",m={exclude:["median"]},f={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},h=new Set(["integer","small-integer"]);let y=null;const g=["date","date-only","timestamp-offset"];function _(e){return(0,r.isDateField)(e)||(0,r.isDateOnlyField)(e)||(0,r.isTimestampOffsetField)(e)}async function v(e){const{field:t,field2:n,field3:i,normalizationField:r,valueExpression:o}=e;let a=[];if(o){if(!y){const{arcadeUtils:e}=await(0,s.lw)();y=e}a=y.extractFieldNames(o)}return t&&a.push(t),n&&a.push(n),i&&a.push(i),r&&a.push(r),a}function x(e){let t=e.normalizationType;return t||(e.normalizationField?t=c:null!=e.normalizationTotal&&(t=p)),t??void 0}function E(e){return String(e).padStart(2,"0")}function b(e,t,n){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${E((n?e.getMonth():e.getUTCMonth())+1)}-${E(n?e.getDate():e.getUTCDate())} ${E(n?e.getHours():e.getUTCHours())}:${E(n?e.getMinutes():e.getUTCMinutes())}:${E(n?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function I(e,t,n,i){const{hasQueryEngine:r}=e,s=`(${b(n,M(e,n),r)} - ${b(t,M(e,t),r)})`;let o=f[i],a="/";return o<1&&(o=1/o,a="*"),{sqlExpression:1===o?s:`(${s} ${a} ${o})`,sqlWhere:null}}function M(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const n=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,r.isDateField)(n))return"field"}}function F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;for(const n in t)if(t[n].includes(e))return n}function w(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=null;return e&&("string"==typeof e?t.includes(e)&&(i=e):i=(0,o.q3)(e)),n?i||"gray":i}function T(e,t){const n=t&&e.getField(t);return!!n&&h.has(n.type)}function Z(e){return`cast(${e} as float)`}function S(e,t){const{format:n,timeZoneOptions:r,fieldType:s}=t??{};let o,u;if(r&&({timeZone:o,timeZoneName:u}=(0,l.hv)(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,(0,i.J2)(n||"short-date-short-time"),s)),"string"==typeof e&&isNaN(Date.parse("time-only"===s?`1970-01-01T${e}Z`:e)))return e;switch(s){case"date-only":{const t=(0,i.J2)(n||"short-date");return"string"==typeof e?(0,i.iS)(e,{...t}):(0,i.Yq)(e,{...t,timeZone:a.n$})}case"time-only":{const t=(0,i.J2)(n||"short-time");return"string"==typeof e?(0,i.F8)(e,t):(0,i.Yq)(e,{...t,timeZone:a.n$})}case"timestamp-offset":{if(!o&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=n||r?(0,i.J2)(n||"short-date-short-time"):void 0,s=t?{...t,timeZone:o,timeZoneName:u}:void 0;return"string"==typeof e?(0,i.Ey)(e,s):(0,i.Yq)(e,s)}default:{const t=n||r?(0,i.J2)(n||"short-date-short-time"):void 0;return(0,i.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:o,timeZoneName:u}:void 0)}}}},82368:(e,t,n)=>{n.d(t,{$$:()=>E,D_:()=>c,Gd:()=>p,Kx:()=>i,PA:()=>g,Po:()=>m,Qv:()=>_,gK:()=>r,hQ:()=>x,jl:()=>h,of:()=>d,qn:()=>v,zU:()=>f});var i,r,s,o=n(96299),a=n(7249),l=n(95011),u=n(53826);(s=i||(i={})).Text="text",s.Number="number",s.Date="date",s.Unsupported="unsupported",function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(r||(r={}));const d=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};function p(e,t){const{dataType:n,domain:i,field:s,maxLength:o,minLength:d,range:p,required:c}=t;if(null==e)return c?r.CANNOT_BE_EMPTY:null;if("text"===n&&"string"==typeof e){if(d>-1&&e.length<d)return r.TOO_SHORT;if(o>-1&&e.length>o)return r.TOO_LONG}return"date"!==n||(0,u.yk)({type:s.type,range:p,value:e})?i?(0,a.wb)(s,e,i):(0,l.validateFieldValue)(s,e)??(0,a.wb)(s,e):l.NumericRangeValidationError.OUT_OF_RANGE}function c(e,t){return!(!m(e)||!m(t))||e===t}function m(e){return null==e||""===e}function f(e){let{dataType:t,field:n,input:r}=e;if(t===i.Date)return-1;const s=y(n.length);if(!r||!(0,o.AI)(r))return s;const a=y(r.maxLength);return-1===a?s:-1===s?a:Math.min(s,a)}function h(e){let{dataType:t,field:n,input:r}=e;if(t===i.Date)return-1;if(!r||!(0,o.AI)(r))return-1;const s=y(r.minLength);if(s<0)return-1;const a=y(n.length);return a>-1&&a<s?-1:s}function y(e){return"number"==typeof e&&e>-1?e:-1}const g={type:"number"},_={type:"number",intlOptions:{notation:"scientific"}};function v(e){return e>=1e7||e<=-1e7}function x(e,t){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}const E=e=>e&&!Number.isNaN(e.valueOf())},92660:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ae});var i=n(93800),r=n(58828),s=n(89129),o=n(74719),a=n(58448),l=n(50925),u=n(17741),d=n(49959),p=n(90450),c=n(79953),m=n(48602),f=(n(21265),n(14746),n(75269)),h=n(15492),y=n(93321),g=n(73210),_=n(36045),v=n(18453);const x=(0,v.createArcadeProfile)("form-calculation");class E{constructor(){this._executors=new Map,this._executorPromises=new Map}async getArcadeExecutor(e){return this._executors.has(e)?this._executors.get(e):this._executorPromises.has(e)?this._executorPromises.get(e):this._createExecutor(e)}async _createExecutor(e){try{const t=(0,v.createArcadeExecutor)(e,x);this._executorPromises.set(e,t);const n=await t;return this._executors.set(e,n),n}finally{this._executorPromises.delete(e)}}}var b=n(6946),I=n(45622),M=n(73974),F=n(35527),w=n(36445);function T(e){return"field"===e.type}function Z(e){return"group"===e.type}let S=null;const V="esri.widgets.BatchAttributeForm.expressions.ExpressionsManager",N=()=>l.A.getLogger(V);let O=class extends b.default{constructor(e){super(e),this.calculating=!1,this.arcadeContext=null,this._abortController=new AbortController,this.layerExpressionsModelMap=new Map,this.evaluatedExpressions=new p.A,this.expressionEvaluationFailed=!1}abort(){this._abortController.abort()}async runAllExpressions(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.calculating=!0;try{const n=[];for(const i of e){const e=this.layerExpressionsModelMap.get(i.layer);if(!e||0===e.components.length)continue;const r=new Set;n.push(this.evaluateAffectedComponents(e.components,i,e,t,r))}await(0,d.whenOrAbort)(Promise.all(n),this._abortController)}catch(E){N().error(E),this.expressionEvaluationFailed=!0}finally{this.calculating=!1}}async valueChanged(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{this.calculating=!0;const i=t.map((t=>this.evaluateValueChangedForFeature(e,t,n)));await Promise.all(i)}catch(x){N().error(x),this.expressionEvaluationFailed=!0}finally{this.calculating=!1}}async evaluateValueChangedForFeature(e,t,n){if(this._abortController.signal.aborted)return;const i=this.layerExpressionsModelMap.get(t.layer);if(!i||0===i.components.length)return;const r=new Set,s=new Set([e]),o=new Set;for(;s.size>0;){const[e]=s;if(s.delete(e),r.has(e))continue;r.add(e);const a=i.fieldReferencesMap.get(e.toLowerCase());if(!a)continue;for(const t of a)o.has(t)&&a.delete(t);if(0===a.size)continue;const l=new Set;await this.evaluateAffectedComponents([...a],t,i,n,l);for(const t of a)o.add(t);for(const t of l)r.has(t)||s.add(t)}}async evaluateAffectedComponents(e,t,n,i,r){const s=new Map;for(const a of e)s.has(a)||s.set(a,this.createSccEvaluator(a,t,s,n));if(0===s.size)return;const o=[...s.values()].map((e=>e.evaluate(i,r)));await Promise.all(o)}createSccEvaluator(e,t,n,i){const r=new L(e,t,this.arcadeContext,i,this.evaluatedExpressions,this._abortController);for(const s of e.adjacencyList)r.dependentEvaluators.push((0,I.tE)(n,s,(()=>this.createSccEvaluator(s,t,n,i))));return r}};(0,i._)([(0,m.MZ)()],O.prototype,"calculating",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],O.prototype,"arcadeContext",void 0),(0,i._)([(0,m.MZ)()],O.prototype,"_abortController",void 0),(0,i._)([(0,m.MZ)()],O.prototype,"layerExpressionsModelMap",void 0),(0,i._)([(0,m.MZ)()],O.prototype,"evaluatedExpressions",void 0),(0,i._)([(0,m.MZ)()],O.prototype,"expressionEvaluationFailed",void 0),O=(0,i._)([(0,f.$)(V)],O);class L{constructor(e,t,n,i,r,s){this.scc=e,this.feature=t,this.arcadeContextInfo=n,this.expressionsModel=i,this.evaluatedExpressions=r,this._abortController=s,this.dependentEvaluators=[],this._evaluatorPromise=null}get baseContext(){const{editType:e,map:t,spatialReference:n,timeZone:i}=this.arcadeContextInfo,r=this.feature.layer,s="scene"===r?.type&&null!=r.associatedLayer?r.associatedLayer:r;return{variables:{$originalfeature:this.feature.original.clone(),$editcontext:{editType:e},$layer:s,$featureset:s,$datastore:s?.url,$feature:this.feature.plainGraphic.clone(),$map:t},executeContext:{rawOutput:!0,spatialReference:n??void 0,timeZone:i,abortSignal:this._abortController.signal}}}evaluate(e,t){return null==this._evaluatorPromise&&(this._evaluatorPromise=this._evaluate(e,t)),this._evaluatorPromise}async _evaluate(e,t){null===S&&(S=await Promise.all([n.e(95927),n.e(43093)]).then(n.bind(n,43093)));const i=this.dependentEvaluators.map((n=>n.evaluate(e,t)));await(0,d.whenOrAbort)(Promise.all(i),this._abortController);for(const n of this.scc.executors){const i=this.baseContext;if(this._abortController.signal.aborted)break;const r=this.expressionsModel.arcadeExecutorUses.get(n)??[],s=(0,I.tE)(this.evaluatedExpressions,this.feature,(()=>new p.A));let a=null,l=null;try{a=n.isAsync?await n.executeAsync(i.variables,i.executeContext):n.execute(i.variables,i.executeContext),l={result:a,status:"success"}}catch(ue){l={error:ue,status:"error"}}for(const n of r){const i=this.expressionsModel.elementTemplateMap.get(n.elementId);switch(n.executorPurpose){case"editable":case"required":s.set((0,w.ng)(n.elementId,n.executorPurpose),l);break;case"value":{if("error"===l?.status)continue;const e=i.getExpressionExecutorsForLayer(this.feature.layer);let n=!0;if(e?.editableExpression&&(n=!1===s.get((0,w.ng)(i.elementId,"editable"))?.result),n){const e=this.feature.getAttribute(i.fieldName)??null,n=A(l.result,this.feature,i.fieldName,this.arcadeContextInfo.timeZone);n!==e&&(this.feature.setAttribute(i.fieldName,n),t.add(i.fieldName))}}break;case"visibility":if(s.set((0,w.ng)(n.elementId,n.executorPurpose),l),!this.expressionsModel.preserveFieldValuesWhenHidden&&!1===l.result&&e)if(Z(i))for(const e of i.elements)T(e)&&(null!==this.feature.getAttribute(e.fieldName)&&t.add(e.fieldName),this.feature.setAttribute(e.fieldName,null));else T(i)&&(null!==this.feature.getAttribute(i.fieldName)&&t.add(i.fieldName),this.feature.setAttribute(i.fieldName,null))}}if("error"===l?.status){const e=new Set;for(const t of r){const n=this.expressionsModel.elementTemplateMap.get(t.elementId);if(n)switch(t.executorPurpose){case"editable":e.add(n.label+" - Editable expression");break;case"required":e.add(n.label+" - Required expression");break;case"value":e.add(n.label+" - Value expression");break;case"visibility":e.add(n.label+" - Visibility expression")}}if(e.size>0)throw new o.default("expression-evaluation-failed","Arcade evaluation failed ("+[...e].join(",")+")");throw new o.default("expression-evaluation-failed","Arcade evaluation failed ")}}}}function A(e,t,n,i){if(null===e)return null;const r=t.layer.fieldsIndex.get(n);if(!r)throw new o.default("field-not-found","Unable set field value as the field cannot be found. ("+n+")");switch(r.type){case"big-integer":case"integer":case"long":case"oid":case"small-integer":case"single":case"double":return S.toNumber(e);case"global-id":case"guid":case"string":return S.toString(e);case"date":{if(S.isDate(e))return e.getTime();const t=S.toDate(e,i);if(!t)throw new o.default("unsupported-value-type","Arcade return type is not a supported field type. ("+n+")");return t.getTime()}case"date-only":{if(S.isDateOnly(e))return e.toStorageFormat();if(S.isDate(e))return M.n.fromDateTime(e.toDateTime()).toStorageFormat();const t=M.n.fromString(S.toString(e));if(!t)throw new o.default("unsupported-value-type","Arcade return type is not a supported field type.");return t.toStorageFormat()}case"time-only":{if(S.isTime(e))return e.toStorageString();if(S.isDate(e))return F.k.fromDateTime(e.toDateTime()).toStorageString();const t=F.k.fromString(S.toString(e));if(!t)throw new o.default("unsupported-value-type","Arcade return type is not a supported field type.");return t.toStorageString()}case"timestamp-offset":{if(S.isDate(e))return e.toISOString(!1);const t=S.toDate(e,i);if(!t)throw new o.default("unsupported-value-type","Arcade return type is not a supported field type. ("+n+")");return t.toISOString(!1)}}throw new o.default("unsupported-value-type","Arcade return type is not a supported field type. ("+n+")")}var D=n(62631),C=n(83626),k=n(35920);let R=0;class ${constructor(e){this.arcadeExecutorUses=new Map,this.components=[],this.preserveFieldValuesWhenHidden=!1,this.executorMap=e.executorMap,this.preserveFieldValuesWhenHidden=!0===e.preserveFieldValuesWhenHidden,this.elementTemplateMap=new Map;for(const t of this.executorMap.keys())this.elementTemplateMap.set(t.elementId,t);this._buildDependencyGraph()}_buildDependencyGraph(){const e=function(e){const t=Array.from(e.values()).filter(D.Ru),n=new Set(t.flatMap((e=>Array.from(Object.values(e))))),i=Array.from(n).map((e=>({component:null,crossLinkNeighbors:new Set,executor:e,index:-1,lowlink:-1,onStack:!1})));return new Map(i.map((e=>[e.executor,e])))}(this.executorMap),t={components:[],arcadeExecutorUses:this.arcadeExecutorUses,elementTemplatesById:new Map([...this.executorMap.keys()].map((e=>[e.elementId,e]))),executorMap:this.executorMap,fieldElementTemplateMap:B(this.executorMap),fieldReferencesMap:new Map,nextIndex:0,nodeInfoMap:e,nodeStack:new C.A(k.HV),shouldConsiderVisibility:!this.preserveFieldValuesWhenHidden};for(const n of this.executorMap.keys()){const e=this.executorMap.get(n);e.editableExpression&&(0,I.tE)(this.arcadeExecutorUses,e.editableExpression,(()=>[])).push({elementId:n.elementId,executorPurpose:"editable"}),e.valueExpression&&(0,I.tE)(this.arcadeExecutorUses,e.valueExpression,(()=>[])).push({elementId:n.elementId,executorPurpose:"value"}),e?.visibilityExpression&&(0,I.tE)(this.arcadeExecutorUses,e.visibilityExpression,(()=>[])).push({elementId:n.elementId,executorPurpose:"visibility"}),e?.requiredExpression&&(0,I.tE)(this.arcadeExecutorUses,e.requiredExpression,(()=>[])).push({elementId:n.elementId,executorPurpose:"required"})}for(const n of this.arcadeExecutorUses.values())n.sort((e=>"editable"===e.executorPurpose?-1:1));for(const n of e.values())-1===n.index&&H(n,t);this.dependencyGraphComponents=function(e){return new Map([...e.values()].map((e=>{let{component:t,executor:n}=e;return[n,t]})))}(t.nodeInfoMap),this.fieldReferencesMap=function(e){let{fieldReferencesMap:t,nodeInfoMap:n}=e;const i=new Map;for(const[r,s]of t.entries()){const e=new Set;for(const t of s){const i=n.get(t);i?.component&&e.add(i.component)}i.set(r,e)}return i}(t),this.components=t.components}}function H(e,t){e.index=e.lowlink=t.nextIndex++,t.nodeStack.push(e);for(const n of function(e,t){let{executor:n}=e;const i=new Set;for(const s of n.fieldsUsed){const e=s.toLowerCase();(0,I.tE)(t.fieldReferencesMap,e,(()=>new Set)).add(n),(0,k.FB)(i,P(e,t))}const r=t.arcadeExecutorUses.get(n)?.filter((e=>"value"===e.executorPurpose))??[];for(const s of r){const e=t.executorMap.get(t.elementTemplatesById.get(s.elementId));e?.editableExpression&&e.editableExpression!==n&&i.add(e.editableExpression)}return Array.from(i).map((e=>t.nodeInfoMap.get(e))).filter(D.Ru)}(e,t))-1===n.index?(H(n,t),e.lowlink=Math.min(e.lowlink,n.lowlink)):n.index<e.index&&t.nodeStack.contains(n)&&(e.lowlink=Math.min(e.lowlink,n.index)),t.nodeStack.contains(n)||e.crossLinkNeighbors.add(n);if(e.lowlink===e.index){const n=function(){R++;const e=R.toString();return{executors:new Set,adjacencyList:new Set,componentId:e}}();for(t.components.push(n);q(t.nodeStack)>=e.index;){const e=t.nodeStack.pop();if(null!=e){e.component=n,n.executors.add(e.executor);for(const t of e.crossLinkNeighbors)null!=t.component&&n.adjacencyList.add(t.component)}}}}function P(e,t){let{executorMap:n,fieldElementTemplateMap:i,shouldConsiderVisibility:r}=t;const s=[],o=i.get(e);if(null==o)return s;const a=n.get(o);if(null==a)return s;if((0,D.OZ)(s,a.editableExpression),(0,D.OZ)(s,a.valueExpression),r){(0,D.OZ)(s,a?.visibilityExpression);const{group:e}=o;if(null!=e){const t=n.get(e)?.visibilityExpression;(0,D.OZ)(s,t)}}return s}function B(e){const t=new Map;for(const n of e.keys())T(n)&&t.set(n.fieldName.toLowerCase(),n);return t}function q(e){return e.peek()?.index??-1}let U=class extends b.default{constructor(e){super(e),this.inputs=[],this.template=null}get allFieldInputs(){const e=[];for(const t of this.inputs)(0,w.rf)(t)?e.push(t):(0,w.Et)(t)&&e.push(...t.inputs.filter(w.rf));return e}get description(){return this.template?.description??null}get hasInvalidHiddenInputs(){return this.invalidHiddenInputs.length>0}get invalidFeatures(){return Array.from(new Set(this.allFieldInputs.flatMap((e=>e.invalidFeatures))))}get invalidHiddenInputs(){return this.allFieldInputs.filter((e=>!e.valid&&!e.effectiveVisible))}get title(){return this.template?.title??null}get valid(){return this.allFieldInputs.every((e=>e.valid))}};(0,i._)([(0,m.MZ)()],U.prototype,"allFieldInputs",null),(0,i._)([(0,m.MZ)()],U.prototype,"description",null),(0,i._)([(0,m.MZ)()],U.prototype,"inputs",void 0),(0,i._)([(0,m.MZ)()],U.prototype,"hasInvalidHiddenInputs",null),(0,i._)([(0,m.MZ)()],U.prototype,"invalidFeatures",null),(0,i._)([(0,m.MZ)()],U.prototype,"invalidHiddenInputs",null),(0,i._)([(0,m.MZ)()],U.prototype,"template",void 0),(0,i._)([(0,m.MZ)()],U.prototype,"title",null),(0,i._)([(0,m.MZ)()],U.prototype,"valid",null),U=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.inputs.BatchFormInputs")],U);var G=n(89406),Y=n(3266),W=(n(30542),n(19090),n(49445)),X=n(7249),z=n(95011),j=n(79538),J=n(69943);let K=class extends b.default{constructor(e){super(e),this.existsInAllLayers=!0,this.features=new s.default}get description(){return this.template.description}get featuresHaveSameCalculatedVisibility(){const e=new Set;for(const t of this.features){if(null==this.template.getExpressionExecutorsForLayer(t.layer)?.visibilityExpression){e.add(!0);continue}const n=this._lookupEvaluatedExpression(t,"visibility");if("success"===n?.status){if(e.add(!0===n.result),e.size>1)return!1}else e.add(!1)}return e.size<=1}get label(){return this.template.label}get layers(){return Array.from(new Set(this.features.map((e=>e.layer))))}get visibilityCode(){return this._baseVisibilityCode}get visible(){return(0,w.n8)(this.visibilityCode)}get _baseVisibilityCode(){return this.existsInAllLayers?this.featuresHaveSameCalculatedVisibility?!1===this._evaluatedVisibilityExpression?w.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL:w.qp.VISIBLE:w.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME:w.qp.HIDDEN_NOT_IN_ALL_LAYERS}get _evaluatedVisibilityExpression(){let e=!0,t=!0;for(const n of this.features){if(null==this.template.getExpressionExecutorsForLayer(n.layer)?.visibilityExpression){e=e&&!0;continue}t=!1;const i=this._lookupEvaluatedExpression(n,"visibility");e="success"===i?.status&&(e&&!0===i.result)}return t?null:e}_lookupEvaluatedExpression(e,t){return this.expressionsManager.evaluatedExpressions.get(e)?.get((0,w.ng)(this.template.elementId,t))}};(0,i._)([(0,m.MZ)({constructOnly:!0})],K.prototype,"expressionsManager",void 0),(0,i._)([(0,m.MZ)()],K.prototype,"description",null),(0,i._)([(0,m.MZ)()],K.prototype,"existsInAllLayers",void 0),(0,i._)([(0,m.MZ)()],K.prototype,"features",void 0),(0,i._)([(0,m.MZ)()],K.prototype,"featuresHaveSameCalculatedVisibility",null),(0,i._)([(0,m.MZ)()],K.prototype,"label",null),(0,i._)([(0,m.MZ)()],K.prototype,"layers",null),(0,i._)([(0,m.MZ)({constructOnly:!0})],K.prototype,"template",void 0),(0,i._)([(0,m.MZ)()],K.prototype,"visibilityCode",null),(0,i._)([(0,m.MZ)()],K.prototype,"visible",null),(0,i._)([(0,m.MZ)()],K.prototype,"_baseVisibilityCode",null),(0,i._)([(0,m.MZ)()],K.prototype,"_evaluatedVisibilityExpression",null),K=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.inputs.InputBase")],K);let Q=class extends K{constructor(){super(...arguments),this.editType="NA"}get editable(){return this._evaluatedEditableExpression??!0}get _evaluatedEditableExpression(){let e=!0,t=!0;for(const n of this.features){if(null==this.template.getExpressionExecutorsForLayer(n.layer)?.editableExpression){e=e&&!0;continue}t=!1;const i=this._lookupEvaluatedExpression(n,"editable");e="success"===i?.status&&(e&&!0===i.result)}return t?null:e}};(0,i._)([(0,m.MZ)()],Q.prototype,"editable",null),(0,i._)([(0,m.MZ)()],Q.prototype,"editType",void 0),(0,i._)([(0,m.MZ)()],Q.prototype,"_evaluatedEditableExpression",null),Q=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.inputs.EditableInput")],Q);var ee=n(82368);let te=class extends Q{constructor(e){super(e),this.group=null,this.type="field",this.userHasChangedValue=!1,this._hasIntersectionWithElementFieldDomain=!1}get compositeError(){if(this.valid)return null;const{errors:e}=this;if(e.length<this.features.length)return w.uB.DIFFERENT_ERRORS;const t=e[0];for(const n of e)if(n.error!==t.error)return w.uB.DIFFERENT_ERRORS;return t.error}get dataType(){const{field:e}=this;return(0,z.isNumericField)(e)?ee.Kx.Number:(0,z.isStringField)(e)?ee.Kx.Text:(0,j.fs)(e)||(0,z.isTimeOnlyField)(e)?ee.Kx.Date:ee.Kx.Unsupported}get domain(){const e=this._allDomains.toArray();return this.calculateDomain(e)}get distinctValues(){if(this.featuresHaveSameValue)return[this.value];const e=new Set;for(const t of this.features)e.add(t.getAttribute(this.fieldName));return Array.from(e)}get editable(){return!!this.field.editable&&(this._evaluatedEditableExpression??!0)}get effectiveVisible(){return(0,w.n8)(this.effectiveVisibilityCode)}get effectiveVisibilityCode(){const{visibilityCode:e}=this;if(e!==w.qp.VISIBLE)return e;const{group:t}=this;if(null==t)return e;const n=t.visibilityCode;return n===w.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL?w.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL:n===w.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME?w.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME:e}get errors(){return this._validate()}get featuresHaveSameValue(){const{fieldName:e}=this,t=this.features.at(0)?.getAttribute(e);return this.features.every((n=>n.getAttribute(e)===t))}get field(){return this.template.field}get fieldName(){return this.field.name}get invalidFeatures(){return this.errors.map((e=>e.feature))}get isSubtypeField(){return this.layers.some((e=>{if(e&&"subtypeField"in e){const{subtypeField:t,fieldsIndex:n}=e;return(n.get(t)?.name??t)===this.fieldName}return!1}))}get showNoValueOptionEnabled(){const{input:e}=this.template;return!this.required&&(!(0,w.hJ)(e)||!0===e?.showNoValueOption)}get showNoValueLabel(){const{input:e}=this.template;return(0,w.hJ)(e)?e?.noValueOptionLabel:null}get includeTime(){const{template:e,field:t}=this;return this.dataType===ee.Kx.Date&&("time-only"===t.type||"date-only"!==t.type&&("datetime-picker"!==e.input?.type||e.input.includeTime))}get includeTimeOffset(){if("timestamp-offset"!==this.field.type)return!1;const e=this.template.input;return!e||"datetimeoffset-picker"===e.type&&e.includeTimeOffset}get maxLength(){return(0,ee.zU)({dataType:this.dataType,field:this.field,input:this.template.input})}get minLength(){return(0,ee.jl)({dataType:this.dataType,field:this.field,input:this.template.input})}get range(){if("date"===this.dataType)return this._dateRange;const{domain:e,field:t}=this;if(e){const n=(0,X.A5)(t,e);return{max:n?.max,min:n?.min}}const n=this._allDomains.toArray().every((e=>!e))?(0,z.getFieldRange)(t):null;return{max:n?.max===Number.MAX_VALUE?null:n?.max??null,min:n?.min===-Number.MAX_VALUE?null:n?.min??null}}get required(){if(!this.editable)return!1;if(!this.field.nullable||this.isSubtypeField)return!0;const e=this.visible&&!1!==this.group?.visible,t=this._evaluatedRequiredExpression;return!(!e||null==t)&&t}get submittable(){return(!this.required||!this.distinctValues.some((e=>(0,ee.Po)(e))))&&!!this.valid}get valid(){return 0===this.errors.length}get value(){return this.featuresHaveSameValue?this.features.at(0)?.getAttribute(this.fieldName)??null:w.pg}get visibilityCode(){return this.field.visible?this._fieldShouldHaveDomain&&null==this.domain?w.qp.HIDDEN_NO_DOMAIN_IN_COMMON:this._baseVisibilityCode:w.qp.HIDDEN_FIELD_DEFINITION}get effectiveTimeZone(){const e=this.template;let t=e.formTimeZone??"system";return e.layerTimeZone?e.layerTimeZone===g.L5?t=g.n$:e.formTimeZone===g.L5&&(t=e.layerTimeZone):e.formTimeZone===g.L5&&(t=g.n$),t}get codedValueDomainOptions(){return"coded-value"===this.domain?.type?this.domain.codedValues.map((e=>{let{name:t,code:n}=e;return{name:t,value:n}})):[]}get codedValueOptions(){const e=this.codedValueDomainOptions,{value:t}=this,n=null==t||t===w.pg||e.some((e=>e.value===t))?[]:[{name:`${t}`,value:t}];return[e,n]}get _evaluatedRequiredExpression(){let e=!1,t=!0;const n=this.template;for(const i of this.features){if(null==n.getExpressionExecutorsForLayer(i.layer)?.requiredExpression)continue;t=!1;const r=this._lookupEvaluatedExpression(i,"required");e="success"!==r?.status||(e||!0===r.result)}return t?null:e}get _allDomains(){const e=this.template.domain;return this.features.map((t=>{const n=t.layer.getFieldDomain(this.fieldName,{feature:t.plainGraphic});return"range"===n?.type||"range"===e?.type?n??this.template.domain:n}))}get _fieldShouldHaveDomain(){return!!this._hasIntersectionWithElementFieldDomain||this._allDomains.some(D.Ru)}get _dateFormRange(){if("date"!==this.dataType)return{};const e=this.template.input;if(!e)return{};const{type:t}=e;let n={};if("date-picker"!==t&&"time-picker"!==t&&"datetimeoffset-picker"!==t||(n=(0,X.nm)(this.field,e.max,e.min)),"datetime-picker"===t){const{max:t,min:i}=e;n={max:null!=t&&(0,ee.$$)(t)?t.getTime():null,min:null!=i&&(0,ee.$$)(i)?i.getTime():null}}return{min:n.min,max:n.max,rawMax:n?.rawMax??null,rawMin:n?.rawMin??null}}get _dateRange(){const{_dateFormRange:e,template:t,field:n,domain:i}=this;if("date"!==this.dataType)return{};if(!i)return this._fieldShouldHaveDomain?{}:e;const r=(0,X.A5)(n,i);if(!r)return e;const{max:s,min:o,rawMax:a,rawMin:l}=e,{type:u}=t.field;if("date"===u){const{max:e,min:t}=r;return{max:(0,J.Et)(s)&&(null===e||null!=e&&s<=e)?s:e??null,min:(0,J.Et)(o)&&(null===t||null!=t&&o>=t)?o:t??null}}if("date-only"===u||"time-only"===u||"timestamp-offset"===u){const{max:e,min:t,rawMax:n,rawMin:i}=r,u=(0,J.Et)(s)&&a&&(null==e||s<e),d=(0,J.Et)(o)&&l&&(null==t||o>t);return{max:u?s:e,min:d?o:t,rawMax:u?a:n,rawMin:d?l:i}}return{}}async setValueFromUser(e){this.userHasChangedValue=!0;const t=new s.default,n=this.fieldName;for(const i of this.features)i.getAttribute(n)!==e&&t.push(i);this._setValue(e),await this.expressionsManager.valueChanged(n,t)}_setValue(e){const{fieldName:t}=this;for(const n of this.features)n.setAttribute(t,e)}_validate(){const{dataType:e,fieldName:t,maxLength:n,minLength:i,range:r}=this,s=[];for(const o of this.features){const{layer:a}=o,l=a.getField(t)??this.field,u=a.getFieldDomain(t,{feature:o.plainGraphic}),d=this.calculateDomain([u]),p=this._requiredForFeature(o),c=o.getAttribute(t),m=(0,ee.Gd)(c,{dataType:e,domain:d,field:l,maxLength:n,minLength:i,range:r,required:p});m&&s.push({error:m,feature:o.original})}return s}_editableForFeature(e){if(!this.field.editable)return!1;if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.editableExpression)return!0;const t=this._lookupEvaluatedExpression(e,"editable");return"success"===t?.status&&!0===t.result}_effectiveVisibleFeature(e){if(this.group&&!this.group.visibleForFeature(e))return!1;if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.visibilityExpression)return!0;const t=this._lookupEvaluatedExpression(e,"visibility");return"success"===t?.status&&!0===t.result}_requiredForFeature(e){if(!this._editableForFeature(e))return!1;if(!this.field.nullable||this.isSubtypeField)return!0;const t=this._effectiveVisibleFeature(e);if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.requiredExpression)return!1;const n=this._lookupEvaluatedExpression(e,"required");return"success"!==n?.status?t:t&&!0===n.result}calculateDomain(e){const t=e.find((e=>null!=e)),n=this.template.domain;if(!t)return n&&(0,X.QZ)(this.field,n)?n:null;switch(t.type){case"coded-value":if(e.some((e=>!e))){if(!n)return null;e=e.filter((e=>null!==e))}break;case"range":e=e.filter((e=>null!==e))}if(!e.every((e=>e?.type===t?.type)))return null;let i=null;switch(t?.type){case"range":i=this._intersectRangeDomains(e);break;case"coded-value":i=this._intersectCodedValueDomains(e)}return i}_intersectCodedValueDomains(e){if(!e.length)return null;const t=new Map(e[0].codedValues.map((e=>{let{code:t,name:n}=e;return[t,n]}))),n=this.template.domain?new Map(this.template.domain.codedValues.map((e=>{let{code:t,name:n}=e;return[t,n]}))):null;for(const s of e)for(const[e,n]of t)s.codedValues.some((t=>t.code===e&&t.name===n))||t.delete(e);let i=t;if(n){i=new Map;for(const[e,r]of n)t.has(e)&&i.set(e,r)}const r=Array.from(i.entries()).map((e=>{let[t,n]=e;return new G.H({code:t,name:n})}));return r.length?new Y.default({codedValues:r}):null}_intersectRangeDomains(e){if(!e.length)return null;let t=e[0];if(e.length>1&&(t=e.reduce(((e,t)=>this._findMinMaxValuesBetweenTwoDomains(e,t)||null),t)),t&&!(0,X.QZ)(this.field,t))return null;const{domain:n}=this.template;if(t&&n&&n instanceof W.default){const e=this._findMinMaxValuesBetweenTwoDomains(t,n);return this._hasIntersectionWithElementFieldDomain=!!e,e}return t}_getMinMaxFromRangeDomain(e){const t=e.minValue,n=e.maxValue,{field:i}=this;return(0,z.isDateOnlyField)(i)||(0,z.isTimeOnlyField)(i)||(0,z.isTimestampOffsetField)(i)?(0,X.nm)(i,n,t):{min:null!=t&&"number"==typeof t?t:null,max:null!=n&&"number"==typeof n?n:null}}_findMinMaxValuesBetweenTwoDomains(e,t){const n=new W.default,i=this._getMinMaxFromRangeDomain(e),r=this._getMinMaxFromRangeDomain(t),{field:s}=this,o=this._getValidRangeValue(i.min,-1/0),a=this._getValidRangeValue(i.max,1/0),l=this._getValidRangeValue(r.min,-1/0),u=this._getValidRangeValue(r.max,1/0);return n.minValue=Math.max(o,l),n.maxValue=Math.min(a,u),n.minValue===-1/0||n.maxValue===1/0||n.minValue>n.maxValue?null:(((0,z.isDateOnlyField)(s)||(0,z.isTimeOnlyField)(s)||(0,z.isTimestampOffsetField)(s))&&(n.minValue=Number(i.min)>Number(r.min)?i.rawMin:r.rawMin,n.maxValue=Number(i.max)<Number(r.max)?i.rawMax:r.rawMax),n.name="intersection",n)}_getValidRangeValue(e,t){return(0,J.Et)(e)?e:t}};(0,i._)([(0,m.MZ)()],te.prototype,"dataType",null),(0,i._)([(0,m.MZ)()],te.prototype,"domain",null),(0,i._)([(0,m.MZ)()],te.prototype,"distinctValues",null),(0,i._)([(0,m.MZ)()],te.prototype,"editable",null),(0,i._)([(0,m.MZ)()],te.prototype,"effectiveVisible",null),(0,i._)([(0,m.MZ)()],te.prototype,"effectiveVisibilityCode",null),(0,i._)([(0,m.MZ)()],te.prototype,"errors",null),(0,i._)([(0,m.MZ)()],te.prototype,"featuresHaveSameValue",null),(0,i._)([(0,m.MZ)()],te.prototype,"field",null),(0,i._)([(0,m.MZ)()],te.prototype,"fieldName",null),(0,i._)([(0,m.MZ)()],te.prototype,"group",void 0),(0,i._)([(0,m.MZ)()],te.prototype,"invalidFeatures",null),(0,i._)([(0,m.MZ)()],te.prototype,"isSubtypeField",null),(0,i._)([(0,m.MZ)()],te.prototype,"showNoValueOptionEnabled",null),(0,i._)([(0,m.MZ)()],te.prototype,"includeTime",null),(0,i._)([(0,m.MZ)()],te.prototype,"includeTimeOffset",null),(0,i._)([(0,m.MZ)()],te.prototype,"maxLength",null),(0,i._)([(0,m.MZ)()],te.prototype,"minLength",null),(0,i._)([(0,m.MZ)()],te.prototype,"range",null),(0,i._)([(0,m.MZ)()],te.prototype,"required",null),(0,i._)([(0,m.MZ)()],te.prototype,"submittable",null),(0,i._)([(0,m.MZ)({readOnly:!0})],te.prototype,"type",void 0),(0,i._)([(0,m.MZ)()],te.prototype,"userHasChangedValue",void 0),(0,i._)([(0,m.MZ)()],te.prototype,"valid",null),(0,i._)([(0,m.MZ)()],te.prototype,"value",null),(0,i._)([(0,m.MZ)()],te.prototype,"visibilityCode",null),(0,i._)([(0,m.MZ)()],te.prototype,"effectiveTimeZone",null),(0,i._)([(0,m.MZ)()],te.prototype,"_evaluatedRequiredExpression",null),(0,i._)([(0,m.MZ)()],te.prototype,"_hasIntersectionWithElementFieldDomain",void 0),(0,i._)([(0,m.MZ)()],te.prototype,"_allDomains",null),(0,i._)([(0,m.MZ)()],te.prototype,"_fieldShouldHaveDomain",null),(0,i._)([(0,m.MZ)()],te.prototype,"_dateFormRange",null),(0,i._)([(0,m.MZ)()],te.prototype,"_dateRange",null),te=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.inputs.FieldInput")],te);let ne=class extends K{constructor(e){super(e),this.inputs=[],this.type="group"}initialize(){for(const e of this.inputs)e.group=this}get open(){return"expanded"===this.template.initialState}set open(e){this._override("open",e)}get visible(){return(0,w.n8)(this.visibilityCode)&&this.inputs.some((e=>e.visible))}visibleForFeature(e){if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.visibilityExpression)return!0;const t=this._lookupEvaluatedExpression(e,"visibility");return"success"===t?.status&&!0===t.result}};function ie(e,t,n){const i=e.elements.map((e=>re(e,t,n)));return new U({inputs:i,template:e})}function re(e,t,n){const i=new Set(e.layers),r=t.filter((e=>i.has(e.layer))),s=r.length===t.length;if(T(e))return new te({existsInAllLayers:s,features:r,template:e,expressionsManager:n});if(Z(e)){const i=e.elements.map((e=>re(e,t,n)));return new ne({existsInAllLayers:s,features:r,inputs:i,template:e,expressionsManager:n})}throw new o.default("batch-attribute-form:unsupported-element-template","The type of form element template provided is not supported")}(0,i._)([(0,m.MZ)()],ne.prototype,"inputs",void 0),(0,i._)([(0,m.MZ)({readOnly:!0})],ne.prototype,"type",void 0),(0,i._)([(0,m.MZ)()],ne.prototype,"open",null),(0,i._)([(0,m.MZ)()],ne.prototype,"visible",null),ne=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.inputs.GroupInput")],ne);let se=class extends b.default{constructor(e){super(e),this.description=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}get elementsFlat(){const e=[];for(const t of this.elements)if(e.push(t),Z(t))for(const n of t.elements)e.push(n);return e}get elementsInCommon(){const e=this.layers.length;return this.elements.filter((t=>t.layers.length===e))}get layers(){const e=new Set(this.elements.flatMap((e=>e.layers)));return Array.from(e)}getExpressionExecutorsForLayer(e){const t=new Map;for(const n of this.elementsFlat)n.layers.includes(e)&&t.set(n,n.getExpressionExecutorsForLayer(e));return t}};(0,i._)([(0,m.MZ)()],se.prototype,"description",void 0),(0,i._)([(0,m.MZ)()],se.prototype,"elements",void 0),(0,i._)([(0,m.MZ)()],se.prototype,"elementsFlat",null),(0,i._)([(0,m.MZ)()],se.prototype,"elementsInCommon",null),(0,i._)([(0,m.MZ)()],se.prototype,"layers",null),(0,i._)([(0,m.MZ)()],se.prototype,"preserveFieldValuesWhenHidden",void 0),(0,i._)([(0,m.MZ)()],se.prototype,"title",void 0),se=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.templates.BatchFormTemplate")],se);const oe=se;var ae=n(20119),le=n(78076);const ue=new Map;async function de(e){if(!(e=(0,le.Sv)(e)?e.parent:"feature"===e?.type?e:null))return null;const t=(0,I.tE)(ue,e,(()=>{const t=ae.A.createLoadedLayerContingentValuesCache(e);return e.addHandles({remove(){ue.delete(e)}}),t}));return await t??null}var pe=n(22872),ce=n(96299);async function me(e){let{element:t,expressionInfos:n,provider:i}=e;const r={};if(t.visibilityExpression){const e=n.get(t.visibilityExpression);r.visibilityExpression=e?await i.getArcadeExecutor(e.expression):void 0}if("editableExpression"in t&&t.editableExpression){const e=n.get(t.editableExpression);r.editableExpression=e?await i.getArcadeExecutor(e.expression):void 0}if("requiredExpression"in t&&t.requiredExpression){const e=n.get(t.requiredExpression);r.requiredExpression=e?await i.getArcadeExecutor(e.expression):void 0}if("valueExpression"in t&&t.valueExpression){const e=n.get(t.valueExpression);r.valueExpression=e?await i.getArcadeExecutor(e.expression):void 0}return r}var fe=n(85715),he=n(56612);const ye="";function ge(e){return T(e)?(0,he.Wm)((t=e,`${_e(t)}.${function(e){const t=e.name,n=e.alias??ye;return`${t}.${n===t?ye:n}.${e.nullable}.${e.type}.${e.length??ye}.${e.defaultValue??ye}.${e.description??ye}.${e.editable}.${e.visible}`}(t.field)}.${function(e){return e?"coded-value"===e.type?function(e){const{type:t}=e;return`${t}.${e.codedValues.map((e=>{let{code:t,name:n}=e;return`${xe(t)}.${n}`})).sort().join(".")}`}(e):"range"===e.type?function(e){const{maxValue:t,minValue:n,type:i}=e;return`${i}.${n}.${t}`}(e):JSON.stringify(e):ye}(t.domain)}.${t.hint??ye}.${function(e){if(!e)return ye;const{type:t}=e;if(function(e){return"barcode-scanner"===e.type}(e))return t??ye;if(function(e){return"combo-box"===e.type}(e)||function(e){return"radio-buttons"===e.type}(e)){const{showNoValueOption:n}=e;return`${t}.${n}.${e.noValueOptionLabel??ye}`}if(function(e){return"date-picker"===e.type}(e))return`${t}.${ve(e)}`;if(function(e){return"datetime-picker"===e.type}(e)){const n=e.min?.getTime(),i=e.max?.getTime(),{includeTime:r}=e;return`${t}.${n}.${i}.${r}`}if(function(e){return"datetimeoffset-picker"===e.type}(e)){const n=ve(e),{includeTimeOffset:i,timeResolution:r}=e;return`${t}.${n}.${i}.${r}`}if(function(e){return"switch"===e.type}(e)){const{offValue:n,onValue:i}=e;return`${t}.${xe(n)}.${xe(i)}`}if(function(e){return"text-area"===e.type}(e)||function(e){return"text-box"===e.type}(e))return`${t}.${e.minLength?.toString()??ye}.${e.maxLength?.toString()??ye}`;if(function(e){return"time-picker"===e.type}(e)){const n=ve(e),{timeResolution:i}=e;return`${t}.${n}.${i}`}return JSON.stringify(e)}(t.input)}.${t.layerTimeZone??""}`)).toString():Z(e)?(0,he.Wm)(function(e){const t=_e(e)+`.${e.initialState}`;let n=ye;for(const i of e.elements)n+="."+ge(i).toString();return`${t}${n}`}(e)).toString():(0,he.Wm)(JSON.stringify(e)).toString();var t}function _e(e){return`${e.label??ye}.${e.description??ye}`}function ve(e){return`${e.min??ye}.${e.max??ye}`}function xe(e){return"number"==typeof e?`num:${e}`:e}let Ee=class extends fe.A{constructor(e){super(e),this.description=null,this.label=null,this._expressionExecutorsByLayer=new p.A}get elementId(){return ge(this)}get layers(){return Array.from(this._expressionExecutorsByLayer.keys())}addLayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._expressionExecutorsByLayer.set(e,t)}foldIn(e){for(const t of e.layers)this.addLayer(t,e.getExpressionExecutorsForLayer(t))}getExpressionExecutorsForLayer(e){return this._expressionExecutorsByLayer.get(e)??null}};(0,i._)([(0,m.MZ)()],Ee.prototype,"description",void 0),(0,i._)([(0,m.MZ)({readOnly:!0})],Ee.prototype,"elementId",null),(0,i._)([(0,m.MZ)()],Ee.prototype,"label",void 0),(0,i._)([(0,m.MZ)({readOnly:!0})],Ee.prototype,"layers",null),(0,i._)([(0,m.MZ)({readOnly:!0})],Ee.prototype,"type",void 0),(0,i._)([(0,m.MZ)({clonable:e=>new p.A(Array.from(e))})],Ee.prototype,"_expressionExecutorsByLayer",void 0),Ee=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.templates.ElementTemplateBase")],Ee);let be=class extends Ee{constructor(e){super(e),this.domain=null,this.group=null,this.hint=null,this.input=null,this.type="field",this.layerTimeZone=null,this.formTimeZone=null}get fieldName(){return this.field.name}get hasValueCalculations(){for(const e of this.layers){const t=this.getExpressionExecutorsForLayer(e);if(t?.valueExpression)return!0}return!1}};(0,i._)([(0,m.MZ)({clonable:"reference"})],be.prototype,"domain",void 0),(0,i._)([(0,m.MZ)({clonable:"reference",constructOnly:!0})],be.prototype,"field",void 0),(0,i._)([(0,m.MZ)()],be.prototype,"fieldName",null),(0,i._)([(0,m.MZ)({clonable:!1})],be.prototype,"group",void 0),(0,i._)([(0,m.MZ)()],be.prototype,"hint",void 0),(0,i._)([(0,m.MZ)()],be.prototype,"input",void 0),(0,i._)([(0,m.MZ)()],be.prototype,"type",void 0),(0,i._)([(0,m.MZ)()],be.prototype,"layerTimeZone",void 0),(0,i._)([(0,m.MZ)()],be.prototype,"formTimeZone",void 0),(0,i._)([(0,m.MZ)()],be.prototype,"hasValueCalculations",null),be=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.templates.FieldElementTemplate")],be);let Ie=class extends Ee{constructor(e){super(e),this.initialState="expanded",this.type="group"}initialize(){for(const e of this.elements)e.group=this}foldIn(e){const{elements:t}=this,n=e.elements;if(t.length!==n.length)throw new o.default("unable-to-fold-in","Unable to fold in the given GroupElementTemplate because it has a different number of child elements");for(const i of e.layers){this.addLayer(i,e.getExpressionExecutorsForLayer(i));for(let e=0;e<t.length;e++)t.at(e).foldIn(n.at(e))}}};(0,i._)([(0,m.MZ)()],Ie.prototype,"initialState",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],Ie.prototype,"elements",void 0),(0,i._)([(0,m.MZ)()],Ie.prototype,"type",void 0),Ie=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.templates.GroupElementTemplate")],Ie);const Me="expression/dea57012-47ca4b55a000-8df62742ed0c",Fe=()=>l.A.getLogger("esri.widgets.BatchAttributeForm.templates.templateUtils");async function we(e,t){return e.formTemplate?.elements&&e.formTemplate?.elements.length>0?async function(e,t){const n=e.formTemplate;if(!n)return Te(e,t);let i=null;Ze(n.elements??[],e)&&(i=new pe.default({title:"",name:Me,expression:"false"}));const r=function(e){return new Map(e?.map((e=>[e.name,e])))}(i?[...n.expressionInfos??[],i]:n.expressionInfos),s={description:n.description,elements:new Array,title:n.title,preserveFieldValuesWhenHidden:n.preserveFieldValuesWhenHidden},{elements:o}=n;if(!o)return new oe(s);const{arcadeExecutorProvider:a,formTimeZone:l}=t;for(const u of o){const t=await Se(u,{arcadeExecutorProvider:a,expressionInfos:r,layer:e,formTimeZone:l});t&&s.elements.push(t)}return new oe(s)}(e,t):Te(e,t)}async function Te(e,t){let{arcadeExecutorProvider:n,formTimeZone:i}=t;const r=new Set((0,z.getLowerCaseEditTrackingFields)(e)),s={arcadeExecutorProvider:n,editTrackingFields:r,formTimeZone:i,layer:e},o=[];for(const l of e.fields)Ne(l,e,r)&&o.push(Ve(l,s));const a=await Promise.all(o);return new oe({elements:a,preserveFieldValuesWhenHidden:!0})}function Ze(e,t){for(const n of e??[])if("group"!==n.type){if("field"===n.type){if(!1===n.editable&&!n.editableExpression)return!0;if(t.subtypeField&&((0,le.Sv)(t)||(0,le.F2)(t))&&n.fieldName?.toLowerCase()===t.subtypeField.toLowerCase())return!0}}else if(Ze(n.elements??[],t))return!0;return!1}async function Se(e,t){return(0,ce.jt)(e)?async function(e,t){let{arcadeExecutorProvider:n,expressionInfos:i,layer:r,formTimeZone:s}=t;const{fieldsIndex:a}=r,{description:l,domain:u,fieldName:d,hint:p,input:c,label:m}=e;if(null==d||!a.has(d))return Fe().warn(new o.default("batch-attribute-form:invalid-form-element-field",`Field element with label '${m}' does not refer to a valid field`)),null;const f={description:l,domain:u,field:a.get(d),hint:p,input:c,formTimeZone:s,layerTimeZone:Oe(r),label:m};!1!==e.editable||e.editableExpression||((e=e.clone()).editableExpression=Me),r.subtypeField&&((0,le.Sv)(r)||(0,le.F2)(r))&&e.fieldName?.toLowerCase()===r.subtypeField.toLowerCase()&&((e=e.clone()).editableExpression=Me);const h=new be(f),y=await me({element:e,expressionInfos:i,provider:n});return h.addLayer(r,y),h}(e,t):(0,ce.CG)(e)?async function(e,t){const{arcadeExecutorProvider:n,expressionInfos:i,layer:r}=t,{description:s,label:o,initialState:a}=e,l={description:s,elements:[],label:o,initialState:a??"expanded"};for(const p of e.elements){const e=await Se(p,t);e&&l.elements.push(e)}const u=new Ie(l),d=await me({element:e,expressionInfos:i,provider:n});return u.addLayer(r,d),u}(e,t):(Fe().warn(new o.default("batch-attribute-form:unsupported-element-type",`Form elements of type ${e.type} are not supported`)),null)}async function Ve(e,t){let{arcadeExecutorProvider:n,layer:i,formTimeZone:r}=t;const s=new be({field:e,label:e.alias??e.name,formTimeZone:r,layerTimeZone:Oe(i)}),o={},a=((0,le.F2)(i)||(0,le.Sv)(i))&&i.subtypeField&&i.subtypeField.toLowerCase()===e.name.toLowerCase();return!a&&e.editable&&i.userHasUpdateItemPrivileges&&(o.editableExpression=await n.getArcadeExecutor("true")),a&&(o.editableExpression=await n.getArcadeExecutor("false")),s.addLayer(i,o),s}function Ne(e,t,n){return!n.has(e.name.toLowerCase())&&(0,z.isFieldVisibleByDefault)(e,t)}function Oe(e){return(0,le.Sv)(e)&&e.parent&&(e=e.parent),e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone?g.L5:e&&"preferredTimeZone"in e&&e.preferredTimeZone?e.preferredTimeZone:null}let Le=class extends a.A.EventedAccessor{constructor(e){super(e),this.activeFeatureIndex=-1,this.disabled=!1,this.editType="NA",this.features=new s.default,this.map=null,this.spatialReference=null,this.submitHasBeenAttempted=!1,this.timeZone=null,this.userHasChangedValues=!1,this._arcadeExecutorProvider=new E,this._activeFormInputsByElementId=new Map,this._emptyForm=new U({inputs:[]}),this._emptyFormTemplate=new oe({elements:[]}),this._featureFormMap=new Map,this._prepareTask=null,this._reactiveGraphicLookup=new p.A,this._updatingHandles=new h.U,this._layerTemplateMap=new p.A,this._layerContingentValuesMap=new p.A,this._workingFeatures=new s.default,this._expressionsManager=new O({arcadeContext:{editType:"NA",spatialReference:null,map:null,timeZone:g.qU}}),this.sharedForm=this._emptyForm,this.sharedFormTemplate=this._emptyFormTemplate}initialize(){this.addHandles([(0,c.on)((()=>this.features),"after-changes",(()=>this._prepare()),{sync:!0}),(0,c.watch)((()=>[this.features,this.map,this.timeZone,this.editType]),(()=>{this._prepare()}),c.sync),(0,c.watch)((()=>this.activeForm),(()=>this._activeFormInputsByElementId.clear()),c.sync)]),this._prepare()}destroy(){this._prepareTask=(0,u.DC)(this._prepareTask),this._workingFeatures.destroyAll(),this._expressionsManager&&this._expressionsManager.abort(),this._reactiveGraphicLookup=new p.A,this._emptyForm.destroy(),this._emptyFormTemplate.destroy()}get _effectiveTimeZone(){return this.timeZone??"system"}get activeFeature(){const e=this.activeFeatureIndex;return e<0?null:this.features.at(e)}get activeForm(){if("batch"===this.mode)return this.sharedForm;const e=this._workingFeatures.at(this.activeFeatureIndex);if(!e)return this._emptyForm;const t=this._featureFormMap.get(e);if(t)return t;const n=this._makeBatchFormInputsForFeature(e);return n!==this._emptyForm&&this._featureFormMap.set(e,n),n}get calculating(){return this._expressionsManager.calculating}get expressionEvaluationFailed(){return this._expressionsManager.expressionEvaluationFailed}get hasNonActiveInvalidFeatures(){if("batch"===this.mode)return!1;const{activeFeature:e}=this;return this.invalidFeatures.some((t=>t!==e))}get invalidFeatures(){return this.sharedForm.invalidFeatures}get hasVisibleInputs(){return this.visibleInputs.length>0}get hasLayersWithContingentValues(){for(const e of this.layers){const t=this._layerContingentValuesMap.get(e);if(t&&t.size>0)return!0}return!1}get visibleInputs(){return this.activeForm.inputs.filter((e=>e.visible))}get noVisibleElementsReason(){if(this.hasVisibleInputs)return null;if(0===this.activeForm.inputs.length)return w.sO.noElements;const e=new Set;for(const t of this.activeForm.inputs)switch(t.visibilityCode){case w.qp.HIDDEN_NOT_IN_ALL_LAYERS:case w.qp.HIDDEN_NO_DOMAIN_IN_COMMON:e.add(w.sO.noElementsInCommon);break;case w.qp.HIDDEN_FIELD_DEFINITION:case w.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL:case w.qp.HIDDEN_VISIBILITY_EXPRESSION_ALL:e.add(w.sO.allElementsHidden);break;case w.qp.HIDDEN_GROUP_VISIBILITY_EXPRESSION_SOME:case w.qp.HIDDEN_VISIBILITY_EXPRESSION_SOME:return w.sO.elementsHiddenInSome}return e.has(w.sO.allElementsHidden)?w.sO.allElementsHidden:w.sO.noElementsInCommon}get status(){const e=this._prepareTask;return null==e?"not-loaded":e.finished?null!=e.error?"failed":"loaded":"loading"}get submittable(){return this.valid,!0}get updating(){return this._updatingHandles.updating||this.calculating}get valid(){return this.sharedForm.valid}get layers(){const e=new Set;return this.features.forEach((t=>{const n=t.sourceLayer??t.layer;e.add(n)})),Array.from(e)}get mode(){return this.activeFeatureIndex>-1?"single":"batch"}submit(){this.submitHasBeenAttempted=!0,this.emit("submit",{})}findFieldInput(e){if(null==e)return;const t=this._activeFormInputsByElementId;if(t.has(e))return t.get(e);const n=this.activeForm.allFieldInputs.find((t=>t.template.elementId===e));return void 0!==n?(t.set(e,n),n):void 0}getFirstVisibleInvalidFieldInput(){if(this.hasVisibleInputs&&!this.activeForm.valid)for(const e of this.visibleInputs){if((0,w.Et)(e)){const t=e.inputs.find((e=>!e.valid));if(t)return{input:t,groupInput:e}}if((0,w.rf)(e)&&!e.valid)return{input:e}}}getFieldInputValue(e){return this.findFieldInput(e)?.value}getValues(e){const t=this._workingFeatures.find((t=>{let{original:n}=t;return n===e}));if(!t)throw new o.default("feature-not-found","The given feature is not present in the BatchAttributeForm");return{...t.attributes}}setFieldInputValue(e,t){const n=new Set(this.invalidFeatures);e.setValueFromUser(t),this.userHasChangedValues=!0,this._trackValidityChange(n),this.emit("value-change",{features:e.features.toArray().map((e=>e.original)),fieldName:e.fieldName,name:"value-change",value:t})}setValue(e,t){const n=this.findFieldInput(e);if(null==n)throw new o.default("no-FieldInput-found",`Cannot set the value of FieldInput with ID: ${e} because none was found in the active form`);this.setFieldInputValue(n,t)}userChangesHaveMadeFeatureInvalid(e){return!!this._reactiveGraphicLookup.get(e)?.userChangesHaveMadeInvalid}async _trackValidityChange(e){await(0,c.whenOnce)((()=>!1===this.calculating));const t=this.invalidFeatures;for(const n of t)!1===e.has(n)&&this._reactiveGraphicLookup.has(n)&&(this._reactiveGraphicLookup.get(n).userChangesHaveMadeInvalid=!0)}validate(){return!1}_makeBatchFormInputsForFeature(e){const t=this._layerTemplateMap.get(e.layer);return t?ie(t,new s.default([e]),this._expressionsManager):this._emptyForm}async _prepare(){this._prepareTask=(0,u.DC)(this._prepareTask),this._updateWorkingFeatures(),(0,u.DC)(this._expressionsManager),this.userHasChangedValues=!1,this._expressionsManager=new O({arcadeContext:{editType:this.editType,spatialReference:this.spatialReference??y.default.WebMercator,map:this.map,timeZone:this._effectiveTimeZone}});const{layers:e}=this;if(0===e.length)return;const t=(0,r.UT)((async n=>{try{(0,d.throwIfAborted)(n);const t=new Map;for(const n of e){const e=await de(n);if(e){const t=e.fieldGroups.flatMap((e=>e.fields));this._layerContingentValuesMap.set(n,new Set(t))}else this._layerContingentValuesMap.set(n,new Set);const i=await we(n,{arcadeExecutorProvider:this._arcadeExecutorProvider,formTimeZone:this._effectiveTimeZone});this._layerTemplateMap.set(n,i),this._expressionsManager.layerExpressionsModelMap.set(n,new $({preserveFieldValuesWhenHidden:i.preserveFieldValuesWhenHidden,executorMap:i.getExpressionExecutorsForLayer(n)}));for(const n of i.elements){const{elementId:e}=n;t.has(e)?t.get(e).foldIn(n):t.set(e,n.clone())}}const i=new oe({elements:Array.from(t.values())});this.sharedFormTemplate=i,this.sharedForm=ie(i,this._workingFeatures,this._expressionsManager),await this._expressionsManager.runAllExpressions(this._workingFeatures)}catch(t){throw l.A.getLogger(this).error("Failed preparing form",t),t}}));this._updatingHandles.addPromise(t.promise),this._prepareTask=t}_updateWorkingFeatures(){this._workingFeatures.destroyAll();const{features:e}=this;if(this._reactiveGraphicLookup=new p.A,0!==e.length){this._workingFeatures.addMany(e.map(_.IS));for(const e of this._workingFeatures)this._reactiveGraphicLookup.set(e.original,e)}}};(0,i._)([(0,m.MZ)()],Le.prototype,"_effectiveTimeZone",null),(0,i._)([(0,m.MZ)({readOnly:!0})],Le.prototype,"activeFeature",null),(0,i._)([(0,m.MZ)()],Le.prototype,"activeFeatureIndex",void 0),(0,i._)([(0,m.MZ)({readOnly:!0})],Le.prototype,"activeForm",null),(0,i._)([(0,m.MZ)()],Le.prototype,"disabled",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"calculating",null),(0,i._)([(0,m.MZ)()],Le.prototype,"editType",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"features",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"expressionEvaluationFailed",null),(0,i._)([(0,m.MZ)()],Le.prototype,"hasNonActiveInvalidFeatures",null),(0,i._)([(0,m.MZ)()],Le.prototype,"invalidFeatures",null),(0,i._)([(0,m.MZ)()],Le.prototype,"hasVisibleInputs",null),(0,i._)([(0,m.MZ)()],Le.prototype,"hasLayersWithContingentValues",null),(0,i._)([(0,m.MZ)()],Le.prototype,"visibleInputs",null),(0,i._)([(0,m.MZ)()],Le.prototype,"map",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"noVisibleElementsReason",null),(0,i._)([(0,m.MZ)()],Le.prototype,"spatialReference",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"submitHasBeenAttempted",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"timeZone",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"updating",null),(0,i._)([(0,m.MZ)()],Le.prototype,"valid",null),(0,i._)([(0,m.MZ)()],Le.prototype,"layers",null),(0,i._)([(0,m.MZ)()],Le.prototype,"mode",null),(0,i._)([(0,m.MZ)()],Le.prototype,"sharedForm",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"sharedFormTemplate",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"userHasChangedValues",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"_arcadeExecutorProvider",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"_prepareTask",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"_reactiveGraphicLookup",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"_layerTemplateMap",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"_layerContingentValuesMap",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"_workingFeatures",void 0),(0,i._)([(0,m.MZ)()],Le.prototype,"_expressionsManager",void 0),Le=(0,i._)([(0,f.$)("esri.widgets.BatchAttributeForm.BatchAttributeFormViewModel")],Le);const Ae=Le}}]);