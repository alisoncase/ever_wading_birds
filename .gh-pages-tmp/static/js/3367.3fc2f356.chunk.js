"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[3367],{769:(e,t,r)=>{r.d(t,{c:()=>s});var o=r(16878),n=r(22131);function s(e,t){t.hasVertexColors?(e.attributes.add(n.r.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(o.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(o.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(o.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},4127:(e,t,r)=>{r.d(t,{EM:()=>g,dO:()=>p,em:()=>v});var o=r(13473),n=r(10382),s=r(28473),a=r(84025),i=r(31500),l=r(8815),f=r(57554),c=r(16878),d=r(91018),u=r(80203),h=r(94320),m=r(20783);function v(e,t){e.include(a.I);const r=e.vertex;r.include(i.u,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add(new f.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new f.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new u.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new h.X("transformProjFromView",(e=>e.transformProjFromView)),new d.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new l.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new l.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),r.code.add(c.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(c.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?c.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:c.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new f.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),r.code.add(c.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(c.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class p extends m.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,s.vt)(),this.transformWorldFromViewTL=(0,s.vt)(),this.transformViewFromCameraRelativeRS=(0,o.vt)(),this.transformProjFromView=(0,n.vt)()}}class g extends m.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,o.vt)(),this.transformWorldFromModelTH=(0,s.vt)(),this.transformWorldFromModelTL=(0,s.vt)()}}},13473:(e,t,r)=>{function o(){return[1,0,0,0,1,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function s(e,t,r,o,n,s,a,i,l){return[e,t,r,o,n,s,a,i,l]}r.d(t,{fA:()=>s,o8:()=>n,vt:()=>o,zK:()=>a});const a=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:a,clone:n,create:o,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},31500:(e,t,r)=>{r.d(t,{u:()=>n});var o=r(16878);function n(e,t){let{code:r}=e;t.doublePrecisionRequiresObfuscation?r.add(o.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):r.add(o.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}},40753:(e,t,r)=>{r.d(t,{a:()=>d,b:()=>i,c:()=>a,d:()=>n,e:()=>u,f:()=>c,l:()=>f,n:()=>h,t:()=>s});var o=r(8601);r(21265),r(50925);function n(e,t,r){s(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function s(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o;if(e.length/o!==Math.ceil(t.length/n))return e;const s=e.length/o,a=r[0],i=r[1],l=r[2],f=r[4],c=r[5],d=r[6],u=r[8],h=r[9],m=r[10],v=r[12],p=r[13],g=r[14];let y=0,w=0;for(let _=0;_<s;_++){const r=t[y],s=t[y+1],_=t[y+2];e[w]=a*r+f*s+u*_+v,e[w+1]=i*r+c*s+h*_+p,e[w+2]=l*r+d*s+m*_+g,y+=n,w+=o}return e}function a(e,t,r){i(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function i(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o;if(e.length/o!==Math.ceil(t.length/n))return;const s=e.length/o,a=r[0],i=r[1],l=r[2],f=r[3],c=r[4],d=r[5],u=r[6],h=r[7],m=r[8];let v=0,p=0;for(let g=0;g<s;g++){const r=t[v],s=t[v+1],g=t[v+2];e[p]=a*r+f*s+u*g,e[p+1]=i*r+c*s+h*g,e[p+2]=l*r+d*s+m*g,v+=n,p+=o}}function l(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o;const s=Math.min(e.length/o,t.length/n);let a=0,i=0;for(let l=0;l<s;l++)e[i]=r*t[a],e[i+1]=r*t[a+1],e[i+2]=r*t[a+2],a+=n,i+=o;return e}function f(e,t,r,o){c(e.typedBuffer,t.typedBuffer,r,o,e.typedBufferStride,t.typedBufferStride)}function c(e,t,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s;const i=Math.min(e.length/s,t.length/a);let l=0,f=0;const c=1/o.Tf;for(let o=0;o<i;o++)e[f]=n*(r*t[l])**c,e[f+1]=n*(r*t[l+1])**c,e[f+2]=n*(r*t[l+2])**c,l+=a,f+=s}function d(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o;const s=e.length/o;if(s!==Math.ceil(t.length/n))return e;let a=0,i=0;for(let l=0;l<s;l++)e[i]=t[a]+r[0],e[i+1]=t[a+1]+r[1],e[i+2]=t[a+2]+r[2],a+=n,i+=o;return e}function u(e,t){h(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;const n=Math.min(e.length/r,t.length/o);let s=0,a=0;for(let i=0;i<n;i++){const n=t[s],i=t[s+1],l=t[s+2],f=n*n+i*i+l*l;if(f>0){const t=1/Math.sqrt(f);e[a]=t*n,e[a+1]=t*i,e[a+2]=t*l}s+=o,a+=r}}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:c,linearToSRGBView:f,normalize:h,normalizeView:u,scale:l,scaleView:function(e,t,r){l(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)},shiftRight:function(e,t,r){const o=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,i=t.typedBufferStride;let l=0,f=0;for(let c=0;c<o;c++)n[f]=a[l]>>r,n[f+1]=a[l+1]>>r,n[f+2]=a[l+2]>>r,l+=i,f+=s},transformMat3:i,transformMat3View:a,transformMat4:s,transformMat4View:n,translate:d},Symbol.toStringTag,{value:"Module"}))},42080:(e,t,r)=>{r.d(t,{$B:()=>n,Qf:()=>f,Qh:()=>i,RS:()=>s,ez:()=>u,i5:()=>h,lM:()=>a,qK:()=>d,rq:()=>c});var o=r(25048);function n(e){return 32+e.length}const s=16;function a(e){if(!e)return 0;let t=d;for(const r in e)e.hasOwnProperty(r)&&(t+=l(e[r],!1));return t}function i(e){if(!e)return 0;if("number"==typeof e[0])return f(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return c(e,8);let r=u;for(let o=0;o<t;o++)r+=l(e[o]);return r}(e);let t=d;for(const r in e)e.hasOwnProperty(r)&&(t+=l(e[r]));return t}function l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?i(e):d;case"string":return n(e);case"number":return s;case"boolean":return 4;default:return 8}}function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(((e,t)=>e+(t?(0,o.iu)(t)?t.byteLength+h:Array.isArray(t)?c(t,s):0:0)),0)}function c(e,t){return u+e.length*t}const d=32,u=16,h=145},49443:(e,t,r)=>{r.d(t,{Mu:()=>i,i$:()=>f,oD:()=>c,xJ:()=>l});var o=r(96236),n=r(4127),s=r(15025),a=r(16878);function i(e){e.varyings.add("linearDepth","float")}function l(e){e.vertex.uniforms.add(new s.E("nearFar",(e=>e.camera.nearFar)))}function f(e){e.vertex.code.add(a.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function c(e,t){const{vertex:r}=e;switch(t.output){case o.V.Color:case o.V.ColorEmission:if(t.receiveShadows)return i(e),void r.code.add(a.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case o.V.Shadow:case o.V.ShadowHighlight:case o.V.ShadowExcludeHighlight:case o.V.ViewshedShadow:return e.include(n.em,t),i(e),l(e),f(e),void r.code.add(a.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(a.H`void forwardLinearDepth() {}`)}},50366:(e,t,r)=>{r.d(t,{d:()=>s});var o=r(49443),n=r(16878);function s(e){(0,o.i$)(e),e.vertex.code.add(n.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(n.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},57942:(e,t,r)=>{r.d(t,{O:()=>o});class o{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}getInner(e){return this._outer.get(e)}set(e,t,r){const o=this._outer.get(e);o?o.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,r)=>e(t,r)))}forAll(e){for(const t of this._outer.values())for(const r of t.values())e(r)}}},64863:(e,t,r)=>{r.d(t,{XG:()=>g,dd:()=>w,dg:()=>u,fo:()=>_,ou:()=>v});var o=r(67965),n=r(13473),s=r(87752),a=r(10382),i=r(89227),l=r(28473),f=r(89476),c=r(51064),d=r(99717);class u{constructor(){this._transform=(0,a.vt)(),this._transformInverse=new h({value:this._transform},s.B8,a.vt),this._transformInverseTranspose=new h(this._transformInverse,s.mg,a.vt),this._transformTranspose=new h({value:this._transform},s.mg,a.vt),this._transformInverseRotation=new h({value:this._transform},o.dR,n.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,s.C)(this._transform,e)}multiplyTransform(e){(0,s.lw)(this._transform,this._transform,e)}set(e){(0,s.C)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class h{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const m=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=e,this.sphere=(0,f.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const o=this.objectTransform.transform,n=(0,i.i)(b,e,t,r),s=(0,i.t)(n,n,o),a=this.offset/(0,i.l)(s);(0,i.b)(s,s,s,a);const l=this.objectTransform.inverse;return(0,i.t)(this.tmpVertex,s,l),this.tmpVertex}applyToMinMax(e,t){const r=this.offset/(0,i.l)(e);(0,i.b)(e,e,e,r);const o=this.offset/(0,i.l)(t);(0,i.b)(t,t,t,o)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=(0,i.l)((0,f.a)(e)),r=this.offset/t;return(0,i.b)((0,f.a)(this.sphere),(0,f.a)(e),(0,f.a)(e),r),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function v(e){return null!=e?(m.offset=e,m):null}const p=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,f.c)(),this._tmpObb=new d.ab,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=(0,i.l)(e)}applyToVertex(e,t,r){const o=(0,i.i)(b,e,t,r),n=(0,i.i)(M,e,t,r+this.componentLocalOriginLength),s=this._totalOffset/(0,i.l)(n);return(0,i.b)(this._tmpVertex,o,n,s),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,r=e[0],o=e[1],n=e[2]+t,s=e[3],a=e[4],i=e[5]+t,l=Math.abs(r),f=Math.abs(o),c=Math.abs(n),d=Math.abs(s),u=Math.abs(a),h=Math.abs(i),m=.5*(1+Math.sign(r*s))*Math.min(l,d),v=.5*(1+Math.sign(o*a))*Math.min(f,u),p=.5*(1+Math.sign(n*i))*Math.min(c,h),g=Math.max(l,d),y=Math.max(f,u),w=Math.max(c,h),_=Math.sqrt(m*m+v*v+p*p),b=Math.sign(l+r),M=Math.sign(f+o),x=Math.sign(c+n),T=Math.sign(d+s),F=Math.sign(u+a),O=Math.sign(h+i),V=this._totalOffset;if(_<V)return e[0]-=(1-b)*V,e[1]-=(1-M)*V,e[2]-=(1-x)*V,e[3]+=T*V,e[4]+=F*V,e[5]+=O*V,e;const A=V/Math.sqrt(g*g+y*y+w*w),P=V/_,R=P-A,B=-R;return e[0]+=r*(b*B+P),e[1]+=o*(M*B+P),e[2]+=n*(x*B+P),e[3]+=s*(T*R+A),e[4]+=a*(F*R+A),e[5]+=i*(O*R+A),e}applyToMbs(e){const t=(0,i.l)((0,f.a)(e)),r=this._totalOffset/t;return(0,i.b)((0,f.a)(this._tmpMbs),(0,f.a)(e),(0,f.a)(e),r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return(0,d.gm)(e,this._totalOffset,this._totalOffset,c.RT.Global,this._tmpObb),this._tmpObb}};function g(e){return null!=e?(p.offset=e,p):null}const y=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=e,this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const o=(0,i.i)(b,e,t,r),n=(0,i.g)(M,o,this.localOrigin),s=this.offset/(0,i.l)(n);return(0,i.b)(this.tmpVertex,o,n,s),this.tmpVertex}applyToAabb(e){const t=x,r=T,o=F;for(let i=0;i<3;++i)t[i]=e[0+i]+this.localOrigin[i],r[i]=e[3+i]+this.localOrigin[i],o[i]=t[i];const n=this.applyToVertex(t[0],t[1],t[2]);for(let i=0;i<3;++i)e[i]=n[i],e[i+3]=n[i];const s=t=>{const r=this.applyToVertex(t[0],t[1],t[2]);for(let o=0;o<3;++o)e[o]=Math.min(e[o],r[o]),e[o+3]=Math.max(e[o+3],r[o])};for(let i=1;i<8;++i){for(let e=0;e<3;++e)o[e]=i&1<<e?r[e]:t[e];s(o)}let a=0;for(let i=0;i<3;++i)t[i]*r[i]<0&&(a|=1<<i);if(0!==a&&7!==a)for(let i=0;i<8;++i)if(!(a&i)){for(let e=0;e<3;++e)o[e]=a&1<<e?0:i&1<<e?t[e]:r[e];s(o)}for(let i=0;i<3;++i)e[i]-=this.localOrigin[i],e[i+3]-=this.localOrigin[i];return e}};function w(e){return null!=e?(y.offset=e,y):null}const _="terrain",b=(0,l.vt)(),M=(0,l.vt)(),x=(0,l.vt)(),T=(0,l.vt)(),F=(0,l.vt)()},84025:(e,t,r)=>{r.d(t,{I:()=>s});var o=r(16878),n=r(22131);function s(e){e.attributes.add(n.r.POSITION,"vec3"),e.vertex.code.add(o.H`vec3 positionModel() { return position; }`)}},88796:(e,t,r)=>{r.d(t,{R:()=>l});var o=r(23060),n=r(58828),s=r(74719),a=r(49959),i=r(43103);class l{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return(0,i.isDataProtocol)(e)?((0,a.throwIfAborted)(t),(0,i.dataToArrayBuffer)(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,r){if(null==this._streamDataRequester)return(await(0,o.default)(t,{responseType:f[e]})).data;const i=await(0,n.Ke)(this._streamDataRequester.request(t,e,r));if(!0===i.ok)return i.value;throw(0,a.throwIfAbortError)(i.error),new s.default("glt-loader-request-error",`Request for resource failed: ${i.error}`)}}const f={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},91018:(e,t,r)=>{r.d(t,{h:()=>s});var o=r(73031),n=r(826);class s extends n.n{constructor(e,t){super(e,"mat3",o.c.Draw,((r,o,n)=>r.setUniformMatrix3fv(e,t(o,n))))}}},91315:(e,t,r)=>{r.d(t,{FJ:()=>V,Hh:()=>T});var o=r(23060),n=r(58828),s=r(74719),a=r(50925),i=r(42080),l=r(57942),f=r(49959),c=r(13997),d=r(28473),u=r(4309),h=r(55239),m=r(72538),v=r(65069),p=r(71723),g=r(25735),y=r(51446),w=r(22131),_=r(9789),b=r(92156);const M=()=>a.A.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class x{constructor(e,t,r){this.resource=e,this.textures=t,this.cachedMemory=r}}async function T(e,t){const r=await async function(e,t){const r=t?.streamDataRequester;if(r)return async function(e,t,r){const o=await(0,n.Ke)(t.request(e,"json",r));if(!0===o.ok)return o.value;(0,f.throwIfAbortError)(o.error),F(o.error.details.url)}(e,r,t);const s=await(0,n.Ke)((0,o.default)(e,t));if(!0===s.ok)return s.value.data;(0,f.throwIfAbortError)(s.error),F(s.error)}(e,t),s=await async function(e,t){const r=new Array;for(const s in e){const o=e[s],n=o.images[0].data;if(!n){M().warn("Externally referenced texture data is not yet supported");continue}const a=o.encoding+";base64,"+n,i="/textureDefinitions/"+s,l="rgba"===o.channels?o.alphaChannelUsage||"transparency":"none",f={noUnpackFlip:!0,wrap:{s:b.pF.REPEAT,t:b.pF.REPEAT},preMultiplyAlpha:P(l)!==p.sf.Opaque},c=t?.disableTextures?Promise.resolve(null):(0,m.D)(a,t);r.push(c.then((e=>({refId:i,image:e,parameters:f,alphaChannelUsage:l}))))}const o=await Promise.all(r),n={};for(const s of o)n[s.refId]=s;return n}(r.textureDefinitions??{},t);let a=0;for(const o in s)if(s.hasOwnProperty(o)){const e=s[o];a+=e?.image?e.image.width*e.image.height*4:0}return new x(r,s,a+(0,i.Qh)(r))}function F(e){throw new s.default("",`Request for object resource failed: ${e}`)}function O(e){const t=e.params,r=t.topology;let o=!0;switch(t.vertexAttributes||(M().warn("Geometry must specify vertex attributes"),o=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const r in t.vertexAttributes){const t=e[r];t?.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(M().warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),o=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(M().warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),o=!1)):(M().warn(`Indexed geometry does not specify face indices for '${r}' attribute`),o=!1)}}else M().warn("Indexed geometries must specify faces"),o=!1;break}default:M().warn(`Unsupported topology '${r}'`),o=!1}e.params.material||(M().warn("Geometry requires material"),o=!1);const n=e.params.vertexAttributes;for(const s in n)n[s].values||(M().warn("Geometries with externally defined attributes are not yet supported"),o=!1);return o}function V(e,t){const r=new Array,o=new Array,n=new Array,s=new l.O,a=e.resource,i=c.R.parse(a.version||"1.0","wosr");B.validate(i);const f=a.model.name,u=a.model.geometries,m=a.materialDefinitions??{},b=e.textures;let M=0;const x=new Map;for(let l=0;l<u.length;l++){const e=u[l];if(!O(e))continue;const a=R(e),i=e.params.vertexAttributes,f=[],c=t=>{if("PerAttributeArray"===e.params.topology)return null;const r=e.params.faces;for(const e in r)if(e===t)return r[e].values;return null},T=i[w.r.POSITION],F=T.values.length/T.valuesPerElement;for(const t in i){const e=i[t],r=e.values,o=c(t)??(0,h.tM)(F);f.push([t,new v.n(r,o,e.valuesPerElement,!0)])}const V=a.texture,A=b&&b[V];if(A&&!x.has(V)){const{image:e,parameters:t}=A,r=new y.g(e,t);o.push(r),x.set(V,r)}const B=x.get(V),W=B?B.id:void 0,I=a.material;let S=s.get(I,V);if(null==S){const e=m[I.slice(I.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const r=A&&A.alphaChannelUsage,o=e.transparency>0||"transparency"===r||"maskAndTransparency"===r,n=A?P(A.alphaChannelUsage):void 0,a={ambient:(0,d.ci)(e.diffuse),diffuse:(0,d.ci)(e.diffuse),opacity:1-(e.transparency||0),transparent:o,textureAlphaMode:n,textureAlphaCutoff:.33,textureId:W,doubleSided:!0,cullFace:p.s2.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:A?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(a,t.materialParameters),S=new _.$U(a,t),s.set(I,V,S)}n.push(S);const C=new g.V(S,f);M+=f.find((e=>e[0]===w.r.POSITION))?.[1]?.indices.length??0,r.push(C)}return{engineResources:[{name:f,stageResources:{textures:o,materials:n,geometries:r},pivotOffset:a.model.pivotOffset,numberOfVertices:M,lodThreshold:null}],referenceBoundingBox:A(r)}}function A(e){const t=(0,u.Ie)();return e.forEach((e=>{const r=e.boundingInfo;null!=r&&((0,u.iT)(t,r.bbMin),(0,u.iT)(t,r.bbMax))})),t}function P(e){switch(e){case"mask":return p.sf.Mask;case"maskAndTransparency":return p.sf.MaskBlend;case"none":return p.sf.Opaque;default:return p.sf.Blend}}function R(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const B=new c.R(1,2,"wosr")},94320:(e,t,r)=>{r.d(t,{X:()=>s});var o=r(73031),n=r(826);class s extends n.n{constructor(e,t){super(e,"mat4",o.c.Pass,((r,o,n)=>r.setUniformMatrix4fv(e,t(o,n))))}}}}]);