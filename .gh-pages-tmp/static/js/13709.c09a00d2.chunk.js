"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[13709],{13709:(e,n,t)=>{t.r(n),t.d(n,{getLabelSchemes:()=>u});t(88677);var i=t(74719),a=t(55786),l=t(85151),o=t(53957);async function r(e){const{layer:n,renderer:t}=e;if(await n.load(),"binning"!==n.featureReduction?.type)throw new i.default("bins-label-schemes:invalid-parameters","featureReduction type of the layer is not valid");const a=t||n.featureReduction.renderer;if(!a)throw new i.default("bins-label-schemes:invalid-parameters","'renderer' is not valid");return{layer:n,renderer:a}}async function s(e,n,t,i){const l=(0,a.yb)(e,n);if(!l)return null;const o=(0,a.Hg)(n,t,l,i);return{name:`binning-${e}`,labelingInfo:[(0,a.Rl)(o,!0)],fieldName:e}}async function u(e){const[{renderer:n,layer:t},a]=await Promise.all([r(e),(0,o.ud)("esri/smartMapping/t9n/smartMapping")]),u=a.clusters.predominantNoneValue;if(e.field){const a=await s(e.field,t,n,u);if(!a)throw new i.default("bins-label-schemes:invalid-parameters","'field' is not a valid aggregate field");return{primaryScheme:a,secondarySchemes:[]}}const f=await s(l.z,t),p=[],d=function(e){let n=[];const t=e.featureReduction;return"fields"in t&&(n=t.fields.map((e=>e.name))),n}(t).filter((e=>e.toLowerCase()!==l.z.toLowerCase()));for(const i of d){const e=await s(i,t,n,u);e&&p.push(e)}return{primaryScheme:f,secondarySchemes:p}}},43579:(e,n,t)=>{t.d(n,{G2:()=>w,Lb:()=>$,Xj:()=>h,bF:()=>y,gS:()=>z,lm:()=>g});var i=t(62631),a=(t(21265),t(53957)),l=t(99961),o=t(95011),r=(t(76519),t(62155),t(83014),t(23621),t(45608)),s=(t(36917),t(19609),t(7282)),u=(t(12969),t(56488)),f=t(26964),p=t(67823),d=t(88171),c=t(71237),m=t(66809);let v=0;const y="expression/";function w(e){return"hasVisualVariables"in e&&e.hasVisualVariables()?e.visualVariables.filter((e=>!c.viewScaleRE.test(e.valueExpression)&&(!("target"in e)||"outline"!==e.target))):[]}function b(e,n){if(!n)return null;const t=(0,m.Rm)(e);return t?.find((e=>e.name.toLowerCase()===n.toLowerCase()))}function g(e,n,t){let i=null;if(t&&"featureReduction"in e){const n=e.featureReduction;n&&"popupTemplate"in n&&n.popupTemplate&&(i=n.popupTemplate.fieldInfos)}else"popupTemplate"in e&&e.popupTemplate&&(i=e.popupTemplate.fieldInfos);const a=t?b(e,n):e.getField(n);let l=null;if(i&&i.some((e=>!(!e||e.fieldName?.toLowerCase()!==a?.name.toLowerCase())&&(l=e.clone(),!0))),!l){const e=o.numericTypes.includes(a.type),n="integer"===a.type||"small-integer"===a.type;l=new f.default({fieldName:a.name,isEditable:a.editable,visible:!0,format:e?new p.default({places:n?0:2,digitSeparator:!0}):void 0})}return l.label||(l.label=a.alias),l}function T(e){const{expression:n,title:t,returnType:i}=e;return new u.default({name:"expr"+v++,expression:n,title:t,returnType:i})}function x(e){const n="number"===e.returnType?new p.default({places:2,digitSeparator:!0}):void 0;return new f.default({fieldName:`${y}${e.name}`,visible:!0,format:n})}async function h(e){const n=await(0,a.ud)("esri/smartMapping/t9n/smartMapping"),{renderer:t,layer:o,normFieldExpressionTemplate:r,isFeatureReduction:s}=e,u=[],f=[],p=(0,d.getAttributes)(t,w);for(const i of p)if("field"===i.type)u.push(g(o,i.field,s));else if("normalized-field"===i.type){const e=s?b(o,i.field):o.getField(i.field),t=s?b(o,i.normalizationField):o.getField(i.normalizationField),a=T({type:"expression",expression:`\n      $feature["${e.name}"];\n      $feature["${t.name}"];\n      ${"percentage"===r?`($feature["${e.name}"] / $feature["${t.name}"]) * 100;`:`$feature["${e.name}"] / $feature["${t.name}"];`}\n      `,title:(0,l.V)("percentage"===r?n.normFieldLabelAsPercent:n.normFieldLabel,{expression1:e.alias,expression2:t.alias}),returnType:"number"});u.push(x(a),g(o,i.field,s),g(o,i.normalizationField,s)),f.push(a)}else if("expression"===i.type){const e=T(i);u.push(x(e)),f.push(e)}return{fieldInfos:(0,i.Am)(u,((e,n)=>e.fieldName===n.fieldName)),expressionInfos:(0,i.Am)(f,((e,n)=>e.expression===n.expression))}}async function $(e,n,t){const{fieldInfos:i,expressionInfos:o}=n,u=await(0,a.ud)("esri/smartMapping/t9n/smartMapping");if(i.length>2)return[new r.default({fieldInfos:i})];const f=[];for(const a of i){const n=a.fieldName||"";let i=a.label;if(!i){const a=t?b(e,n):e.getField(n);if(a)i=a.alias||n;else if(o){const e=n.split(y)[1],t=o[o.findIndex((n=>n.name===e))];t&&(i=t.title||t.name)}}f.push(new s.default({text:(0,l.V)(u.fieldInfo,{fieldLabel:i,fieldValue:`{${n}}`})}))}return f}function z(e){return!(!("normalizationField"in e)||!e.normalizationField)||"hasVisualVariables"in e&&e.hasVisualVariables()&&e.visualVariables.some((e=>!(!("normalizationField"in e)||!e.normalizationField)))}},44320:(e,n,t)=>{t.d(n,{Dv:()=>p,Qb:()=>s,Wx:()=>v,eU:()=>b,pq:()=>u});var i=t(62631),a=t(99521),l=t(85074),o=t(43579),r=t(79538);const s="cluster_count";function u(e,n){return e.split(`cluster_${n}_`).pop()}function f(e,n){const t=function(e){if(!e)return null;const{field:n,valueExpression:t,normalizationField:i,normalizationType:a,normalizationTotal:o}=e;let s=null;if(t)s=t;else if(n){const e=(0,r.Wy)({normalizationType:a,normalizationField:i,normalizationTotal:o});if(e){const t=e.toLowerCase();if(s=n.toLowerCase()+",norm:"+t,i)s+=","+i.toLowerCase();else if("percent-of-total"===t){let e=o;(0,l.gf)(e)&&0!==e||(e=null),s+=","+e}}}return s}(e);return`${n}_${null!=t?function(e){return(0,a.d)(e)}(t):e.field}`}function p(e,n){return`cluster_${f(e,n)}`}function d(e,n){const t=n.getField(e);return t?.type}function c(e,n){const t="rotation"===n.type?n.rotationType:null,i=n.legendOptions?.title,a=n.field,l=a?d(a,e):null;return{field:a,fieldType:null!=l?l:null,rotationType:t,valueExpression:n.valueExpression,valueExpressionTitle:n.valueExpressionTitle||n.valueExpression&&i,normalizationField:"normalizationField"in n?n.normalizationField:null,vvType:n.type}}function m(e){return e?e.replaceAll('"','\\"'):""}function v(e,n,t){return`\n  var uvInfos = [${function(e){return e.map((e=>`{\n        "value": "${String(e.value)}",\n        "label": "${m(String(e.label))}"\n      }`))}(e).join(", ")}];\n  var predominantType = Text($feature["${n}"]);\n  var label = "${m(t)}";\n\n  for (var i = 0; i < Count(uvInfos); i++) {\n    if (uvInfos[i].value == predominantType) {\n      label = uvInfos[i].label;\n      break;\n    }\n  }\n\n  return label;\n  `}function y(e,n){const t=[f(e,n)];return"date"===e.fieldType&&t.push(e.fieldType.toLowerCase()),e.rotationType&&t.push(e.rotationType.toLowerCase()),t.join("_")}function w(e,n){return{statisticHash:y(e,n),attributeInfo:e,statisticType:n}}function b(e,n){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=[],l=function(e,n){const t="field"in n?n.field:null,i=t?d(t,e):null;return{field:t,fieldType:null!=i?i:null,valueExpression:"valueExpression"in n?n.valueExpression:null,valueExpressionTitle:"valueExpressionTitle"in n?n.valueExpressionTitle:null,normalizationField:"normalizationField"in n?n.normalizationField:null,normalizationType:"normalizationType"in n?n.normalizationType:null,normalizationTotal:"normalizationTotal"in n?n.normalizationTotal:null}}(e,n);"class-breaks"===n.type?a.push(w(l,"avg")):"unique-value"===n.type&&a.push(w(l,"type"));const r=(0,o.G2)(n);for(const i of r){const n=c(e,i);a.push(w(n,"avg"))}return t?(0,i.Am)(a,((e,n)=>e.statisticHash===n.statisticHash)):a}},55786:(e,n,t)=>{t.d(n,{Hg:()=>f,Rl:()=>p,ik:()=>u,yb:()=>s});var i=t(56808),a=t(24280),l=t(16378),o=t(44320),r=t(89320);function s(e,n){const t=n.featureReduction;if("fields"in t)for(const i of t.fields)if(i.name.toLowerCase()===e.toLowerCase())return i;return null}function u(e){return`\n  $feature["${e}"];\n  var value = $feature["${e}"];\n  var num = Count(Text(Round(value)));\n  var label = When(\n    num < 4, Text(value, "#.#"),\n    num == 4, Text(value / Pow(10, 3), "#.0k"),\n    num <= 6, Text(value / Pow(10, 3), "#k"),\n    num == 7, Text(value / Pow(10, 6), "#.0m"),\n    num > 7, Text(value / Pow(10, 6), "#m"),\n    Text(value, "#,###")\n  );\n  return label;\n  `}function f(e,n,t,i){const a=t.name;if("mode"===t.statisticType){const r="getFieldDomain"in e?e.getFieldDomain(t.onStatisticField):null;let s=null;return"coded-value"===r?.type?s=r.codedValues.map((e=>new l.default({value:e.code,label:e.name}))):"unique-value"===n?.type&&null!=n.field&&n.field.toLowerCase()===a.toLowerCase()&&(s=(n.uniqueValueInfos??[]).map((e=>e.clone()))),s?(0,o.Wx)(s,a,i):`Text($feature["${a}"])`}return u(a)}function p(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=new r.default({haloColor:"#373837",haloSize:"1px",color:"#f0f0f0",font:{family:"Noto Sans",size:"12px",weight:"bold"}});return new i.default({symbol:t,deconflictionStrategy:"none",labelPlacement:n?"always-horizontal":"center-center",labelExpressionInfo:new a.A({expression:e})})}},85151:(e,n,t)=>{t.d(n,{p:()=>l,z:()=>a});var i=t(74719);const a="aggregateCount";function l(e,n){if(!e.view)throw new i.default(`${n}:missing-parameters`,"'view' parameter is required for binning");if(e.sqlExpression)throw new i.default(`${n}:invalid-parameters`,"'sqlExpression' parameter is not supported for binning");if("3d"===e.view.type)throw new i.default(`${n}:invalid-parameters`,"3d view is not supported for binning")}}}]);