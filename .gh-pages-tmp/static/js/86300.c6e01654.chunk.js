"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[60814,86300],{1350:(e,t,n)=>{n.d(t,{E:()=>u});var r=n(93800),i=n(50925),s=n(48602),o=(n(21265),n(14746),n(75269)),l=n(60897),a=n(69270);const u=e=>{let t=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=e=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&i.A.getLogger(this).error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&i.A.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;try{const e=l.default.create(this.i3slayer.definitionExpression,{fieldsIndex:this.i3slayer.fieldsIndex});if(!e.isStandardized)return i.A.getLogger(this).error("definitionExpression is using non standard function"),null;const t=[],n=e.fieldNames;return(0,a.W)(n,this.i3slayer.fields,{missingFields:t}),t.length>0?(i.A.getLogger(this).error(`definitionExpression references unknown fields: ${t.join(", ")}`),null):(this._definitionExpressionErrors=0,e)}catch(e){return i.A.getLogger(this).error("Failed to parse definitionExpression: "+e),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(e,t){try{return e.testFeature(t)}catch(n){return this.logError(n),!1}}_addDefinitionExpressionToQuery(e){if(!this.parsedDefinitionExpression)return e;const t=this.i3slayer.definitionExpression,n=e.clone();return n.where?n.where=`(${t}) AND (${n.where})`:n.where=t,n}};return(0,r._)([(0,s.MZ)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,r._)([(0,s.MZ)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,r._)([(0,o.$)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},7472:(e,t,n)=>{n.d(t,{X:()=>r});const r=Symbol("WebScene")},23007:(e,t,n)=>{n.d(t,{P:()=>c});var r=n(93800),i=n(48602),s=(n(21265),n(50925),n(14746),n(75269)),o=n(87449),l=n(63136),a=n(75972),u=n(69270);const c=e=>{let t=class extends e{get timeExtent(){return(0,a.F)(this.i3slayer,this.view?.timeExtent,this._get("timeExtent"))}get mergedFilter(){const{filter:e,timeExtent:t}=this;if(null==t)return e;const n=e?.clone()??new l.default;return null!=t&&(n.timeExtent=n.timeExtent?.intersection(t)??t),n}getTimeFilterDependencies(){const{timeInfo:e}=this.i3slayer;if(null==e)return[];const{startField:t,endField:n}=e;return[t,n]}addTimeFilter(e,t){if(null==t)return;const{timeInfo:n}=this.i3slayer;if(null==n)return;const{startField:r,endField:i,useTime:s}=n;if(!s||null==r&&null==i)return;const l=n.toJSON(),a=t.toJSON();e.push(((e,t)=>function(e,t,n,r){const i=t.attributeInfo?.attributeData;if(null==i)return;const{startTimeField:s,endTimeField:l}=n;if(null!=s&&null==i[s]||null!=l&&null==i[l])return;const a=(0,o.I)(n,r,new d(i));if(null==a)return;const{featureIds:c}=t;(0,u.$i)(e,c,a)}(e,t,l,a)))}};return(0,r._)([(0,i.MZ)({readOnly:!0})],t.prototype,"timeExtent",null),(0,r._)([(0,i.MZ)()],t.prototype,"mergedFilter",null),t=(0,r._)([(0,s.$)("esri.views.3d.layers.support.TemporalSceneLayerView")],t),t};class d{constructor(e){this.attributeData=e}getAttribute(e,t){return(0,u.E5)(this.attributeData[t],e)}getAttributeAsTimestamp(e,t){const n=this.getAttribute(e,t);return"string"==typeof n?new Date(n).getTime():"number"==typeof n||null==n?n:null}}},60814:(e,t,n)=>{n.r(t),n.d(t,{getTimeExtentFromLayers:()=>f,getTimeSliderSettingsFromWebDocument:()=>y,toLocalTimeExtent:()=>g,toUTCTimeExtent:()=>h});var r=n(62631),i=n(82301),s=n(87431),o=n(32474),l=n(46047),a=n(7472);function u(e){return void 0!==e.timeInfo}async function c(e,t){return e.widgets?.timeSlider?.fullTimeExtent??f(e.allLayers,t)}function d(e){const{numStops:t,stopInterval:n,stops:r}=e;return r?{dates:(0,i.clone)(r)}:n?{interval:n.clone()}:{count:t??5}}async function f(e,t){if(0===e.length)return o.default.allTime;await Promise.all(e.map((e=>e.load({signal:t}))));const n=e.filter(u),i=e.filter((e=>!u(e)&&null!=e.visibilityTimeExtent));if(0===n.length&&0===i.length)return o.default.allTime;const s=[],l=[];for(const r of n)"feature"!==r?.type&&"map-image"!==r?.type||!r.timeInfo?.hasLiveData?l.push(r):s.push(r);const a=e=>null==e||e.isAllTime,c=[...l.map((e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=e;return t?.intersection(n)??n})),...i.map((e=>e.visibilityTimeExtent))];if(c.some(a))return o.default.allTime;const d=s.map((async e=>{const n=(await e.fetchRecomputedExtents({signal:t}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:r}=e;return n?.intersection(r)??r})),f=(await Promise.allSettled(d)).map((e=>"fulfilled"===e.status?e.value:null));if(f.some(a))return o.default.allTime;const p=[...f,...c].filter(r.Ru);return 0===p.length?o.default.allTime:p.reduce(((e,t)=>e.union(t)))}function p(e,t){const n=e.currentTimeExtent;if(!n)return null;const{start:r,end:i}=n,s=r??i??null;switch(t){case"time-window":return new o.default({start:r,end:i});case"cumulative-from-start":return new o.default({start:null,end:s});case"cumulative-from-end":return new o.default({start:s,end:null});case"instant":return new o.default({start:s,end:s})}}async function y(e,t){if(!(0,l.r)(e)&&!function(e){return null!=e&&"object"==typeof e&&a.X in e}(e))return null;await e.load({signal:t});const n=e?.widgets?.timeSlider;if(!n)return null;const r=await c(e,t),i=n.loop,s=function(e){const t=e.numThumbs??2,n=e.currentTimeExtent;if(n){const{start:e,end:r}=n;return null!=e&&null!=r&&e.getTime()===r.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(n);return{fullTimeExtent:r,loop:i,mode:s,playRate:n.stopDelay??2e3,stops:d(n),timeExtent:p(n,s)}}function h(e){if(!e)return e;const{start:t,end:n}=e;return new o.default({start:null!=t?(0,s.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,s.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}function g(e){if(!e)return e;const{start:t,end:n}=e;return new o.default({start:null!=t?(0,s.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,s.S1)(n,n.getTimezoneOffset(),"minutes"):n})}},65117:(e,t,n)=>{n.d(t,{n:()=>l,w:()=>a});var r=n(4309),i=n(40602),s=n(39817),o=n(69270);class l{constructor(e){this._objectIdField=e.objectIdField,this._getFeatureExtent=e.getFeatureExtent}getObjectId(e){return e.id}getAttributes(e){const{meta:t,index:n}=e,r={};this._objectIdField&&(r[this._objectIdField]=e.id);const i=t.attributeInfo?.attributeData;if(null!=i)for(const s of Object.keys(i))r[s]=(0,o.E5)(i[s],n);return r}getAttribute(e,t){if(t===this._objectIdField)return e.id;const{meta:n,index:r}=e,i=n.attributeInfo?.attributeData;return null!=i?(0,o.E5)(i[t],r):null}getGeometry(e){if(e.geometry)return e.geometry;const[t,n,r,i,o]=this._getFeatureExtent(e,u);return new s.A([5],[t,n,r,i,n,r,i,o,r,t,o,r,t,n,r])}getCentroid(e,t){if(e.geometry)return(0,i.Q)(new s.A,e.geometry,t.hasZ,t.hasM);const[n,r,o,l,a,c]=this._getFeatureExtent(e,u);return new s.A([0],[(n+l)/2,(r+a)/2,(o+c)/2])}cloneWithGeometry(e,t){const{id:n,index:r,meta:i}=e;return new a(n,r,i,t)}}class a{constructor(e,t,n,r){this.id=e,this.index=t,this.meta=n,this.geometry=r}get usedMemory(){return 32+(this.geometry?.usedMemory??0)}}const u=(0,r.vt)()},66995:(e,t,n)=>{n.d(t,{D:()=>h});var r=n(93800),i=n(6946),s=n(7951),o=n(58448),l=n(48602),a=(n(50925),n(14746),n(75269)),u=n(87438),c=n(4309),d=n(90772),f=n(89476),p=n(2430);const y=(0,c.vt)();let h=class extends i.default{constructor(e){super(e),this.events=new o.A}forEach(e){this.forAllFeatures((t=>(e(t),p._R.CONTINUE)))}forEachBounds(e,t){for(const n of e)t(this.getFeatureExtent(n,y))}forEachInBounds(e,t){this.forAllFeatures((n=>{const r=this.getFeatureExtent((0,s.zI)(n),m);return(0,d.HY)(e,(0,c.ES)(r,E))&&t((0,s.zI)(n)),p._R.CONTINUE}),(t=>{if((0,u.z)(t.node.serviceMbsInIndexSR,this.sourceSpatialReference,g,this.viewSpatialReference),g[0]>=e[0]&&g[2]<=e[2]&&g[1]>=e[1]&&g[3]<=e[3])return p._R.CONTINUE;const n=Math.max(e[0],Math.min(g[0],e[2])),r=Math.max(e[1],Math.min(g[1],e[3])),i=g[0]-n,s=g[1]-r;return i*i+s*s<=g[3]*g[3]?p._R.CONTINUE:p._R.SKIP}))}};(0,r._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"featureAdapter",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"forAllFeatures",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"getFeatureExtent",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"sourceSpatialReference",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"viewSpatialReference",void 0),h=(0,r._)([(0,a.$)("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],h);const g=(0,f.f)(0,0,0,0),m=(0,c.vt)(),E=(0,d.vt)()},67171:(e,t,n)=>{n.d(t,{DS:()=>s,J7:()=>r,w$:()=>i});const r="updating";function i(e){return"updating"===e?null:e}function s(e){return"updating"===e}},75972:(e,t,n)=>{n.d(t,{F:()=>i});var r=n(60814);function i(e,t,n){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:i=!1,timeOffset:s,useViewTime:o}=e;let l=e.timeExtent;i&&(l=(0,r.toLocalTimeExtent)(l));let a=o?t&&l?t.intersection(l):t||l:l;return!a||a.isEmpty||a.isAllTime?a:(s&&(a=a.offset(-s.value,s.unit)),i&&(a=(0,r.toUTCTimeExtent)(a)),a.equals(n)?n:a)}},75992:(e,t,n)=>{n.d(t,{_:()=>A});var r=n(93800),i=n(6946),s=n(62631),o=n(50925),l=n(64682),a=n(67171),u=n(79953),c=n(84190),d=n(48602),f=(n(21265),n(75269)),p=n(89227),y=n(28473),h=n(60897),g=n(30142),m=n(96913),E=n(93321),w=n(87438),_=n(18162),x=n(4309),v=n(90772),S=n(66028),F=n(23311),I=n(70576),b=n(89476),T=n(5616),R=n(63136),M=n(69270);const O="esri.views.3d.layers.i3s.I3SMeshViewFilter",D=()=>o.A.getLogger(O);let A=class extends i.default{constructor(e){super(e),this._projectionEngineLoaded=!1}initialize(){(0,u.whenOnce)((()=>this.viewFilter?.geometry||null!=this.layerFilter)).then((()=>this.loadAsyncModule(Promise.all([n.e(31329),n.e(73959)]).then(n.bind(n,60822)).then((e=>{this.destroyed||(this._geometryEngine=e)})))))}get sortedObjectIds(){if(null==this.viewFilter?.objectIds)return null;const e=(0,S.xm)(this.viewFilter.objectIds);return e.sort(),e}get parsedWhereClause(){const e=this.viewFilter?.where;if(null==e||!e)return null;try{return h.default.create(e,{fieldsIndex:this.layerFieldsIndex})}catch(t){D().error(`Failed to parse filter where clause: ${t}`)}return null}addFilters(e,t,n,r){const i=this.sortedObjectIds;null!=i&&e.push((e=>(0,M.Be)(i,!0,e))),this.addSqlFilter(e,this.parsedWhereClause),this.addTimeFilter(e,this.viewFilter?.timeExtent);const s=(0,a.w$)(this._layerMaskGeometries),o=this._geometryEngine;if(null!=s&&null!=this.layerFilter&&null!=o){const i=this.layerFilter.spatialRelationship;e.push(((e,l)=>k(o,e,l,r,t,n,s,i)))}const l=(0,a.w$)(this._viewMaskGeometries);if(null!=l&&null!=this.viewFilter&&null!=o){const i=this.viewFilter.spatialRelationship;e.push(((e,s)=>k(o,e,s,r,t,n,l,i)))}}isMBSGeometryVisible(e,t,n){const r=(0,a.w$)(this._layerMaskGeometries),i=this._geometryEngine;if(null!=r&&null!=this.layerFilter&&null!=i){const s=this.layerFilter.spatialRelationship,o=r[0].spatialReference||t;return(0,w.z)(e,n,G,o)?N(i,G,r,o,s):(D().warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}const s=(0,a.w$)(this._viewMaskGeometries);if(null!=s&&null!=this.viewFilter&&null!=i){const r=this.viewFilter.spatialRelationship,o=s[0].spatialReference||t;return(0,w.z)(e,n,G,o)?N(i,G,s,o,r):(D().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){const e=(0,a.w$)(this._viewMaskGeometries),t=(0,a.w$)(this._layerMaskGeometries);return null==e||null==t?e||t:t.concat(e)}get _layerMaskGeometries(){const e=this.layerFilter;return null==e?null:null==this._geometryEngine?a.J7:"disjoint"===e.spatialRelationship?e.geometries.map((e=>({type:"polygon",rings:e.rings,spatialReference:e.spatialReference,cache:{}}))):[e.geometries.reduce(((e,t)=>(e.rings=[...e.rings,...t.rings],e)),{type:"polygon",rings:[],spatialReference:e.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(null==this.viewFilter)return null;const{geometry:e}=this.viewFilter;if(null==e)return null;if(null==this.viewFilter||null==this._geometryEngine)return a.J7;const{distance:t,units:n}=this.viewFilter,r=this.viewFilter.spatialRelationship,i="mesh"===e.type?e.extent:e;if(null==t||0===t)return Z(this._geometryEngine,i,r);const s=n||(0,c.Ij)(i.spatialReference);if(i.spatialReference.isWGS84){const e=this._geometryEngine.geodesicBuffer(i,t,s);return Z(this._geometryEngine,e,r)}const o=(0,T.project)(i,E.default.WGS84);if(null!=o){const e=(0,T.project)(this._geometryEngine.geodesicBuffer(o,t,s),i.spatialReference);return Z(this._geometryEngine,e,r)}if(!this._projectionEngineLoaded&&(this.loadAsyncModule((0,m.load)().then((()=>this._projectionEngineLoaded=!0))),!this._projectionEngineLoaded))return null;let l=null;try{l=(0,m.project)(i,E.default.WGS84)}catch(u){}if(l)try{l=(0,m.project)(this._geometryEngine.geodesicBuffer(l,t,s),i.spatialReference)}catch(u){l=null}return l||D().error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${i.spatialReference.wkid}) to WGS84.`),Z(this._geometryEngine,l,r)}get updating(){return(0,a.DS)(this._layerMaskGeometries)||(0,a.DS)(this._viewMaskGeometries)}static checkSupport(e){return null!=e&&(!!function(e){return null!=e&&j.includes(e)}(e.spatialRelationship)||(D().warn(`Filters with spatialRelationship other than ${j.join(", ")} are not supported for mesh scene layers`),!1))}};(0,r._)([(0,d.MZ)()],A.prototype,"layerFilter",void 0),(0,r._)([(0,d.MZ)({type:R.default})],A.prototype,"viewFilter",void 0),(0,r._)([(0,d.MZ)()],A.prototype,"layerFieldsIndex",void 0),(0,r._)([(0,d.MZ)()],A.prototype,"loadAsyncModule",void 0),(0,r._)([(0,d.MZ)()],A.prototype,"addSqlFilter",void 0),(0,r._)([(0,d.MZ)()],A.prototype,"addTimeFilter",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],A.prototype,"sortedObjectIds",null),(0,r._)([(0,d.MZ)({readOnly:!0})],A.prototype,"parsedWhereClause",null),(0,r._)([(0,d.MZ)({readOnly:!0})],A.prototype,"parsedGeometry",null),(0,r._)([(0,d.MZ)({readOnly:!0})],A.prototype,"_layerMaskGeometries",null),(0,r._)([(0,d.MZ)({readOnly:!0})],A.prototype,"_viewMaskGeometries",null),(0,r._)([(0,d.MZ)()],A.prototype,"updating",null),(0,r._)([(0,d.MZ)()],A.prototype,"_projectionEngineLoaded",void 0),(0,r._)([(0,d.MZ)()],A.prototype,"_geometryEngine",void 0),A=(0,r._)([(0,f.$)(O)],A);const j=["contains","intersects","disjoint"];var Q,C;function Z(e,t,n){if(null==t)return null;if("disjoint"===n&&"polygon"===t.type){const n=t.rings.length,r=t.spatialReference,i=new Array(n);for(let e=0;e<n;++e){const n=(0,v.fA)(1/0,1/0,-1/0,-1/0);(0,v.Jf)(n,t.rings[e]),i[e]={type:"polygon",rings:[t.rings[e]],spatialReference:r,cache:{},aabr:n}}i.sort(((e,t)=>e.aabr[0]-t.aabr[0]));const o=new Set,l=new s.vW;for(let t=0;t<i.length;++t){const n=i[t],r=n.aabr[0];o.forEach((t=>{if(r>=t.aabr[2])return void o.delete(t);if(n.aabr[1]>t.aabr[3]||n.aabr[3]<t.aabr[1]||!e.intersects(n,t))return;n.rings=n.rings.concat(t.rings),(0,v.fT)(n.aabr,t.aabr,n.aabr),n.cache={},o.delete(t);const a=(0,s.qh)(i,t,i.length,l);i.splice(a,1)})),o.add(n)}for(const e of i)e.aabr=void 0;return i}return[t]}function N(e,t,n,r,i){if(t[3]>=.5*(t[2]+(0,g.tO)(r).radius))return!0;const s=L(e,t,r);return n.every((t=>$(e,t,s,i)!==Q.DISCARD))}function k(e,t,n,r,i,s,o,l){const a=o[0].spatialReference||i.spatialReference;if(!(0,w.z)(n.node.serviceMbsInIndexSR,s,G,a))return void D().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const u=L(e,G,a),c=function(e,t,n,r,i){const s=t.renderSpatialReference,o=new Map,l={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:n};l.rings[0][3]=l.rings[0][0];const a={indices:null,data:null,stride:0,startIndex:0,endIndex:0};let u,c;switch(e){case"intersects":u=(e,t,n)=>e.intersects(t,n)?Q.KEEP:Q.TEST,c=J;break;case"contains":u=(e,t,n)=>e.contains(t,n)?Q.TEST:Q.DISCARD,c=J;break;default:u=(e,t,n)=>e.disjoint(t,n)?Q.TEST:Q.DISCARD,c=P}return{collection:r,object:i,type:e,maskSR:n,renderSR:s,aabbCache:o,triangle:l,positions:a,triangleTest:u,geometryTest:c}}(l,i,a,r,n.objectHandle);for(const d of o){if(0===t.length)return;switch($(e,d,u,l)){case Q.DISCARD:return void(t.length=0);case Q.KEEP:continue}(0,M.$i)(t,n.featureIds,(t=>q(e,d,t,c)))}}(C=Q||(Q={}))[C.KEEP=0]="KEEP",C[C.DISCARD=1]="DISCARD",C[C.TEST=2]="TEST";const G=(0,b.f)(0,0,0,0);function L(e,t,n){const r={type:"point",x:t[0],y:t[1],hasZ:!1,hasM:!1,spatialReference:n},i=!(0,I.oT)(n)&&!(0,I.K8)(n),s=Number.isNaN(t[3])?0:(0,l.qE)(t[3],0,2*F.$O.radius),o=i?e.buffer(r,s,1):e.geodesicBuffer(r,s,1);return o.type="polygon",o}function $(e,t,n,r){switch(r){case"intersects":case"contains":return J(e,t,n);case"disjoint":return P(e,t,n)}}function J(e,t,n){return e.intersects(t,n)?e.contains(t,n)?Q.KEEP:Q.TEST:Q.DISCARD}function P(e,t,n){return e.intersects(t,n)?e.contains(t,n)?Q.DISCARD:Q.TEST:Q.KEEP}function q(e,t,n,r){const{collection:i,object:s,renderSR:o,maskSR:l,geometryTest:a,aabbCache:u}=r;let c=u.get(n);if(!c){const e=i.getObjectTransform(s);i.getComponentAabb(s,n,z);const t=[(0,y.fA)(z[0],z[1],0),(0,y.fA)(z[0],z[4],0),(0,y.fA)(z[3],z[4],0),(0,y.fA)(z[3],z[1],0)];for(let n=0;n<4;++n)(0,p.q)(t[n],t[n],e.rotationScale),(0,p.g)(t[n],t[n],e.position),(0,_.F)(t[n],o,t[n],l);c={type:"polygon",rings:[t],spatialReference:l,cache:{}},c.rings[0][4]=c.rings[0][0],u.set(n,c)}switch(a(e,t,c)){case Q.DISCARD:return!1;case Q.KEEP:return!0}const{triangle:d,triangleTest:f,positions:h}=r,g=d.rings[0][0],m=d.rings[0][1],E=d.rings[0][2],w=i.getObjectTransform(s);i.getComponentPositions(s,n,h);const{indices:x,data:v,stride:S,startIndex:F,endIndex:I}=h;for(let y=F;y<I;y+=3){const n=S*x[y],r=S*x[y+1],i=S*x[y+2];switch((0,p.i)(g,v[n],v[n+1],v[n+2]),(0,p.i)(m,v[r],v[r+1],v[r+2]),(0,p.i)(E,v[i],v[i+1],v[i+2]),(0,p.q)(g,g,w.rotationScale),(0,p.q)(m,m,w.rotationScale),(0,p.q)(E,E,w.rotationScale),(0,p.g)(g,g,w.position),(0,p.g)(m,m,w.position),(0,p.g)(E,E,w.position),(0,_.F)(g,o,g,l),(0,_.F)(m,o,m,l),(0,_.F)(E,o,E,l),f(e,t,d)){case Q.DISCARD:return!1;case Q.KEEP:return!0}}return"intersects"!==r.type}const z=(0,x.vt)()},91778:(e,t,n)=>{n.d(t,{_:()=>g});var r=n(93800),i=n(6946),s=n(74719),o=n(17741),l=n(48602),a=(n(21265),n(50925),n(14746),n(75269)),u=n(12560),c=n(46808),d=n(13791),f=n(76747),p=n(87520),y=n(53512);const h=d.do;let g=class extends i.default{constructor(e){super(e)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",(()=>this.spatialIndex.events.emit("changed"))))}destroy(){this._dataQueryEngineInstance=(0,o.pR)(this._dataQueryEngineInstance),this._set("layerView",null)}get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return new y.default({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}async executeQueryForCount(e,t){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)}async executeQueryForExtent(e,t){const{count:n,extent:r}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t);return{count:n,extent:u.default.fromJSON(r)}}async executeQueryForIds(e,t){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)}async executeQuery(e,t){const n=this._ensureQueryJSON(e);if(n.returnGeometry)throw new s.default("unsupported-query","returnGeometry is not supported when querying a mesh scene layer view, it is only supported when directly querying a scene layer");if(n.returnCentroid)throw new s.default("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");const r=await this._dataQueryEngine.executeQuery(n,t),i=p.default.fromJSON(r);return i.features.forEach((e=>e.geometry=null)),i}_ensureQueryJSON(e){return null==e?this.defaultQueryJSON:e.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=this.layer.objectIdField||c.r,t=this.layer.fieldsIndex?.toJSON()||new f.default([]),n=this.layerView.view.resourceController.scheduler,r=this.spatialReference.toJSON(),i=this.priority,s=this.spatialIndex;return this._dataQueryEngineInstance=new h({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:t,timeInfo:null,spatialReference:r,objectIdField:e,featureStore:s,scheduler:n,priority:i}),this._dataQueryEngineInstance}};(0,r._)([(0,l.MZ)({constructOnly:!0})],g.prototype,"layerView",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],g.prototype,"priority",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],g.prototype,"spatialIndex",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"spatialReference",null),(0,r._)([(0,l.MZ)()],g.prototype,"layer",null),(0,r._)([(0,l.MZ)()],g.prototype,"defaultQueryJSON",null),g=(0,r._)([(0,a.$)("esri.views.3d.layers.i3s.I3SQueryEngine")],g)}}]);