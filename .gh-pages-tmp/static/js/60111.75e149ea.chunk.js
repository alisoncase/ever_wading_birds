"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[60111],{15:(e,t,i)=>{i.d(t,{y:()=>r});var n=i(16878);function r(e){const{fragment:t}=e;t.code.add(n.H`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}},826:(e,t,i)=>{i.d(t,{n:()=>r});i(21265);var n=i(73031);class r{constructor(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(this.name=e,this.type=t,this.arraySize=s,this.bind={[n.c.Bind]:null,[n.c.Pass]:null,[n.c.Draw]:null},r)switch(i){case void 0:break;case n.c.Bind:this.bind[n.c.Bind]=r;break;case n.c.Pass:this.bind[n.c.Pass]=r;break;case n.c.Draw:this.bind[n.c.Draw]=r}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},4241:(e,t,i)=>{i.d(t,{U:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"float",n.c.Bind,((i,n)=>i.setUniform1f(e,t(n))))}}},8118:(e,t,i)=>{i.d(t,{N5:()=>l});var n=i(74719),r=(i(21265),i(50925)),s=i(73031);const o=()=>r.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class a{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class l extends a{constructor(){super(...arguments),this.vertex=new h,this.fragment=new h,this.attributes=new f,this.varyings=new g,this.extensions=new p,this.outputs=new v}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(e),s="vertex"===e?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=s.main.generateSource(t),c="vertex"===e?A:_,u=s.constants.generateSource(),d=this.outputs.generateSource(e);return`#version 300 es\n${i.join("\n")}\n${c}\n${u.join("\n")}\n${o.join("\n")}\n${n.join("\n")}\n${r.join("\n")}\n${d.join("\n")}\n${a.join("\n")}\n${l.join("\n")}`}generateBind(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[s.c.Bind];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[s.c.Bind];i&&t.set(e.name,i)}));const i=Array.from(t.values()),n=i.length;return t=>{for(let r=0;r<n;++r)i[r](e,t)}}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[s.c.Pass];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[s.c.Pass];i&&t.set(e.name,i)}));const i=Array.from(t.values()),n=i.length;return(t,r)=>{for(let s=0;s<n;++s)i[s](e,t,r)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[s.c.Draw];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[s.c.Draw];i&&t.set(e.name,i)}));const i=Array.from(t.values()),n=i.length;return(t,r,s)=>{for(let o=0;o<n;++o)i[o](e,s,t,r)}}}class c{constructor(e){this._stage=e,this._entries=new Map}add(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const n of t)this._add(n);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new n.default(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else o().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(e)throw new n.default("Shader does not contain main function body.");return[]}}class d{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class h extends a{constructor(){super(...arguments),this.uniforms=new c(this),this.main=new u(this),this.code=new d(this),this.constants=new m(this)}get builder(){return this}}class f{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class g{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)?o().warn(`Ignoring duplicate varying ${t} ${e}`):this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((i,n)=>t.push("vertex"===e?`out ${i} ${n};`:`in ${i} ${n};`))),t}}class p{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?p.ALLOWLIST_VERTEX:p.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}p.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],p.ALLOWLIST_VERTEX=[];class v{constructor(){this._entries=new Map}add(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this._entries.get(i);n?.name!==e||n?.type!==t?this._entries.set(i,{name:e,type:t}):o().warn(`Fragment shader output location ${i} occupied`)}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:v.DEFAULT_NAME,type:v.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,i)=>t.push(`layout(location = ${i}) out ${e.type} ${e.name};`))),t}}v.DEFAULT_TYPE="vec4",v.DEFAULT_NAME="fragColor";class m{constructor(e){this._stage=e,this._entries=new Set}add(e,t,i){let n="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":n=m._numberToFloatStr(i);break;case"int":n=m._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${m._numberToFloatStr(i[0])},                            ${m._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${m._numberToFloatStr(i[0])},                            ${m._numberToFloatStr(i[1])},                            ${m._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${m._numberToFloatStr(i[0])},                            ${m._numberToFloatStr(i[1])},                            ${m._numberToFloatStr(i[2])},                            ${m._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${m._numberToIntStr(i[0])},                             ${m._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${m._numberToIntStr(i[0])},                             ${m._numberToIntStr(i[1])},                             ${m._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${m._numberToIntStr(i[0])},                             ${m._numberToIntStr(i[1])},                             ${m._numberToIntStr(i[2])},                             ${m._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${t}(${Array.prototype.map.call(i,(e=>m._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${n};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const _="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n#endif",A="precision highp float;\nprecision highp sampler2D;"},8815:(e,t,i)=>{i.d(t,{W:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"vec3",n.c.Draw,((i,n,r,s)=>i.setUniform3fv(e,t(n,r,s))))}}},9215:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(71723);class r{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}getTechnique(e,t){return this._techniques.get(e,this._material.getConfiguration(this._output,t))}ensureResources(e){return n.Am.LOADED}}},11833:(e,t,i)=>{function n(e){const t=3.141592653589793,i=.3183098861837907;e.vertex.constants.add("PI","float",t),e.fragment.constants.add("PI","float",t),e.fragment.constants.add("LIGHT_NORMALIZATION","float",i),e.fragment.constants.add("INV_PI","float",i),e.fragment.constants.add("HALF_PI","float",1.570796326794897),e.fragment.constants.add("TWO_PI","float",6.28318530717958)}i.d(t,{p:()=>n})},12621:(e,t,i)=>{i.d(t,{Q:()=>n});const n=1/255.5},12723:(e,t,i)=>{i.d(t,{Ey:()=>C,Ky:()=>d,Ms:()=>X,Os:()=>u,PI:()=>h,Uy:()=>p,Xt:()=>g,fg:()=>l,gh:()=>a,hG:()=>f,kn:()=>v,ox:()=>s,p3:()=>o,vg:()=>c});var n=i(71723),r=i(92156);function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Tb.ADD,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}}function o(e,t,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.Tb.ADD,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:r.Tb.ADD,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,0];return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:n,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a=s(r.dn.ZERO,r.dn.ONE_MINUS_SRC_ALPHA),l=s(r.dn.ONE,r.dn.ZERO),c=s(r.dn.ONE,r.dn.ONE),u=s(r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA),d=o(r.dn.SRC_ALPHA,r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA,r.dn.ONE_MINUS_SRC_ALPHA),h={face:r.Y7.BACK,mode:r.Ac.CCW},f={face:r.Y7.FRONT,mode:r.Ac.CCW},g=e=>e===n.s2.Back?h:e===n.s2.Front?f:null,p={zNear:0,zFar:1},v={r:!0,g:!0,b:!0,a:!0};function m(e){return P.intern(e)}function _(e){return R.intern(e)}function A(e){return D.intern(e)}function T(e){return N.intern(e)}function x(e){return B.intern(e)}function E(e){return F.intern(e)}function y(e){return V.intern(e)}function b(e){return W.intern(e)}function S(e){return k.intern(e)}function C(e){return K.intern(e)}class w{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),i=this._interns;return i.has(t)||i.set(t,this._makeRef(e)),i.get(t)??null}}function I(e){return"["+e.join(",")+"]"}const P=new w(O,(e=>({__tag:"Blending",...e})));function O(e){return e?I([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const R=new w(M,(e=>({__tag:"Culling",...e})));function M(e){return e?I([e.face,e.mode]):null}const D=new w(L,(e=>({__tag:"PolygonOffset",...e})));function L(e){return e?I([e.factor,e.units]):null}const N=new w(U,(e=>({__tag:"DepthTest",...e})));function U(e){return e?I([e.func]):null}const B=new w(z,(e=>({__tag:"StencilTest",...e})));function z(e){return e?I([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const F=new w(H,(e=>({__tag:"DepthWrite",...e})));function H(e){return e?I([e.zNear,e.zFar]):null}const V=new w(G,(e=>({__tag:"ColorWrite",...e})));function G(e){return e?I([e.r,e.g,e.b,e.a]):null}const W=new w($,(e=>({__tag:"StencilWrite",...e})));function $(e){return e?I([e.mask]):null}const k=new w(j,(e=>({__tag:"DrawBuffers",...e})));function j(e){return e?I(e.buffers):null}const K=new w((function(e){return e?I([O(e.blending),M(e.culling),L(e.polygonOffset),U(e.depthTest),z(e.stencilTest),H(e.depthWrite),G(e.colorWrite),$(e.stencilWrite),j(e.drawBuffers)]):null}),(e=>({blending:m(e.blending),culling:_(e.culling),polygonOffset:A(e.polygonOffset),depthTest:T(e.depthTest),stencilTest:x(e.stencilTest),depthWrite:E(e.depthWrite),colorWrite:y(e.colorWrite),stencilWrite:b(e.stencilWrite),drawBuffers:S(e.drawBuffers)})));class X{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,i,n){return(i||e!==t)&&(n(e),this._pipelineInvalid=!0),e}}},12893:(e,t,i)=>{i.d(t,{r:()=>r});var n=i(16878);function r(e){e.fragment.code.add(n.H`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}},12901:(e,t,i)=>{i.d(t,{S:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"mat4",n.c.Draw,((i,n,r)=>i.setUniformMatrix4fv(e,t(n,r))))}}},14480:(e,t,i)=>{i.d(t,{z:()=>u});var n=i(96236),r=i(82606),s=i(65228),o=i(66652),a=i(16878),l=i(86836),c=i(12621);function u(e,t){e.include(s.Q,t),e.include(r.NL,t),e.fragment.include(o.a);const i=t.output===n.V.ObjectAndLayerIdColor,u=(0,n.LG)(t.output),d=(0,n.RN)(t.output)&&t.oitPass===l.Y.ColorAlpha,h=(0,n.RN)(t.output)&&t.oitPass!==l.Y.ColorAlpha,f=t.discardInvisibleFragments;let g=0;(h||u||d)&&e.outputs.add("fragColor","vec4",g++),u&&e.outputs.add("fragEmission","vec4",g++),d&&e.outputs.add("fragAlpha","float",g++),e.fragment.code.add(a.H`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${(0,a.If)(i,"finalColor.a = 1.0;")}

      ${(0,a.If)(f,`if (finalColor.a < ${a.H.float(c.Q)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${(0,a.If)(d,a.H`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${(0,a.If)(h,"fragColor = finalColor;")}
      ${(0,a.If)(u,"fragEmission = finalColor.a * getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${(0,a.If)(i,"outputObjectAndLayerIdColor();")}
    }
  `)}},15025:(e,t,i)=>{i.d(t,{E:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"vec2",n.c.Bind,((i,n)=>i.setUniform2fv(e,t(n))))}}},16434:(e,t,i)=>{i.d(t,{w:()=>d});var n=i(50925),r=i(17741),s=i(69586),o=i(15899),a=i(24591);class l{constructor(e,t,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new o.A({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex",!0),t.generate("fragment",!0),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=t.generateBind(this),this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=(0,a.en)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform2iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let i=this._textures.get(e);return null==i?(i=this._allocTextureUnit(t),this._textures.set(e,i)):i.texture=t,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(t,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}var c=i(92156),u=i(12723);class d{constructor(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.D;this.locations=o,this.primitiveType=c.WR.TRIANGLES,this.key=t.key,this._program=new l(e.rctx,i.get().build(t),o),this._pipeline=this.initializePipeline(t),this.reload=async s=>{s&&await i.reload(),this.key.equals(t.key)||n.A.getLogger("esri.views.3d.webgl.ShaderTechnique").warn("Configuration was changed after construction, cannot reload shader.",i),(0,r.WD)(this._program),this._program=new l(e.rctx,i.get().build(t),o),this._pipeline=this.initializePipeline(t)}}destroy(){this._program=(0,r.WD)(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,t){return this._pipeline}initializePipeline(e){return(0,u.Ey)({blending:u.Os,colorWrite:u.kn})}}},16878:(e,t,i)=>{function n(e){let t="";for(let i=0;i<(arguments.length<=1?0:arguments.length-1);i++)t+=e[i]+(i+1<1||arguments.length<=i+1?void 0:arguments[i+1]);return t+=e[e.length-1],t}function r(e,t){return e?t:arguments.length>2&&void 0!==arguments[2]?arguments[2]:""}i.d(t,{H:()=>n,If:()=>r}),function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(n)},21484:(e,t,i)=>{i.d(t,{K:()=>a,W:()=>l});var n=i(74719),r=i(62631);class s{constructor(e){this._bits=[...e]}equals(e){return(0,r.aI)(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}}var o=i(20783);class a extends o.Y{constructor(){super(),this._parameterBits=this._parameterBits?.map((()=>0))??[],this._parameterNames??=[]}get key(){return this._key??=new s(this._parameterBits),this._key}decode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.key;const t=this._parameterBits;this._parameterBits=[...e.bits];const i=this._parameterNames.map((e=>`    ${e}: ${this[e]}`)).join("\n");return this._parameterBits=t,i}}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,i)=>{t.hasOwnProperty("_parameterNames")||Object.defineProperty(t,"_parameterNames",{value:t._parameterNames?.slice()??[],configurable:!0,writable:!0}),t.hasOwnProperty("_parameterBits")||Object.defineProperty(t,"_parameterBits",{value:t._parameterBits?.slice()??[0],configurable:!0,writable:!0}),t._parameterNames.push(i);const r=e.count||2,s=Math.ceil(Math.log2(r)),o=t._parameterBits;let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);const l=o[a],c=(1<<s)-1<<l;o[a]+=s,e.count?Object.defineProperty(t,i,{get(){return(this._parameterBits[a]&c)>>l},set(t){if(this[i]!==t){if(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+t<<l&c,"number"!=typeof t)throw new n.default(`Configuration value for ${i} must be a number, got ${typeof t}`);if(null==e.count)throw new n.default(`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(t,i,{get(){return!!((this._parameterBits[a]&c)>>l)},set(e){if(this[i]!==e&&(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"boolean"!=typeof e))throw new n.default(`Configuration value for ${i} must be boolean, got ${typeof e}`)}})}}},22392:(e,t,i)=>{i.d(t,{F:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t,i){super(e,"vec4",n.c.Pass,((i,n,r)=>i.setUniform4fv(e,t(n,r))),i)}}},25735:(e,t,i)=>{i.d(t,{V:()=>A});var n=i(10382),r=i(89227),s=i(55239),o=i(72840),a=i(68957),l=i(33683),c=i(69291),u=i(28473),d=i(54380);const h=(0,u.vt)(),f=(0,u.vt)(),g=(0,u.vt)(),p=(0,u.vt)();var v=i(86845),m=i(89893),_=i(22131);class A extends l.J{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c.X.Mesh,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;super(),this.material=e,this.mapPositions=i,this.type=n,this.objectAndLayerIdColor=r,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of t)this._attributes.set(a,{...l,indices:(0,s.Dg)(l.indices)}),a===_.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new A(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,i)=>{e.exclusive=!1,t._attributes.set(i,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:(0,o.S)(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const i=this._attributes.get(e);i&&this._attributes.set(e,{...i,exclusive:!0,data:t})}get indexCount(){const e=this._attributes.values().next().value?.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===c.X.Mesh?this._computeAttachmentOriginTriangles(e):this.type===c.X.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&(0,r.t)(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){return function(e,t){if(!e)return!1;const{size:i,data:n,indices:s}=e;(0,r.i)(t,0,0,0),(0,r.i)(p,0,0,0);let o=0,a=0;for(let l=0;l<s.length-2;l+=3){const e=s[l]*i,c=s[l+1]*i,u=s[l+2]*i;(0,r.i)(h,n[e],n[e+1],n[e+2]),(0,r.i)(f,n[c],n[c+1],n[c+2]),(0,r.i)(g,n[u],n[u+1],n[u+2]);const v=(0,d.Q7)(h,f,g);v?((0,r.g)(h,h,f),(0,r.g)(h,h,g),(0,r.h)(h,h,1/3*v),(0,r.g)(t,t,h),o+=v):((0,r.g)(p,p,h),(0,r.g)(p,p,f),(0,r.g)(p,p,g),a+=3)}return(0!==a||0!==o)&&(0!==o?((0,r.h)(t,t,1/o),!0):0!==a&&((0,r.h)(t,p,1/a),!0))}(this.attributes.get(_.r.POSITION),e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(_.r.POSITION);return function(e,t,i){if(!e)return!1;(0,r.i)(i,0,0,0),(0,r.i)(p,0,0,0);let n=0,s=0;const{size:o,data:a,indices:l}=e,c=l.length-1,u=c+(t?2:0);for(let d=0;d<u;d+=2){const e=d<c?d+1:0,t=l[d<c?d:c]*o,u=l[e]*o;h[0]=a[t],h[1]=a[t+1],h[2]=a[t+2],f[0]=a[u],f[1]=a[u+1],f[2]=a[u+2],(0,r.h)(h,(0,r.g)(h,h,f),.5);const g=(0,r.G)(h,f);g>0?((0,r.g)(i,i,(0,r.h)(h,h,g)),n+=g):0===n&&((0,r.g)(p,p,h),s++)}return 0!==n?((0,r.h)(i,i,1/n),!0):0!==s&&((0,r.h)(i,p,1/s),!0)}(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){return function(e,t){if(!e)return!1;const{size:i,data:n,indices:s}=e;(0,r.i)(t,0,0,0);let o=-1,a=0;for(let r=0;r<s.length;r++){const e=s[r]*i;o!==e&&(t[0]+=n[e],t[1]+=n[e+1],t[2]+=n[e+2],a++),o=e}return a>1&&(0,r.h)(t,t,1/a),a>0}(this.attributes.get(_.r.POSITION),e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(_.r.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===c.X.Mesh?3:1;(0,m.vA)(e.indices.length%t==0,"Indexing error: "+e.indices.length+" not divisible by "+t);const i=(0,s.tM)(e.indices.length/t);return new a.j(i,t,e)}get transformation(){return this._transformation??n.zK}set transformation(e){this._transformation=e&&e!==n.zK?(0,n.o8)(e):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(e){this._highlightOptionsCounts.forEach(((t,i)=>e(i)))}allocateIdAndHighlight(e){const t=new v.h(e);return this.addHighlight(t)}addHighlight(e){this.highlights.add(e);const{highlightName:t}=e,i=(this._highlightOptionsCounts.get(t)??0)+1;return this._highlightOptionsCounts.set(t,i),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightName:t}=e,i=this._highlightOptionsCounts.get(t)??0;i<=1?this._highlightOptionsCounts.delete(t):this._highlightOptionsCounts.set(t,i-1)}}}},33273:(e,t,i)=>{i.d(t,{E:()=>a});var n=i(32006),r=i(98080),s=i(15025),o=i(16878);function a(e){e.uniforms.add(new s.E("zProjectionMap",(e=>function(e){const t=e.projectionMatrix;return(0,n.hZ)(l,t[14],t[10])}(e.camera)))),e.code.add(o.H`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(o.H`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(o.H`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const l=(0,r.vt)()},34927:(e,t,i)=>{i.d(t,{I:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"vec4",n.c.Bind,((i,n)=>i.setUniform4fv(e,t(n))))}}},35490:(e,t,i)=>{i.d(t,{NB:()=>f,Nz:()=>m,S7:()=>v,yu:()=>h});var n=i(87752),r=i(10382),s=i(89227),o=i(28473),a=i(87824),l=i(8815),c=i(4241),u=i(38950),d=i(12901);function h(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.uY):e.uniforms.add(new l.W("cameraPosition",((e,t)=>(0,s.i)(p,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function f(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new u.F("proj",(e=>e.camera.projectionMatrix)),new d.S("view",((e,t)=>(0,n.Tl)(g,t.camera.viewMatrix,e.origin))),new l.W("localOrigin",(e=>e.origin)));const i=e=>{let{camera:t}=e;return(0,s.i)(p,t.viewInverseTransposeMatrix[3],t.viewInverseTransposeMatrix[7],t.viewInverseTransposeMatrix[11])};e.uniforms.add(new u.F("proj",(e=>e.camera.projectionMatrix)),new u.F("view",(e=>(0,n.Tl)(g,e.camera.viewMatrix,i(e)))),new a.d("localOrigin",(e=>i(e))))}const g=(0,r.vt)(),p=(0,o.vt)();function v(e){e.uniforms.add(new u.F("viewNormal",(e=>e.camera.viewInverseTransposeMatrix)))}function m(e){e.uniforms.add(new c.U("pixelRatio",(e=>e.camera.pixelRatio/e.overlayStretch)))}},35694:(e,t,i)=>{i.d(t,{NV:()=>u,m8:()=>l});var n=i(17741),r=i(49959),s=i(71723),o=i(9215),a=i(20783);class l extends o.A{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){super.dispose(),this._texture=(0,n.Gz)(this._texture),this._textureNormal=(0,n.Gz)(this._textureNormal),this._textureEmissive=(0,n.Gz)(this._textureEmissive),this._textureOcclusion=(0,n.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,n.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?s.Am.LOADED:s.Am.LOADING}get textureBindParameters(){return new u(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=(0,n.Gz)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if(null==e)return void t(null);const i=this._textures.acquire(e);if((0,r.isPromiseLike)(i))return++this._numLoading,void i.then((e=>{if(this._disposed)return(0,n.Gz)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(i)}}class c extends a.Y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.textureEmissive=e}}class u extends c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;super(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null),this.texture=e,this.textureNormal=t,this.textureOcclusion=i,this.textureMetallicRoughness=n,this.scale=r,this.normalTextureTransformMatrix=s}}},38950:(e,t,i)=>{i.d(t,{F:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"mat4",n.c.Bind,((i,n)=>i.setUniformMatrix4fv(e,t(n))))}}},42403:(e,t,i)=>{i.d(t,{m:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"float",n.c.Pass,((i,n,r)=>i.setUniform1f(e,t(n,r))))}}},46576:(e,t,i)=>{i.d(t,{AK:()=>a,Wz:()=>o,oe:()=>r,p_:()=>s});var n=i(25048);function r(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=n.y9?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function s(e){return Array.isArray(e)?e.length<n.y9?e:new Float32Array(e):e.length<n.y9?Array.from(e):e}function o(e){return(Array.isArray(e)?e.length:e.byteLength/8)<=n.y9?Array.from(e):new Float32Array(e)}function a(e,t,i){return Array.isArray(e)?e.slice(t,t+i):e.subarray(t,t+i)}},51446:(e,t,i)=>{i.d(t,{g:()=>I});i(21265);var n=i(74719),r=i(58448),s=i(17741),o=i(49959),a=i(25048),l=i(43103),c=i(72538),u=i(91367),d=i(71723),h=i(85083),f=i(33683),g=i(69291),p=i(50925),v=i(92156),m=i(64177);const _=()=>p.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function A(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const T=A("DXT1"),x=A("DXT3"),E=A("DXT5");function y(e,t){const i=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==i[0])return _().error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return _().error("Unsupported format, must contain a FourCC code"),null;const n=i[21];let r,s;switch(n){case T:r=8,s=v.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case x:r=16,s=v.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case E:r=16,s=v.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return _().error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(n)),null}let o=1,a=i[4],l=i[3];(3&a||3&l)&&(_().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,h;131072&i[2]&&!1!==t&&(o=Math.max(1,i[7]));let f=e.byteOffset+i[1]+4;const g=[];for(let p=0;p<o;++p)h=(a+3>>2)*(l+3>>2)*r,d=new Uint8Array(e.buffer,f,h),g.push(d),f+=h,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:s,width:c,height:u}}var b,S=i(85293),C=i(89893),w=i(77936);class I extends f.J{constructor(e,t){super(),this._data=e,this.type=g.X.Texture,this.events=new r.A,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this._parameters={...O,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,l.isBlobProtocol)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,l.isDataProtocol)(e.src)||(0,l.isBlobProtocol)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new w.R;return t.wrapMode=this._parameters.wrap??v.pF.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?v.Cj.LINEAR_MIPMAP_LINEAR:v.Cj.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if((0,a.mw)(e)||(0,a.mg)(e))return t.encoding===d.JS.KTX2_ENCODING?(0,h.JI)(e,!!t.mipmap):t.encoding===d.JS.BASIS_ENCODING?(0,h.Cr)(e,!!t.mipmap):e.byteLength;const{width:i,height:n}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?P(e):t;return(t.mipmap?4/3:1)*i*n*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new m.g(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):(0,a.mg)(t)&&this._parameters.encoding===d.JS.DDS_ENCODING?this._loadFromDDSData(e,t):(0,a.mw)(t)&&this._parameters.encoding===d.JS.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(t)):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===d.JS.KTX2_ENCODING?this._loadFromKTX2(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===d.JS.BASIS_ENCODING?this._loadFromBasis(e,t):(0,a.mg)(t)?this._loadFromPixelData(e,t):(0,a.mw)(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<b.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,i){const n=y(i,t.hasMipmap??!1);if(null==n)throw new Error("DDS texture data is null");const{textureData:r,internalFormat:s,width:o,height:a}=n;return t.samplingMode=r.levels.length>1?v.Cj.LINEAR_MIPMAP_LINEAR:v.Cj.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=o,t.height=a,new m.g(e,t,r)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>(0,h.Vc)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>(0,h.KV)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,C.vA)(this._parameters.width>0&&this._parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=1===this._parameters.components?v.Ab.LUMINANCE:3===this._parameters.components?v.Ab.RGB:v.Ab.RGBA,i.width=this._parameters.width??0,i.height=this._parameters.height??0,this._glTexture=new m.g(e,i,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async i=>{const n=await(0,c.D)(t,{signal:i});return(0,o.throwIfAborted)(i),this._loadFromImage(e,n)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async i=>{const n=await(0,u.Sx)(t,t.src,!1,i);return(0,o.throwIfAborted)(i),this._loadFromImage(e,n)}))}_loadFromVideoElement(e,t){return t.readyState>=b.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((i=>new Promise(((r,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),(0,s.xt)(d)},c=()=>{t.readyState>=b.HAVE_CURRENT_DATA&&(l(),r(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new n.default("Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const d=(0,o.onAbort)(i,(()=>u((0,o.createAbortError)())))}))))}_loadFromImage(e,t){let i=t;if(!(i instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;i=this._parameters.downsampleUncompressed?(0,S.IR)(i,t):(0,S.vM)(i,t)}const n=P(i);this._parameters.width=n.width,this._parameters.height=n.height;const r=this._createDescriptor(e);return r.pixelFormat=3===this._parameters.components?v.Ab.RGB:v.Ab.RGBA,r.width=n.width,r.height=n.height,r.shouldCompress=this._parameters.shouldCompress,this._glTexture=new m.g(e,r,i),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const i=e(t.signal);this._loadingPromise=i;const n=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}unload(){if(this._glTexture=(0,s.WD)(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}}function P(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}!function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(b||(b={}));const O={wrap:{s:v.pF.REPEAT,t:v.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1,shouldCompress:!1}},51448:(e,t,i)=>{i.d(t,{E:()=>c});var n=i(93800),r=i(96236),s=i(21484);class o extends s.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,n._)([(0,s.W)()],o.prototype,"instancedDoublePrecision",void 0),(0,n._)([(0,s.W)()],o.prototype,"hasModelTransformation",void 0);var a=i(86836),l=i(73031);class c extends o{constructor(){super(...arguments),this.output=r.V.Color,this.oitPass=a.Y.NONE,this.hasSlicePlane=!1,this.bindType=l.c.Pass,this.writeDepth=!0}}(0,n._)([(0,s.W)({count:r.V.COUNT})],c.prototype,"output",void 0),(0,n._)([(0,s.W)({count:a.Y.COUNT})],c.prototype,"oitPass",void 0),(0,n._)([(0,s.W)()],c.prototype,"hasSlicePlane",void 0)},53801:(e,t,i)=>{var n;i.d(t,{N:()=>n}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.HUD_MATERIAL=12]="HUD_MATERIAL",e[e.LABEL_MATERIAL=13]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=14]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",e[e.OVERLAY=16]="OVERLAY",e[e.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",e[e.DRAPED_WATER=18]="DRAPED_WATER",e[e.VOXEL=19]="VOXEL",e[e.MAX_SLOTS=20]="MAX_SLOTS"}(n||(n={}))},54380:(e,t,i)=>{i.d(t,{Fm:()=>c,Q7:()=>u,Ui:()=>l});var n=i(32636),r=i(89227),s=i(28473),o=i(1277);i(1696);function a(e){return e?{p0:(0,s.o8)(e.p0),p1:(0,s.o8)(e.p1),p2:(0,s.o8)(e.p2)}:{p0:(0,s.vt)(),p1:(0,s.vt)(),p2:(0,s.vt)()}}function l(e,t,i){const{direction:n,origin:s}=t,{p0:o,p1:a,p2:l}=e,c=a[0]-o[0],u=a[1]-o[1],d=a[2]-o[2],h=l[0]-o[0],f=l[1]-o[1],g=l[2]-o[2],p=n[1]*g-f*n[2],v=n[2]*h-g*n[0],m=n[0]*f-h*n[1],_=c*p+u*v+d*m;if(_>-1e-5&&_<1e-5)return!1;const A=1/_,T=s[0]-o[0],x=s[1]-o[1],E=s[2]-o[2],y=A*(T*p+x*v+E*m);if(y<0||y>1)return!1;const b=x*d-u*E,S=E*c-d*T,C=T*u-c*x,w=A*(n[0]*b+n[1]*S+n[2]*C);return!(w<0||y+w>1)&&(i&&((0,r.h)(i,n,A*(h*b+f*S+g*C)),(0,r.g)(i,s,i)),!0)}function c(e,t,i){const n=t[0]-e[0],r=t[1]-e[1],s=i[0]-e[0],o=i[1]-e[1];return.5*Math.abs(n*o-r*s)}function u(e,t,i){return(0,r.d)(d,t,e),(0,r.d)(h,i,e),.5*(0,r.l)((0,r.e)(d,d,h))}new n.I(o.vt),new n.I((()=>a()));const d=(0,s.vt)(),h=(0,s.vt)()},55239:(e,t,i)=>{i.d(t,{BF:()=>g,Dg:()=>r,EH:()=>f,JH:()=>o,my:()=>s,tM:()=>u});var n=i(25048);function r(e){if(Array.isArray(e)){if(e.length<n.y9)return e}else if(e.length<n.y9)return Array.from(e);let t=!0,i=!0;return e.some(((e,n)=>(t=t&&0===e,i=i&&e===n,!t&&!i))),t?f(e.length):i?u(e.length):(0,n.iu)(e)&&e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?e:function(e){let t=!0;for(const i of e){if(i>=65536)return(0,n.iu)(e)?e:new Uint32Array(e);i>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}(e)}function s(e){return e<=n.y9?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function o(e){return e<=n.y9?new Array(e):new Uint32Array(e)}let a=d(131072);const l=[0],c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function u(e){return 1===e?l:e<n.y9?Array.from(new Uint16Array(c.buffer,0,e)):e<c.length?new Uint16Array(c.buffer,0,e):(e>a.length&&(a=d(Math.max(2*a.length,e))),new Uint32Array(a.buffer,0,e))}function d(e){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}let h=new Uint8Array(65536);function f(e){if(1===e)return l;if(e<n.y9)return new Array(e).fill(0);if(e>h.length){const t=Math.max(2*h.length,e);h=new Uint8Array(t)}return new Uint8Array(h.buffer,0,e)}function g(){a=d(131072),h=new Uint8Array(65536)}},57554:(e,t,i)=>{i.d(t,{t:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"vec3",n.c.Pass,((i,n,r)=>i.setUniform3fv(e,t(n,r))))}}},59246:(e,t,i)=>{var n;i.d(t,{n:()=>n}),function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(n||(n={}))},61535:(e,t,i)=>{i.d(t,{Z:()=>o});var n=i(33273),r=i(16878),s=i(73712);function o(e,t){let{occlusionPass:i,terrainDepthTest:o,cullAboveTerrain:a}=t;const l=e.vertex,c=e.fragment;if(!o)return l.code.add("void forwardViewPosDepth(vec3 pos) {}"),void c.code.add(`${i?"bool":"void"} discardByTerrainDepth() { ${(0,r.If)(i,"return false;")}}`);e.varyings.add("viewPosDepth","float"),l.code.add("void forwardViewPosDepth(vec3 pos) {\n    viewPosDepth = pos.z;\n  }"),c.include(n.E),c.uniforms.add(new s.x("terrainDepthTexture",(e=>e.terrainDepth?.attachment))).code.add(r.H`
    ${i?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${i?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${a?">":"<="} linearDepth) discard;`}
    }`)}},65228:(e,t,i)=>{i.d(t,{Q:()=>d});var n=i(15),r=i(96236),s=i(16878),o=i(73031),a=i(826);class l extends a.n{constructor(e,t){super(e,"ivec2",o.c.Bind,((i,n)=>i.setUniform2iv(e,t(n))))}}var c=i(68017),u=i(73712);function d(e,t){const{fragment:i}=e;t.output===r.V.Highlight?(i.uniforms.add(new u.x("depthTexture",(e=>e.mainDepth)),new u.x("highlightTexture",(e=>e.highlightMixTexture)),new c.W("highlightLevel",(e=>e.highlightLevel??0)),new l("highlightMixOrigin",(e=>e.highlightMixOrigin))),e.outputs.add("fragHighlight","vec2",0),e.include(n.y),i.code.add(s.H`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),t.canHaveOverlay&&i.code.add(s.H`void calculateOcclusionAndOutputHighlightOverlay(vec2 highlightToAdd) {
uint levelBits = readLevelBits(highlightToAdd, highlightLevel);
if ((levelBits & 1u) == 0u) { discard; }
outputHighlight(isHighlightOccluded());
}`)):i.code.add(s.H`void calculateOcclusionAndOutputHighlight() {}`)}},66652:(e,t,i)=>{i.d(t,{a:()=>r});var n=i(16878);function r(e){e.code.add(n.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},67058:(e,t,i)=>{i.d(t,{N:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"sampler2D",n.c.Pass,((i,n,r)=>i.bindTexture(e,t(n,r))))}}},68017:(e,t,i)=>{i.d(t,{W:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"int",n.c.Bind,((i,n)=>i.setUniform1i(e,t(n))))}}},68957:(e,t,i)=>{i.d(t,{j:()=>a});var n=i(15899),r=i(89227),s=i(28473),o=i(89893);class a{constructor(e,t,i){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=i,this._children=void 0,(0,o.vA)(e.length>=1),(0,o.vA)(3===i.size||4===i.size);const{data:n,size:a,indices:c}=i;(0,o.vA)(c.length%this._numIndexPerPrimitive==0),(0,o.vA)(c.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let d=a*c[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(d);const h=(0,s.fA)(n[d],n[d+1],n[d+2]),f=(0,s.o8)(h);for(let r=0;r<u;++r){const t=this._numIndexPerPrimitive*e[r];for(let e=0;e<this._numIndexPerPrimitive;++e){d=a*c[t+e],l.push(d);let i=n[d];h[0]=Math.min(i,h[0]),f[0]=Math.max(i,f[0]),i=n[d+1],h[1]=Math.min(i,h[1]),f[1]=Math.max(i,f[1]),i=n[d+2],h[2]=Math.min(i,h[2]),f[2]=Math.max(i,f[2])}}this.bbMin=h,this.bbMax=f;const g=(0,r.m)((0,s.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(f[0]-h[0],f[1]-h[1]),f[2]-h[2]);let p=this.radius*this.radius;for(let r=0;r<l.length;++r){d=l.at(r);const e=n[d]-g[0],t=n[d+1]-g[1],i=n[d+2]-g[2],s=e*e+t*t+i*i;if(s<=p)continue;const o=Math.sqrt(s),a=.5*(o-this.radius);this.radius=this.radius+a,p=this.radius*this.radius;const c=a/o;g[0]+=e*c,g[1]+=t*c,g[2]+=i*c}this.center=g,l.clear()}getChildren(){if(this._children||(0,r.s)(this.bbMin,this.bbMax)<=1)return this._children;const e=(0,r.m)((0,s.vt)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),n=new Array(8);for(let r=0;r<8;++r)n[r]=0;const{data:o,size:l,indices:c}=this.position;for(let r=0;r<t;++r){let t=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[r];let a=l*c[s],u=o[a],d=o[a+1],h=o[a+2];for(let e=1;e<this._numIndexPerPrimitive;++e){a=l*c[s+e];const t=o[a],i=o[a+1],n=o[a+2];t<u&&(u=t),i<d&&(d=i),n<h&&(h=n)}u<e[0]&&(t|=1),d<e[1]&&(t|=2),h<e[2]&&(t|=4),i[r]=t,++n[t]}let u=0;for(let r=0;r<8;++r)n[r]>0&&++u;if(u<2)return;const d=new Array(8);for(let r=0;r<8;++r)d[r]=n[r]>0?new Uint32Array(n[r]):void 0;for(let r=0;r<8;++r)n[r]=0;for(let r=0;r<t;++r){const e=i[r];d[e][n[e]++]=this.primitiveIndices[r]}this._children=new Array;for(let r=0;r<8;++r)void 0!==d[r]&&this._children.push(new a(d[r],this._numIndexPerPrimitive,this.position));return this._children}static prune(){l.prune()}}const l=new n.A({deallocator:null})},69261:(e,t,i)=>{i.d(t,{I:()=>n,U:()=>a});var n,r=i(7951),s=i(16878),o=i(22131);function a(e,t){switch(t.textureCoordinateType){case n.Default:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case n.Compressed:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case n.Atlas:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(o.r.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,r.Xb)(t.textureCoordinateType);case n.None:return void e.vertex.code.add(s.H`void forwardTextureCoordinates() {}`);case n.COUNT:return}}!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.Compressed=3]="Compressed",e[e.COUNT=4]="COUNT"}(n||(n={}))},71723:(e,t,i)=>{var n,r,s,o,a,l,c,u;i.d(t,{Am:()=>o,C7:()=>s,JS:()=>u,Mg:()=>l,dd:()=>a,it:()=>r,s2:()=>n,sf:()=>c}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(n||(n={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(r||(r={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(s||(s={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(o||(o={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee"}(l||(l={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(c||(c={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(u||(u={}))},72538:(e,t,i)=>{i.d(t,{D:()=>r});var n=i(23060);async function r(e,t){const{data:i}=await(0,n.default)(e,{responseType:"image",...t});return i}},72840:(e,t,i)=>{i.d(t,{S:()=>r});var n=i(25048);function r(e){if(e.length<n.y9)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return(0,n.jq)(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}},73031:(e,t,i)=>{var n;i.d(t,{c:()=>n}),function(e){e[e.Bind=0]="Bind",e[e.Pass=1]="Pass",e[e.Draw=2]="Draw"}(n||(n={}))},73712:(e,t,i)=>{i.d(t,{x:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"sampler2D",n.c.Bind,((i,n)=>i.bindTexture(e,t(n))))}}},74802:(e,t,i)=>{i.d(t,{x:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t,i){super(e,"float",n.c.Pass,((i,n,r)=>i.setUniform1fv(e,t(n,r))),i)}}},75304:(e,t,i)=>{i.d(t,{HQ:()=>f,S4:()=>h,dk:()=>d,rA:()=>g});var n=i(87752),r=i(10382),s=i(89227),o=i(28473),a=i(8815),l=i(57554),c=i(16878),u=i(20783);class d extends u.Y{constructor(e){super(),this.slicePlaneLocalOrigin=e}}function h(e,t){m(e,t,new l.t("slicePlaneOrigin",((e,i)=>x(t,e,i))),new l.t("slicePlaneBasis1",((e,i)=>E(t,e,i,i.slicePlane?.basis1))),new l.t("slicePlaneBasis2",((e,i)=>E(t,e,i,i.slicePlane?.basis2))))}function f(e,t){m(e,t,new a.W("slicePlaneOrigin",((e,i)=>x(t,e,i))),new a.W("slicePlaneBasis1",((e,i)=>E(t,e,i,i.slicePlane?.basis1))),new a.W("slicePlaneBasis2",((e,i)=>E(t,e,i,i.slicePlane?.basis2))))}function g(e,t){v(e,t,new a.W("slicePlaneOrigin",((e,i)=>x(t,e,i))),new a.W("slicePlaneBasis1",((e,i)=>E(t,e,i,i.slicePlane?.basis1))),new a.W("slicePlaneBasis2",((e,i)=>E(t,e,i,i.slicePlane?.basis2))))}const p=c.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function v(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];t.hasSlicePlane?(e.uniforms.add(...n),e.code.add(p)):e.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function m(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];v(e,t,...n),t.hasSlicePlane?e.code.add("\n    void discardBySlice(vec3 pos) {\n      if (sliceByPlane(pos)) {\n        discard;\n      }\n    }\n\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\n      SliceFactors factors = calculateSliceFactors(pos);\n\n      factors.front /= 2.0 * fwidth(factors.front);\n      factors.side0 /= 2.0 * fwidth(factors.side0);\n      factors.side1 /= 2.0 * fwidth(factors.side1);\n      factors.side2 /= 2.0 * fwidth(factors.side2);\n      factors.side3 /= 2.0 * fwidth(factors.side3);\n\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\n      if (sliceByFactors(factors)) {\n        return color;\n      }\n\n      float outlineFactor = (1.0 - step(0.5, factors.front))\n        * (1.0 - step(0.5, factors.side0))\n        * (1.0 - step(0.5, factors.side1))\n        * (1.0 - step(0.5, factors.side2))\n        * (1.0 - step(0.5, factors.side3));\n\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\n    }\n\n    vec4 applySlice(vec4 color, vec3 pos) {\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\n    }\n  "):e.code.add(c.H`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function _(e,t,i){return e.instancedDoublePrecision?(0,s.i)(y,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function A(e,t){return null!=e?(0,s.d)(b,t.origin,e):t.origin}function T(e,t,i){return e.hasSliceTranslatedView?null!=t?(0,n.Tl)(C,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function x(e,t,i){if(null==i.slicePlane)return o.uY;const n=_(e,t,i),r=A(n,i.slicePlane),a=T(e,n,i);return null!=a?(0,s.t)(b,r,a):r}function E(e,t,i,n){if(null==n||null==i.slicePlane)return o.uY;const r=_(e,t,i),a=A(r,i.slicePlane),l=T(e,r,i);return null!=l?((0,s.g)(S,n,a),(0,s.t)(b,a,l),(0,s.t)(S,S,l),(0,s.d)(S,S,b)):n}const y=(0,o.vt)(),b=(0,o.vt)(),S=(0,o.vt)(),C=(0,r.vt)()},75762:(e,t,i)=>{i.d(t,{A:()=>u});var n=i(57554),r=i(22392),s=i(74802),o=i(16878),a=i(80203),l=i(22131),c=i(90623);function u(e,t){const{vertex:i,attributes:u}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&u.add(l.r.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(i.uniforms.add(new n.t("vvSizeMinSize",(e=>e.vvSize.minSize))),i.uniforms.add(new n.t("vvSizeMaxSize",(e=>e.vvSize.maxSize))),i.uniforms.add(new n.t("vvSizeOffset",(e=>e.vvSize.offset))),i.uniforms.add(new n.t("vvSizeFactor",(e=>e.vvSize.factor))),i.uniforms.add(new a.k("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),i.uniforms.add(new n.t("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),i.code.add(o.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(o.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?o.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(o.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",c.p),i.uniforms.add(new s.x("vvColorValues",(e=>e.vvColor.values),c.p),new r.F("vvColorColors",(e=>e.vvColor.colors),c.p)),i.code.add(o.H`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?o.H`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(o.H`vec4 vvColor() { return vec4(1.0); }`)}},78731:(e,t,i)=>{i.d(t,{g:()=>o});var n=i(96236),r=i(16878),s=i(22131);function o(e,t){if(t.output!==n.V.ObjectAndLayerIdColor)return e.vertex.code.add(r.H`void forwardObjectAndLayerIdColor() {}`),void e.fragment.code.add(r.H`void outputObjectAndLayerIdColor() {}`);const i=t.objectAndLayerIdColorInstanced;e.varyings.add("objectAndLayerIdColorVarying","vec4"),e.attributes.add(i?s.r.INSTANCEOBJECTANDLAYERIDCOLOR:s.r.OBJECTANDLAYERIDCOLOR,"vec4"),e.vertex.code.add(r.H`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${i?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),e.fragment.code.add(r.H`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}},80203:(e,t,i)=>{i.d(t,{k:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"mat3",n.c.Pass,((i,n,r)=>i.setUniformMatrix3fv(e,t(n,r))))}}},81775:(e,t,i)=>{i.d(t,{o:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"sampler2D",n.c.Draw,((i,n,r)=>i.bindTexture(e,t(n,r))))}}},82501:(e,t,i)=>{i.d(t,{Gd:()=>D,J_:()=>R,VC:()=>U,b3:()=>N,s_:()=>O,ul:()=>B,wI:()=>w});i(21265);var n,r,s=i(64682),o=i(67965),a=i(13473),l=i(87752),c=i(10382),u=i(89227),d=i(28473),h=i(8299),f=i(69943),g=i(4794),p=i(20783);!function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"}(n||(n={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(r||(r={}));class v{constructor(e){this.field=e}}class m extends v{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[n.Undefined,n.Undefined,n.Undefined]}}class _ extends v{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class A extends v{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class T{}function x(e){return null!=e}function E(e,t){e&&e.push(t)}function y(e,t,i,r,s){const o=e.minSize,a=e.maxSize;if(e.useSymbolValue){const e=r.symbolSize[i];return t.minSize[i]=e,t.maxSize[i]=e,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=n.DefinedSize,!0}if(x(e.field))return x(e.stops)?2===e.stops.length&&(0,f.Et)(e.stops[0].size)&&(0,f.Et)(e.stops[1].size)?(b(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=n.DefinedSize,!0):(E(s,"Could not convert size info: stops only supported with 2 elements"),!1):(0,f.Et)(o)&&(0,f.Et)(a)&&x(e.minDataValue)&&x(e.maxDataValue)?(b(o,a,e.minDataValue,e.maxDataValue,t,i),t.type[i]=n.DefinedSize,!0):"unknown"===e.valueUnit?(E(s,"Could not convert size info: proportional size not supported"),!1):null!=h.j[e.valueUnit]?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/h.j[e.valueUnit],t.type[i]=n.DefinedSize,!0):(E(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!x(e.field)){if(e.stops?.[0]&&(0,f.Et)(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=n.DefinedSize,!0;if((0,f.Et)(o))return t.minSize[i]=o,t.maxSize[i]=o,t.offset[i]=o,t.factor[i]=0,t.type[i]=n.DefinedSize,!0}return E(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function b(e,t,i,n,r,s){const o=Math.abs(n-i)>0?(t-e)/(n-i):0;r.minSize[s]=o>0?e:t,r.maxSize[s]=o>0?t:e,r.offset[s]=e-i*o,r.factor[s]=o}function S(e,t,i){e[4*t]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function C(e,t,i){const n=2===i&&"arithmetic"===e.rotationType;t.offset[i]=n?90:0,t.factor[i]=n?-1:1,t.type[i]=1}class w{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1,1],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0,0],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0];this.supports=e,this.modelSize=t,this.symbolSize=i,this.unitInMeters=n,this.anchor=r,this.scale=s,this.rotation=o}}function I(e,t,i){if(!e)return null;const r=e.reduce(((e,n)=>{if(!e)return e;if(n.valueExpression)return E(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return t.supports.size?function(e,t,i,n){if(e.normalizationField||e.valueRepresentation)return E(n,"Could not convert size info: unsupported property"),null;if(!(0,f.CO)(e.field))return E(n,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return E(n,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new m(e.field);let r;switch(e.axis){case"width":return r=y(e,t.size,0,i,n),r?t:null;case"height":return r=y(e,t.size,2,i,n),r?t:null;case"depth":return r=y(e,t.size,1,i,n),r?t:null;case"width-and-depth":return r=y(e,t.size,0,i,n),r&&y(e,t.size,1,i,n),r?t:null;case null:case void 0:case"all":return r=y(e,t.size,0,i,n),r=r&&y(e,t.size,1,i,n),r=r&&y(e,t.size,2,i,n),r?t:null;default:return E(n,`Could not convert size info: unknown axis "${e.axis}""`),null}}(n,e,t,i):e;case"color":return t.supports.color?function(e,t,i){if(e.normalizationField)return E(i,"Could not convert color info: unsupported property"),null;if((0,f.Kg)(e.field)){if(!e.stops)return E(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return E(i,"Could not convert color info: too many color stops"),null;t.color=new _(e.field);const n=e.stops;for(let e=0;e<8;++e){const i=n[Math.min(e,n.length-1)];t.color.values[e]=i.value,S(t.color.colors,e,i.color)}}}else{if(!(e.stops&&e.stops.length>=0))return E(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,S(t.color.colors,e,i)}}return t}(n,e,i):e;case"opacity":return t.supports.opacity?function(e,t,i){if(e.normalizationField)return E(i,"Could not convert opacity info: unsupported property"),null;if((0,f.Kg)(e.field)){if(!e.stops)return E(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return E(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new A(e.field);const n=e.stops;for(let e=0;e<8;++e){const i=n[Math.min(e,n.length-1)];t.opacity.values[e]=i.value,t.opacity.opacityValues[e]=i.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return E(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}(n,e,i):null;case"rotation":return t.supports.rotation?function(e,t,i){if(!(0,f.Kg)(e.field))return E(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return E(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return C(e,t.rotation,0),t;case"roll":return C(e,t.rotation,1),t;case null:case void 0:case"heading":return C(e,t.rotation,2),t;default:return E(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(n,e,i):e;default:return null}}),new T);return!(e.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!function(e,t,i){for(let s=0;s<3;++s){let i=t.unitInMeters;e.type[s]===n.DefinedSize&&(i*=t.modelSize[s],e.type[s]=n.DefinedScale),e.minSize[s]=e.minSize[s]/i,e.maxSize[s]=e.maxSize[s]/i,e.offset[s]=e.offset[s]/i,e.factor[s]=e.factor[s]/i}let r;if(e.type[0]!==n.Undefined)r=0;else if(e.type[1]!==n.Undefined)r=1;else{if(e.type[2]===n.Undefined)return E(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===n.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}(r.size,t,i)?null:r:null}class P{constructor(e,t,i){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=i}}function O(e,t){if(!e)return null;if(g.b.TESTS_DISABLE_FAST_UPDATES)return null;const i=I(e.visualVariables,t);return i?new P(i,L(i,t),!!i.size):null}function R(e,t,i){if(!t||!e)return!1;const n=e.visualVariables,r=I(t.visualVariables,i);return!!r&&!!(M(n.size,r.size,"size")&&M(n.color,r.color,"color")&&M(n.rotation,r.rotation,"rotation")&&M(n.opacity,r.opacity,"opacity"))&&(e.visualVariables=r,e.materialParameters=L(r,i),e.requiresShaderTransformation=!!r.size,!0)}function M(e,t,i){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===i){const i=e,n=t;for(let e=0;e<3;e++)if(i.type[e]!==n.type[e]||i.offset[e]!==n.offset[e]||i.factor[e]!==n.factor[e])return!1}return!0}class D extends p.Y{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function L(e,t){const i=new D(e);return i.vvSize&&(i.vvSymbolAnchor=t.anchor,(0,l.D_)(H),function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,c.vt)();const r=e||0,s=t||0,o=i||0;0!==r&&(0,l.Qr)(n,n,-r/180*Math.PI),0!==s&&(0,l.eL)(n,n,s/180*Math.PI),0!==o&&(0,l.Z8)(n,n,o/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],H),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||(0,a.vt)(),(0,o.z0)(i.vvSymbolRotationMatrix,H)),i}function N(e,t,i){if(!e.vvSize)return i;(0,l.C)(z,i);const n=e.vvSymbolRotationMatrix;(0,l.hZ)(H,n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1),(0,l.lw)(z,z,H);for(let r=0;r<3;++r){const i=e.vvSize.offset[r]+t[0]*e.vvSize.factor[r];F[r]=(0,s.qE)(i,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return(0,l.hs)(z,z,F),(0,l.Tl)(z,z,e.vvSymbolAnchor),z}function U(e,t,i){if(!t.vvSize)return(0,u.i)(e,1,1,1),e;for(let n=0;n<3;++n){const r=t.vvSize.offset[n]+i[0]*t.vvSize.factor[n];e[n]=(0,s.qE)(r,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return e}function B(e,t){const i=null==e?0:t.attributes[e];return"number"==typeof i&&isFinite(i)?i:0}const z=(0,c.vt)(),F=(0,d.vt)(),H=(0,c.vt)()},82606:(e,t,i)=>{i.d(t,{NL:()=>h,ZX:()=>n});var n,r=i(96236),s=i(99424),o=i(8815),a=i(57554),l=i(16878),c=i(81775),u=i(67058),d=(i(35694),i(73031));!function(e){e[e.None=0]="None",e[e.Value=1]="Value",e[e.Texture=2]="Texture",e[e.COUNT=3]="COUNT"}(n||(n={}));function h(e,t){if(!(0,r.RN)(t.output))return;const{emissionSource:i,hasEmissiveTextureTransform:h,bindType:f}=t,g=i===n.Texture;g&&(e.include(s.r,t),e.fragment.uniforms.add(f===d.c.Pass?new u.N("texEmission",(e=>e.textureEmissive)):new c.o("texEmission",(e=>e.textureEmissive))));const p=i===n.Value||g;p&&e.fragment.uniforms.add(f===d.c.Pass?new a.t("emissionFactor",(e=>e.emissiveFactor)):new o.W("emissionFactor",(e=>e.emissiveFactor))),e.fragment.code.add(l.H`
    vec4 getEmissions() {
      vec4 emissions = ${p?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${(0,l.If)(g,`emissions *= textureLookup(texEmission, ${h?"emissiveUV":"vuv0"});\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      return emissions;
    }
  `)}},85083:(e,t,i)=>{i.d(t,{KV:()=>m,Vc:()=>_,Cr:()=>h,JI:()=>f,q9:()=>d});var n=i(21772);let r;var s=i(59246),o=i(92156),a=i(64177),l=i(44480);let c=null,u=null;async function d(){return null==u&&(r??=(async()=>{const e=await i.e(59642).then(i.bind(i,59642)),t=await e.default({locateFile:e=>(0,n.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),u=r,c=await u),u}function h(e,t){if(null==c)return e.byteLength;const i=new c.BasisFile(new Uint8Array(e)),n=p(i)?g(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),n}function f(e,t){if(null==c)return e.byteLength;const i=new c.KTX2File(new Uint8Array(e)),n=v(i)?g(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),n}function g(e,t,i,n,r){const s=(0,l.IB)(t?o.CQ.COMPRESSED_RGBA8_ETC2_EAC:o.CQ.COMPRESSED_RGB8_ETC2),a=r&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*n*s*a)}function p(e){return e.getNumImages()>=1&&!e.isUASTC()}function v(e){return e.getFaces()>=1&&e.isETC1S()}async function m(e,t,i){null==c&&(c=await d());const n=new c.BasisFile(new Uint8Array(i));if(!p(n))return null;n.startTranscoding();const r=A(e,t,n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),((e,t)=>n.getImageTranscodedSizeInBytes(0,e,t)),((e,t,i)=>n.transcodeImage(i,0,e,t,0,0)));return n.close(),n.delete(),r}async function _(e,t,i){null==c&&(c=await d());const n=new c.KTX2File(new Uint8Array(i));if(!v(n))return null;n.startTranscoding();const r=A(e,t,n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),((e,t)=>n.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,i)=>n.transcodeImage(i,e,0,0,t,0,-1,-1)));return n.close(),n.delete(),r}function A(e,t,i,n,r,l,c,u){const{compressedTextureETC:d,compressedTextureS3TC:h}=e.capabilities,[f,g]=d?n?[s.n.ETC2_RGBA,o.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[s.n.ETC1_RGB,o.CQ.COMPRESSED_RGB8_ETC2]:h?n?[s.n.BC3_RGBA,o.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[s.n.BC1_RGB,o.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[s.n.RGBA32,o.Ab.RGBA],p=t.hasMipmap?i:Math.min(1,i),v=[];for(let s=0;s<p;s++)v.push(new Uint8Array(c(s,f))),u(s,f,v[s]);return t.internalFormat=g,t.hasMipmap=v.length>1,t.samplingMode=t.hasMipmap?o.Cj.LINEAR_MIPMAP_LINEAR:o.Cj.LINEAR,t.width=r,t.height=l,new a.g(e,t,{type:"compressed",levels:v})}},85293:(e,t,i)=>{i.d(t,{IR:()=>a,Mv:()=>s,uT:()=>o,vM:()=>l});var n=i(74719);const r=16;function s(e){return Math.ceil(e/r)*r}function o(e){return Math.floor(e/r)*r}function a(e,t){let i=e.width*e.height;if(i<4096)return e instanceof ImageData?u(e):e;let n=e.width,r=e.height;do{n=Math.ceil(n/2),r=Math.ceil(r/2),i=n*r}while(i>1048576||null!=t&&(n>t||r>t));return c(e,n,r)}function l(e,t){const i=Math.max(e.width,e.height);if(i<=t)return e;const n=t/i;return c(e,Math.round(e.width*n),Math.round(e.height*n))}function c(e,t,i){if(e instanceof ImageData)return c(u(e),t,i);const n=document.createElement("canvas");return n.width=t,n.height=i,n.getContext("2d").drawImage(e,0,0,n.width,n.height),n}function u(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");if(null==i)throw new n.default("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(e,0,0),t}},85645:(e,t,i)=>{i.d(t,{K_:()=>g,SE:()=>h,Yf:()=>c,aB:()=>f,ez:()=>l,m6:()=>p,xt:()=>d,z5:()=>u});var n=i(96236),r=i(86836),s=i(92156),o=i(12723);const a=(0,o.p3)(s.dn.ONE,s.dn.ZERO,s.dn.ONE,s.dn.ONE_MINUS_SRC_ALPHA);function l(e){return e===r.Y.FrontFace?null:a}function c(e){switch(e){case r.Y.NONE:return o.Ky;case r.Y.ColorAlpha:return a;case r.Y.FrontFace:case r.Y.COUNT:return null}}function u(e){if(e.draped)return null;switch(e.oitPass){case r.Y.NONE:case r.Y.FrontFace:return e.writeDepth?o.Uy:null;case r.Y.ColorAlpha:case r.Y.COUNT:return null}}const d=5e5,h={factor:-1,units:-2};function f(e){return e?h:null}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.MT.LESS;return e===r.Y.NONE||e===r.Y.FrontFace?t:s.MT.LEQUAL}function p(e,t){const i=(0,n.LG)(t);return e===r.Y.ColorAlpha?i?{buffers:[s.Nm.COLOR_ATTACHMENT0,s.Nm.COLOR_ATTACHMENT1,s.Nm.COLOR_ATTACHMENT2]}:{buffers:[s.Nm.COLOR_ATTACHMENT0,s.Nm.COLOR_ATTACHMENT1]}:i?{buffers:[s.Nm.COLOR_ATTACHMENT0,s.Nm.COLOR_ATTACHMENT1]}:null}},86836:(e,t,i)=>{var n;i.d(t,{Y:()=>n}),function(e){e[e.NONE=0]="NONE",e[e.ColorAlpha=1]="ColorAlpha",e[e.FrontFace=2]="FrontFace",e[e.COUNT=3]="COUNT"}(n||(n={}))},86845:(e,t,i)=>{i.d(t,{h:()=>o,p:()=>a});var n=i(31923),r=i(71723);class s{constructor(){this.uid=(0,n.c)()}}class o extends s{constructor(e){super(),this.highlightName=e,this.channel=r.Mg.Highlight}}class a extends s{constructor(){super(...arguments),this.channel=r.Mg.MaskOccludee}}},87824:(e,t,i)=>{i.d(t,{d:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"vec3",n.c.Bind,((i,n)=>i.setUniform3fv(e,t(n))))}}},89893:(e,t,i)=>{i.d(t,{Cv:()=>d,L:()=>u,MX:()=>l,O_:()=>c,kL:()=>h,vA:()=>a,zH:()=>f});var n=i(98080),r=i(60548);const s=(0,i(24646).vt)();class o{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Assertion";if(!e){const e=new Error(t).stack;throw new o(`${t} at ${e}`)}}function l(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function c(e,t,i,n){let r,s=(i[0]-e[0])/t[0],o=(n[0]-e[0])/t[0];s>o&&(r=s,s=o,o=r);let a=(i[1]-e[1])/t[1],l=(n[1]-e[1])/t[1];if(a>l&&(r=a,a=l,l=r),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],u=(n[2]-e[2])/t[2];return c>u&&(r=c,c=u,u=r),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function u(e,t,i,r,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,n.vt)();const a=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),l=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[s]+c*(t[s]-e[s]),!0}function d(e,t,i,n,o){s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1,(0,r.t)(s,s,t),o.length>2&&(o[2]=-s[2]),(0,r.t)(s,s,i),a(0!==s[3]),o[0]=s[0]/s[3],o[1]=s[1]/s[3],o[2]=s[2]/s[3],o[0]=(.5*o[0]+.5)*n[2]+n[0],o[1]=(.5*o[1]+.5)*n[3]+n[1]}function h(e,t){return Math.log(e)/Math.log(t)}function f(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},90623:(e,t,i)=>{i.d(t,{S:()=>s,p:()=>o});var n=i(82501),r=i(60984);class s extends n.Gd{constructor(){super(...arguments),this.renderOccluded=r.m$.Occlude,this.isDecoration=!1}}const o=8},92804:(e,t,i)=>{i.d(t,{I$:()=>f,Rv:()=>c,a9:()=>h,m:()=>s,mK:()=>g,qh:()=>d,r8:()=>l,sf:()=>o,ub:()=>u,v0:()=>a});var n=i(71723),r=i(92156);const s={func:r.MT.LESS},o={func:r.MT.ALWAYS},a={mask:255},l={mask:0},c=e=>({function:{func:r.MT.NOTEQUAL,ref:e,mask:e},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}}),u=e=>({function:{func:r.MT.ALWAYS,ref:e,mask:e},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.REPLACE}}),d={function:{func:r.MT.ALWAYS,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.ZERO}},h={function:{func:r.MT.ALWAYS,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.REPLACE}},f={function:{func:r.MT.EQUAL,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}},g={function:{func:r.MT.NOTEQUAL,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}}},93003:(e,t,i)=>{i.d(t,{$:()=>n});class n{constructor(e,t){this._module=e,this._load=t}get(){return this._module}async reload(){return this._module=await this._load(),this._module}}},94409:(e,t,i)=>{i.d(t,{E:()=>s});var n=i(73031),r=i(826);class s extends r.n{constructor(e,t){super(e,"vec4",n.c.Pass,((i,n,r)=>i.setUniform4fv(e,t(n,r))))}}},96122:(e,t,i)=>{i.d(t,{E:()=>r});var n=i(21265);function r(){return!!(0,n.A)("enable-feature:objectAndLayerId-rendering")}},96236:(e,t,i)=>{var n;function r(e){return e===n.Shadow||e===n.ShadowHighlight||e===n.ShadowExcludeHighlight||e===n.ViewshedShadow}function s(e){return function(e){return p(e)||_(e)}(e)||e===n.Normal}function o(e){return m(e)||e===n.Normal}function a(e){return e===n.Highlight||e===n.ObjectAndLayerIdColor}function l(e){return c(e)||a(e)}function c(e){return e===n.Color}function u(e){return c(e)||A(e)}function d(e){return c(e)||e===n.ObjectAndLayerIdColor}function h(e){return u(e)||e===n.ObjectAndLayerIdColor}function f(e){return c(e)||e===n.Highlight}function g(e){return f(e)||_(e)}function p(e){return c(e)||a(e)}function v(e){return u(e)||a(e)}function m(e){return v(e)||_(e)}function _(e){return e===n.Depth}function A(e){return e===n.ColorEmission}i.d(t,{CL:()=>a,LG:()=>A,Mb:()=>v,PJ:()=>r,QG:()=>h,RN:()=>u,T2:()=>m,V:()=>n,XY:()=>s,_o:()=>c,aD:()=>g,dX:()=>p,eh:()=>_,i3:()=>l,iq:()=>o,zW:()=>d}),function(e){e[e.Color=0]="Color",e[e.ColorEmission=1]="ColorEmission",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal",e[e.Shadow=4]="Shadow",e[e.ShadowHighlight=5]="ShadowHighlight",e[e.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",e[e.ViewshedShadow=7]="ViewshedShadow",e[e.Highlight=8]="Highlight",e[e.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",e[e.COUNT=10]="COUNT"}(n||(n={}))},97928:(e,t,i)=>{function n(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}i.d(t,{GJ:()=>n})},98876:(e,t,i)=>{i.d(t,{BP:()=>l,l5:()=>c,q3:()=>a});var n=i(76517),r=i(97928),s=i(89893);class o{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const i of e.fields.keys()){const t=e.fields.get(i);this[i]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new o(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.count;const r=this.stride;if(r%4==0){const s=new Uint32Array(e.buffer,t*r,n*r/4);new Uint32Array(this.buffer,i*r,n*r/4).set(s)}else{const s=new Uint8Array(e.buffer,t*r,n*r);new Uint8Array(this.buffer,i*r,n*r).set(s)}return this}get cachedMemory(){return this.byteLength}dispose(){}}class a{constructor(e){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:h(e[1].constructor)}))))}freeze(){return this}vec2f(e,t){return this._appendField(e,n.gH,t),this}vec2f64(e,t){return this._appendField(e,n.si,t),this}vec3f(e,t){return this._appendField(e,n.xs,t),this}vec3f64(e,t){return this._appendField(e,n.Xm,t),this}vec4f(e,t){return this._appendField(e,n.Eq,t),this}vec4f64(e,t){return this._appendField(e,n.Aj,t),this}mat3f(e,t){return this._appendField(e,n.jZ,t),this}mat3f64(e,t){return this._appendField(e,n.j0,t),this}mat4f(e,t){return this._appendField(e,n.Sx,t),this}mat4f64(e,t){return this._appendField(e,n.E$,t),this}vec4u8(e,t){return this._appendField(e,n.XP,t),this}f32(e,t){return this._appendField(e,n.Y$,t),this}f64(e,t){return this._appendField(e,n.qB,t),this}u8(e,t){return this._appendField(e,n.SL,t),this}u16(e,t){return this._appendField(e,n.h,t),this}i8(e,t){return this._appendField(e,n.bf,t),this}vec2i8(e,t){return this._appendField(e,n.D6,t),this}vec2i16(e,t){return this._appendField(e,n.mJ,t),this}vec2u8(e,t){return this._appendField(e,n.LC,t),this}vec4u16(e,t){return this._appendField(e,n.Uz,t),this}u32(e,t){return this._appendField(e,n.P,t),this}_appendField(e,t,i){if(this._fields.has(e))return void(0,s.vA)(!1,`${e} already added to vertex buffer layout`);const n=t.ElementCount*(0,r.GJ)(t.ElementType),o=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:t,offset:o,optional:i})}createBuffer(e){return new o(this,e)}createView(e){return new o(this,e)}clone(){const e=new a;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,i)=>e._fields.set(i,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,(0,r.GJ)(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function l(){return new a}class c{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const i={...e,constructor:d(e.constructor)};this.fields.push([t,i])})),this.stride=e.stride}}const u=[n.Y$,n.gH,n.xs,n.Eq,n.jZ,n.Sx,n.qB,n.si,n.Xm,n.Aj,n.j0,n.E$,n.SL,n.LC,n.eI,n.XP,n.h,n.Yi,n.nS,n.Uz,n.P,n.An,n.H$,n.ml,n.bf,n.D6,n.m8,n.TX,n.Qt,n.mJ,n.Vp,n.E7,n.My,n.UL,n.zD,n.Y4];function d(e){return`${e.ElementType}_${e.ElementCount}`}function h(e){return f.get(e)}const f=new Map;u.forEach((e=>f.set(d(e),e)))},99416:(e,t,i)=>{function n(e,t,i){for(let n=0;n<i;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}function r(e,t){const i=e.length;for(let n=0;n<i;++n)o[0]=e[n],t[n]=o[0];return t}function s(e,t){const i=e.length;for(let n=0;n<i;++n)o[0]=e[n],o[1]=e[n]-o[0],t[n]=o[1];return t}i.d(t,{Zo:()=>r,jA:()=>s,jS:()=>n});const o=new Float32Array(2)},99424:(e,t,i)=>{i.d(t,{r:()=>o});var n=i(69261),r=i(12893),s=i(16878);function o(e,t){const{textureCoordinateType:i}=t;if(i===n.I.None||i===n.I.COUNT)return;e.include(n.U,t);const o=i===n.I.Atlas;o&&e.include(r.r),e.fragment.code.add(s.H`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${o?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}}}]);