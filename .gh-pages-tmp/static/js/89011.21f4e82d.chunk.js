"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[33737,89011],{21503:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var i=n(93800),r=n(50925),l=n(48602),o=(n(21265),n(14746),n(75269)),a=n(66845),u=n(23224),s=n(5172),d=n(78308),c=n(50616),p=n(95011),f=n(79538),m=n(73210),y=n(40731),h=n(84958),g=n(67881),v=n(4500);const b="Enter",F="Escape";let _=class extends g.default{constructor(e){super(e),this.editInfo=null,this.cellValueValidatorFunction=e=>{let{oldValue:t,value:n}=e;return t!==n},this.editable=!0,this.headerRenderFunction=e=>{const{root:t}=e,n=this.createHeaderContent();this.tableEditingEnabled&&!this.effectiveEditable&&n.prepend(this._lockIconNode),this.removeCellContent(t),t.appendChild(n)},this.inputRenderFunction=e=>{let{root:t,column:n,rowData:i}=e;if(this.editInfo||!this.effectiveEditable||!i)return;const r=this.getCellValue(i),l=this.createInputElement({value:r});this._set("editInfo",{column:n,inputs:[l],root:t,rowData:i,oldValue:r});const o=document.createElement("div");o.appendChild(l),this.removeCellContent(t),t.appendChild(o),l.focus(),l instanceof HTMLInputElement&&l.select()},this.loadingMessage="",this.inputType="text",this.maxLength=null,this.onShowPromptCallback=()=>{},this.parseInputValueFunction=e=>{let{inputs:t}=e;return t?.length||1!==t.length||Array.isArray(t[0].value)?null:t[0].value},this.renderFunction=e=>{const{root:t,rowData:n}=e,{editInfo:i}=this;if(i)return;const r=this.getCellValue(n),l=this.cellValueFormatFunction({root:t,rowData:n,value:r});let o=null;t.onclick=()=>t.focus(),t.ondblclick=()=>this.inputRenderFunction(e),t.ontouchend=()=>this.inputRenderFunction(e);const a=this.grid?.getSlotElementByName(t.slot),u=a?.parentElement;u&&!u.onkeydown&&(u.onkeydown=t=>{t.key!==b||this.editInfo||this.inputRenderFunction(e),t.key===F&&this.editInfo&&this.cancel()}),null!=r&&null!=l?t.title=l.toString():t.title&&t.removeAttribute("title"),o=l instanceof HTMLElement?l:(0,v.Q)(this.messagesURIUtils,l),this.removeCellContent(t),o instanceof HTMLElement?t.appendChild(o):null!=o&&(t.innerHTML=o.toString())},this.required=!1,this.tableEditingEnabled=!1}get _lockIconNode(){return this.createCalciteIcon({icon:"lock",textLabel:this.messages?.editingPreventedColumn})}get effectiveEditable(){return this.tableEditingEnabled&&this.editable}get effectiveRequired(){return this.required}get editing(){return!!this.editInfo}get shouldShowPrompt(){return!1}cancel(){const{editInfo:e}=this;if(!e)return;const{column:t,root:n,rowData:i}=e;this.onEditComplete(),this.renderFunction({column:t,root:n,rowData:i})}createCalciteOption(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=document.createElement("calcite-option");return i.label=e,i.value=`${t}`,i.selected=n,i}createCalciteSelect(e,t){const{effectiveRequired:n,messages:i}=this;let r=!1;const l=t.map((t=>{let{name:n,value:i}=t;const l=i===e;return l&&(r=!0),this.createCalciteOption(n,i,l)}));if(null!=e&&""!==e&&!r){const t=e.toString(),n=this.createCalciteOption(t,t);l.unshift(n)}n||l.unshift(this.createCalciteOption(`<${i?.noValue}>`,""));const o=document.createElement("calcite-select");return l.forEach((e=>o.appendChild(e))),o}createInputElement(e){let{value:t}=e;const{effectiveRequired:n,maxLength:i}=this,r=document.createElement("calcite-input");return null!=i&&(r.maxLength=i),r.required=n,r.value=t,r.addEventListener("calciteInputChange",(()=>this.onInputBlur(r))),r.onkeydown=e=>{e.key===F&&this.onInputBlur(r,!0)},r.onblur=()=>this.onInputBlur(r),r}createDateComponent(){const e=document.createElement("calcite-input-date-picker");return e.focusTrapDisabled=!0,e.overlayPositioning="fixed",e}createTimeComponent(){const e=document.createElement("calcite-input-time-picker");return e.overlayPositioning="fixed",e.placement="auto-start",e.step=1,e}createTimeZoneComponent(){const e=document.createElement("calcite-input-time-zone");return e.maxItems=4,e.overlayPositioning="fixed",e}onEditComplete(){this._set("editInfo",null),this.grid?.generateCellPartNames()}onInputBlur(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.onblur=null,t?this.cancel():this.submit()}async submit(){const{editInfo:e}=this;if(!e)return void this.cancel();const{inputs:t,rowData:n,oldValue:i}=e,r=this.parseInputValueFunction({inputs:t});if(!this.cellValueValidatorFunction({value:r,oldValue:i}))return void this.cancel();const{root:l}=e,o=n.item.objectId,{fieldName:a}=this;l.textContent=this.loadingMessage,this.shouldShowPrompt?this.onShowPromptCallback({column:this,objectId:o,oldValue:i,value:r}):await this.updateItems({objectId:o,updates:[{fieldName:a,value:r}]})}async updateItems(e){const{store:t}=this;if(t)try{await t.updateItem(e),this.onEditComplete()}catch{this.cancel()}else this.cancel()}};(0,i._)([(0,l.MZ)()],_.prototype,"_lockIconNode",null),(0,i._)([(0,l.MZ)({readOnly:!0})],_.prototype,"editInfo",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"cellValueValidatorFunction",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"editable",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"effectiveEditable",null),(0,i._)([(0,l.MZ)()],_.prototype,"effectiveRequired",null),(0,i._)([(0,l.MZ)()],_.prototype,"editing",null),(0,i._)([(0,l.MZ)()],_.prototype,"headerRenderFunction",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"inputRenderFunction",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],_.prototype,"loadingMessage",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"inputType",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"maxLength",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"onShowPromptCallback",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"parseInputValueFunction",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"renderFunction",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"required",void 0),(0,i._)([(0,l.MZ)()],_.prototype,"shouldShowPrompt",null),(0,i._)([(0,l.MZ)()],_.prototype,"tableEditingEnabled",void 0),_=(0,i._)([(0,o.$)("esri.widgets.FeatureTable.Grid.EditorColumn")],_);const I=_;var T=n(98461),Z=n(53826),C=n(17745);const w="Escape",E="esri-column",x={input:`${E}__cell-input`,inputContainer:`${E}__cell__input-container`},O=(0,a.J2)("short-date-short-time"),N=(0,a.J2)("short-date"),M={useGrouping:!0,maximumFractionDigits:20};let V=class extends I{constructor(e){super(e),this._activeFieldInput=null,this.cellValueFormatFunction=e=>{let{root:t,rowData:n,value:i}=e;const{formatFunction:r}=this;if(r&&n){const{index:e,item:{attachments:l,feature:o,relatedRecords:a}}=n;return r({attachments:l,column:this,feature:o,field:this.field,index:e,relatedRecords:a,value:C.W5.sanitize(i),virtualIndex:this.getVirtualRowIndex(t)})}if(null===i)return"&nbsp;";const{field:l}=this,o=this._getDomainForFeature(n?.item?.feature);if(o){const e=this._getComputedDomain(i,o);if("date"===l.type&&"range"===o.type)return this._formatDateValueForDisplay(l,e);if(this._isNumericField&&"range"===o.type){const e=this.template?.format,t=e?(0,u.yx)(e):M;return(0,u.ZV)(parseFloat(i),t)}return Z.sH.has(l.type)?"range"===o.type?C.W5.sanitize((0,Z.ZP)(l,e)):C.W5.sanitize(e):e}if("date"===l.type||Z.sH.has(l.type))return this._formatDateValueForDisplay(l,i);if(this._isNumericField){const e=this.template?.format,t=e?(0,u.yx)(e):M;return(0,u.ZV)(parseFloat(i),t)}return C.W5.sanitize(i)},this.cellValueValidatorFunction=e=>{let{oldValue:t,value:n}=e;const{_effectiveRange:i,field:l}=this,{max:o,min:a}=i;if(this.effectiveRequired&&(null==n||""===n))return!1;if(this._isNumericField&&((0,p.validateFieldValue)(l,n)||!(0,Z.eX)({max:o,min:a,value:n})))return r.A.getLogger(this).warn("value-exceeds-valid-range","Field value exceeds valid range. Attempted edit was rejected."),!1;if(this._isAnyDateOrTimeField){const e=l.type;if(!(0,Z.yk)({type:e,range:i,value:n}))return!1}return t!==n},this.field=null,this.formatFunction=null,this.inputRenderFunction=async e=>{let{root:t,column:n,rowData:i}=e;if(this.editInfo||!this.effectiveEditable)return;const l=this.getCellValue(i),{field:o}=this;if("big-integer"===o.type&&(0,p.validateFieldValue)(o,l))return void r.A.getLogger(this).warn("value-exceeds-valid-range","Field value is beyond supported limit. Editing is disabled for this field value.");const a=i?.item.feature;if(!a)return;this._activeFieldInput=this._setUpFieldInput(a,l);const u=document.createElement("div");u.classList.add(x.inputContainer);const s=[],d="coded-value"===this._effectiveDomain?.type;if(this._isAnyDateOrTimeField&&!d){const e=document.createElement("div"),t=this._setUpDateComponents(l),n=this._setUpDateActionBar();t.forEach((t=>e.appendChild(t))),u.appendChild(e),u.appendChild(n),s.push(...t)}else{const e=this.createInputElement({value:l});u.appendChild(e),s.push(e)}this._set("editInfo",{column:n,inputs:s,root:t,rowData:i,oldValue:l}),this.removeCellContent(t),t.appendChild(u),this._syncRowEditingState(t,!0),this.grid?.generateCellPartNames();const c=s[0];await(0,C.Z6)(c),"selectText"in c&&await c.selectText()},this.layer=null,this.parseInputValueFunction=e=>{let{inputs:t}=e;const{editInfo:n,field:i,includeTime:r}=this;if(!n||!t.length)return null;const l=t[0];if(this._isAnyDateOrTimeField){if("coded-value"===this._effectiveDomain?.type){if(null==l.value)return null;const e=String(l.value);return(0,p.isDateField)(i)?parseFloat(e):e}const{timeZone:e}=this.effectiveTimeZoneOptions,o=n.oldValue??void 0;switch(i.type){case"date-only":{const e=l.value;return""!==e?e:null}case"time-only":{const e=(0,Z.iP)(l.value);return""!==e?e:null}case"timestamp-offset":{const n=r?t[1]:void 0,i=t.at(-1);return(0,Z.Ng)({oldValue:o,dateComponent:l,timeComponent:n,timeZoneComponent:i,defaultTimeZone:e})}case"date":{const{max:n,min:i}=this._effectiveRange;return(0,Z.oh)({oldValue:o,dateComponent:l,timeComponent:t[1],timeZone:e,max:n,min:i})}}return null}const o=l.value,{effectiveRequired:a}=this;return a||null!=o&&""!==o?this._isNumericField?parseFloat(o):this._isStringField?o.trim():o:null},this.sortable=!0,this.store=null,this.template=null,this.view=null}get _effectiveDomain(){const e=this._activeFieldInput?.feature;return e?this._getDomainForFeature(e):null}get _effectiveRange(){return this._activeFieldInput?.range??{max:null,min:null}}get _isAnyDateOrTimeField(){const{field:e}=this;return(0,f.fs)(e)||(0,p.isTimeOnlyField)(e)}get _isIntegerField(){return(0,p.isIntegerField)(this.field)}get _isNumericField(){return(0,p.isNumericField)(this.field)}get _isStringField(){return(0,p.isStringField)(this.field)}get _isSubtypeField(){const{layer:e}=this;if(e?.subtypeField){const{subtypeField:t,fieldsIndex:n}=e;return(n.get(t)?.name??t)===this.fieldName}return!1}get alias(){return this.field?.alias}get defaultValue(){return this.field?.defaultValue}get effectiveDescription(){const{description:e,field:t}=this,n=t.description,i=(0,T.$m)(e)?(0,T.$m)(n)?null:n:e;return null==i?null:C.W5.sanitize(i)}get effectiveEditable(){const{editable:e,field:t,layer:n,tableEditingEnabled:i}=this;if(!t||!n)return!1;const r=(0,s.S)(n),l=n.effectiveCapabilities??n.capabilities,o=l?.operations?.supportsUpdate;return!!(t.editable&&r&&o&&"oid"!==t.type&&i)&&e}get effectiveLabel(){return C.W5.sanitize(this.label||this.alias||this.fieldName)}get effectiveRequired(){return!this.nullable||this._isSubtypeField||this._activeFieldInput?.required||this.required}get effectiveTimeZoneOptions(){const{layer:e,field:t}=this;if(!e||"date"!==t?.type&&"timestamp-offset"!==t?.type)return{timeZone:void 0,timeZoneName:void 0};const{tableTimeZone:n,timeZone:i,view:r}=this;return(0,y.hv)(e.preferredTimeZone||null,!!e.datesInUnknownTimezone,i??n??r?.timeZone??m.qU,(0,a.J2)("short-time"),t.type)}get includeTime(){const{field:e,template:t}=this;return"time-only"===e.type||"date-only"!==e.type&&(!t?.input||"includeTime"in t.input&&!1!==t.input.includeTime)}get loadingMessage(){return this.messages?.loading||"..."}get maxLength(){const{field:e,template:t}=this,n=e?.length??-1,i=t?.input&&"maxLength"in t.input?t.input.maxLength:null;return null!=i&&!isNaN(i)&&i>=-1&&(-1===n||i<=n)?i:n}get minLength(){const{template:e,maxLength:t}=this,n=e?.input&&"minLength"in e.input?e.input.minLength:null;return t&&n<=t?n:null}get name(){return this.field?.name}get nullable(){return!1!==this.field.nullable}get shouldShowPrompt(){return this._isSubtypeField}createInputElement(e){let{value:t}=e;const{_effectiveDomain:n,maxLength:i,minLength:r,effectiveRequired:l}=this;let o;if("coded-value"===n?.type)o=this.createCalciteSelect(t,n.codedValues.map((e=>{let{code:t,name:n}=e;return{value:t,name:n}}))),o.addEventListener("calciteSelectChange",(()=>this.onInputBlur(o)));else if(this._isNumericField){const{_effectiveRange:{max:e,min:n}}=this;o=document.createElement("calcite-input"),o.type="number",this._isIntegerField&&(o.step=1),null!=e&&(o.max=e),null!=n&&(o.min=n),o.status=(0,Z.eX)({max:e,min:n,value:t})?"idle":"invalid"}else o=document.createElement("calcite-input"),o.addEventListener("calciteInputChange",(()=>this.onInputBlur(o))),i>-1&&(o.maxLength=i),r>0&&(o.minLength=r);return o.classList.add(x.input),o.required=l,o.value=null!=t?t.toString():"",o.onkeydown=e=>{e.key===w&&this.onInputBlur(o,!0)},o.onblur=()=>this.onInputBlur(o),o}onEditComplete(){const e=this.editInfo?.root;e&&this._syncRowEditingState(e,!1),this._activeFieldInput=null,super.onEditComplete()}_clearActiveEditValues(){this.editInfo?.inputs?.forEach((e=>e.value=""))}_setUpDateActionBar(){const{messagesCommon:e}=this,t=e?.cancel??"",n=e?.clear??"",i=e?.save??"",r=document.createElement("calcite-action-bar");return r.expandDisabled=!0,r.layout="horizontal",r.appendChild(this.createCalciteAction({text:i,icon:"save",onclick:()=>this.submit()})),this.effectiveRequired||r.appendChild(this.createCalciteAction({text:n,icon:"trash",onclick:()=>{this._clearActiveEditValues(),this.submit()}})),r.appendChild(this.createCalciteAction({text:t,icon:"x",onclick:()=>this.cancel()})),r}_formatDateValueForDisplay(e,t){const{timeZone:n,timeZoneName:i}=this.effectiveTimeZoneOptions;return null!=t?(0,Z.ZP)(e,t,{...this._getDateFormatOptions(),timeZone:n,timeZoneName:i}):null}_setUpDateComponents(e){const{_effectiveRange:{max:t,min:n,rawMax:i,rawMin:r},field:l,effectiveRequired:o}=this,a=this._getDateFieldValuesForComponents(l,e),u=[];if((0,f.fs)(l)){const e=this.createDateComponent(),s=(0,p.isDateOnlyField)(l)||(0,p.isTimestampOffsetField)(l)?i:t,d=(0,p.isDateOnlyField)(l)||(0,p.isTimestampOffsetField)(l)?r:n,c=this._getDateFieldValuesForComponents(l,s??null),f=this._getDateFieldValuesForComponents(l,d??null);e.value=a.date??"",e.max=c.date??"",e.min=f.date??"",e.required=o,e.addEventListener("calciteInputDatePickerOpen",(()=>this._onDateComponentOpen(e))),u.push(e)}if(this.includeTime){const e=this.createTimeComponent();e.value=a.time??"",e.required=o,e.addEventListener("calciteInputTimePickerOpen",(()=>this._onDateComponentOpen(e))),u.push(e)}if("timestamp-offset"===l.type){const e=this.createTimeZoneComponent();e.value=a.timeZoneOffset??"0",e.addEventListener("calciteInputTimeZoneOpen",(()=>this._onDateComponentOpen(e))),u.push(e)}return u}_onDateComponentOpen(e){this.editInfo?.inputs.forEach((t=>{t!==e&&"open"in t&&(t.open=!1)}))}_syncRowEditingState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.grid?.getRowContainingNode(e);n&&(t?n.setAttribute("editing","true"):n.removeAttribute("editing"))}_getDateFieldValuesForComponents(e,t){switch(e.type){case"date":return(0,Z.Q0)(t,this.effectiveTimeZoneOptions.timeZone);case"date-only":return{date:t};case"time-only":return{time:t};case"timestamp-offset":return(0,Z.T8)(t);default:return{}}}_setUpFieldInput(e,t){const{field:n,layer:i,effectiveTimeZoneOptions:{timeZone:r}}=this,l=new h.default({feature:e,field:n,initialFeature:e.clone(),layer:i,timeZone:r});return l.set("value",t),l}_isDomainCompatible(e){if(!e)return!1;const{_isNumericField:t,_isStringField:n}=this,{type:i}=e;if("coded-value"===i){const i=typeof e.codedValues[0].code;if("string"===i&&n||"number"===i&&t)return!0}return!("range"!==i||!t)}_getDomainForFeature(e){const{fieldName:t,layer:n,template:i}=this;if(!e||!n?.getFieldDomain)return null;if("wfs"===n.type||"geojson"===n.type||"csv"===n.type||"knowledge-graph-sublayer"===n.type)return null;if(i?.domain&&this._isDomainCompatible(i.domain))return i.domain;if("feature"!==n.type&&"subtype-group"!==n.type&&null==n.getField(t)?.domain){const e=(0,d.hx)(n,t);if(e)return e}return n.getFieldDomain(t,{feature:e})}_getComputedDomain(e,t){if(!t)return null;if("range"===t.type)return e;if("coded-value"===t.type){const n=t.codedValues.filter((t=>t.hasOwnProperty("code")&&t.code===e));return n&&n.length?n[0].name:e}return null}_getDateFormatOptions(){const{template:e}=this,t=e?.format?.dateFormat;return t?(0,a.J2)(t):e?.input&&"includeTime"in e.input&&!1===e.input.includeTime?N:O}};(0,i._)([(0,l.MZ)()],V.prototype,"_effectiveDomain",null),(0,i._)([(0,l.MZ)()],V.prototype,"_activeFieldInput",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"_effectiveRange",null),(0,i._)([(0,l.MZ)()],V.prototype,"_isAnyDateOrTimeField",null),(0,i._)([(0,l.MZ)()],V.prototype,"_isIntegerField",null),(0,i._)([(0,l.MZ)()],V.prototype,"_isNumericField",null),(0,i._)([(0,l.MZ)()],V.prototype,"_isStringField",null),(0,i._)([(0,l.MZ)()],V.prototype,"_isSubtypeField",null),(0,i._)([(0,l.MZ)({readOnly:!0})],V.prototype,"alias",null),(0,i._)([(0,l.MZ)()],V.prototype,"cellValueFormatFunction",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"cellValueValidatorFunction",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],V.prototype,"defaultValue",null),(0,i._)([(0,l.MZ)()],V.prototype,"effectiveDescription",null),(0,i._)([(0,l.MZ)()],V.prototype,"effectiveEditable",null),(0,i._)([(0,l.MZ)()],V.prototype,"effectiveLabel",null),(0,i._)([(0,l.MZ)()],V.prototype,"effectiveRequired",null),(0,i._)([(0,l.MZ)()],V.prototype,"effectiveTimeZoneOptions",null),(0,i._)([(0,l.MZ)({type:c.default})],V.prototype,"field",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"formatFunction",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"includeTime",null),(0,i._)([(0,l.MZ)()],V.prototype,"inputRenderFunction",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"layer",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],V.prototype,"loadingMessage",null),(0,i._)([(0,l.MZ)()],V.prototype,"maxLength",null),(0,i._)([(0,l.MZ)()],V.prototype,"minLength",null),(0,i._)([(0,l.MZ)({readOnly:!0})],V.prototype,"name",null),(0,i._)([(0,l.MZ)({readOnly:!0})],V.prototype,"nullable",null),(0,i._)([(0,l.MZ)()],V.prototype,"parseInputValueFunction",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"shouldShowPrompt",null),(0,i._)([(0,l.MZ)()],V.prototype,"sortable",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"store",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"template",void 0),(0,i._)([(0,l.MZ)()],V.prototype,"view",void 0),V=(0,i._)([(0,o.$)("esri.widgets.FeatureTable.FieldColumn")],V);const D=V},39652:(e,t,n)=>{function i(e){const{attributes:t,sourceLayer:n}=e??{},i=n&&"displayField"in n?n.displayField:null,r=i?t?.[i]:null,l=null!=r?JSON.stringify(r):null,o=e?.getObjectId()?.toString();return l||o||""}n.d(t,{R:()=>i})},41327:(e,t,n)=>{n.d(t,{Au:()=>_,CU:()=>j,Et:()=>v,Gq:()=>O,H1:()=>S,HG:()=>x,Iy:()=>Z,Kl:()=>B,Kn:()=>G,LZ:()=>M,TN:()=>w,U3:()=>Q,Ve:()=>U,XI:()=>E,bx:()=>I,cU:()=>C,k_:()=>F,lB:()=>H,l_:()=>$,n4:()=>z,nT:()=>b,oc:()=>R,qG:()=>q,rf:()=>g,s9:()=>k,t6:()=>A,tM:()=>P,vp:()=>N,wr:()=>T});n(88677);var i=n(62631),r=n(7951),l=n(82301),o=n(50925),a=n(56612),u=n(96299),s=n(7249),d=n(95011),c=n(78076),p=n(79538),f=n(53826),m=n(82368),y=n(39652),h=n(99961);const g=e=>"field"===e?.type,v=e=>"group"===e?.type,b=e=>"relationship"===e?.type,F=e=>"text"===e.type,_=e=>"utilityNetworkAssociations"===e.type,I=e=>!v(e)&&null!=e.group,T=e=>e.reduce(((e,t)=>v(t)?[...e,...t.inputs]:[...e,t]),[]),Z=e=>T(e).filter(g),C=e=>T(e).filter(b),w=e=>T(e).filter(_),E=e=>null!=e&&(x(e,"combo-box")||x(e,"radio-buttons")),x=(e,t)=>null!=e&&e.input?.type===t,O=e=>{let{domain:t,inputType:n="text-box",dataType:i}=e;return"number"===i&&"text-box"===n&&(!t||"coded-value"!==t.type)};function N(e,t){const{title:n,feature:i}=e??{};return n||(i?(0,y.R)(i):null)||t||""}function M(e){const{attributes:t,fieldsIndex:n,label:r,timeZone:l}=e;if(!t||"object"!=typeof t)return r;const o=Object.keys(t).filter((e=>(0,a.mk)(r,e))),u=o.map((e=>t[e])),s=o.map((e=>n.get(e))).filter(i.Ru);return function(e,t){return(0,a.HC)((0,a.HC)(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[t.toLowerCase(),n]}))))}(r,U({values:u,fields:s,timeZone:l}))}const V="expression/",D="expr/",L="field/";function R(e){const[t,n]=e.split(V);return""===t&&n?n:(o.A.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${V}/expressionName'`),"")}function A(e){return`${V}${e}`}function S(e){return`${L}${e}`}function k(e){return e.startsWith(V)}function q(e){return e.startsWith(D)}function U(e){const{fields:t,values:n}=e,i=e.timeZone??void 0,r=t.map(((e,t)=>{let r=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===r));t?.name&&(r=t.name)}return((0,p.fs)(e)||(0,d.isTimeOnlyField)(e))&&(r=(0,f.ZP)(e,r,{timeZone:i,...(0,f.ZT)(e)})),[e.name,r]}));return Object.fromEntries(r)}const j=e=>{const t={typeFieldName:null,types:[]};return e?((0,c.Sv)(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map((e=>{let{id:t,name:n,domains:i}=e;return{code:t,name:n,domains:i}}))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},P=(e,t,n)=>{const{dataType:i,error:r,minLength:l}=e,o=t?.validationErrors;if(!o||!r)return null;if(r===m.gK.CANNOT_BE_EMPTY)return o.cannotBeNull;if(r===s.Mh.VALUE_OUT_OF_RANGE||r===d.NumericRangeValidationError.OUT_OF_RANGE){const{field:t,range:r}=e,l={type:"date",intlOptions:{timeZone:"date"===t.type&&n?n:void 0,...(0,f.ZT)(t)}},a=(0,m.hQ)(r,o);return(0,h.V)(a,r,{format:{max:"date"===i?l:null!=r.max&&(0,m.qn)(r.max)?m.Qv:m.PA,min:"date"===i?l:null!=r.min&&(0,m.qn)(r.min)?m.Qv:m.PA}})}return r===s.Mh.INVALID_CODED_VALUE?o.invalidCodedValue:r===d.TypeValidationError.INVALID_TYPE?o.invalidType:r===m.gK.TOO_SHORT?(0,h.V)(o.tooShort,{min:l}):(m.gK.TOO_LONG,null)},$=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,i=e.geometry?.type;return"polyline"===i||"polyline"===n?"line":"mesh"===i||"mesh"===n||"multipatch"===n?"cube":"multipoint"===i||"multipoint"===n?"point":i||n||"table"},z=e=>{const t=[];if(e.formTemplate){const{description:n,title:i}=e.formTemplate;e.fields?.forEach((e=>{const r=i&&(0,a.mk)(i,e.name),l=n&&(0,a.mk)(n,e.name);(r||l)&&t.push(e.name)}))}return t};function H(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(u.jt)??[]).some((t=>{let{fieldName:n}=t;return!e.fieldsIndex.get(n)}))}function G(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function B(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return(0,r.Xb)(t.objectType),!1}}function Q(e,t,n){const i=(0,c.fV)(e),r=i?.find((e=>e.code===n));if(!r)return!1;const o=i?.find((e=>e.code===t));return!(0,l.equalsShallow)(r.defaultValues,o?.defaultValues)&&Object.values(r.defaultValues).some((e=>null!=e))}},53826:(e,t,n)=>{n.d(t,{Ng:()=>T,OM:()=>g,Q0:()=>F,T8:()=>b,ZP:()=>I,ZT:()=>_,eX:()=>w,fD:()=>O,fb:()=>m,fl:()=>f,iP:()=>x,oh:()=>Z,rX:()=>N,sH:()=>y,yk:()=>M});n(88677),n(21265);var i=n(74719),r=n(64682),l=n(66845),o=n(72520),a=n(69943),u=n(73210),s=n(51536),d=n(12711);const c=u.n$,p={date:null,time:null,timeZoneOffset:null},f=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),m="latn",y=new Set(["date-only","time-only","timestamp-offset"]),h=e=>"valueAsDate"in e;function g(e){return{locale:(0,d.JK)(),numberingSystem:m,zone:e??c}}function v(e,t){return null==e?null:s.c9.fromMillis(e,g(t))}function b(e,t){if(null==e||!(0,a.Kg)(e)||""===e){if(t){const e=s.c9.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return p}const n=s.c9.fromISO(e,{setZone:!0});return{date:n.toFormat(o.mo,g()),time:n.toFormat(o.Uq.HMS_MS,g()),timeZoneOffset:n.offset.toString()}}function F(e,t){if(null==e||!(0,a.Et)(e)||isNaN(e))return p;const n=v(e,t);return n?{date:n.toFormat(o.mo,g(t)),time:n.toFormat(o.Fj,g(t))}:p}function _(e){switch(e.type){case"date":default:return(0,l.J2)("short-date-short-time");case"date-only":return(0,l.J2)("short-date");case"time-only":return(0,l.J2)("short-time");case"timestamp-offset":return{...(0,l.J2)("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function I(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return(0,l.Yq)(t,n);case"date-only":return(0,l.iS)(t,n);case"time-only":return(0,l.F8)(t,n);case"timestamp-offset":return(0,l.Ey)(t,n);default:return null}}function T(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:i,timeZoneComponent:r,oldValue:l}=e;if(!t?.value)return null;const{year:a,month:d,day:c}=s.c9.fromFormat(t.value,o.mo),{hour:p,minute:f,second:m,millisecond:y}=C(i,u.n$)??s.c9.now(),h=b(l,n),g=r?.value?parseInt(r.value,10):null!=h.timeZoneOffset?parseInt(h.timeZoneOffset,10):(new Date).getTimezoneOffset(),v=s.mQ.instance(g),F=s.c9.fromObject({year:a,month:d,day:c,hour:p,minute:f,second:m,millisecond:y},{zone:v});return F.isValid?F.toISO({includeOffset:!0}):null}function Z(e){const{dateComponent:t,timeComponent:n,timeZone:i,max:r,min:l,oldValue:o}=e,a=C(t,i);let u=!!e.applyRange;if(!a)return null;let d=null;if(null!=n?.value){const e=C(n,i),t=Date.now(),l=null!=r&&r<t?r:t,o=s.c9.fromMillis(l,g(i)),u=a||o,{year:c,month:p,day:f}=u,{hour:m,minute:y,second:h,millisecond:v}=e||o;d=u.set({year:c,month:p,day:f,hour:m,minute:y,second:h,millisecond:v})}else{const e=v(E({value:o??Date.now(),max:r,min:l}),i),{year:t,month:n,day:s}=a,{hour:c,minute:p,second:f,millisecond:m}=e;u=!0,d=a.set({year:t,month:n,day:s,hour:c,minute:p,second:f,millisecond:m})}if(!d.isValid)return null;const c=d.toMillis();return u?E({value:c,max:r,min:l}):c}function C(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=h(e)?s.c9.fromFormat(e.value,o.mo,g(t)):(0,o.UE)(e.value),n?.isValid?n:null}function w(e){const{max:t,min:n,value:i}=e;return!isNaN(i)&&!(null!=t&&i>t)&&!(null!=n&&i<n)}function E(e){const{max:t,min:n,value:i}=e;return null!=t&&null!=n?(0,r.qE)(i,n,t):null!=t&&i>t?t:null!=n&&i<n?n:i}function x(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new i.default("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),r=new Array(3);for(let i=0;i<3;i++){const e=n.at(i)??"";r[i]=e.padStart(2,"0")}return r.join(":")}function O(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return x(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function N(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function M(e){const{type:t,range:n,value:i}=e;if(null==i||!n||i===n.min||i===n.max)return!0;if("date"===t)return w({value:i,min:n.min,max:n.max});const{rawMax:r,rawMin:l}=n;let a=null,u=null,s=null;switch(t){case"date-only":a=(0,o.Xi)(r),u=(0,o.Xi)(l),s=(0,o.Xi)(i);break;case"time-only":a=(0,o.UE)(r),u=(0,o.UE)(l),s=(0,o.UE)(i);break;case"timestamp-offset":a=(0,o.gz)(r),u=(0,o.gz)(l),s=(0,o.gz)(i)}return!s||w({value:s.valueOf(),min:u?.valueOf(),max:a?.valueOf()})}},82368:(e,t,n)=>{n.d(t,{$$:()=>_,D_:()=>p,Gd:()=>c,Kx:()=>i,PA:()=>g,Po:()=>f,Qv:()=>v,gK:()=>r,hQ:()=>F,jl:()=>y,of:()=>d,qn:()=>b,zU:()=>m});var i,r,l,o=n(96299),a=n(7249),u=n(95011),s=n(53826);(l=i||(i={})).Text="text",l.Number="number",l.Date="date",l.Unsupported="unsupported",function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(r||(r={}));const d=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};function c(e,t){const{dataType:n,domain:i,field:l,maxLength:o,minLength:d,range:c,required:p}=t;if(null==e)return p?r.CANNOT_BE_EMPTY:null;if("text"===n&&"string"==typeof e){if(d>-1&&e.length<d)return r.TOO_SHORT;if(o>-1&&e.length>o)return r.TOO_LONG}return"date"!==n||(0,s.yk)({type:l.type,range:c,value:e})?i?(0,a.wb)(l,e,i):(0,u.validateFieldValue)(l,e)??(0,a.wb)(l,e):u.NumericRangeValidationError.OUT_OF_RANGE}function p(e,t){return!(!f(e)||!f(t))||e===t}function f(e){return null==e||""===e}function m(e){let{dataType:t,field:n,input:r}=e;if(t===i.Date)return-1;const l=h(n.length);if(!r||!(0,o.AI)(r))return l;const a=h(r.maxLength);return-1===a?l:-1===l?a:Math.min(l,a)}function y(e){let{dataType:t,field:n,input:r}=e;if(t===i.Date)return-1;if(!r||!(0,o.AI)(r))return-1;const l=h(r.minLength);if(l<0)return-1;const a=h(n.length);return a>-1&&a<l?-1:l}function h(e){return"number"==typeof e&&e>-1?e:-1}const g={type:"number"},v={type:"number",intlOptions:{notation:"scientific"}};function b(e){return e>=1e7||e<=-1e7}function F(e,t){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}const _=e=>e&&!Number.isNaN(e.valueOf())},92471:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>K,createFieldInfoMap:()=>B,findRelatedLayer:()=>ae,findUtilityNetwork:()=>ue,fixTokens:()=>A,formatAttributes:()=>W,formatEditInfo:()=>G,formatValueToFieldInfo:()=>$,getAllFieldInfos:()=>Q,getFieldInfo:()=>H,getFieldInfoLabel:()=>x,getFixedFieldName:()=>O,getFixedFieldNames:()=>N,getHighlightKeyForFeature:()=>ce,getSourceLayer:()=>Z,graphicCallback:()=>C,htmlEntities:()=>J,isAssociatedFeatureSupportedLayer:()=>j,isExpressionField:()=>E,isFeatureSupportedLayer:()=>k,isGraphicForRelatableFeatureSupportedLayer:()=>P,isRelatableFeatureSupportedLayer:()=>U,isRelatableLayer:()=>q,isRelatedField:()=>te,preLayerQueryCallback:()=>le,preRequestCallback:()=>oe,querySourceLayer:()=>Y,queryUpdatedFeature:()=>ee,shouldOpenInNewTab:()=>w,substituteAttributes:()=>L,substituteFieldsInLinksAndAttributes:()=>D});var i=n(21265),r=n(50925),l=n(56612),o=n(66845),a=n(23224),u=n(95011),s=n(78076),d=n(79538),c=n(96247),p=n(40731);const f=()=>r.A.getLogger("esri.widgets.Feature.support.featureUtils"),m=/href=(""|'')/gi,y=/(\{([^{\r\n]+)\})/g,h=/'/g,g=/^\s*expression\//i,v=/(\n)/gi,b=/[\u00A0-\u9999<>&]/gim,F=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,_=/^(?:mailto:|tel:)/,I="relationships/",T=(0,o.J2)("short-date-short-time");function Z(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function C(e){let{type:t,value:n,event:i}=e;try{return"function"==typeof n?n(i):await n}catch(r){return void f().error("error",`An error occurred when calling the "${t}" function`,{error:r,graphic:i.graphic,value:n})}}function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!_.test(e.trim().toLowerCase())}function E(e){return!!e&&g.test(e)}function x(e,t){const n=function(e,t){if(!t||!E(t)||!e)return;const n=t.replace(g,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===n}))}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function O(e,t){const n=M(t,e);return n?n.name:e}function N(e,t){return e&&e.map((e=>O(e,t)))}function M(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function V(e){return`${e}`.trim()}function D(e){let{attributes:t,globalAttributes:n,layer:i,text:r,expressionAttributes:l,fieldInfoMap:o}=e;return r?L({formattedAttributes:n,template:S(r,{...n,...l,...t},i),fieldInfoMap:o}):""}function L(e){let{formattedAttributes:t,template:n,fieldInfoMap:i}=e;return V(function(e){return e.replaceAll(m,"")}((0,l.HC)((0,l.HC)(n,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,i))),t)))}function R(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t[e];if("string"==typeof i){const r="%27",l=(n?encodeURIComponent(i):i).replaceAll(h,r);t[e]=l}}(e,n,t))),n}function A(e,t){return e.replaceAll(y,((e,n,i)=>{const r=M(t,i);return r?`{${r.name}}`:n}))}function S(e,t,n){const i=A(e,n);return i?i.replaceAll(F,((e,n,i)=>function(e,t,n){const i=(t=V(t))&&"{"!==t[0];return(0,l.HC)(e,R(n,i||!1))}(e,n||i,t))):i}function k(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function q(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function U(e){return k(e)&&q(e)}function j(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function P(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&U(e.sourceLayer)}function $(e,t){const{fieldInfos:n,fieldName:i,preventPlacesFormatting:r,layer:l,timeZone:o}=t,s=H(n,i),c=M(l,i);if(s&&!(0,u.isRasterPixelValueField)(i)){const t=c?.type,n=s.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,d.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:l&&"preferredTimeZone"in l?l.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:!(!l||!("datesInUnknownTimezone"in l))&&!!l.datesInUnknownTimezone}})}const p=s?.format;return"string"==typeof e&&(0,u.isRasterPixelValueField)(i)&&p?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?z(e,",",", ",t):e.includes(";")?z(e,";","; ",t):e.includes(" ")?z(e," "," ",t):(0,a.ZV)(Number(e),(0,a.yx)(t))}(e,p):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,p))||null==e||null==p?K(e):(0,a.ZV)(e,r?{...(0,a.yx)(p),minimumFractionDigits:0,maximumFractionDigits:20}:(0,a.yx)(p))}function z(e,t,n,i){return e.trim().split(t).map((e=>(0,a.ZV)(Number(e),(0,a.yx)(i)))).join(n)}function H(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function G(e,t,n,i){const{creatorField:r,creationDateField:l,editorField:a,editDateField:u}=e;if(!t)return;const s=(0,p.hv)(i&&"preferredTimeZone"in i?i.preferredTimeZone:null,!(!i||!("datesInUnknownTimezone"in i))&&!!i.datesInUnknownTimezone,n,T,"date"),d={...T,...s},c=t[u];if("number"==typeof c){const e=t[a];return{type:"edit",date:(0,o.Yq)(c,d),user:e}}const f=t[l];if("number"==typeof f){const e=t[r];return{type:"create",date:(0,o.Yq)(f,d),user:e}}return null}function B(e,t){const n=new Map;if(!e)return n;for(const i of e){if(!i.fieldName)continue;const e=O(i.fieldName,t);i.fieldName=e,n.set(e.toLowerCase(),i)}return n}function Q(e){const t=[];if(!e)return t;const{fieldInfos:n,content:i}=e;return n&&t.push(...n),i&&Array.isArray(i)?(i.forEach((e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}})),t):t}function J(e){return e.replaceAll(b,(e=>`&#${e.charCodeAt(0)};`))}function K(e){return"string"==typeof e?e.replaceAll(v,'<br class="esri-text-new-line" />'):e}function X(e){const{value:t,fieldName:n,fieldInfos:r,fieldInfoMap:l,layer:o,graphic:a,timeZone:s}=e;if(null==t)return"";const c=function(e){let{fieldName:t,value:n,graphic:r,layer:l}=e;if(te(t))return null;if(!l||"function"!=typeof l.getFieldDomain)return null;const o=r&&l.getFieldDomain(t,{feature:r,excludeImpliedDomains:(0,i.A)("esri-widget-legacy-field-domain-calculation")});return o&&"coded-value"===o.type?o.getName(n):null}({fieldName:n,value:t,graphic:a,layer:o});if(c)return c;const p=function(e){let{fieldName:t,graphic:n,layer:i}=e;if(te(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const l=i.getFeatureType(n);return l?l.name:null}({fieldName:n,graphic:a,layer:o});if(p)return p;if(l.get(n.toLowerCase()))return $(t,{fieldInfos:r||Array.from(l.values()),fieldName:n,layer:o,timeZone:s});const f=o?.fieldsIndex?.get(n);return f&&((0,d.fs)(f)||(0,u.isTimeOnlyField)(f))?(0,d.i0)(t,{fieldType:f.type,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}}):K(t)}function W(e){let{fieldInfos:t,attributes:n,layer:i,graphic:r,fieldInfoMap:l,relatedInfos:o,timeZone:a}=e;const u={};return o?.forEach((e=>function(e){let{attributes:t,relatedInfo:n,fieldInfoMap:i,fieldInfos:r,layer:l,timeZone:o}=e;t&&n&&(n.relatedFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:i,fieldInfos:r,layer:l,timeZone:o}))),n.relatedStatsFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:i,fieldInfos:r,layer:l,timeZone:o}))))}({attributes:u,relatedInfo:e,fieldInfoMap:l,fieldInfos:t,layer:i,timeZone:a}))),n&&Object.keys(n).forEach((e=>{const o=n[e];u[e]=X({fieldName:e,fieldInfos:t,fieldInfoMap:l,layer:i,value:o,graphic:r,timeZone:a})})),u}async function Y(e,t){const{layer:n,graphic:i,outFields:r,objectIds:l,returnGeometry:o,spatialReference:a}=e,u=l[0];if("number"!=typeof u&&"string"!=typeof u){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:i,objectId:u,requiredFields:r};return f().warn(e,t),null}if(!(0,s.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:i,requiredFields:r,returnGeometry:o};return f().warn(e,t),null}const d=n.createQuery();return d.objectIds=l,d.outFields=r?.length?r:[n.objectIdField],d.returnGeometry=!!o,d.returnZ=!!o,d.returnM=!!o,d.outSpatialReference=a,(await n.queryFeatures(d,t)).features[0]}async function ee(e,t){let{graphic:n,popupTemplate:i,layer:r,spatialReference:l}=e;if(!r||!i)return;if("function"==typeof r.load&&await r.load(t),!n.attributes)return;const o=r.objectIdField,a=n.attributes[o];if(null==a)return;const s=[a],d=await i.getRequiredFields(r.fieldsIndex),p=(0,u.featureHasFields)(d,n),f=p?[]:d.includes(o)?d:[...d,o],m=i.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(i);if(p&&!m)return;const y=await Y({layer:r,graphic:n,outFields:f,objectIds:s,returnGeometry:m,spatialReference:l},t);y&&(y.geometry&&(n.geometry=y.geometry),y.attributes&&(n.attributes={...n.attributes,...y.attributes}))}function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(I)}function ne(e){let{attributes:t,graphic:n,relatedInfo:i,fieldInfos:r,fieldInfoMap:l,layer:o,timeZone:a}=e;t&&n&&i&&Object.keys(n.attributes).forEach((e=>{const u=function(e){return`${I}${e.layerId}/${e.fieldName}`}({layerId:i.relation.id.toString(),fieldName:e}),s=n.attributes[e];t[u]=X({fieldName:u,fieldInfos:r,fieldInfoMap:l,layer:o,value:s,graphic:n,timeZone:a})}))}const ie=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},re=e=>{let{layer:t,method:n,query:i,definitionExpression:r}=e;if(!t.capabilities?.query?.supportsCacheHint||"attachments"===n)return;const l=null!=i.where?i.where:null,o=null!=i.geometry?i.geometry:null;ie(r)||ie(l)||"extent"===o?.type||"tile"===i.resultType||(i.cacheHint=!0)},le=e=>{let{query:t,layer:n,method:i}=e;re({layer:n,method:i,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})},oe=e=>{let{queryPayload:t,layer:n,method:i}=e;re({layer:n,method:i,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})};function ae(e,t,n){return e&&t&&n?"sublayer"===t.type?de({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:n})||de({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):de({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||de({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function ue(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function se(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function de(e){let{map:t,relationship:n,relationship:{relatedTableId:i},relatedLayer:r,layers:l}=e;if(!l)return null;for(const o of l){if("map-image"===o.type){const e=de({layers:o.sublayers,map:t,relatedLayer:r,relationship:n})||de({layers:o.subtables,map:t,relatedLayer:r,relationship:n});if(e)return e;continue}if(!U(o))continue;if("sublayer"===r.type){if(o!==r&&o.id===i)return o.isTable?se(t,o):o;continue}const e="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!e)return null;if("sublayer"!==o.type){if(o!==r&&o.url===e&&o.layerId===i)return o}else if(o!==r&&o.layer?.url===e&&o.id===i)return o.isTable?se(t,o):o}return null}function ce(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}}}]);