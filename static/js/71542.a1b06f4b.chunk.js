"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[71542],{19983:(e,t,r)=>{r.d(t,{E5:()=>a,JU:()=>o,Of:()=>i,Uk:()=>l,WK:()=>n,g7:()=>u,lO:()=>c,lQ:()=>d});var s=r(74719);function i(e){return e&&"function"==typeof e.highlight}function l(e){return e&&"function"==typeof e.maskOccludee}function o(e,t,r){return null==e||e>=r&&(0===t||e<=t)}function a(e,t){if(t&&e){const{minScale:r,maxScale:s}=e;if(n(r,s))return o(t,r,s)}return!0}function n(e,t){return null!=e&&e>0||null!=t&&t>0}function u(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}function c(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatures"in e&&"layer"in e&&"view"in e}function d(e,t,r){return new s.default("layerview:spatial-reference-incompatible",`The spatial reference of this ${e}${t?`(wkid:${t})`:""} is incompatible with the spatial reference of the view${r?`(wkid:${r})`:""}.`,{})}},24252:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var s=r(93800),i=r(82301),l=r(48602),o=r(21265),a=r(50925),n=r(75269),u=r(56055),c=(r(88677),r(74719)),d=r(17741),h=r(84190),p=r(65920),g=r(13203),f=r(22576),y=r(99961),m=r(66845);const _=/https?:\/\/services.*\.arcgis\.com/i,S=/(?:\{([^}]+)\})/g,w=()=>a.A.getLogger("esri.widgets.Search.support.layerSearchUtils");function v(e,t){const{exactMatch:r=!1,location:s,maxResults:i,spatialReference:l,source:o,sourceIndex:a,suggestResult:n,view:u}=e,{layer:d,filter:p,zoomScale:g}=o,f=u?.scale,y=b(o,u),m=t?.signal;return M(d).then((()=>{const e=d.popupTemplate;return e?e.getRequiredFields(d.fieldsIndex):null})).then((e=>{const{objectIdField:t,returnZ:_}=d,S=Z(o);if(!$(d,S))throw w().error("invalid-field: displayField is invalid."),new c.default("getResults():invalid-field","displayField is invalid.");const v=e?.length?e:[S],x=o.outFields||v,b=F(x);if(x.includes(t)||b||x.push(t),d.floorInfo?.floorField&&x.push(d.floorInfo.floorField),!b&&!A(d,x))throw w().error("invalid-field: outField is invalid."),new c.default("getResults():invalid-field","outField is invalid.");const M=d.createQuery(),{orderByFields:P}=o;if(P&&(M.orderByFields=P),l){M.outSpatialReference=l;const e=1/(0,h.GA)(l);e&&(M.maxAllowableOffset=e)}const G="mesh"===d.geometryType||"multipatch"===d.geometryType,D=d.capabilities?.data?.supportsZ&&!G;if(M.returnZ=D&&!1!==_,M.returnGeometry=!0,M.multipatchOption=G?"xyFootprint":null,x&&(M.outFields=x),s)M.geometry=s;else if(n.key)M.objectIds=[n.key];else{const e=o.searchFields||[S];if(!A(d,e))throw w().error("invalid-field: search field is invalid."),new c.default("getResults():invalid-field","search field is invalid.");E(d)&&(M.num=i),y&&(M.geometry=y);const t=n.text?.trim();if(!t)return[];const s=n.text,{prefix:l="",suffix:a=""}=o,u=C(`${l}${s}${a}`);R(d)&&L(d,e)&&!r&&s&&(M.fullText=I({text:s,searchFields:e}));const h=O({searchTerm:u,layer:d,searchFields:e,filter:p,exactMatch:r,query:M,type:"search"});if(M.where=h,!T(M))return[]}return d.queryFeatures(M,{signal:m}).then((e=>function(e,t,r,s,i,l,o){return e.features.map((e=>N(e,t,r,s,i,l,o)))}(e,u,o,a,S,f,g)))}))}function x(e,t){const{source:r,spatialReference:s,view:i,suggestTerm:l,maxSuggestions:o,sourceIndex:a,exactMatch:n}=e,{layer:u,filter:d}=r,h=t?.signal,p=b(r,i);return M(u).then((()=>{if(!E(u))return[];const e=Z(r),t=r.searchFields||[e],i=[];r.suggestionTemplate?r.suggestionTemplate.replaceAll(S,((e,t)=>(i.push(t),e))):i.push(e);const g=F(i);i.includes(u.objectIdField)||g||i.push(u.objectIdField);const f=$(u,e),y=g||A(u,i),m=A(u,t);if(!f)throw w().error("invalid-field: displayField is invalid."),new c.default("getSuggestions():invalid-field","displayField is invalid.");if(!y)throw w().error("invalid-field: outField is invalid."),new c.default("getSuggestions():invalid-field","outField is invalid.");if(!m)throw w().error("invalid-field: search field is invalid."),new c.default("getSuggestions():invalid-field","search field is invalid.");const _=u.createQuery(),{orderByFields:v}=r;if(v&&(_.orderByFields=v),_.outSpatialReference=s,_.returnGeometry=!1,_.num=o,_.outFields=i,p&&(_.geometry=p),!l.trim())return[];const{prefix:x="",suffix:b=""}=r,M=C(`${x}${l}${b}`);R(u)&&L(u,t)&&!n&&l&&(_.fullText=I({text:l,searchFields:t}));const P=O({searchTerm:M,layer:u,searchFields:t,filter:d,exactMatch:n,query:_,type:"suggest"});return _.where=P,T(_)?u.queryFeatures(_,{signal:h}).then((t=>function(e,t,r,s){return e.features.map((e=>function(e,t,r,s){const i=e.sourceLayer,{attributes:l}=e,{objectIdField:o}=i,a=o?l[o]:null;return{text:G(e,t.suggestionTemplate,s),key:a,sourceIndex:r}}(e,t,r,s)))}(t,r,a,e))):[]}))}function b(e,t){const{filter:r,withinViewEnabled:s}=e,i=t?.extent,l=r?.geometry;return l??(s&&i?i:void 0)}function F(e){return e&&e.includes("*")}async function M(e){e&&await e.load()}function T(e){return!(!e.fullText&&!e.where)}function L(e,t){const r=e?.indexes;return!(!r||!t?.length)&&r.filter((e=>"FullText"===e.indexType)).some((e=>{const r=e.fields?.split(",").map((e=>e.trim().toLowerCase()))||[];return t.every((e=>r.includes(e.toLowerCase())))}))}function I(e){let{text:t,searchFields:r}=e;return t.trim().split(" ").filter((e=>!!e.trim())).map((e=>new f.A({onFields:r,searchTerm:e,searchType:"prefix"})))}function R(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function E(e){return e?.capabilities?.query?.supportsPagination??!1}function Z(e){return e.displayField||e.layer.displayField||function(e){return e?.fieldsIndex?.fields?.find((e=>"string"===e.type))?.name??""}(e.layer)}function A(e,t){return!(!e||!t?.length)&&t.every((t=>$(e,t)))}function $(e,t){return!!e.getField(t)}function C(e){return e.replaceAll("'","''")}function P(e,t){const r=t?.where;return r?`(${e}) AND (${r})`:e}function O(e){let{searchTerm:t,layer:r,searchFields:s,filter:i,exactMatch:l,query:a,type:n}=e;const{definitionExpression:u,url:c}=r;let h="";return!a.fullText&&t&&s&&s.forEach((e=>{const s=r.getField(e),a=r.getFieldDomain?.(e,{excludeImpliedDomains:(0,o.A)("esri-widget-legacy-field-domain-calculation")}),u=(a&&"coded-value"===a.type?function(e,t,r){let{codedValues:s}=e;return(0,d.Pb)(s??[],(e=>{const s=e.name,i=r?s:s.toLowerCase();return(r?t:t.toLowerCase())===i?e.code.toString():null}))??null}(a,t,l):null)||t||null;if(null!==u){const e=function(e){let{currentTerm:t,field:r,filter:s,exactMatch:i,url:l,type:o}=e;const a=r?.type,n=r?.name;if("string"===a||"date"===a||"global-id"===a){const e=_.test(l??""),r=e&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(t)?"N":"";return P(i&&"search"===o?`${n} = ${r}'${t}'`:e?`${n} LIKE ${r}'${t}%'`:`LOWER(${n}) LIKE ${r}'${t.toLowerCase()}%'`,s)}if("oid"===a||"small-integer"===a||"integer"===a||"single"===a||"double"===a){const e=Number(t);return isNaN(e)?null:P(`${n} = ${e}`,s)}return P(`${n} = ${t}`,s)}({currentTerm:u,field:s,filter:i,exactMatch:l,url:c,type:n});e&&(h+=function(e,t){return e?` OR (${t})`:`(${t})`}(h,e))}})),u&&h?`(${u}) AND (${h})`:u||h}function G(e,t,r){const s=e.sourceLayer,{attributes:i}=e,l=s.getFieldDomain?.(r,{feature:e,excludeImpliedDomains:(0,o.A)("esri-widget-legacy-field-domain-calculation")});if(t)return(0,y.V)(t,i);if(r&&i){const e=s.getField(r),t=function(e,t){return e[t]??e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(i,r);return null==t?"":l&&"coded-value"===l.type?function(e,t){let r=null;const{codedValues:s}=e;return s&&s.length&&s.some((e=>e.code===t&&(r=e.name,!0))),r}(l,t)??"":"date"===e?.type?(0,m.Yq)(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}function N(e,t,r,s,l,o,a){const n=e.clone(),u=e.sourceLayer,c=u?.objectIdField,d=c?e.attributes[c]:null,h=G(e,r.searchTemplate,l);null!=o&&function(e){return null!=e&&null!=e.minScale&&null!=e.maxScale}(u)&&(u.minScale&&u.minScale<o?o=u.minScale:u.maxScale&&u.maxScale>o&&(o=u.maxScale));const f=n.geometry?(0,g.ZY)(n.geometry,t??void 0,o??void 0):void 0,y="number"==typeof a&&f?(0,g.DN)((0,i.clone)(f),t??void 0,a):f,m=e.clone();return null!=y&&(m.geometry=p.default.fromExtent(y)),{extent:y,target:m,feature:n,key:d,name:h,sourceIndex:s}}var D;let k=D=class extends u.default{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>v({source:this,...e},t),this.getSuggestions=(e,t)=>x({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new D({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,i.clone)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,i.clone)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find((e=>"string"===e.type))?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const r=e.getField(t);return r?.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};(0,s._)([(0,l.MZ)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],k.prototype,"displayField",void 0),(0,s._)([(0,l.MZ)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],k.prototype,"exactMatch",void 0),(0,s._)([(0,l.MZ)({value:null})],k.prototype,"layer",null),(0,s._)([(0,l.MZ)()],k.prototype,"name",null),(0,s._)([(0,l.MZ)({type:[String],json:{write:!0}})],k.prototype,"orderByFields",void 0),(0,s._)([(0,l.MZ)()],k.prototype,"searchFields",void 0),(0,s._)([(0,l.MZ)()],k.prototype,"searchTemplate",void 0),(0,s._)([(0,l.MZ)()],k.prototype,"suggestionTemplate",void 0),k=D=(0,s._)([(0,n.$)("esri.widgets.Search.LayerSearchSource")],k);const j=k},71542:(e,t,r)=>{r.r(t),r.d(t,{default:()=>q});var s=r(93800),i=r(21772),l=r(32195),o=r(79625),a=r(35377),n=r(6946),u=r(62631),c=r(89129),d=r(74719),h=r(58448),p=r(50925),g=r(17741),f=r(49959),y=r(79953),m=r(48602),_=(r(21265),r(75269)),S=r(75400),w=r(93321),v=r(13203),x=r(12711),b=r(53957),F=r(78139),M=r(9167),T=r(92744),L=r(99071),I=r(89320),R=r(19983),E=r(24252),Z=r(17135),A=r(56055),$=r(62333),C=r(72744),P=r(30920);function O(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const G="highlight",N=c.default.ofType({key:e=>e.layer?"layer":"locator",base:A.default,typeMap:{layer:E.default,locator:Z.default}}),D=w.default.WGS84,k=/<[\s\S]*?>/g,j=-1;let V=class extends((0,P.A)(h.A.EventedMixin(n.default))){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new N,this.defaultSymbols={point:new M.default({url:(0,i.s)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new L.default({color:[130,130,130,1],width:2}),polygon:new T.default({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=F.default.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new N,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await(0,b.ud)("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new a.default({title:e.searchResult,content:"{Match_addr}"})};e(),this.addHandles([(0,y.watch)((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),y.initial),(0,x.oQ)(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?j:0}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:r}=this,s="function"==typeof r?r.call(null,{sources:e,defaultSources:t}):r?t.concat(e):e,i=this._get("allSources")||new N;return i.removeAll(),i.addMany(s.filter(Boolean)),i}get locationEnabled(){return this._get("locationEnabled")||(0,C.$j)()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=(0,C.$j)();if(e&&!t){const e=new d.default("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});p.A.getLogger(this).error(e)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:r}=this;if(t===j)return r??"";const s=e.at(t);return s?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const r=this._createSuggestionForSearch(e),s=(async()=>{try{await this.when();const e=await this._getResultsFromSources(r,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:r.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(s,e,r);const i=this._getFirstResult(s.results),l=r.location&&i?i.name:r.text,o=l?.replace(k,"");return this._set("searchTerm",o),(r.key&&"number"==typeof r.sourceIndex||r.location)&&this._set("selectedSuggestion",r),this._set("results",s.results),this._set("resultCount",s.results.reduce(((e,t)=>e+(t.results?.length??0)),0)),this.emit("search-complete",s),await this._selectFirstResult(i),s}finally{this._clearSearching()}})();return this._searching=s,s}async searchNearby(e){if(!this.locationEnabled){const e=new d.default("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw p.A.getLogger(this).error(e),e}const t=(async()=>{try{const t=await(0,C.J1)(),r=await(0,C.Ly)({position:t,view:this.view},e);return await this.search(r,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const t=new d.default("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw p.A.getLogger(this).error(t),t}const{view:t}=this,r=O(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),s=null!=r?this.allSources.at(r):null;if(!s){const e=new d.default("select:missing-source","Cannot select without a source.",{source:s});throw p.A.getLogger(this).error(e),e}const i=s instanceof E.default?this._getLayerSourcePopupTemplate(s):s.popupTemplate,l=s.resultSymbol||this._getDefaultSymbol(e),a=O(s,"resultGraphicEnabled")?s.resultGraphicEnabled:this.resultGraphicEnabled,n=O(s,"autoNavigate")?s.autoNavigate:this.autoNavigate,u=O(s,"popupEnabled")?s.popupEnabled:this.popupEnabled,c=u?i||this.popupTemplate||this.defaultPopupTemplate:null,{feature:h}=e;if(!h){const e=new d.default("select:missing-feature","Cannot select without a feature.",{feature:h});throw p.A.getLogger(this).error(e),e}const{attributes:g,geometry:y,layer:m,sourceLayer:_}=h,S=y?(0,v.z8)(y):null,w={layerViewQuery:this._getLayerView(h),elevationQuery:t&&null!=S?(0,v.Sv)(S,t):Promise.resolve(S)},x=await(0,f.eachAlways)(w),b=x.layerViewQuery.value,F=x.elevationQuery.value;l instanceof I.default&&(l.text=e.name);const M=t&&n?e.target||e.extent:null,T=null!=M?this._goToSearchResult(M):Promise.resolve();await T;const L=b?h:new o.default({geometry:y,symbol:l,attributes:g,layer:m,sourceLayer:_,popupTemplate:c}),Z=t?.popup,A=Z&&u&&L.getEffectivePopupTemplate(Z.defaultPopupTemplateEnabled);return A&&await t.openPopup({features:[L],location:F}),b&&(0,R.Of)(b)&&!A&&this._highlightFeature({graphic:L,layerView:b}),!b&&a&&t&&t.graphics.push(L),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",L),this.emit("select-result",{result:e,source:s,sourceIndex:r}),e}async suggest(e,t,r){const s=e||this.searchTerm;this.emit("suggest-start",{searchTerm:s}),await this._suggestTimer(t,r);const i=await this._suggestImmediate(s,r);return this._set("suggestions",i?.results),this._set("suggestionCount",i?.results.reduce(((e,t)=>e+(t.results?.length??0)),0)??null),this.emit("suggest-complete",i),i}async when(){await(0,y.whenOnce)((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const r=this._updatingPromise=(0,f.eachAlways)([e?.load(),t?.when()]);if(this.destroyed)return;if(await r,r!==this._updatingPromise)return}await(0,y.whenOnce)((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map((e=>{if(!1===e.placefinding)return;const t=l.default.apiKey&&(0,$.m$)(e.url)?{url:$.jd}:null,r=Z.default.fromJSON({...e,...t}),s=r.url;if((0,$.m$)(s)||(0,$.jE)(s)||(0,$.sx)(s)){const e=r.outFields??["Addr_type","Match_addr","StAddr","City"],t=(r.placeholder||this.messages?.placeholder)??"",s="number"==typeof r.defaultZoomScale?r.defaultZoomScale:2500;r.singleLineFieldName="SingleLine",r.outFields=e,r.placeholder=t,r.defaultZoomScale=s}return r.singleLineFieldName?r:void 0})).filter(u.Ru):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>e?.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){const r=this.view?.map;return e.map((e=>{const s=r.findLayerById(e.id);if(!s)return;const i=this._getLayerJSON(e),l=E.default.fromJSON(i);return l.placeholder=t,this._getLayer(s,i).then((e=>{l.layer=e})),l})).filter(u.Ru).toArray()}_getTableSources(e,t){const r=this.view?.map;return e.map((e=>{if(!e.id)return;const s=r.findTableById(e.id);if(!s)return;const i=this._getLayerJSON(e),l=E.default.fromJSON(i);return l.placeholder=t,this._getLayer(s,i).then((e=>{l.layer=e})),l})).filter(u.Ru).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:r,hintText:s,layers:i,tables:l}=t;return r?[...this._getLayerSources(i,s),...this._getTableSources(l,s)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const r=e.allSublayers.find((e=>e.id===t.subLayer));if(!r)throw new Error;const s=await(r.createFeatureLayer?.());if(!s)throw new Error;return this._createdFeatureLayers.push(s),s}async _getBuildingSubLayer(e,t){await e.load();const r=e.allSublayers.find((e=>e.id===t.subLayer));if("building-component"!==r?.type)throw new Error;if(await r.load(),null==r.associatedLayer)throw new Error;return await r.associatedLayer.load(),r}async _getLayer(e,t){if("feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type)return e;if("map-image"===e.type)try{return await this._getSubLayer(e,t)}catch(r){const t=new d.default("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return p.A.getLogger(this).error(t),null}return"building-scene"===e.type?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const r="selectedFeature"in e,s=r?e.selectedFeature:null;r&&s&&s===t&&e.close()}_suggestTimer(e,t){const r=null!=e?e:this.suggestionDelay;return(0,f.after)(r,null,t?.signal)}_createLocationForSearch(e){return e instanceof o.default&&e.geometry?(0,v.z8)(e.geometry):e instanceof S.default?e:Array.isArray(e)&&2===e.length?new S.default({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&O(e,"key")&&O(e,"text")&&O(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),r="string"==typeof e?e:this.searchTerm,{selectedSuggestion:s,selectedResult:i}=this,l=!e&&s&&i,o=l&&s.key===i.key&&s.sourceIndex===i.sourceIndex,a=l&&s.location;return o||a?s:{location:t,text:t?"":r,sourceIndex:null,key:null}}_getFirstResult(e){return(0,g.Pb)(e,(e=>{let{results:t}=e;return t?.[0]}))??null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){await this.when();const r=await this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(s,r),s}_formatSourceResponse(e,t,r){const s=t?.value||[],i=t?.error,l=this.allSources.at(r);if(i){const t={sourceIndex:r,source:l,error:i};e.errors.push(t),p.A.getLogger(this).error(i),e.numErrors++}else{const t={sourceIndex:r,source:l,results:s};e.results.push(t),e.numResults+=s.length}}_formatResponse(e,t,r){if(t)if(e.activeSourceIndex===j){const s=r&&O(r,"sourceIndex")&&-1!==r.sourceIndex?r.sourceIndex:void 0;t.forEach(((t,r)=>{const i=void 0!==s?s:r;this._formatSourceResponse(e,t,i)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:r}=this,s=!e.location&&O(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,i=[];if(!r.length){const e=new d.default("search:no-sources-defined","At least one source is required.",{allSources:r});throw p.A.getLogger(this).error(e),e}return s===j?r.forEach(((r,s)=>{i.push(this._getResultsFromSource(e,s,t))})):i.push(this._getResultsFromSource(e,s,t)),(0,f.eachAlways)(i)}async _getSuggestionsFromSources(e,t){const{allSources:r,activeSourceIndex:s}=this,i=[];if(!r.length){const e=new d.default("suggest:no-sources-defined","At least one source is required.",{allSources:r});throw p.A.getLogger(this).error(e),e}return s===j?r.forEach(((r,s)=>{i.push(this._getSuggestionsFromSource(e,s,t))})):i.push(this._getSuggestionsFromSource(e,s,t)),(0,f.eachAlways)(i)}async _getResultsFromSource(e,t,r){const s=null!=t?this.allSources.at(t):null;if(!s)return null;const{location:i=null}=e,l=this.view?.spatialReference||D,o=O(s,"maxResults")?s.maxResults:this.maxResults,a=!!(s instanceof E.default&&O(s,"exactMatch"))&&s.exactMatch,{view:n}=this;return s.getResults?.({view:n,sourceIndex:t,location:i,suggestResult:e,spatialReference:l,exactMatch:a,maxResults:o},r)}async _getSuggestionsFromSource(e,t,r){const s=this.allSources.at(t);if(!s)return null;e??="";const i=O(s,"suggestionsEnabled")?s.suggestionsEnabled:this.suggestionsEnabled,l=e?.length,o=O(s,"minSuggestCharacters")?s.minSuggestCharacters:this.minSuggestCharacters;if(i&&e.trim()&&l>=o){const i=this.view?.spatialReference||D,l=O(s,"maxSuggestions")?s.maxSuggestions:this.maxSuggestions,{view:o}=this,a=!!(s instanceof E.default&&O(s,"exactMatch"))&&s.exactMatch;return s.getSuggestions?.({view:o,sourceIndex:t,suggestTerm:e,spatialReference:i,maxSuggestions:l,exactMatch:a},r)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return O(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return(0,g.Pb)(this.results??[],(t=>{let{results:r,sourceIndex:s}=t;const i=r?.includes(e);return i?s:null}))??null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const r={target:{target:e},options:{signal:t.signal}};e||(r.options.animate=!1),await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,r=e.feature?.geometry;if(null==r)return null;switch(r.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(G)}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer?.type||"subtype-sublayer"===e.layer?.type)return null;const{layer:r}=e;return r?(await t.when(),t.whenLayerView(r)):null}_highlightFeature(e){const{graphic:t,layerView:r}=e,{attributes:s,layer:i}=t,{objectIdField:l}=i,o=(l&&s?.[l])??null,a=r.highlight(o??t);this.addHandles(a,G)}_setResultFloor(e){const{view:t}=this,r=e.feature?.attributes,s=e.feature?.sourceLayer;if(s&&"floorInfo"in s&&s?.floorInfo?.floorField&&r){const e=r[s.floorInfo.floorField];t?.emit("select-result-floor",e)}}};V.ALL_INDEX=j,(0,s._)([(0,m.MZ)()],V.prototype,"_searching",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"_updatingPromise",void 0),(0,s._)([(0,m.MZ)({readOnly:!0,value:null})],V.prototype,"activeSource",null),(0,s._)([(0,m.MZ)()],V.prototype,"activeSourceIndex",null),(0,s._)([(0,m.MZ)()],V.prototype,"allPlaceholder",null),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"allSources",null),(0,s._)([(0,m.MZ)()],V.prototype,"autoNavigate",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"autoSelect",void 0),(0,s._)([(0,m.MZ)({type:a.default})],V.prototype,"defaultPopupTemplate",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"defaultSources",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"defaultSymbols",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"includeDefaultSources",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"locationEnabled",null),(0,s._)([(0,m.MZ)()],V.prototype,"maxInputLength",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"maxResults",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"maxSuggestions",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"messages",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"minSuggestCharacters",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"placeholder",null),(0,s._)([(0,m.MZ)()],V.prototype,"popupEnabled",void 0),(0,s._)([(0,m.MZ)({type:a.default})],V.prototype,"popupTemplate",void 0),(0,s._)([(0,m.MZ)({type:F.default})],V.prototype,"portal",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"resultCount",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"resultGraphicEnabled",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"resultGraphic",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"results",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"selectedSuggestion",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"searchAllEnabled",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"selectedResult",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"searchTerm",null),(0,s._)([(0,m.MZ)({type:N})],V.prototype,"sources",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"state",null),(0,s._)([(0,m.MZ)()],V.prototype,"suggestionDelay",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"suggestionCount",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"suggestions",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],V.prototype,"updating",null),(0,s._)([(0,m.MZ)()],V.prototype,"view",void 0),(0,s._)([(0,m.MZ)()],V.prototype,"clear",null),V=(0,s._)([(0,_.$)("esri.widgets.Search.SearchViewModel")],V);const q=V}}]);