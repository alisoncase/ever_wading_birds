"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[57263],{57263:(e,t,o)=>{o.r(t),o.d(t,{default:()=>he});var i=o(93800),s=(o(88677),o(62631)),l=o(42198),n=o(50925),r=o(17741),a=o(49959),c=o(79953),d=o(48602),p=(o(21265),o(75269)),h=o(98258),u=o(27811),v=o(17577),g=o(54611),_=o(42265);o(14746);const m=1,y={s:32,m:48,l:64},f={horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}},b={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function M(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap((e=>M(e,t)))??[]}const w=e=>{let t=class extends e{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(e){const t=this._get("measurementManager");e!==t&&(t&&t.managedElements.remove(this),this._set("measurementManager",e),e?.managedElements.add(this))}set budgetedLength(e){this.budgetedLength!==e&&(this._set("budgetedLength",e),this.scheduleRender())}get actionChildren(){return this.children?.flatMap((e=>M(e,"calcite-action")))??[]}get activeChildElement(){const e=this.actionChildren.find((e=>!0===e.properties?.active));return e?(this._set("lastActiveKey",e.properties?.key),e):this.lastActiveKey?this.actionChildren.find((e=>e.properties?.key===this.lastActiveKey)):void 0}_handleClick(e){e?.dataset&&"dataset"in e&&e.dataset.actionKey&&(this.lastActiveKey=e.dataset.actionKey)}};return(0,i._)([(0,d.MZ)()],t.prototype,"priority",void 0),(0,i._)([(0,d.MZ)()],t.prototype,"measurementManager",null),(0,i._)([(0,d.MZ)()],t.prototype,"budgetedLength",null),(0,i._)([(0,d.MZ)()],t.prototype,"actionChildren",null),(0,i._)([(0,d.MZ)()],t.prototype,"activeChildElement",null),(0,i._)([(0,d.MZ)()],t.prototype,"scale",void 0),(0,i._)([(0,d.MZ)()],t.prototype,"slot",void 0),(0,i._)([(0,d.MZ)()],t.prototype,"lastActiveKey",void 0),(0,i._)([(0,d.MZ)()],t.prototype,"layout",void 0),t=(0,i._)([(0,p.$)("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],t),t};var T=o(17745),C=o(87118);const O=Symbol("on-resize-handle-key");let k=class extends(w(u.default)){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return["horizontal"===this.layout?this._measuredWidth:this._measuredHeight]}render(){return(0,C.K)("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles((0,T.EV)(this._measuredElement,(()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0})),O)},afterRemoved:()=>this.removeHandles(O)},this.children)}};(0,i._)([(0,d.MZ)()],k.prototype,"_measuredWidth",void 0),(0,i._)([(0,d.MZ)()],k.prototype,"_measuredHeight",void 0),(0,i._)([(0,d.MZ)()],k.prototype,"lengthOptions",null),(0,i._)([(0,d.MZ)()],k.prototype,"_measuredElement",void 0),k=(0,i._)([(0,p.$)("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],k);const Z=k;var E=o(49403),S=o(76697);let P=class extends(w(u.default)){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return(0,E.W)({action:()=>o.e(88342).then(o.bind(o,88342)),"action-group":()=>Promise.all([o.e(86290),o.e(74597),o.e(11484)]).then(o.bind(o,11484)),"action-menu":()=>Promise.all([o.e(86290),o.e(74597),o.e(71564)]).then(o.bind(o,71564))})}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?m+y[t]*Math.min(e.length,2):m+y[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:o,allowCollapse:i,priority:s}=this,l=[o];if(e.length<=2||!i||s<1)return l;for(let n=1;n<e.length-1;n++)l.push(o+y[t]*n);return l}render(){if(!this.actionChildren.length)return(0,C.K)(C.w,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:o,layout:i,slot:s,scale:l}=this,n=Math.floor(e/y[l]),r=[],a=[];if(n>=t.length)r.push(...t);else{const e=o??r.at(0);if(r.push(...t.slice(0,n-1)),a.push(...t.slice(n-1)),e&&a.includes(e)){const[t]=a.splice(a.indexOf(e),1),o=r.pop();r.push(t),o&&a.unshift(o)}}return(0,C.K)("calcite-action-group",{key:"overflow-button-group",layout:i,onclick:e=>this._handleClick(e.target),slot:s},r.map((e=>this._renderManagedAction(e))),a.length>0?(0,C.K)("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},(0,C.K)("calcite-action",{icon:b.overflow,key:"split-button-dropdown-trigger",scale:l,slot:"trigger",text:this.messagesCommon.more}),a.map((e=>this._renderManagedAction(e)))):void 0)}_renderManagedAction(e){return(0,C.K)("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};P.vnodeSelector="calcite-action-group",(0,i._)([(0,d.MZ)()],P.prototype,"allowCollapse",void 0),(0,i._)([(0,d.MZ)()],P.prototype,"minimumLength",null),(0,i._)([(0,d.MZ)(),(0,S.G)("esri/t9n/common")],P.prototype,"messagesCommon",void 0),(0,i._)([(0,d.MZ)()],P.prototype,"lengthOptions",null),P=(0,i._)([(0,p.$)("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],P);const x=P;var K=o(6946),R=o(89129);let L=class extends K.default{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new R.default,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver((()=>{this._measure()}))}get _sortedElements(){return[...this.managedElements].sort(((e,t)=>t.priority-e.priority))}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:o}=this;let i=0;for(const s of o){const t=s.lengthOptions[0];e.set(s,t),i+=t}for(const s of o)for(;i<t;){const o=e.get(s);if(!o)break;const l=s.lengthOptions.find((e=>e>o));if(!l)break;const n=i-o+l;if(n>t)break;e.set(s,l),i=n}for(const[s,l]of e)s.budgetedLength=l}_measure(){const e=this.measuredElement;this.availableLength=e?"horizontal"===this.layout?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};(0,i._)([(0,d.MZ)()],L.prototype,"measuredElement",void 0),(0,i._)([(0,d.MZ)()],L.prototype,"managedElements",void 0),(0,i._)([(0,d.MZ)()],L.prototype,"_sortedElements",null),(0,i._)([(0,d.MZ)()],L.prototype,"availableLength",void 0),(0,i._)([(0,d.MZ)()],L.prototype,"layout",void 0),L=(0,i._)([(0,p.$)("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],L);const I=L,G="esri-split-button--split-part";let A=class extends(w(u.default)){constructor(e){super(e),this.messagesCommon=null}loadDependencies(){return(0,E.W)({action:()=>o.e(88342).then(o.bind(o,88342)),"action-group":()=>Promise.all([o.e(86290),o.e(74597),o.e(11484)]).then(o.bind(o,11484)),"action-menu":()=>Promise.all([o.e(86290),o.e(74597),o.e(71564)]).then(o.bind(o,71564))})}get minimumLength(){const e=this.actionChildren;return e.length?1===e.length?y[this.scale]+m:y[this.scale]+f[this.layout][this.scale]+m:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:o,scale:i,priority:s}=this;if(e.length<2||s<0)return[t];const l=m+y[i]*e.length;return[m+y[i]+f[o][i],l]}render(){if(!this.actionChildren.length)return(0,C.K)(C.w,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:o,layout:i,slot:s}=this,l=e.length<2||o>t;return(0,C.K)("calcite-action-group",{key:"split-button-group",layout:i,onclick:e=>this._handleClick(e.target),slot:s},l?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:o,scale:i,messagesCommon:s}=this,l=e??o.at(0);if(!l)return;const n=o.filter((e=>e!==l));return[this._renderManagedAction(l),(0,C.K)("calcite-action-menu",{key:"split-button-dropdown",label:s.more,overlayPositioning:"fixed",placement:"horizontal"===t?"bottom-end":"right-end"},(0,C.K)("calcite-action",{class:`${G}--${t}--${this.scale}`,compact:"horizontal"===t,icon:b.splitButton[t],key:"split-button-dropdown-trigger",scale:i,slot:"trigger",text:s.more}),n?.map((e=>this._renderManagedAction(e))))]}_renderUnSplit(){return this.actionChildren.map((e=>this._renderManagedAction(e)))}_renderManagedAction(e){return(0,C.K)("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};A.vnodeSelector="calcite-action-group",(0,i._)([(0,d.MZ)()],A.prototype,"minimumLength",null),(0,i._)([(0,d.MZ)()],A.prototype,"lengthOptions",null),(0,i._)([(0,d.MZ)(),(0,S.G)("esri/t9n/common")],A.prototype,"messagesCommon",void 0),A=(0,i._)([(0,p.$)("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],A);const z="esri-responsive-toolbar",$={rulerBase:`${z}__ruler`,rulerBarHorizontal:`${z}__ruler--bar`,rulerBarVertical:`${z}__ruler--bar--vertical`,rulerPadVertical:`${z}__ruler--pad--vertical`,rulerPadHorizontal:`${z}__ruler--pad--horizontal`,bar:`${z}__bar`,barHorizontal:`${z}__bar--horizontal`,barVertical:`${z}__bar--vertical`,pad:`${z}__pad`,padVertical:`${z}__pad--vertical`,padHorizontal:`${z}__pad--horizontal`};let H=class extends u.default{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new I,this._managedWidgets=new Map}loadDependencies(){return(0,E.W)({"action-bar":()=>Promise.all([o.e(86290),o.e(74597),o.e(36334)]).then(o.bind(o,36334)),"action-pad":()=>Promise.all([o.e(86290),o.e(74597),o.e(29022)]).then(o.bind(o,29022))})}destroy(){this._measurementManager=(0,r.pR)(this._measurementManager),this._managedWidgets.forEach((e=>e.destroy())),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}render(){const{layout:e,scale:t,barStyle:o}=this,i={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},s="docked"===o?"vertical"===e?$.rulerBarVertical:$.rulerBarHorizontal:"horizontal"===e?$.rulerPadHorizontal:$.rulerPadVertical;return(0,C.K)("div",null,(0,C.K)("div",{afterCreate:e=>{this._measurementManager?.connect(e)},class:this.classes($.rulerBase,s)}),"docked"===o?(0,C.K)("calcite-action-bar",{...i,classes:{[$.barHorizontal]:"horizontal"===this.layout,[$.barVertical]:"vertical"===this.layout,[$.bar]:!0},overflowActionsDisabled:!0},this._renderChildren()):(0,C.K)("calcite-action-pad",{...i,class:this.classes($.pad,"horizontal"===e?$.padHorizontal:$.padVertical)},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter((e=>void 0!==e.properties?.key&&"group-kind"in e.properties)),t=new Set,o=e.map((e=>{const o=e.properties,i=o.key;t.add(i);const s="docked"===this.barStyle?o.slot??void 0:void 0,l=o.priority??0,n=o["group-kind"]??"overflow-group",r=o["allow-collapse"]??!0,a=this._managedWidgets.get(i);if(a)return a.children=e.children,a.priority=l,"allowCollapse"in a&&(a.allowCollapse=r),a.slot=s,a.layout=this.layout,a.scale=this.scale,a.measurementManager=this._measurementManager,a;const c={scale:this.scale,priority:l,measurementManager:this._measurementManager,children:e.children,slot:s,layout:this.layout};switch(n){case"split-button":{const e=new A({...c});return this._managedWidgets.set(i,e),e}case"overflow-group":{const e=new x({...c,allowCollapse:r});return this._managedWidgets.set(i,e),e}case"measured-content":{const e=new Z({...c});return this._managedWidgets.set(i,e),e}}})).filter(s.Ru);return Array.from(this._managedWidgets.keys()).filter((e=>!t.has(e))).forEach((e=>{this._managedWidgets.get(e)?.destroy(),this._managedWidgets.delete(e)})),this._measurementManager?.allocate(),o.map((e=>e.render()))}};(0,i._)([(0,d.MZ)()],H.prototype,"scale",void 0),(0,i._)([(0,d.MZ)({value:"horizontal"})],H.prototype,"layout",null),(0,i._)([(0,d.MZ)()],H.prototype,"barStyle",void 0),(0,i._)([(0,d.MZ)()],H.prototype,"_measurementManager",void 0),(0,i._)([(0,d.MZ)()],H.prototype,"_managedWidgets",void 0),H=(0,i._)([(0,p.$)("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],H);const B=H;var V=o(56082),W=o(32980),D=o(50821),U=o(58448),F=o(78076),N=o(22093),J=o(19983),j=o(2663);let q=class extends U.A.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layerViewPreferenceEnabled=!0,this.sources=null}initialize(){this.addHandles([(0,c.watch)((()=>this._sources),(e=>{this.activeOperation&&(this.activeOperation.sources=e)}))])}destroy(){this._operationHandlesGroup=(0,r.xt)(this._operationHandlesGroup)}get _sources(){const{layerViewPreferenceEnabled:e,sources:t,view:o}=this;return o&&t?.length?t.flatMap((t=>{if((0,J.lO)(t))return t;if((0,F.cM)(t)||(0,F.Qz)(t)){const i=t.layers||[],s=i.map((t=>{const i=(0,N.i)(o,t)||void 0;return e&&(0,J.lO)(i)?i:t}));return s.length?s.toArray():i.length?i.toArray():t}if(!e)return t;const i=(0,N.i)(o,t)||void 0;return(0,J.lO)(i)?i:t})):[]}get layers(){return(0,V.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){(0,V.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){const{_sources:e,view:t}=this,o=!e?.length&&!t?.selectionManager.sources.length;return this.activeOperation?"active":t?.ready&&!o?"ready":"disabled"}cancel(){"active"===this.state&&(this.activeOperation?.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:t,state:o,view:i}=this,s=!t?.length&&!i?.selectionManager.sources.length;if("disabled"===o||s||!this.view)return;"active"===o&&this.cancel();const n=new j.A({view:this.view,sources:t,options:e});return this._operationHandlesGroup=(0,l.vE)([n.selection.on("change",(e=>this.emit("selection-change",e))),n.once("complete",(e=>this._onOperationComplete(e)))]),this._set("activeOperation",n),n}_onOperationComplete(e){this._operationHandlesGroup=(0,r.xt)(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};(0,i._)([(0,d.MZ)()],q.prototype,"_sources",null),(0,i._)([(0,d.MZ)({readOnly:!0})],q.prototype,"activeOperation",void 0),(0,i._)([(0,d.MZ)()],q.prototype,"layers",null),(0,i._)([(0,d.MZ)()],q.prototype,"layerViewPreferenceEnabled",void 0),(0,i._)([(0,d.MZ)()],q.prototype,"sources",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],q.prototype,"state",null),(0,i._)([(0,d.MZ)()],q.prototype,"view",void 0),q=(0,i._)([(0,p.$)("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],q);const Q=q,X={lassoTool:!0,rectangleTool:!0},Y="esri-selection-toolbar",ee={base:Y,container:`${Y}__container`,toolButton:`${Y}__tool-button`};let te=class extends u.default{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.defaultLassoToolOptions={createTool:"polygon",mode:"freehand"},this.defaultRectangleToolOptions={createTool:"rectangle"},this.messages=null,this.toolConfigs=[],this.viewModel=new Q,this.visibleElements={...X},this.scale="s",this.layout="horizontal",this._viewModelHandlesGroup=(0,l.vE)([this.viewModel.on("complete",(e=>{this._set("activeToolInfo",null),this.emit("complete",e)}))])}destroy(){this._viewModelHandlesGroup=(0,r.xt)(this._viewModelHandlesGroup)}loadDependencies(){return(0,E.W)({action:()=>o.e(88342).then(o.bind(o,88342))})}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return(0,V.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){(0,V.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...X,...e}}get state(){return this.viewModel.state}get visibleToolCount(){const{view:e,toolConfigs:t,visibleElements:o}=this;return(t?.length??0)+("2d"===e?.type?(o.lassoTool?1:0)+(o.rectangleTool?1:0):0)}activate(e){if(this.cancel(),"disabled"!==this.state)switch(e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return(0,C.K)("div",{"aria-label":this.label,class:this.classes(ee.base,D.D.widget)},(0,C.K)("div",{class:ee.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){if("2d"===this.view?.type)return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){if(this.toolConfigs?.length)return this.toolConfigs.map((e=>{let{toolName:t,icon:o,toolKey:i}=e;return this._renderToolWithTooltip(t,i,o)}))}_renderLassoTool(){const{messages:e,visibleElements:t}=this;if(!t.lassoTool)return;const o=e.selectByLasso;return this._renderToolWithTooltip("lasso","lasso","lasso-select",o)}_renderRectangleTool(){const{messages:e,visibleElements:t}=this;if(!t.rectangleTool)return;const o=e.selectByRectangle;return this._renderToolWithTooltip("rectangle","rectangle","cursor-marquee",o)}_renderToolWithTooltip(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;const s=`${this.id}-tool-${t}`;return(0,C.K)("calcite-action",{active:this.activeToolInfo?.toolName===e,bind:this,class:ee.toolButton,disabled:"disabled"===this.state,icon:o||"selection",id:s,key:s,onclick:()=>this._toggleTool(e),scale:this.scale,text:i,title:i})}_activateTool(e){const t=this._getToolOptions(e);if(!t)return;const o=this.viewModel.activate(t);o&&this._set("activeToolInfo",{toolName:e,operation:o})}_toggleTool(e){if(this.activeToolInfo){const t=this.activeToolInfo.toolName;if(this.cancel(),t===e)return}this._activateTool(e)}_getToolOptions(e){return"lasso"===e?this.defaultLassoToolOptions:"rectangle"===e?this.defaultRectangleToolOptions:this.toolConfigs.find((t=>t.toolName===e))}};(0,i._)([(0,d.MZ)({readOnly:!0})],te.prototype,"activeToolInfo",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"defaultLassoToolOptions",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"defaultRectangleToolOptions",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"label",null),(0,i._)([(0,d.MZ)()],te.prototype,"layers",null),(0,i._)([(0,d.MZ)()],te.prototype,"layerViewPreferenceEnabled",null),(0,i._)([(0,d.MZ)(),(0,S.G)("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],te.prototype,"messages",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"sources",null),(0,i._)([(0,d.MZ)()],te.prototype,"toolConfigs",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"view",null),(0,i._)([(0,d.MZ)()],te.prototype,"viewModel",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"visibleElements",void 0),(0,i._)([(0,W.w)("visibleElements")],te.prototype,"castVisibleElements",null),(0,i._)([(0,d.MZ)()],te.prototype,"scale",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"state",null),(0,i._)([(0,d.MZ)()],te.prototype,"layout",void 0),(0,i._)([(0,d.MZ)()],te.prototype,"visibleToolCount",null),te=(0,i._)([(0,p.$)("esri.widgets.support.SelectionToolbar")],te);const oe=te;var ie=o(7010),se=o(79889),le=o(66201),ne=o(56390),re=o(99961);const ae="esri-sketch",ce={base:ae,vertical:`${ae}--vertical`,docked:`${ae}-bar`,floating:`${ae}-pad`,chipHorizontal:`${ae}__selection-count-chip--horizontal`,chipVertical:`${ae}__selection-count-chip--vertical`,chipVerticalSmall:`${ae}__selection-count-chip--vertical--s`,popoverWrapper:`${ae}__popover-wrapper`},de={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3-d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let pe=class extends u.default{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new g.AP,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new v.default({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,o=new oe({view:"2d"===t?.type?t:null,sources:e?[e]:null,scale:this.scale});this.addHandles([(0,c.watch)((()=>this.viewModel),(e=>{this._viewModelHandlesGroup=(0,r.xt)(this._viewModelHandlesGroup),e&&(this._viewModelHandlesGroup=(0,l.vE)([e.on("create",(()=>this.scheduleRender())),e.on("update",(()=>this.scheduleRender())),e.on("delete",(e=>this.emit("delete",e))),e.on("undo",(()=>this.scheduleRender())),e.on("redo",(()=>this.scheduleRender())),(0,c.watch)((()=>e.layer),(e=>{this._selectionToolbar&&(this._selectionToolbar.sources=e?[e]:null)})),(0,c.watch)((()=>e.view),(e=>{this._selectionToolbar&&(this._selectionToolbar.view="2d"===e?.type?e:null)})),(0,c.watch)((()=>e.state),(()=>this.notifyChange("state")))]))}),c.syncAndInitial),(0,c.when)((()=>o.activeToolInfo),(()=>this.viewModel.cancel())),o.on("complete",(e=>this._onSelectionOperationComplete(e))),(0,c.watch)((()=>{const{selectionTools:e}=this.visibleElements;return{lassoTool:!!e?.["lasso-selection"],rectangleTool:!!e?.["rectangle-selection"]}}),(e=>{Object.assign(o.visibleElements,e)}),c.syncAndInitial)]),this._selectionToolbar=o}loadDependencies(){return(0,E.W)({action:()=>o.e(88342).then(o.bind(o,88342)),chip:()=>o.e(60382).then(o.bind(o,60382)),popover:()=>Promise.all([o.e(86290),o.e(74597)]).then(o.bind(o,74597))})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=(0,r.xt)(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:o,activeCreateToolDrawMode:i}=this.viewModel;return"polygon"===o&&"freehand"===i&&t?.includes("freehandPolygon")?"freehandPolygon":"polyline"===o&&"freehand"===i&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&(0,r.pR)(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:o}=this,i=e?.filter((e=>!!o.createTools?.[e]));return"3d"===t?.type?i?.filter((e=>"multipoint"!==e)):i}create(e,t,o){const i=o?.createOptions??t;return this._activeCustomToolOptions=o,(0,a.ignoreAbortErrors)(this.viewModel.create(e,i))}update(e,t){return(0,a.ignoreAbortErrors)(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:o}=this,i=this.customActions?.filter((e=>"selection-toolbar"===e.position));return(0,C.K)("div",null,(0,C.K)("div",{classes:{[ce.base]:!0,[ce.floating]:"floating"===e,[ce.docked]:"docked"===e,[ce.vertical]:"vertical"===t}},(0,C.K)(B,{barStyle:e,layout:t,scale:o},this._renderSelectionSetItemGroupInline(),(0,C.K)("div",{"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??_.Jl.Low},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),i?.map((e=>this._renderToolbarItem(e)))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:o,viewModel:i,visibleElements:s}=this;if(!this._calcitePopoverReferenceElement)return;const l={directionModePicker:s.directionModePicker,labelsToggle:s.labelsToggle,tooltipsToggle:s.tooltipsToggle},n="horizontal"===this.layout?"top"===this._relativeLocation?"bottom-end":"top-end":"right-end";return(0,C.K)("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:n,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:e=>this._remeasurePopoverSizes(e.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},(0,C.K)("div",{class:ce.popoverWrapper},Object.values(l).includes(!0)?(0,C.K)(ie.A,{sketchOptions:i.sketchOptions,viewType:o?.type,visibleElements:new ne.A(l)}):void 0,s.snappingControls&&o&&t?(0,C.K)(se.default,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:o,visibleElements:s.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if("separate"!==this.contextualToolLocation)return;const e=this._renderSelectionSetItemGroup();return e?.length?(0,C.K)(B,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return"separate"===this.contextualToolLocation?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return(0,C.K)("div",{"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??_.Jl.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach((o=>{"settings-before"===o.position?t.push(o):"settings-after"===o.position&&e.push(o)}));const o=[...t.map((e=>this._renderToolbarItem(e))),this._renderSettingsMenuButton(),...e.map((e=>this._renderToolbarItem(e)))].filter(s.Ru);if(o.length)return(0,C.K)("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??_.Jl.Max,slot:"actions-end"},o)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e="inline-end"===this.contextualToolLocation?"actions-end":void 0,t=this.customActions?.filter((e=>"before-selection-set"===e.position)),o=this.customActions?.filter((e=>"after-selection-set"===e.position)),i=this.groupCollapsePriorities?.get("selectionSet")??_.Jl.High;return[(0,C.K)("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:i,slot:e},this._renderFeatureCountChip()),(0,C.K)("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:i,slot:e},t?.map((e=>this._renderToolbarItem(e))),this._renderDuplicateButton(),this._renderDeleteButton(),o?.map((e=>this._renderToolbarItem(e))))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:"ready"===t})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap((e=>this._renderBuiltInCreateToolItem(e)))??[],t=this.customToolOptions?.flatMap((e=>this._renderCustomToolItem(e)))??[];return(0,C.K)("div",{"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??_.Jl.High},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:de[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:o,id:i,updateGraphics:{length:s}}=this,l=(0,re.V)(t.selectedCount,{count:s}),n="s"===o?99:999,r=s>n?(0,re.V)(t.selectedCountTruncated,{truncated:n}):s,a="s"===o&&"vertical"===e,c=a?`${i}-selection-chip-small`:`${i}-selection-chip`;return[a?(0,C.K)("span",{classes:{[ce.chipVertical]:!0,[ce.chipVerticalSmall]:"s"===this.scale},id:c,tabIndex:0,title:l},r):(0,C.K)("calcite-chip",{appearance:"outline",class:"horizontal"===e?ce.chipHorizontal:ce.chipVertical,id:c,kind:"brand",label:l,scale:"l"===o?"m":"s",tabIndex:0,title:"vertical"===e?l:void 0},"vertical"===e?r:l)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem(e){let{id:t,text:o,icon:i,disabled:s,onclick:l,active:n,flipRTL:r,afterCreate:a,afterUpdate:c,afterRemoved:d}=e;const p=`${this.id}-${t}`;return[(0,C.K)("calcite-action",{active:n,afterCreate:a,afterRemoved:d,afterUpdate:c,bind:this,"data-testid":t,disabled:s||"disabled"===this.state,icon:i,iconFlipRtl:r??!1,id:p,key:t,onclick:l,scale:this.scale,text:o,title:o})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,o=this?.view?.container?.getBoundingClientRect(),i=t?.style;if(!(t&&o&&i&&this.view?.container?.contains(t)))return;const s=this._calcitePopoverReferenceElement;if(!s)return;const{bottom:l,top:n}=s.getBoundingClientRect();if("horizontal"===this.layout){const e=l<o.height/2;e!==("top"===this._relativeLocation)&&(this._relativeLocation=e?"top":"bottom"),e?(i?.setProperty("--sketch-view-height-offset",l-o.top+"px"),i?.setProperty("--sketch-view-margin-offset","30px")):(i?.setProperty("--sketch-view-height-offset",o.bottom-n+"px"),i?.setProperty("--sketch-view-margin-offset","15px"))}else"vertical"===this.layout&&(i.setProperty("--sketch-view-height-offset","15px"),i.setProperty("--sketch-view-margin-offset","15px"));const r=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;i.setProperty("--sketch-popover-header-offset",`${r}px`)}catch(t){n.A.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",t)}}_activateCreateTool(e,t,o){const i=this._activeCustomToolOptions;if(o||i){if(o?.toolKey===i?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,o)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;"transform"!==t&&"reshape"!==t||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:o}=e;if(!e.aborted&&o.length){const e=t.tool,i=o.length>1&&"reshape"===e?"transform":e;this.update(o,{...t,tool:i})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};(0,i._)([(0,d.MZ)()],pe.prototype,"_activeCustomToolOptions",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"activeTool",null),(0,i._)([(0,d.MZ)({readOnly:!0})],pe.prototype,"activeTooltip",null),(0,i._)([(0,d.MZ)({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter((e=>t.has(e)))}})],pe.prototype,"availableCreateTools",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],pe.prototype,"createGraphic",null),(0,i._)([(0,d.MZ)()],pe.prototype,"creationMode",null),(0,i._)([(0,d.MZ)()],pe.prototype,"customToolOptions",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"customActions",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"defaultCreateOptions",null),(0,i._)([(0,d.MZ)()],pe.prototype,"defaultUpdateOptions",null),(0,i._)([(0,d.MZ)()],pe.prototype,"icon",null),(0,i._)([(0,d.MZ)()],pe.prototype,"label",null),(0,i._)([(0,d.MZ)()],pe.prototype,"labelOptions",null),(0,i._)([(0,d.MZ)()],pe.prototype,"layer",null),(0,i._)([(0,d.MZ)({type:["horizontal","vertical"],value:"horizontal"})],pe.prototype,"layout",null),(0,i._)([(0,d.MZ)({value:"m"})],pe.prototype,"scale",null),(0,i._)([(0,d.MZ)()],pe.prototype,"toolbarKind",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"contextualToolLocation",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"groupCollapsePriorities",void 0),(0,i._)([(0,d.MZ)(),(0,S.G)("esri/widgets/Sketch/t9n/Sketch")],pe.prototype,"messages",void 0),(0,i._)([(0,d.MZ)(),(0,S.G)("esri/t9n/common")],pe.prototype,"messagesCommon",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"snappingOptions",null),(0,i._)([(0,d.MZ)()],pe.prototype,"state",null),(0,i._)([(0,d.MZ)()],pe.prototype,"tooltipOptions",null),(0,i._)([(0,d.MZ)({readOnly:!0})],pe.prototype,"updateGraphics",null),(0,i._)([(0,d.MZ)({type:h.default,nonNullable:!0})],pe.prototype,"valueOptions",null),(0,i._)([(0,d.MZ)()],pe.prototype,"view",null),(0,i._)([(0,d.MZ)({type:v.default}),(0,le.U)(["create","update","undo","redo"])],pe.prototype,"viewModel",null),(0,i._)([(0,d.MZ)({type:g.AP,nonNullable:!0})],pe.prototype,"visibleElements",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"_effectiveAvailableCreateTools",null),(0,i._)([(0,d.MZ)()],pe.prototype,"_defaultViewModel",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"_calcitePopoverReferenceElement",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"_relativeLocation",void 0),(0,i._)([(0,d.MZ)()],pe.prototype,"_popoverOpen",void 0),pe=(0,i._)([(0,p.$)("esri.widgets.Sketch")],pe);const he=pe}}]);