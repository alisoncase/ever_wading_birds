"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[50258],{50258:(t,e,i)=>{i.r(e),i.d(e,{default:()=>T});var n=i(93800),l=i(89129),s=i(58448),r=i(50925),o=i(49959),a=i(79953),u=i(87431),m=i(48602),d=i(80556),h=(i(21265),i(14746),i(75269)),p=i(32474),c=i(61695),f=i(99982),_=i(15926);function w(t){return null!=t&&void 0!==t.count}function g(t){return null!=t&&void 0!==t.interval}function v(t){return null!=t&&void 0!==t.dates}let x=class extends s.A.EventedAccessor{constructor(t){super(t),this._animationController=null,this._isViewTimeExtentInitialized=!1,this._timerId=null,this.actions=new l.default,this.fullTimeExtent=null,this.loop=!1,this.mode="time-window",this.stops={count:10},this.timeExtent=null,this.view=null}initialize(){this.addHandles([(0,a.watch)((()=>this.effectiveStops),(()=>{null==this.timeExtent&&(this.timeExtent=this._getDefaultTimeExtent())}),a.initial),(0,a.watch)((()=>this.view),((t,e)=>{this._unregisterWidget(e),this._registerWidget(t)}),a.syncAndInitial),(0,a.watch)((()=>this.timeExtent),(t=>{if(null==this.view)return;const e=this.view.timeExtent;(null!=t&&!t.isAllTime||null!=e&&!e.isAllTime)&&(null!=t&&null!=e&&t.equals(e)||(this.view.timeExtent=t))}),a.initial),(0,a.watch)((()=>this.view?.timeExtent),(t=>{this._isViewTimeExtentInitialized?(null!=t&&!t.isAllTime||null!=this.timeExtent&&!this.timeExtent.isAllTime)&&(null!=t&&null!=this.timeExtent&&t.equals(this.timeExtent)||(this.timeExtent=t)):this._isViewTimeExtentInitialized=!0}))])}destroy(){null!=this._timerId&&(clearInterval(this._timerId),this._timerId=null),this._unregisterWidget(this.view),this.view=null,null!=this._animationController&&(this._animationController.abort(),this._animationController=null)}get effectiveStops(){const{fullTimeExtent:t,stops:e}=this;if(v(e)){const{dates:i}=e;if(null==i||0===i.length)return null;const n=i.sort(((t,e)=>t.getTime()-e.getTime()));if(null==t)return n;const{start:l,end:s}=t;return null==l||null==s?n:n.filter((t=>!(t.getTime()<l.getTime()||t.getTime()>s.getTime())))}if(w(e)){const i=e.timeExtent??t;return this._divideTimeExtentByCount(i,e.count)}if(g(e)){const i=e.timeExtent??t;return this._divideTimeExtentByInterval(i,e.interval)}return[]}set playRate(t){t<=0||t>36e5||("playing"===this.state&&this._startAnimation(),this._set("playRate",t))}get state(){return null==this.fullTimeExtent?"disabled":null!=this._animationController?"playing":"ready"}get timeExtentValues(){const{mode:t,timeExtent:e}=this;if(null==e||e.isAllTime||e.isEmpty)return null;const{start:i,end:n}=e;switch(t){case"cumulative-from-end":case"instant":return null!=i?[i.getTime()]:null;case"cumulative-from-start":return null!=n?[n.getTime()]:null;case"time-window":return null!=i&&null!=n?[i.getTime(),n.getTime()]:null}}next(){this._step({forward:!0,allowRestart:!1})}play(){this._startAnimation()}previous(){this._step({forward:!1,allowRestart:!1})}stop(){this._stopAnimation()}triggerAction(t){this.emit("trigger-action",{action:t})}updateWebDocument(t){const e=new _.default({currentTimeExtent:this.timeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:w(this.stops)?this.stops.count:null,numThumbs:"time-window"===this.mode?2:1,stopDelay:this.playRate,stopInterval:g(this.stops)?this.stops.interval:null,stops:v(this.stops)?this.stops.dates:null});t.widgets?t.widgets.timeSlider=e:t.widgets=new f.A({timeSlider:e})}valuesToTimeExtent(t){if(null==t)return null;const e=t.sort(((t,e)=>t-e)).map((t=>new Date(t))),i=e.length>0?e[0]:null,n=e.length>1?e[1]:null;switch(this.mode){case"time-window":return new p.default({start:i,end:n});case"instant":return new p.default({start:i,end:i});case"cumulative-from-start":return new p.default({start:null,end:i});case"cumulative-from-end":return new p.default({start:i,end:null});default:return p.default.allTime}}async _animate(){try{const t=this.view,e=this._animationController?.signal;await Promise.all([(0,o.after)(this.playRate,null,e),null!=t&&(0,a.whenOnce)((()=>!1===t.updating),e)])}catch(t){return(0,o.isAbortError)(t)||r.A.getLogger(this).error(t),void(this._animationController=null)}this._step({forward:!0,allowRestart:!1}),null!=this._animationController&&this._animate()}_divideTimeExtentByCount(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!t||!e)return[];const{start:i,end:n}=t;if(null==i||null==n)return[];if(e>1e4)return this._divideTimeExtentByCount(t);const l=[],s=i.getTime(),r=n.getTime()-s;for(let o=0;o<=e;o++)l.push(new Date(s+o/e*r));return l}_divideTimeExtentByInterval(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;if(!t||!e)return[];const{start:n,end:l}=t;if(null==n||null==l)return[];const s=l.getTime()-n.getTime(),r=e.toMilliseconds();if(r<=0||s/r>i)return this._divideTimeExtentByCount(t);const o=[],{value:a,unit:m}=e;let d=n;for(;d.getTime()<=l.getTime();)o.push(new Date(d.getTime())),d=(0,u.S1)(d,a,m);return o}_getDefaultTimeExtent(){const{effectiveStops:t,mode:e}=this;if(null==t||!e)return null;switch(e){case"time-window":return t.length>1?new p.default({start:t[0],end:t[1]}):null;case"cumulative-from-start":return t.length>0?new p.default({start:null,end:t[0]}):null;case"cumulative-from-end":return t.length>0?new p.default({start:t[0],end:null}):null;case"instant":return t.length>0?new p.default({start:t[0],end:t[0]}):null;default:return null}}_registerWidget(t){null!=t&&(t.persistableViewModels.includes(this)||t.persistableViewModels.add(this))}_startAnimation(){this._stopAnimation(),this._animationController=new AbortController,this._step({forward:!0,allowRestart:!0}),this._animate()}_step(t){const{forward:e,allowRestart:i}=t,{effectiveStops:n}=this;if(null==this.timeExtentValues||null==n)return;const l=n.map((t=>t.getTime())),s=this.timeExtentValues.map((t=>{const e=l.indexOf(t);if(-1!==e)return e;const i=l.reduce(((e,i)=>Math.abs(i-t)<Math.abs(e-t)?i:e));return l.indexOf(i)})),r=s.map((t=>t+(e?1:-1))),o=r.some((t=>t<0||t>l.length-1)),{loop:a,state:u}=this;if(o)if(a||i){const t=Math.min(...s),i=Math.max(...s),n=(e?s.map((e=>e-t)):s.map((t=>t+(l.length-1-i)))).map((t=>l[t]));this.timeExtent=this.valuesToTimeExtent(n)}else"playing"===u&&this.stop();else{const t=r.map((t=>l[t]));this.timeExtent=this.valuesToTimeExtent(t)}}_stopAnimation(){null!=this._animationController&&(this._animationController.abort(),this._animationController=null)}_unregisterWidget(t){null!=t&&t.persistableViewModels.remove(this)}};(0,n._)([(0,m.MZ)()],x.prototype,"_animationController",void 0),(0,n._)([(0,m.MZ)({type:l.default})],x.prototype,"actions",void 0),(0,n._)([(0,m.MZ)({readOnly:!0})],x.prototype,"effectiveStops",null),(0,n._)([(0,m.MZ)({type:p.default})],x.prototype,"fullTimeExtent",void 0),(0,n._)([(0,m.MZ)({nonNullable:!0})],x.prototype,"loop",void 0),(0,n._)([(0,m.MZ)({nonNullable:!0})],x.prototype,"mode",void 0),(0,n._)([(0,m.MZ)({nonNullable:!0,value:1e3})],x.prototype,"playRate",null),(0,n._)([(0,m.MZ)({readOnly:!0})],x.prototype,"state",null),(0,n._)([(0,m.MZ)({cast:t=>null==t?null:(g(t)&&(t.interval=(0,d.dp)(c.default,t.interval)),(g(t)||w(t))&&(t.timeExtent=(0,d.dp)(p.default,t.timeExtent)),t)})],x.prototype,"stops",void 0),(0,n._)([(0,m.MZ)({type:p.default})],x.prototype,"timeExtent",void 0),(0,n._)([(0,m.MZ)({readOnly:!0})],x.prototype,"timeExtentValues",null),(0,n._)([(0,m.MZ)()],x.prototype,"view",void 0),(0,n._)([(0,m.MZ)()],x.prototype,"next",null),(0,n._)([(0,m.MZ)()],x.prototype,"play",null),(0,n._)([(0,m.MZ)()],x.prototype,"previous",null),(0,n._)([(0,m.MZ)()],x.prototype,"stop",null),(0,n._)([(0,m.MZ)()],x.prototype,"updateWebDocument",null),x=(0,n._)([(0,h.$)("esri.widgets.TimeSlider.TimeSliderViewModel")],x);const T=x}}]);