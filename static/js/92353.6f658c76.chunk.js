"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[92353],{14406:(e,t,l)=>{l.d(t,{A:()=>p});var s=l(93800),n=l(6946),r=l(62631),i=l(89129),o=l(40736),a=l(49959),u=l(48602),d=(l(21265),l(50925),l(75269)),h=l(87321),f=l(59072);let c=class extends n.default{constructor(e){super(e),this.state="disabled",this._valueBeforeReady=null,this._domainInfo=(0,f.$m)([]),this._loadLayers=(0,h.P)(),this.layers=new i.default}initialize(){this.addHandles(this.layers.on("change",(()=>this._onLayersChange()))),this._onLayersChange()}destroy(){this._set("state","disabled")}get enabled(){return this.allowedValues.length>0&&this._get("enabled")}set enabled(e){e!==this.enabled&&this.allowedValues.length>0&&this._set("enabled",e)}get value(){return("ready"===this.state?this._get("value"):this._valueBeforeReady)??0}set value(e){if("ready"!==this.state)return void(this._valueBeforeReady=e);if(e===this.value)return;const t=(0,f.IM)(e,this);null!=t&&this._set("value",t)}get min(){return(0,f.pg)(this.allowedValues)}get max(){return(0,f.Lu)(this.allowedValues)}get allowedValues(){return this._domainInfo.allowedValues}set allowedValues(e){null==e?this._clearOverride("allowedValues"):this._override("allowedValues",e);const t=(0,f.IM)(this.value,this);null!=t&&(this.value=t)}get hasNext(){if(!this.enabled)return!0;const e=this._valueIndex;return e>=0&&e<this.allowedValues.length-1}get hasPrevious(){return!this.enabled||this._valueIndex>0}set layers(e){const t=this._get("layers");this._set("layers",(0,o.V)(e,t))}get filterExpressions(){return{solid:null,xRay:null}}get _valueIndex(){return(0,r.FQ)(this.allowedValues,this.value)}select(e){"ready"===this.state?null!=(0,f.IM)(e,this)&&(this.enabled=!0,this.value=e):this._valueBeforeReady=e}clear(){"ready"===this.state?this.enabled=!1:this._valueBeforeReady=null}next(){const{state:e,allowedValues:t,enabled:l,hasNext:s,_valueIndex:n}=this;if("ready"===e||null==this._valueBeforeReady){if(0!==t.length)return l?void(s&&(this.value=t[n+1])):(this.enabled=!0,void(this.value=t[0]))}else this._valueBeforeReady++}previous(){const{state:e,allowedValues:t,enabled:l,hasPrevious:s,_valueIndex:n}=this;if("ready"===e||null==this._valueBeforeReady){if(0!==t.length)return l?void(s&&(this.value=t[n-1])):(this.enabled=!0,void(this.value=t[t.length-1]))}else this._valueBeforeReady++}getValueLabel(e){return 0===this.layers.length?null:this._domainInfo.fieldValueMap.get(e)??null}async _onLayersChange(){if(this._set("state","loading"),this._domainInfo=(0,f.$m)([]),0!==this.layers.length)try{await this._loadLayers(this.layers),this._setup()}catch(e){(0,a.isAbortError)(e)||this._set("state","failed")}}};(0,s._)([(0,u.MZ)({value:!1,nonNullable:!0})],c.prototype,"enabled",null),(0,s._)([(0,u.MZ)({nonNullable:!0})],c.prototype,"value",null),(0,s._)([(0,u.MZ)({readOnly:!0})],c.prototype,"min",null),(0,s._)([(0,u.MZ)({readOnly:!0})],c.prototype,"max",null),(0,s._)([(0,u.MZ)()],c.prototype,"allowedValues",null),(0,s._)([(0,u.MZ)({readOnly:!0})],c.prototype,"hasNext",null),(0,s._)([(0,u.MZ)({readOnly:!0})],c.prototype,"hasPrevious",null),(0,s._)([(0,u.MZ)({type:i.default,nonNullable:!0})],c.prototype,"layers",null),(0,s._)([(0,u.MZ)({nonNullable:!0})],c.prototype,"state",void 0),(0,s._)([(0,u.MZ)()],c.prototype,"_valueBeforeReady",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],c.prototype,"_valueIndex",null),(0,s._)([(0,u.MZ)()],c.prototype,"_domainInfo",void 0),c=(0,s._)([(0,d.$)("esri.widgets.BuildingExplorer.BuildingNumericFilterViewModel")],c);const p=c},19033:(e,t,l)=>{l.d(t,{BJ:()=>o,Cb:()=>i,tV:()=>n});const s=e=>t=>{const l=e.toLowerCase();return t.sublayers.find((e=>e.modelName?.toLowerCase()===l))??null},n=s("fullmodel"),r=s("overview");function i(e){const t=n(e);null!=t&&(t.visible=!0);const l=r(e);null!=l&&(l.visible=!1)}function o(e,t){const l=function(e,t){const l=e.summaryStatistics?.fields??[],s=t.toLowerCase();return l.find((e=>e.modelName?.toLowerCase()===s))??null}(e,t);if(null==l)return null;const s=l.fieldName;if(null==s||!s)return null;const n=function(e,t){for(const l of e.allSublayers.items){const e="building-component"===l.type?l.getFieldDomain?.(t):null;if(e&&"coded-value"===e.type)return e}return null}(e,s),r=new Map;for(const i of l.mostFrequentValues??[])"number"==typeof i&&r.set(i,null!=n?n.getName(i):String(i));return{fieldName:s,fieldValueMap:r}}},20461:(e,t,l)=>{l.d(t,{A:()=>w});var s,n=l(93800),r=l(19455),i=l(82301),o=l(48602),a=(l(21265),l(50925),l(75269)),u=l(38387),d=l(97720),h=l(47332),f=l(54811);let c=s=class extends u.A{constructor(){super(...arguments),this.type="wire-frame",this.edges=null}clone(){return new s({edges:(0,i.clone)(this.edges)})}};(0,n._)([(0,h.e)({wireFrame:"wire-frame"})],c.prototype,"type",void 0),(0,n._)([(0,o.MZ)(f.J)],c.prototype,"edges",void 0),c=s=(0,n._)([(0,a.$)("esri.layers.support.BuildingFilterModeWireFrame")],c);const p=c;var y,_=l(45687);const v={nonNullable:!0,types:{key:"type",base:u.A,typeMap:{solid:d.A,"wire-frame":p,"x-ray":_.A}},json:{read:e=>{switch(e?.type){case"solid":return d.A.fromJSON(e);case"wireFrame":return p.fromJSON(e);case"x-ray":return _.A.fromJSON(e);default:return}},write:{enabled:!0,isRequired:!0}}};let g=y=class extends r.A{constructor(){super(...arguments),this.filterExpression=null,this.filterMode=new d.A,this.title=""}clone(){return new y({filterExpression:this.filterExpression,filterMode:(0,i.clone)(this.filterMode),title:this.title})}};(0,n._)([(0,o.MZ)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],g.prototype,"filterExpression",void 0),(0,n._)([(0,o.MZ)(v)],g.prototype,"filterMode",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],g.prototype,"title",void 0),g=y=(0,n._)([(0,a.$)("esri.layers.support.BuildingFilterBlock")],g);const w=g},38387:(e,t,l)=>{l.d(t,{A:()=>a});var s=l(93800),n=l(19455),r=l(48602),i=(l(21265),l(50925),l(14746),l(75269));let o=class extends n.A{};(0,s._)([(0,r.MZ)({readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],o.prototype,"type",void 0),o=(0,s._)([(0,i.$)("esri.layers.support.BuildingFilterMode")],o);const a=o},45687:(e,t,l)=>{l.d(t,{A:()=>u});var s,n=l(93800),r=l(48602),i=(l(21265),l(50925),l(14746),l(75269)),o=l(38387);let a=s=class extends o.A{constructor(){super(...arguments),this.type="x-ray"}clone(){return new s}};(0,n._)([(0,r.MZ)({type:["x-ray"],readOnly:!0,json:{write:{isRequired:!0}}})],a.prototype,"type",void 0),a=s=(0,n._)([(0,i.$)("esri.layers.support.BuildingFilterModeXRay")],a);const u=a},45732:(e,t,l)=>{l.d(t,{PE:()=>d,Z4:()=>a,gK:()=>h,r$:()=>c,wI:()=>f});var s=l(12130),n=l(20461),r=l(97720),i=l(45687);const o="__BUILDING_EXPLORER_FILTER__";function a(){return`${(0,s.lk)()}${o}`}function u(e){const t="string"==typeof e?e:e.id;return!!t&&t.includes(o)}function d(e,t){for(const l of e.items)for(const e of l.filters.items){if(!u(e))continue;const l=t(e);if(null!=l)return l}return null}function h(e,t){e.forEach((e=>{const l=e.filters.filter((e=>!u(e)));null!=t&&l.push(t),function(e,t){const l=t.length;if(null==e||e.length!==l)return!1;for(let s=0;s<l;++s){const l=t.at(s).toJSON(),n=e.at(s).toJSON();if(l.id="",n.id="",JSON.stringify(l)!==JSON.stringify(n))return!1}return!0}(e.filters,l)||(e.filters=l);const s=e.filters.find((e=>u(e)));e.activeFilterId=null!=s?s.id:null}))}function f(e){const t=p(e);return t?new n.A({filterExpression:t,filterMode:new i.A}):null}function c(e){const t=p(e);return t?new n.A({filterExpression:t,filterMode:new r.A}):null}function p(e){return e.filter((e=>!!e)).map((e=>`(${e})`)).join(" AND ")}},59072:(e,t,l)=>{function s(e){const t={fieldValueMap:new Map,allowedValues:[]};for(const l of e){const e=l.fieldValueMap,s=t.fieldValueMap;e.forEach(((e,l)=>{s.has(l)||(s.set(l,e),t.allowedValues.push(l))}))}return t.allowedValues.sort(((e,t)=>e-t)),t}function n(e){let t=null;for(const l of e)t=null!=t?Math.min(t,l):l;return t}function r(e){let t=null;for(const l of e)t=null!=t?Math.max(t,l):l;return t}function i(e,t){return t.allowedValues.length>0?function(e,t){if(0===t.length)return e;if(e===1/0)return t[t.length-1];if(e===-1/0)return t[0];let l=t[0],s=Math.abs(l-e);for(const n of t){const t=Math.abs(n-e);t<s&&(l=n,s=t)}return l}(e,t.allowedValues):null}l.d(t,{$m:()=>s,IM:()=>i,Lu:()=>r,pg:()=>n})},87321:(e,t,l)=>{l.d(t,{P:()=>n});var s=l(49959);function n(){let e=new AbortController;return async t=>{e.abort(),e=new AbortController;const l={signal:e.signal},n=t.toArray().map((e=>async function(e,t){await e.load(t),await e.loadAll(),(0,s.throwIfAborted)(t),e.summaryStatistics&&await e.summaryStatistics.load(t)}(e,l)));await Promise.all(n),(0,s.throwIfAborted)(l)}}},92353:(e,t,l)=>{l.r(t),l.d(t,{default:()=>h});var s=l(93800),n=l(48602),r=(l(21265),l(50925),l(14746),l(75269)),i=l(14406),o=l(19033),a=l(45732),u=l(59072);let d=class extends i.A{constructor(e){super(e),this._levelFieldName=null,this._parseValueFromFilter=e=>{const t=new RegExp(`${this._levelFieldName}\\s*=\\s*(\\d+)`,"gi"),l=new RegExp(`${this._levelFieldName}\\s*<\\s*(\\d+)`,"gi");for(const{filterMode:s,filterExpression:n}of e.filterBlocks?.items??[]){if(null==n)continue;let e=null;if("solid"===s.type?e=t.exec(n):"x-ray"===s.type&&(e=l.exec(n)),e)return parseInt(e[1],10)}return null}}get filterExpressions(){return this.enabled&&this._levelFieldName?{xRay:`${this._levelFieldName} < ${this.value}`,solid:`${this._levelFieldName} = ${this.value}`}:{solid:null,xRay:null}}get _firstValue(){const e=this.allowedValues;return e.length>0?e[0]:0}_setup(){const e=[];this.layers.forEach((t=>{const l=(0,o.BJ)(t,"bldglevel");null!=l&&(this._levelFieldName=l.fieldName,e.push(l))})),this._domainInfo=(0,u.$m)(e);const t=this._valueBeforeReady;this._set("state","ready"),this._valueBeforeReady=null;const l=t??(0,a.PE)(this.layers,this._parseValueFromFilter);null!=l?this.select(l):(this.enabled=!1,this.value=this._firstValue)}};(0,s._)([(0,n.MZ)({readOnly:!0})],d.prototype,"filterExpressions",null),(0,s._)([(0,n.MZ)()],d.prototype,"_levelFieldName",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],d.prototype,"_firstValue",null),d=(0,s._)([(0,r.$)("esri.widgets.BuildingExplorer.BuildingLevel")],d);const h=d},97720:(e,t,l)=>{l.d(t,{A:()=>u});var s,n=l(93800),r=l(48602),i=(l(21265),l(50925),l(14746),l(75269)),o=l(38387);let a=s=class extends o.A{constructor(){super(...arguments),this.type="solid"}clone(){return new s}};(0,n._)([(0,r.MZ)({type:["solid"],readOnly:!0,json:{write:{isRequired:!0}}})],a.prototype,"type",void 0),a=s=(0,n._)([(0,i.$)("esri.layers.support.BuildingFilterModeSolid")],a);const u=a}}]);