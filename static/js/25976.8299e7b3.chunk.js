"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[25976],{25976:(t,e,i)=>{i.r(e),i.d(e,{default:()=>N});var s=i(93800),r=(i(88677),i(6946)),o=i(89129),a=i(74719),n=i(50925),l=i(79953),d=i(48602),u=(i(21265),i(14746),i(75269)),h=i(15492),y=i(78076),c=i(78139),p=i(28417),w=i(12711),_=i(53957);const g=-2147208940,v=-2147217146,f=-2147220947;let k=class extends r.default{constructor(t){super(t),this._activeOperationDidSucceed=!1,this._initialValidationsFinished=!1,this._dirtyAreasLayer=null,this._serverVersion=null,this._updatingHandles=new h.U,this._validConstructProperties=!1,this.executionError="",this.extentToValidate="current",this.loadErrors=new o.default}initialize(){const t=async()=>{this.messages||(this.messages=await(0,_.ud)("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};t().then((()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([(0,l.watch)((()=>[this.view,this.utilityNetwork]),(async()=>{const{loadErrors:t,messages:{info:{noUtilityNetwork:e,noView:i}}}=this;this._initialValidationsFinished=!1,t.removeAll(),this._validConstructProperties=!0,this._dirtyAreasLayer=null,this._serverVersion=null,"utility"!==this.utilityNetwork?.type&&(this.loadErrors.push(e),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:missing-property",e)),this._validConstructProperties=!1),"2d"!==this.view?.type&&(this.loadErrors.push(i),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:missing-property",i)),this._validConstructProperties=!1),this._validConstructProperties&&(this.utilityNetwork.loaded||await this.utilityNetwork.load().catch((t=>{n.A.getLogger(this).error(t),this._validConstructProperties=!1})),await this._setDirtyAreasLayer()),this._validConstructProperties&&await this._validateNetworkExtension()}),l.initial),(0,l.on)((()=>this.view?.map?.layers),"change",(async()=>{const{loadErrors:t,messages:{info:{noUtilityNetwork:e}}}=this,i=t.find((t=>t===e));this._initialValidationsFinished=!1,i||(t.removeAll(),await this._validateNetworkExtension(),await this._setDirtyAreasLayer()),this._initialValidationsFinished=!0})),(0,w.oQ)(t)])}))}destroy(){this._updatingHandles.destroy()}get state(){return this.loadErrors.length||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}set utilityNetwork(t){this._get("utilityNetwork")!==t&&this._set("utilityNetwork",t)}set view(t){this._get("view")!==t&&this._set("view",t)}async validateTopology(){const{messages:{info:{cannotAcquireVersionLock:t,noDirtyAreasInExtent:e}},utilityNetwork:i,view:s}=this;if(!this.loadErrors.length){this._activeOperationDidSucceed=!1,this._set("executionError","");const r={gdbVersion:i?.gdbVersion,outSpatialReference:s.spatialReference?.clone()||null,validateArea:"current"===this.extentToValidate?s.extent.clone():i.fullExtent.clone()};this._updatingHandles.addPromise(i?.validateTopology(r).then((()=>{this._activeOperationDidSucceed=!0}),(i=>{let s="Error: "+i;if(i instanceof a.default&&i.details?.raw)switch(i.details.raw.extendedCode){case g:s=e;break;case v:case f:s=t;break;default:s=i.details.message}this._set("executionError",s)})))}}async _setDirtyAreasLayer(){const{messages:{info:{noDirtyAreasLayer:t}}}=this,e=this.view?.map.allLayers.items.filter((t=>(0,y.yZ)(t))).find((t=>t.parsedUrl?.path===this.utilityNetwork?.networkSystemLayers.dirtyAreasLayerUrl));e?(this._dirtyAreasLayer=e,await this._dirtyAreasLayer.load(),this._serverVersion=this._dirtyAreasLayer.version??0,this._validConstructProperties=!0):(this.loadErrors.includes(t)||(this.loadErrors.push(t),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:missing-layer",t))),this._validConstructProperties=!1)}async _validateNetworkExtension(){const{messages:{info:{noAdvancedEditingUserTypeExtension:t,noUtilityNetworkServiceUserTypeExtension:e}}}=this,i=await(0,y.wI)(this.utilityNetwork.layerUrl),s=new c.default({url:i});await s.load();const r=s.user?.username??"",o=Number(this._serverVersion)<=11.1?"utilityNetwork":"advediting";if(!await(0,p.RE)(s,r,o)){const i=Number(this._serverVersion)<=11.1?e:t;this.loadErrors.push(i),n.A.getLogger(this).error(new a.default("utilityNetworkValidateTopology:no-user-type-extension",i)),this._validConstructProperties=!1}this._initialValidationsFinished=!0}};(0,s._)([(0,d.MZ)()],k.prototype,"_initialValidationsFinished",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"_dirtyAreasLayer",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"_validConstructProperties",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],k.prototype,"executionError",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"extentToValidate",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"loadErrors",void 0),(0,s._)([(0,d.MZ)()],k.prototype,"messages",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],k.prototype,"state",null),(0,s._)([(0,d.MZ)()],k.prototype,"utilityNetwork",null),(0,s._)([(0,d.MZ)()],k.prototype,"view",null),k=(0,s._)([(0,u.$)("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],k);const N=k},28417:(t,e,i)=>{i.d(e,{Kw:()=>o,RE:()=>n,Sl:()=>a});var s=i(13248),r=i(23060);async function o(t,e,i){const o=s.id?.findCredential(t.restUrl);if(!o)return null;if("loaded"===t.loadStatus&&""===e&&t.user?.sourceJSON&&!1===i)return t.user.sourceJSON;const a={responseType:"json",query:{f:"json"}};if(i&&(a.query.returnUserLicenseTypeExtensions=!0),""===e){const e=await(0,r.default)(t.restUrl+"/community/self",a);if(e.data){const t=e.data;if(t?.username)return t}return null}const n=await(0,r.default)(t.restUrl+"/community/users/"+e,a);if(n.data){const t=n.data;return t.error?null:t}return null}async function a(t,e,i){const s=await o(t,e,!0);return s?.privileges?.includes(i)??!1}async function n(t,e,i){const s=await o(t,e,!0);return s?.userLicenseTypeExtensions?.includes(i)??!1}}}]);