"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[52566,53138,86853],{9137:(e,t,o)=>{o.d(t,{D:()=>a,S:()=>d});var i=o(64682),n=o(50821),s=o(17745),r=o(87118);function a(e,t){let{level:o,class:i,...a}=e;const d=l(o);return(0,r.K)(`h${d}`,{...a,"aria-level":String(d),class:(0,s.Ly)(n.D.heading,i),role:"heading"},t)}function l(e){return(0,i.qE)(Math.ceil(e),1,6)}function d(e){return l(e+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}},27977:(e,t,o)=>{o.r(t),o.d(t,{default:()=>T});var i=o(93800),n=o(50925),s=o(17741),r=o(48602),a=o(32980),l=(o(21265),o(14746),o(75269)),d=o(27811),c=o(54254),u=o(75832),p=o(49403),h=o(50821),_=o(9137),v=o(52353),g=o(79304),m=o(76697),f=o(87118),w=o(17745);const b="esri-coordinate-conversion",y={base:b,captureMode:`${b}--capture-mode`,noBasemap:`${b}--no-basemap`,popup:`${b}__popup`,clipboardPopup:`${b}__clipboard-popup`,conversionList:`${b}__conversion-list`,conversionRow:`${b}__row`,coordDisplay:`${b}__display`,expandButton:`${b}__expand-button`,expanded:`${b}__conversions-view--expanded`,expandDown:`${b}__conversions-view--expand-down`,expandUp:`${b}__conversions-view--expand-up`,conversionsView:`${b}__conversions-view`,rowSelect:`${b}__select-row`,toolDisplay:`${b}__tools`,modeToggle:`${b}__mode-toggle`,rowButton:`${b}__row-button`,coordinateInput:`${b}__input-coordinate`,inputForm:`${b}__input-form`,inputFormGroup:`${b}__input-group`,inputSelect:`${b}__input-select`,sectionHeading:`${b}__heading`,patternInput:`${b}__pattern-input`,settings:`${b}__settings`,settingsFormGroup:`${b}__settings-group`,settingsFormGroupHorizontal:`${b}__settings-group-horizontal`,previewCoordinate:`${b}__preview-coordinate`},C={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0};let M=class extends d.default{constructor(e,t){super(e,t),this._popupMessage=null,this._popupTimeoutId=void 0,this._clipboardPopupTimeoutId=void 0,this._coordinateInput=null,this._badInput=!1,this._goToEnabled=!1,this._conversionFormat=null,this._settingsFormat=null,this._previewConversion=null,this._expanded=!1,this._clipboardPopupVisible=!1,this._popupVisible=!1,this._settingsVisible=!1,this._inputVisible=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.orientation="auto",this.viewModel=new c.default,this.visibleElements={...C}}loadDependencies(){return(0,p.W)({button:()=>Promise.resolve().then(o.bind(o,20423)),checkbox:()=>o.e(70879).then(o.bind(o,70879)),input:()=>o.e(46138).then(o.bind(o,46138)),label:()=>o.e(60216).then(o.bind(o,60216)),option:()=>o.e(99163).then(o.bind(o,99163)),select:()=>o.e(34280).then(o.bind(o,34280))})}get conversions(){return this.viewModel.conversions}set conversions(e){this.viewModel.conversions=e}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(e){this.viewModel.currentLocation=e}get formats(){return this.viewModel.formats}set formats(e){this.viewModel.formats=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"coordinate-system"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}set multipleConversions(e){!1===e&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1)),this._set("multipleConversions",e)}get multipleConversions(){const e=this._get("multipleConversions");return"boolean"!=typeof e||e}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(e){this.viewModel.locationSymbol=e}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(e){this.viewModel.storageEnabled=e}get storageType(){return this.viewModel.storageType}set storageType(e){this.viewModel.storageType=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...C,...e}}reverseConvert(e,t){return this.viewModel.reverseConvert(e,t)}render(){const e=this.viewModel?.state,t="disabled"===e?(0,f.K)("div",{key:"esri-coordinate__no-basemap"},this.messages?.noBasemap):null,o=!t&&this._inputVisible?this._renderInputForm():null,i=!t&&this._settingsVisible?this._renderSettings():null,n=t||o||i?null:this._renderConversionsView(),s=this._popupVisible?this._renderPopup():null,r={[y.captureMode]:"capture"===this.mode,[h.D.disabled]:"loading"===e,[y.noBasemap]:"disabled"===e};return(0,f.K)("div",{class:this.classes(y.base,h.D.widget,r)},s,t,n,i,o)}_addConversion(e){const t=e.target,o=t.selectedOption.value,i=P(t);if(null==o||null==i)return;const n=new u.default({format:o});t.value="default",i>=0?(this.conversions.removeAt(i),this.conversions.add(n,i)):this.conversions.add(n)}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight(((e,t)=>{const o=t.format;return o?.hasDisplayProperties?o:e}),null)||this.formats.find((e=>e.hasDisplayProperties))}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=void 0),this._popupVisible=!1,this._popupMessage=null,this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=void 0),this._clipboardPopupVisible=!1,this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1,this._coordinateInput.value=""}_onCopy(e){const t=function(e){return e["data-conversion"]}(e.currentTarget)?.displayCoordinate;null!=t&&(e.clipboardData?.setData("text/plain",t),this._showClipboardPopup(),e.preventDefault())}_processUserInput(e){const t=(0,s.eJ)(e,"key"),o=this.viewModel;if("Enter"!==t&&t)this._badInput&&(this._badInput=!1);else{const e=this._conversionFormat||this.conversions.at(0).format;if(!e)return;const t=this._coordinateInput.value;this._reverseConvert(t,e).then((e=>{"capture"===this.mode?o.resume():this.mode="capture",this.currentLocation=e,o.setLocation(e),this._onConvertComplete()})).catch((e=>{n.A.getLogger(this).error(e),this._showPopup(this.messages?.invalidCoordinate),this._badInput=!0}))}}async _reverseConvert(e,t){const o=this.viewModel,i=await t.reverseConvert(e);return this._goToEnabled&&i&&o.goToLocation(i).catch((e=>{n.A.getLogger(this).warn(e),this._showPopup(this.messages?.locationOffBasemap)})),i}_setInputFormat(e){const t=e.target.selectedOption.value;null!=t&&(this._conversionFormat=t)}_setPreviewConversion(){const e=this._findSettingsFormat(),t=this.viewModel;if(e){const o=this.conversions.find((t=>t.format===e));this._previewConversion=new u.default({format:e,position:{location:this.currentLocation,coordinate:o?.position?.coordinate}}),this._previewConversion.position?.coordinate||t.previewConversion(this._previewConversion)}}_setSettingsFormat(e){const t=e.target.selectedOption.value;null!=t&&(this._settingsFormat=t,this._setPreviewConversion())}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout((()=>{this._popupTimeoutId=void 0,this._hideClipboardPopup()}),750)}_showPopup(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2500;this._popupMessage=e,this._popupVisible?clearTimeout(this._popupTimeoutId):this._popupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout((()=>{this._popupTimeoutId=void 0,this._hidePopup()}),t)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(e){e.stopPropagation();const t=e.target,o=this._findSettingsFormat();o&&(o.currentPattern=t.value)}_renderConversion(e,t){const{messages:o}=this;if(!o)return(0,f.K)("li",null);const{format:i}=e,n=i?.label??"",s=`${this.id}__list-item-${t}`,r=`${n} ${o.conversionOutputSuffix}`,a=0===t,l=a||this._expanded,d=a?this._renderFirstConversion(e):this._renderTools(t,e,s),c=a&&!e.displayCoordinate?o.noLocation:e.displayCoordinate,u=(0,f.K)("div",{"aria-label":c,class:y.coordDisplay,"data-conversion":e,role:"listitem",tabIndex:0,title:c??""},c),p=this._renderOptions(this.formats.filter((e=>e!==i)));return l?(0,f.K)("li",{"aria-label":r,class:y.conversionRow,id:s,key:e,role:"group",tabIndex:0,title:r},(0,f.K)("calcite-select",{"aria-controls":s,bind:this,class:y.rowSelect,"data-index":t,label:o.selectFormat,scale:"s",onCalciteSelectChange:this._addConversion},(0,f.K)("calcite-option",{label:n.toUpperCase(),selected:!0},n.toUpperCase()),p),u,d):null}_renderCopyButton(e){const t=this._clipboardPopupVisible&&this._renderClipboardPopup(),{messagesCommon:o}=this;return o?(0,f.K)("li",{"aria-label":o.copy,bind:this,class:this.classes(h.D.widgetButton,y.rowButton),"data-conversion":e,onclick:this._copyCoordinateOutput,oncopy:this._onCopy,onkeydown:this._copyCoordinateOutput,role:"button",tabIndex:0,title:o.copy},t,(0,f.K)("span",{"aria-hidden":"true",class:v.T.duplicate})):(0,f.K)("li",null)}_renderFirstConversion(e){const t=this.id,{messages:o,messagesCommon:i,multipleConversions:n,visibleElements:s}=this;if(!i||!o)return(0,f.K)("ul",null);const r="live"===this.mode?o.captureMode:o.liveMode,a=this._expanded?i.collapse:i.expand,l=e.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(e):null,d=n&&s.expandButton&&this._renderIconButton({iconType:this._expanded?"chevron-down":"chevron-up",clickFunction:this._toggleExpand,classes:[y.expandButton],attributes:{"aria-controls":`${t}__${y.conversionList}`,label:a}}),c=!n&&s.captureButton&&this._renderIconButton({iconType:"live"===this.mode?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[y.modeToggle],attributes:{label:r}});return(0,f.K)("ul",{class:y.toolDisplay},l,d,c)}_renderInputForm(){const e=this._conversionFormat||this.conversions.at(0).format,t=this.formats.findIndex((t=>t.name===e?.name)),o=this.id,i=`${o}__${y.coordinateInput}`,n=`${o}__${y.coordinateInput}__header`,s=this._renderOptions(this.formats,!0,t),{messages:r,messagesCommon:a,headingLevel:l}=this;if(!a||!r)return(0,f.K)("div",null);const d=this._renderIconButton({iconType:(0,w.V8)(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleInputVisibility,attributes:{label:a.back}});return(0,f.K)("div",{"aria-labelledby":n,class:y.inputForm,key:"esri-coordinate-conversion__input-form",role:"search"},(0,f.K)("div",{class:y.sectionHeading},d,(0,f.K)(_.D,{class:h.D.heading,id:n,level:l},r.inputCoordTitle)),(0,f.K)("div",{class:y.inputFormGroup},(0,f.K)("calcite-select",{"aria-controls":i,bind:this,class:y.inputSelect,label:r.selectFormat,scale:"s",onCalciteSelectChange:this._setInputFormat},s),(0,f.K)("calcite-input",{afterCreate:w.cA,"aria-labelledby":n,bind:this,class:y.coordinateInput,"data-format":e,"data-node-ref":"_coordinateInput",id:i,onkeydown:this._processUserInput,placeholder:r.inputCoordTitle,required:!0,scale:"s",spellcheck:!1,status:this._badInput?"invalid":"idle"})),(0,f.K)("div",{class:y.inputFormGroup},(0,f.K)("calcite-label",{layout:"inline",scale:"s"},(0,f.K)("calcite-checkbox",{bind:this,checked:this._goToEnabled,onCalciteCheckboxChange:this._toggleGoTo}),r.goTo),(0,f.K)("calcite-button",{appearance:"outline",bind:this,kind:"neutral",onclick:this._processUserInput,type:"button",width:"auto"},r.convert)))}_renderConversionsView(){const{messages:e}=this;if(!e)return(0,f.K)("div",null);const t=`${this.id}__${y.conversionList}`,o=this._renderPrimaryTools(),i=this._renderOptions(this.formats),n=this.conversions.map(((e,t)=>this._renderConversion(e,t))).toArray(),s=this._expanded?(0,f.K)("div",{class:y.conversionRow},(0,f.K)("calcite-select",{"aria-controls":t,bind:this,"data-index":-1,label:e.addConversion,scale:"s",onCalciteSelectChange:this._addConversion},(0,f.K)("calcite-option",{disabled:!0,selected:!0,value:"default"},e.addConversion),i),o):null,r={[y.expanded]:this._expanded,[y.expandUp]:"expand-up"===this.orientation,[y.expandDown]:"expand-down"===this.orientation};return(0,f.K)("div",{class:this.classes(y.conversionsView,r),key:"esri-coordinate-conversion__main-view"},(0,f.K)("ul",{"aria-expanded":this._expanded?"true":"false",class:y.conversionList,id:t},n),s)}_renderOptions(e,t,o){const i=this.conversions.at(0),n=i.format?.name;return e.map(((e,s)=>{const r=!(t||!i)&&(n===e.name||this.conversions.map((e=>e.format?.name)).includes(e.name));return(0,f.K)("calcite-option",{disabled:r,key:e.name??"unnamed-format",label:e.label.toUpperCase(),selected:s===o,value:e},e.label)})).toArray()}_renderPopup(){return(0,f.K)("div",{class:y.popup,role:"alert"},this._popupMessage)}_renderClipboardPopup(){const{messages:e}=this;return e?(0,f.K)("div",{class:this.classes(y.popup,y.clipboardPopup),role:"alert"},e.copySuccessMessage):(0,f.K)("div",null)}_renderPrimaryTools(){const{messages:e,visibleElements:t}=this;if(!e)return(0,f.K)("ul",null);const o="live"===this.mode?e.captureMode:e.liveMode,i=t.inputButton&&this._renderIconButton({iconType:"pencil",clickFunction:this._toggleInputVisibility,attributes:{label:e.inputCoordTitle}}),n=t.captureButton&&this._renderIconButton({iconType:"live"===this.mode?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[y.modeToggle],attributes:{label:o}}),s=t.settingsButton&&this._renderIconButton({iconType:"gear",clickFunction:this._toggleSettingsVisibility,attributes:{label:e.settingsTitle}});return(0,f.K)("ul",{class:y.toolDisplay},i,n,s)}_renderSettings(){const e=this.id,t=`${e}__${y.patternInput}`,o=`${e}__${y.patternInput}__header`,i=`${e}__${y.previewCoordinate}`,n=this.formats.filter((e=>e.hasDisplayProperties)),s=this._findSettingsFormat(),r=s?n.indexOf(s):-1,a=this._renderOptions(n,!0,r),l=s?.currentPattern,{messages:d,messagesCommon:c,headingLevel:u}=this;if(!c||!d)return(0,f.K)("div",null);const p=this._renderIconButton({iconType:(0,w.V8)(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleSettingsVisibility,attributes:{label:c.back}}),v=this._renderIconButton({iconType:"refresh",clickFunction:this._setDefaultPattern,attributes:{label:d.defaultPattern}});return(0,f.K)("div",{"aria-labelledby":o,class:y.settings,key:y.settings},(0,f.K)("div",{class:y.sectionHeading},p,(0,f.K)(_.D,{class:h.D.heading,id:o,level:u},d.settingsTitle)),(0,f.K)("div",{class:y.settingsFormGroup},(0,f.K)("label",{for:t},d.changeCoordinateDisplay),(0,f.K)("calcite-select",{bind:this,label:d.selectFormat,width:"full",onCalciteSelectChange:this._setSettingsFormat},a),(0,f.K)("div",{class:y.settingsFormGroupHorizontal},(0,f.K)("calcite-input",{"aria-controls":i,bind:this,class:y.patternInput,id:t,spellcheck:!1,type:"text",value:l,onCalciteInputInput:this._updateCurrentPattern}),v)),(0,f.K)("div",{class:y.settingsFormGroup},(0,f.K)("label",null,c.preview,(0,f.K)("div",{class:y.previewCoordinate,id:i,tabIndex:0},this._previewConversion?.displayCoordinate))))}_renderIconButton(e){const{iconType:t,clickFunction:o,classes:i,attributes:n}=e;return(0,f.K)("calcite-button",{appearance:"transparent",bind:this,class:this.classes(i),iconStart:t,kind:"neutral",onclick:o,onkeydown:o,...n})}_renderTools(e,t,o){const i=t.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(t):null,{messages:n}=this;if(!n)return(0,f.K)("ul",null);const s=this._renderIconButton({iconType:"x",clickFunction:this._removeConversion,attributes:{"aria-controls":o,label:n.removeConversion,"data-index":e}});return(0,f.K)("ul",{class:y.toolDisplay,role:"listitem"},i,(0,f.K)("li",{class:this.classes(y.rowButton)},s))}_copyCoordinateOutput(e){const t=e.target;if(!("createTextRange"in document.body)){const e=window.getSelection(),o=document.createRange();o.selectNodeContents(t),e?.removeAllRanges(),e?.addRange(o)}document.execCommand("copy")}_removeConversion(e){const t=P(e.currentTarget);null!=t&&this.conversions.removeAt(t)}_setDefaultPattern(e){e.stopPropagation();const t=this._findSettingsFormat();t&&(t.currentPattern=t.defaultPattern)}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible,this._popupVisible&&this._hidePopup(),this._inputVisible?this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode="live"===this.mode?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible,this._popupVisible&&this._hidePopup(),this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};(0,i._)([(0,r.MZ)()],M.prototype,"conversions",null),(0,i._)([(0,r.MZ)()],M.prototype,"currentLocation",null),(0,i._)([(0,r.MZ)()],M.prototype,"formats",null),(0,i._)([(0,r.MZ)()],M.prototype,"goToOverride",null),(0,i._)([(0,r.MZ)()],M.prototype,"headingLevel",void 0),(0,i._)([(0,r.MZ)()],M.prototype,"icon",null),(0,i._)([(0,r.MZ)()],M.prototype,"label",null),(0,i._)([(0,r.MZ)(),(0,m.G)("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],M.prototype,"messages",void 0),(0,i._)([(0,r.MZ)(),(0,m.G)("esri/t9n/common")],M.prototype,"messagesCommon",void 0),(0,i._)([(0,r.MZ)()],M.prototype,"mode",null),(0,i._)([(0,r.MZ)()],M.prototype,"orientation",void 0),(0,i._)([(0,r.MZ)()],M.prototype,"multipleConversions",null),(0,i._)([(0,r.MZ)()],M.prototype,"locationSymbol",null),(0,i._)([(0,r.MZ)()],M.prototype,"storageEnabled",null),(0,i._)([(0,r.MZ)()],M.prototype,"storageType",null),(0,i._)([(0,r.MZ)()],M.prototype,"view",null),(0,i._)([(0,r.MZ)({type:c.default})],M.prototype,"viewModel",void 0),(0,i._)([(0,r.MZ)()],M.prototype,"visibleElements",void 0),(0,i._)([(0,a.w)("visibleElements")],M.prototype,"castVisibleElements",null),(0,i._)([(0,g.$)()],M.prototype,"_copyCoordinateOutput",null),(0,i._)([(0,g.$)()],M.prototype,"_removeConversion",null),(0,i._)([(0,g.$)()],M.prototype,"_setDefaultPattern",null),(0,i._)([(0,g.$)()],M.prototype,"_toggleExpand",null),(0,i._)([(0,g.$)()],M.prototype,"_toggleInputVisibility",null),(0,i._)([(0,g.$)()],M.prototype,"_toggleMode",null),(0,i._)([(0,g.$)()],M.prototype,"_toggleSettingsVisibility",null),M=(0,i._)([(0,l.$)("esri.widgets.CoordinateConversion")],M);const T=M;function P(e){return e["data-index"]}},52566:(e,t,o)=>{o.r(t),o.d(t,{fromLatitude:()=>h,fromLatitudeLongitude:()=>u,fromLongitude:()=>p,fromMgrs:()=>_,fromUsng:()=>v,fromUtm:()=>g,isLoaded:()=>l,isSupported:()=>d,load:()=>c,toLatitudeLongitude:()=>m,toMgrs:()=>f,toUsng:()=>w,toUtm:()=>b});var i=o(74719),n=o(93205),s=o(75400),r=o(93321),a=o(23224);function l(){return(0,n.i)()}function d(){return(0,n.b)()}function c(){return(0,n.l)()}function u(e,t){const o=[];e=(e=(e=e.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("\u2032","'")).replaceAll("\u2033",'"');const i=y(t);return n.c.dmsToGeog(i,1,[e],o)?new s.default(o[0][0],o[0][1],t||r.default.WGS84):null}function p(e){return e&&l()?(0,a.$J)(e)??u(`0\xb0 0' 0" N | ${e}`)?.longitude??u(`0 | ${e}`)?.longitude??null:null}function h(e){return e&&l()?(0,a.$J)(e)??u(`${e} | 0\xb0 0' 0" E`)?.latitude??u(`${e} | 0`)?.latitude??null:null}function _(e,t,o){const i=[],a=C(o);if(-1===a)return console.warn(`invalid conversionMode: ${o}`),null;const l=y(t);return n.d.mgrsToGeogExtended(l,1,[e],a,i)?new s.default(i[0][0],i[0][1],t||r.default.WGS84):null}function v(e,t){const o=[];!t&&/\(.+27/.test(e)&&(t=r.default.GCS_NAD_1927);const i=y(t);return n.e.usngToGeog(i,1,[e],o)?new s.default(o[0][0],o[0][1],t||r.default.WGS84):null}function g(e,t,o){const i=[],a=M(o);if(-1===a)return console.warn(`invalid conversionMode: ${o}`),null;const l=y(t);return n.f.utmToGeog(l,1,[e],a,i)?new s.default(i[0][0],i[0][1],t||r.default.WGS84):null}function m(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=[[e.x,e.y]],s=[],r=y(e.spatialReference);let a=0;switch(t){case"dd":a=n.c.geogToDd(r,1,i,o,s);break;case"ddm":a=n.c.geogToDdm(r,1,i,o,s);break;case"dms":a=n.c.geogToDms(r,1,i,o,s);break;default:return console.warn(`invalid format: ${t}`),null}return a?s[0]:null}function f(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=[[e.x,e.y]],r=[],a=y(e.spatialReference);let l=C(t);return-1===l?(console.warn(`invalid conversionMode: ${t}`),null):(i&&(l|=n.d.PE_MGRS_ADD_SPACES),n.d.geogToMgrsExtended(a,1,s,o,!1,l,r)?r[0]:null)}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[[e.x,e.y]],s=[],r=y(e.spatialReference);return n.e.geogToUsng(r,1,i,t,!1,o,s)?s[0]:null}function b(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[[e.x,e.y]],s=[],r=y(e.spatialReference);let a=M(t);return-1===a?(console.warn(`invalid conversionMode: ${t}`),null):(o&&(a|=n.f.PE_UTM_OPTS_ADD_SPACES),n.f.geogToUtm(r,1,i,a,s)?s[0]:null)}function y(e){let t=null;if(e||(e=r.default.WGS84),e.wkid){if(t=n.P.geogcs(e.wkid),!t)throw new i.default("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt2&&!e.wkt)throw new i.default("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=n.P.fromString(n.a.PE_TYPE_GEOGCS,e.wkt2||e.wkt),!t)throw new i.default("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}function C(e){let t=-1;switch(e){case"automatic":t=n.d.PE_MGRS_STYLE_AUTO;break;case"new-180-in-zone-01":t=n.d.PE_MGRS_STYLE_NEW|n.d.PE_MGRS_180_ZONE_1_PLUS;break;case"new-180-in-zone-60":t=n.d.PE_MGRS_STYLE_NEW;break;case"old-180-in-zone-01":t=n.d.PE_MGRS_STYLE_OLD|n.d.PE_MGRS_180_ZONE_1_PLUS;break;case"old-180-in-zone-60":t=n.d.PE_MGRS_STYLE_OLD}return t}function M(e){let t=-1;switch(e){case"latitude-band-indicators":t=n.f.PE_UTM_OPTS_NONE;break;case"north-south-indicators":t=n.f.PE_UTM_OPTS_NS}return t}},54254:(e,t,o)=>{o.r(t),o.d(t,{default:()=>G});var i=o(93800),n=o(21772),s=o(79625),r=(o(88677),o(89129)),a=o(74719),l=o(58448),d=o(50925),c=o(79953),u=o(48602),p=o(32980),h=(o(21265),o(14746),o(75269)),_=o(75400),v=o(96913),g=o(9167),m=o(38602),f=o(75832),w=o(97673),b=o(62467),y=o(23202),C=o(30920),M=o(12711),T=o(53957);const P="default",S="crosshair",x=new _.default([0,0,500]),L=["mgrs","utm","usng","dd","dms","ddm"],$="esri__coordinateConversionWidgetState",I="conversions",E="formats",k="view",F="view-change";let K=class extends((0,C.A)(l.A.EventedAccessor)){constructor(e){super(e),this._conversionPromise=null,this._locationGraphic=null,this._pointerCount=0,this.conversions=new r.default,this.formats=new r.default,this.formatterAvailable=!1,this.messages=null,this.filteredFormats=new r.default,this.locationSymbol=new g.default({url:(0,n.s)("esri/images/search/search-symbol-32.png"),width:24,height:24}),this.storageEnabled=!0,this.storageType="session",this.view=null,this._saveWidgetState=this._saveWidgetState.bind(this),this._handleFormatChange=this._handleFormatChange.bind(this),this._handleConversionChange=this._handleConversionChange.bind(this),this._handleViewChange=this._handleViewChange.bind(this),this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerUp=this._onPointerUp.bind(this)}initialize(){const e=async()=>this.messages=await(0,T.ud)("esri/widgets/CoordinateConversion/t9n/CoordinateConversion");this.formats.addMany((0,y.ty)()),e().then((()=>{if(!this.destroyed&&((0,y.rA)(this.messages,this.formats),this.storageEnabled&&this._loadWidgetState(),this.formats.forEach((e=>{e.viewModel=this,this.addHandles((0,c.watch)((()=>e.currentPattern),this._saveWidgetState),e.name??"unnamed-format")})),this.addHandles(this.conversions.on("change",this._handleConversionChange),I),this.addHandles(this.formats.on("change",this._handleFormatChange),E),this.addHandles((0,M.oQ)((()=>{e().then((()=>{(0,y.rA)(this.messages,this.formats)}))}))),(0,v.load)().then((()=>{this.formatterAvailable=!0})).catch((e=>{d.A.getLogger(this).error(new a.default("coordinate-conversion:projection-load-failed","Failed to load the projection module.",{error:e})),this.formatterAvailable=!1,this._filterFormatsAndConversions()})).then((()=>this.addHandles((0,c.watch)((()=>this.view),this._handleViewChange,c.initial),F))),0===this.conversions.length)){const e=this.formats.find((e=>"xy"===e.name))||this.formats.at(0);this.conversions.add(new f.default({format:e}))}}))}destroy(){this.removeHandles(),this._cleanUpView(this.view),this.view=null}castConversions(e){return this._castToConversions(e)}set currentLocation(e){this._set("currentLocation",e),this._updateConversions()}get currentLocation(){return this._get("currentLocation")||null}set mode(e){switch(e){case"capture":this.currentLocation=null,this._startCaptureMode(),this._set("mode",e);break;case"live":this._startLiveMode(),this._set("mode",e)}}get mode(){return this._get("mode")||"live"}get state(){const{messages:e,view:t}=this,o=t?.ready;return e?o?"ready":t?"loading":"disabled":"disabled"}get storage(){const{storageType:e}=this;return"session"===e?sessionStorage:localStorage}get waitingForConversions(){return null!=this._conversionPromise}setLocation(e){if(this._locationGraphic&&this.view?.graphics.remove(this._locationGraphic),!e)return;const t=e.clone();t.hasZ&&(t.z=void 0),this._locationGraphic=new s.default({geometry:t,symbol:this.locationSymbol}),this.view?.graphics.add(this._locationGraphic)}async convert(e,t){if(!(0,w.Ny)(t))throw new a.default("coordinate-conversion:invalid-point","Invalid point cannot be converted.",{point:t});return Promise.resolve().then((()=>e.convert(t)))}async goToLocation(e){const{view:t}=this;if(!t)throw new a.default("coordinate-conversion:go-to-failed","no view");const o="3d"===t.type?t.clippingArea:null,i=t.map?.basemap?.baseLayers;if(o||(i?.length??0)>0){const t=o??i?.at(0)?.fullExtent;if(null!=t&&!t.contains(e))throw new a.default("coordinate-conversion:go-to-failed","Point outside basemap extent.",{point:e})}return this.callGoTo({target:e})}pause(){this.currentLocation=null,this.removeHandles(k),this.view&&(this.view.cursor=P,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic))}async previewConversion(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentLocation||x;return(await V(e,t)).displayCoordinate}resume(){"capture"===this.mode?this._startCaptureMode():this._startLiveMode()}reverseConvert(e,t){return t.reverseConvert(e)}async updateConversions(e,t){if("point"!==t?.type)throw this._clearConversions(this.conversions),new a.default("coordinate-conversion:invalid-input-point","Point is invalid, conversions cannot be updated.",{point:t});return this._convertMany(e,t)}_castToConversions(e){const t=new r.default;return e.forEach((e=>{let o=null;if(e instanceof f.default)o=e;else if("string"==typeof e){const t=this.formats.find((t=>t.name===e));t&&(o=new f.default({format:t}))}o&&t.add(o)})),t}_cleanUpView(e){e&&(this._locationGraphic&&e.graphics.remove(this._locationGraphic),this.removeHandles(k),e.cursor=P)}_clearConversions(e){e.forEach((e=>{e.position={location:null,coordinate:null}}))}async _convertMany(e,t){return Promise.all(e.map((e=>V(e,t))))}_handleConversionChange(e){for(const t of e.added){const{format:e}=t;e&&(e.viewModel=this,this.currentLocation&&(this._set("waitingForConversions",!0),this.convert(e,this.currentLocation).then((e=>{t.position=e,this._set("waitingForConversions",!1)}))))}this._saveWidgetState()}_handleFormatChange(e){e.added.forEach((e=>{this.addHandles((0,c.watch)((()=>e.currentPattern),this._saveWidgetState),e.name??"unnamed-format"),e.viewModel=this})),e.removed.forEach((e=>{e.viewModel=null;const t=this.conversions.filter((t=>t.format===e));this.conversions.removeMany(t),e.name&&this.removeHandles(e.name)}))}_loadWidgetState(){try{const e=JSON.parse(this.storage.getItem($));e&&this._setWidgetState(e)}catch(e){d.A.getLogger(this).error(new a.default("coordinate-conversion:invalid-session-storage-json","Could not read from storage.",{error:e}))}}_startCaptureMode(){this.removeHandles(k),this.view&&(this.view.cursor=S,this.currentLocation&&this.setLocation(this.currentLocation),this.addHandles(this.view.on("click",this._onClick),k))}_startLiveMode(){this._pointerCount=0,this.removeHandles(k),this.view&&(this.view.cursor=P,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic),this.addHandles([this.view.on("pointer-down",this._onPointerDown),this.view.on("pointer-up",this._onPointerUp),this.view.on("pointer-move",this._onPointerMove)],k))}_handleViewChange(e,t){t&&t!==e&&this._cleanUpView(t),e&&("capture"===this.mode?this._startCaptureMode():this._startLiveMode(),t&&this._filterFormatsAndConversions())}_onClick(e){if(0===e.button){const t=this.view?.toMap(e),o=t?.normalize();this.setLocation(o),this.currentLocation=o}}_onPointerDown(e){const{pointerType:t}=e;if(this._pointerCount++,("touch"===t||"pen"===t)&&1===this._pointerCount){const t=this.view?.toMap(e);this.currentLocation=t?.normalize()}}_onPointerMove(e){const{pointerType:t}=e;if("mouse"===t||1===this._pointerCount){const t=this.view?.toMap(e);this.currentLocation=t?.normalize()}}_onPointerUp(){this._pointerCount--}_setWidgetState(e){try{e.formats.forEach((t=>{const o=this.formats.find((e=>e.name===t.name));o&&e.locale===(0,M.JK)()&&t.currentPattern&&(o.currentPattern=t.currentPattern),o&&t.index>=0&&this.conversions.add(new f.default({format:o}))}))}catch(t){d.A.getLogger(this).warn(new a.default("coordinate-conversion:session-storage-read-error","Could not get widget state from stored JSON.",{error:t}))}}_saveWidgetState(){if(!this.storageEnabled)return;const e=this._toJSON();try{this.storage.setItem($,JSON.stringify({formats:e,locale:(0,M.JK)()}))}catch(t){d.A.getLogger(this).error(new a.default("coordinate-conversion:local-storage-write-error","Could not write to localStorage.",{error:t}))}}async _updateConversions(){try{await this.updateConversions(this.conversions.toArray(),this.currentLocation)}catch{}}_toJSON(){return this.formats.filter((e=>{const t=e.name;return"xy"===t||"basemap"===t||(0,w.z2)(t)})).map((e=>({name:e.name,currentPattern:e.currentPattern,defaultPattern:e.defaultPattern,index:this.conversions.findIndex((t=>t.format===e))}))).sort(((e,t)=>e.index-t.index)).toArray()}_filterFormatsAndConversions(){const{formatterAvailable:e,conversions:t,formats:o}=this;e||this.addHandles((0,c.when)((()=>this.view?.spatialReference),(e=>{const i=e.isWebMercator||e.isWGS84,n=o.filter((e=>{const{name:t}=e;return!!function(e){return L.includes(e)}(t)||"xy"===t&&!i})),s=this.filteredFormats.filter((e=>"xy"===e.name&&i&&!this.formats.includes(e))),r=t.filter((e=>n.includes(e.format)));o.removeMany(n),t.removeMany(r),this.filteredFormats.addMany(n.filter((e=>!this.filteredFormats.includes(e)))),o.addMany(s)}),{once:!0,initial:!0}),k)}};async function V(e,t){try{e.position=await(e.format?.convert(t))}catch(o){e.position=null}return e}(0,i._)([(0,u.MZ)({type:r.default.ofType(f.default)})],K.prototype,"conversions",void 0),(0,i._)([(0,p.w)("conversions")],K.prototype,"castConversions",null),(0,i._)([(0,u.MZ)({type:_.default})],K.prototype,"currentLocation",null),(0,i._)([(0,u.MZ)({type:r.default.ofType(b.default)})],K.prototype,"formats",void 0),(0,i._)([(0,u.MZ)()],K.prototype,"messages",void 0),(0,i._)([(0,u.MZ)()],K.prototype,"mode",null),(0,i._)([(0,u.MZ)()],K.prototype,"filteredFormats",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],K.prototype,"state",null),(0,i._)([(0,u.MZ)({types:m.wC})],K.prototype,"locationSymbol",void 0),(0,i._)([(0,u.MZ)({readOnly:!0,dependsOn:["storageType"]})],K.prototype,"storage",null),(0,i._)([(0,u.MZ)()],K.prototype,"storageEnabled",void 0),(0,i._)([(0,u.MZ)()],K.prototype,"storageType",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],K.prototype,"waitingForConversions",null),(0,i._)([(0,u.MZ)()],K.prototype,"view",void 0),K=(0,i._)([(0,h.$)("esri.widgets.CoordinateConversion.CoordinateConversionViewModel")],K);const G=K},75832:(e,t,o)=>{o.r(t),o.d(t,{default:()=>d});var i=o(93800),n=o(6946),s=o(48602),r=(o(21265),o(50925),o(14746),o(75269)),a=o(62467);let l=class extends n.default{constructor(e){super(e),this.format=null,this.position={coordinate:null,location:null}}get displayCoordinate(){return this.format?.getDisplayCoordinate(this.position?.coordinate)}};(0,i._)([(0,s.MZ)({readOnly:!0})],l.prototype,"displayCoordinate",null),(0,i._)([(0,s.MZ)({type:a.default})],l.prototype,"format",void 0),(0,i._)([(0,s.MZ)()],l.prototype,"position",void 0),l=(0,i._)([(0,r.$)("esri.widgets.CoordinateConversion.support.Conversion")],l);const d=l}}]);