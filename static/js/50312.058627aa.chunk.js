"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[28058,50312],{10876:(t,e,i)=>{function n(t){return t&&"getAtOrigin"in t&&"originOf"in t}i.d(e,{H:()=>n})},18693:(t,e,i)=>{i.d(e,{l:()=>y});var n=i(64682),r=i(89227),o=i(28473),s=i(60548),a=i(24646),l=i(18162),u=i(4309),c=i(1696),d=i(51064),h=i(75075),p=i(50190),v=i(72249),g=i(18287),_=i(86580),m=i(22131),f=i(99254);class y extends h.X{constructor(t){super(t),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,a.fA)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,a.fA)(1,1,1,1),this._elevationInfo=null,this.applyProperties(t)}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get size(){return this._size}set size(t){if(t!==this._size){const e=this._preferredTextureSize;this._size=t,e<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(t){(0,s.a)(t,this._color)||((0,s.c)(this._color,t),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(t){this._pixelSnappingEnabled!==t&&(this._pixelSnappingEnabled=t,this._updateMaterial())}get primitive(){return this._primitive}set primitive(t){this._primitive!==t&&(this._primitive=t,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){(0,s.a)(t,this._outlineColor)||((0,s.c)(this._outlineColor,t),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){const t=this.object;if(null==t)return;const e=t.geometries[0];if(null==e)return;const i=e.getMutableAttribute(m.r.SIZE).data,n=this._geometrySize;i[0]=n,i[1]=n,t.geometryVertexAttributeUpdated(t.geometries[0],m.r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,g.ny)(this._primitive),distanceFieldBoundingBox:g.PY,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/g.CN}createExternalResources(){this._texture=(0,g.sZ)(this._primitive,this._preferredTextureSize),this._material=new f.R(this._materialParameters,this.view.state.viewingMode===d.RT.Global);const t=this.view._stage;this._texture.load(t.renderView.renderingContext),t.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(t){const e=this._createRenderGeometry();null!=e&&t.addGeometry(e)}forEachExternalMaterial(t){this._material&&t(this._material)}get _preferredTextureSize(){return(0,n.qE)(2*this._geometrySize,16,128)}calculateMapBounds(t){const e=this.object?.geometries[0];if(!e)return!1;const i=e.attributes.get(m.r.POSITION).data;return(0,l.F)(i,this.view.renderCoordsHelper.spatialReference,b,this.view.spatialReference),(0,u.Hq)(t,b),!0}_createRenderGeometry(){const{geometry:t,_material:e}=this;if(null==t||null==e)return null;const{renderCoordsHelper:i,elevationProvider:n}=this.view,o=(0,p.nG)(t,n,v.F.fromElevationInfo(this.elevationInfo),i),s=(0,r.i)(c.rq.get(),t.x,t.y,o),a=c.rq.get();(0,l.F)(s,t.spatialReference,a,i.spatialReference);const u=this._geometrySize;return(0,_.DJ)(e,{position:a,size:[u,u],centerOffsetAndDistance:[0,0,0,1]})}}const b=(0,o.vt)()},20561:(t,e,i)=>{i.d(e,{t:()=>h});var n=i(87752),r=i(10382),o=i(89227),s=i(28473),a=i(24646),l=i(75075),u=i(72530),c=i(60984),d=i(23664);class h extends l.X{constructor(t,e){super(t),this._hasExternalMaterial=!1,this._hasExternalMaterial=null!=e,this._material=null!=e?e:new d.W({width:1,color:(0,a.fA)(1,0,1,1),stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerWidth:1,hasPolygonOffset:!1,renderOccluded:c.m$.OccludeAndTransparent,isDecoration:!!t.isDecoration,writeDepth:!0}),this.applyProperties(t)}setGeometryFromPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;const i=(0,s.vt)();this.view.renderCoordsHelper.toRenderCoords(t,i)&&this.setGeometryFromRenderSpacePoint(i,e)}setGeometryFromRenderSpacePoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.geometry=[[[t[0]-e,t[1],t[2]],[t[0]+e,t[1],t[2]]],[[t[0],t[1]-e,t[2]],[t[0],t[1]+e,t[2]]],[[t[0],t[1],t[2]-e],[t[0],t[1],t[2]+e]]]}setGeometryFromExtent(t){const e=this.view.spatialReference,i=(0,s.vt)(),n=(0,s.vt)(),r=100,a=[];(0,o.i)(i,t[0],t[1],r),this.view.renderCoordsHelper.toRenderCoords(i,e,n),a.push([n[0],n[1],n[2]]),(0,o.i)(i,t[2],t[1],r),this.view.renderCoordsHelper.toRenderCoords(i,e,n),a.push([n[0],n[1],n[2]]),(0,o.i)(i,t[2],t[3],r),this.view.renderCoordsHelper.toRenderCoords(i,e,n),a.push([n[0],n[1],n[2]]),(0,o.i)(i,t[0],t[3],r),this.view.renderCoordsHelper.toRenderCoords(i,e,n),a.push([n[0],n[1],n[2]]),(0,o.i)(i,t[0],t[1],r),this.view.renderCoordsHelper.toRenderCoords(i,e,n),a.push([n[0],n[1],n[2]]),(0,o.i)(i,t[0],t[1],r),this.view.renderCoordsHelper.toRenderCoords(i,e,n),a.push([n[0],n[1],n[2]]),this.geometry=[a]}setGeometryFromFrustum(t){const e=[];t.lines.forEach((t=>{e.push([t.origin[0],t.origin[1],t.origin[2]]),e.push([t.endpoint[0],t.endpoint[1],t.endpoint[2]])})),this.geometry=[e]}setGeometryFromBoundedPlane(t){const e=[],i=t.origin,n=t.basis1,r=t.basis2,o=.5,a=(0,s.vt)(),l=(0,s.vt)(),u=(0,s.vt)(),c=(0,s.vt)();a[0]=i[0]-n[0]*o-r[0]*o,a[1]=i[1]-n[1]*o-r[1]*o,a[2]=i[2]-n[2]*o-r[2]*o,l[0]=i[0]-n[0]*o+r[0]*o,l[1]=i[1]-n[1]*o+r[1]*o,l[2]=i[2]-n[2]*o+r[2]*o,u[0]=i[0]+n[0]*o+r[0]*o,u[1]=i[1]+n[1]*o+r[1]*o,u[2]=i[2]+n[2]*o+r[2]*o,c[0]=i[0]+n[0]*o-r[0]*o,c[1]=i[1]+n[1]*o-r[1]*o,c[2]=i[2]+n[2]*o-r[2]*o,e.push([a[0],a[1],a[2]]),e.push([l[0],l[1],l[2]]),e.push([u[0],u[1],u[2]]),e.push([c[0],c[1],c[2]]),e.push([a[0],a[1],a[2]]),this.geometry=[e]}setGeometryFromSegment(t){const e=t.endRenderSpace;this.transform=(0,n.kN)(p,e);const{points:i}=t.createRenderGeometry(e,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.uY;this.transform=(0,n.kN)(p,e),this.geometry=t.map((t=>t.createRenderGeometry(e,this.view.renderCoordsHelper).points))}getTransformedGeometry(){return null==this._geometry?null:this._geometry.map((t=>t.map((t=>(0,o.t)((0,s.vt)(),t,this.transform)))))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(t){this._material.setParameters({renderOccluded:t})}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(t){this._material.setParameters({width:t})}get color(){return this._material.parameters.color}set color(t){const e=1===t[3];this._material.setParameters({color:t,writeDepth:e})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(t){this._material.setParameters({innerWidth:t})}get innerColor(){return this._material.parameters.innerColor}set innerColor(t){this._material.setParameters({innerColor:t})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(t){null!=this._material&&this._material.setParameters({stipplePattern:t})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(t){this._material.setParameters({stippleOffColor:t})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(t){this._material.setParameters({stipplePreferContinuous:t})}get falloff(){return this._material.parameters.falloff}set falloff(t){this._material.setParameters({falloff:t})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(t){this._material.setParameters({hasPolygonOffset:t})}createExternalResources(){}destroyExternalResources(){}createGeometries(t){for(const e of(0,u.z)(this.geometry)){const i=(0,u.t)(this._material,e);t.addGeometry(i)}}forEachExternalMaterial(t){this._hasExternalMaterial||t(this._material)}}const p=(0,r.vt)()},24589:(t,e,i)=>{i.d(e,{n:()=>r});var n=i(43103);function r(t){return o[function(t){return"json"===t.type?"application/json":"blob"===t.type?t.blob.type:function(t){const e=(0,n.getPathExtension)(t);return l[e]||s}(t.url)}(t)]||a}const o={},s="text/plain",a=o[s],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const u in l)o[l[u]]=u},26905:(t,e,i)=>{i.d(e,{P:()=>l});var n=i(93800),r=i(42198),o=i(20620),s=i(48602),a=(i(21265),i(50925),i(14746),i(75269));const l=t=>{let e=class extends(o.A.EsriPromiseMixin(t)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(t){this._userInteractive=t}get updating(){return!1}get visible(){return null==this.parent||this.parent.visible&&!this.parent.suspended}set visible(t){this._overrideIfSome("visible",t)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,r.hA)((()=>this._interactiveViewModelCount--))}};return(0,n._)([(0,s.MZ)({constructOnly:!0})],e.prototype,"parent",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],e.prototype,"view",void 0),(0,n._)([(0,s.MZ)({type:Boolean})],e.prototype,"interactive",null),(0,n._)([(0,s.MZ)()],e.prototype,"_userInteractive",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],e.prototype,"updating",null),(0,n._)([(0,s.MZ)()],e.prototype,"visible",null),(0,n._)([(0,s.MZ)()],e.prototype,"_interactiveViewModelCount",void 0),e=(0,n._)([(0,a.$)("esri.views.3d.analysis.AnalysisView3D")],e),e}},28058:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});var n=i(93800),r=i(6946),o=i(48602),s=(i(21265),i(50925),i(14746),i(75269));let a=class extends r.default{constructor(t){super(t),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null,this.visible=void 0}};(0,n._)([(0,o.MZ)()],a.prototype,"target",void 0),(0,n._)([(0,o.MZ)()],a.prototype,"intersectedGraphic",void 0),(0,n._)([(0,o.MZ)()],a.prototype,"intersectedLocation",void 0),(0,n._)([(0,o.MZ)()],a.prototype,"elevationAlignedTargetLocation",void 0),(0,n._)([(0,o.MZ)({type:Boolean})],a.prototype,"visible",void 0),a=(0,n._)([(0,s.$)("esri.views.3d.analysis.LineOfSightAnalysisResult")],a);const l=a},29331:(t,e,i)=>{i.d(e,{EX:()=>C,RS:()=>R,Tp:()=>I,VG:()=>y,Wp:()=>v,Xt:()=>h,an:()=>p,bl:()=>f,dp:()=>b,mc:()=>w,pg:()=>T,rh:()=>O,sO:()=>M,y$:()=>m});var n=i(62631),r=(i(21265),i(82301)),o=i(64682),s=i(16804),a=i(96913),l=i(20444),u=i(34156),c=i(41317),d=i(30124);function h(t,e){return t.events.on("drag",function(t,e){let i=null,n=null;return r=>{if("cancel"===r.action)return void(null!=n&&(n.execute({action:"cancel"}),i=null,n=null));const o={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&null==i&&(i=new O,n=new O,e(t,i,n,r.pointerType,o)),null!=i&&i.execute(o),"end"===r.action&&null!=i&&(i=null,n=null)}}(t,e))}function p(t,e){const i=[t.x,t.y,t.z??0],n=e,r=[Math.cos(n),Math.sin(n)],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===o)return null;r[0]/=o,r[1]/=o;const s=t=>{const e=(t.x-i[0])*r[0]+(t.y-i[1])*r[1];t.x=i[0]+e*r[0],t.y=i[1]+e*r[1]};return t=>(s(t.mapStart),s(t.mapEnd),{...t,axis:r})}function v(t){let e=null;return i=>{if("start"===i.action&&(e=function(t,e){const i=t.operations;if(!i)return null;const n=i.data.geometry,r=(0,u.RS)(e);if(n.spatialReference.equals(r))return _(t,i,(()=>{}));if("mesh"!==n.type){const e=g(n,r);if(null==e)return null;const o=n.spatialReference;return _(t,d.p.fromGeometry(e,i.viewingMode),(()=>{const t=(0,a.project)(n,o);i.trySetGeometry(t)}))}if((0,l.CK)(n)){const e=g(n.origin,r);if(!e)return null;const o=n.spatialReference,s=d.p.fromGeometry(e,i.viewingMode);return _(t,i,(()=>{const t=(0,a.project)(s.data.geometry,o),e=t.x-n.origin.x,r=t.y-n.origin.y,l=(t.z??0)-(n.origin.z??0);i.move(e,r,l)}))}return null}(t,i.mapStart.spatialReference)),null==e)return null;const n=i.mapEnd.x-i.mapStart.x,r=i.mapEnd.y-i.mapStart.y,o=(i.mapEnd.z??0)-(i.mapStart.z??0);return e.move(n,r,o,i.action),{...i,translationX:n,translationY:r,translationZ:o}}}function g(t,e){return null==t?null:t.spatialReference.equals(e)?t.clone():(0,a.project)(t,e)}function _(t,e,i){let n=0,r=0,o=0;return{move:(s,a,l,u)=>{"start"===u&&(n=0,r=0,o=0);const c=s-n,d=a-r,h=l-o;e.move(c,d,h),n+=c,r+=d,o+=h,i(),"end"===u&&t.endInteraction?.()}}}function m(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,n=null;const r=null==e||t.spatialReference?.equals(e)?t=>t:t=>null!=t?(0,a.project)(t,e):t,o={exclude:[],...i};return e=>{if("start"===e.action&&(n=r(t.toMap(e.screenStart,o))),null==n)return null;const i=r(t.toMap(e.screenEnd,o));return null!=i?{...e,mapStart:n,mapEnd:i}:null}}function f(t){const e=t.map((t=>v(t))).filter(n.Ru);return t=>{const i=t.mapEnd.x-t.mapStart.x,n=t.mapEnd.y-t.mapStart.y,r=t.mapEnd.z-t.mapStart.z;return e.forEach((e=>e(t))),{...t,translationX:i,translationY:n,translationZ:r}}}function y(t,e){const i=new Map;for(const n of e)i.set(n,(0,r.clone)(t[n]));return e=>(i.forEach(((e,i)=>{t[i]=e})),e)}function b(t){const e=t.operations?.createResetState();return t=>(e?.remove(),t)}function w(t){const e=t.map((t=>b(t))).filter((t=>null!=t));return t=>(e.forEach((e=>e(t))),t)}function C(){let t=0,e=0,i=0;return n=>{"start"===n.action&&(t=n.mapStart.x,e=n.mapStart.y,i=n.mapStart.z);const r=n.mapEnd.x-t,o=n.mapEnd.y-e,s=n.mapEnd.z-i;return t=n.mapEnd.x,e=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:r,mapDeltaY:o,mapDeltaZ:s,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function M(){let t=0,e=0;return i=>{"start"===i.action&&(t=i.screenStart.x,e=i.screenStart.y);const n=i.screenEnd.x-t,r=i.screenEnd.y-e;return t=i.screenEnd.x,e=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:r}}}function I(t,e){let i=null,n=0,r=0;return a=>{if("start"===a.action&&(i=t.toScreen?.(e),null!=i&&(i.x<0||i.x>t.width||i.y<0||i.y>t.height?i=null:(n=a.screenStart.x-i.x,r=a.screenStart.y-i.y))),null==i)return null;const l=(0,o.qE)(a.screenEnd.x-n,0,t.width),u=(0,o.qE)(a.screenEnd.y-r,0,t.height),c=(0,s.tc)(l,u);return a.screenStart=i,a.screenEnd=c,a}}const E=()=>{};class O{constructor(){this.execute=E}next(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O;return null!=t&&(this.execute=i=>{const n=t(i);null!=n&&e.execute(n)}),e}}function T(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("2d"===t.type)return t=>t;let n=null;return r=>{"start"===r.action&&(n=t.toMap(r.screenStart,{exclude:i}),null!=n&&(n.z=(0,c.id)(n,t,e)));const o=t.toMap(r.screenEnd,{exclude:i});null!=o&&(o.z=(0,c.id)(o,t,e));const s=null!=n&&null!=o?{sceneStart:n,sceneEnd:o}:null;return{...r,scenePoints:s}}}function S(t,e,i){const n=e.elevationProvider.getElevation(t.x,t.y,t.z??0,t.spatialReference,"scene")??0,r=(0,u.EL)(t);return r.z=n,r.hasZ=!0,r.z=(0,c.id)(r,e,i),r}function R(t,e){if("2d"===t.type)return t=>t;let i=null;return n=>{"start"===n.action&&(i=S(n.mapStart,t,e));const r=S(n.mapEnd,t,e),o=null!=i&&null!=r?{sceneStart:i,sceneEnd:r}:null;return{...n,scenePoints:o}}}},29383:(t,e,i)=>{i.d(e,{Dh:()=>l,IB:()=>c,Vv:()=>n,fg:()=>a,jI:()=>u});i(64682);var n,r=i(32006),o=i(98080);function s(t,e){return t[0]*e[1]-t[1]*e[0]}function a(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;return(0,r.Re)(h,n,i),(0,r.Re)(v,e,o),function(t,e,i){const n=(0,r.Om)(i,e)/(0,r.m3)(i);(0,r.hs)(t,i,n)}(g,v,h),(0,r.WQ)(t,o,g)}function l(t,e,i,n){(0,r.Re)(h,e,i);const o=n/(0,r.Bw)(h);return(0,r.Ln)(t,i,h,o)}function u(t,e){const i=t.start,o=t.end,a=e.start,l=e.end,u=(0,r.Re)(h,o,i),c=(0,r.Re)(p,l,a),_=s(u,c);if(Math.abs(_)<=d)return[];const m=(0,r.Re)(v,i,a),f=s(c,m)/_,y=s(u,m)/_;if(f>=0){if(y>=0||e.type===n.LINE)return[(0,r.Ln)(g,i,u,f)]}else if(t.type===n.LINE&&(y>=0||e.type===n.LINE))return[(0,r.Ln)(g,i,u,f)];return[]}function c(t,e,i){const o=[],s=(0,r.Re)(h,t.end,t.start),a=(0,r.Re)(p,t.start,e),l=(0,r.m3)(s),u=2*(0,r.Om)(s,a),c=u*u-4*l*((0,r.m3)(a)-i*i);if(0===c){const e=-u/(2*l);(t.type===n.LINE||e>=0)&&o.push((0,r.Ln)(g,t.start,s,e))}else if(c>0){const e=Math.sqrt(c),i=(-u+e)/(2*l);(t.type===n.LINE||i>=0)&&o.push((0,r.Ln)(g,t.start,s,i));const a=(-u-e)/(2*l);(t.type===n.LINE||a>=0)&&o.push((0,r.Ln)(v,t.start,s,a))}return o}!function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"}(n||(n={}));const d=1e-6,h=(0,o.vt)(),p=(0,o.vt)(),v=(0,o.vt)(),g=(0,o.vt)()},34567:(t,e,i)=>{i.d(e,{Hd:()=>l,JY:()=>a,aS:()=>u});var n=i(58828),r=i(17741),o=i(49959),s=i(79953);function a(t,e){t.interactive=!0;const{tool:i,view:a}=t;a.activeTool=i;let l=(0,o.onAbort)(e,(()=>{a.activeTool===i&&(a.activeTool=null)}));return(0,n.UT)((async t=>{await(0,s.whenOnce)((()=>null==i||!i.active),t),l=(0,r.xt)(l)}),e)}function l(t,e){return(0,s.watch)((()=>t.interactive),(()=>function(t,e){t.interactive?function(t,e){u(t);const{view:i,analysis:n}=t,r=new e({view:i,analysis:n,analysisViewData:t});t.tool=r,i.tools.add(r)}(t,e):u(t)}(t,e)),s.syncAndInitial)}function u(t){const{view:e,tool:i}=t;null!=i&&(e.tools.remove(i),t.tool=null)}},38319:(t,e,i)=>{i.d(e,{W:()=>o});var n=i(60984),r=i(30051);class o extends n.im{intersect(t,e,i,n,o,s){return(0,r.Uy)(t,i,n,o,void 0,s)}}},46316:(t,e,i)=>{i.d(e,{N1:()=>c,uY:()=>d,wY:()=>u,xH:()=>l});var n=i(89227),r=i(28473),o=i(91102),s=i(92453),a=i(54407);function l(t,e){return u(t)===u(e)}function u(t){if(null==t)return null;const e=null!=t.layer?t.layer.id:"";let i=null;return i=null!=t.objectId?t.objectId:null!=t.layer&&"objectIdField"in t.layer&&null!=t.layer.objectIdField&&null!=t.attributes?t.attributes[t.layer.objectIdField]:t.uid,null==i?null:`o-${e}-${i}`}const c={json:{write:{writer:function(t,e){null!=t?.layer?.objectIdField&&null!=t.attributes&&(e.feature={layerId:t.layer.id,objectId:t.attributes[t.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String],isRequired:!0},"feature.objectId":{type:[Number,String],isRequired:!0}}},origins:{"web-scene":{read:function(t){if(null!=t.layerId&&null!=t.objectId)return{uid:null,layer:{id:t.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:t.objectId}}}}}}};function d(t,e,i,l){const{sceneIntersectionHelper:c}=t,{observer:d,observerFeatureId:p,targetFeatureId:_,target:m}=i;if(null==p&&null==_)return;l||(l=t=>t),(0,n.a)(g,d,m);const f=(0,n.l)(g);(0,n.b)(g,d,g,1/f);const y=(0,o.Cr)(g,m,v);e.options.store=s.oH.ALL,c.intersectToolIntersectorRay(y,e);let b=null,w=null,C=null,M=null;for(const n of e.results.all){const e=(0,a.Gy)(n,t);if(null==e||null==n.distanceInRenderSpace)continue;const i=u(e);null!=i&&(null!=p&&i===p&&(b??=l(h(n,t,f)),n.distanceInRenderSpace-1<b&&(C=n)),null!=_&&i===_&&(w??=l(h(n,t,f)),null==M&&n.distanceInRenderSpace-1<f&&f-n.distanceInRenderSpace+1<w&&(M=n)))}const{observerAdjusted:I,targetAdjusted:E}=i;C?.getIntersectionPoint(I)?i.observerSurfaceNormal=C.getTransformedNormal((0,r.vt)()):i.observerSurfaceNormal=null,M?.getIntersectionPoint(E)?i.targetSurfaceNormal=M.getTransformedNormal((0,r.vt)()):i.targetSurfaceNormal=null}function h(t,e,i){if((0,a.QS)(t)){const n=(0,a.SM)(t,e);if(null!=n)return Math.min(n*p,i)}return 1e-5*i}const p=.05,v=(0,o.vt)(),g=(0,r.vt)()},46751:(t,e,i)=>{i.d(e,{P:()=>p});var n=i(74719),r=i(99521),o=i(10876),s=i(43103),a=i(12130),l=i(54391),u=i(70605),c=i(48602),d=i(24589),h=i(85042);function p(t){const e=t?.origins??[void 0];return(i,n)=>{const r=function(t,e,i){if("resource"===t?.type)return function(t,e,i){const n=(0,l.z4)(e,i);return{type:String,read:(t,e,i)=>{const r=(0,h.r)(t,e,i);return n.type===String?r:"function"==typeof n.type?new n.type({url:r}):void 0},write:{isRequired:n.json?.write?.isRequired,writer(e,r,a,l){if(!l?.resources)return"string"==typeof e?void(r[a]=(0,h.t)(e,l)):void(r[a]=e.write({},l));const c=function(t){return null==t?null:"string"==typeof t?t:t.url}(e),p=(0,h.t)(c,{...l,verifyItemRelativeUrls:l?.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},h.M.NO),m=n.type!==String&&(!(0,o.H)(this)||l?.origin&&this.originIdOf(i)>(0,u.aB)(l.origin)),f={object:this,propertyName:i,value:e,targetUrl:p,dest:r,targetPropertyName:a,context:l,params:t};l?.portalItem&&p&&!(0,s.isAbsolute)(p)?m&&t?.contentAddressed?v(f):m?function(t){const{context:e,targetUrl:i,params:n,value:r,dest:o,targetPropertyName:a}=t;if(!e.portalItem)return;const l=e.portalItem.resourceFromPath(i),u=_(r,i,e),c=(0,d.n)(u),h=(0,s.getPathExtension)(l.path),p=n?.compress??!1;c===h?(e.resources&&g({...t,resource:l,content:u,compress:p,updates:e.resources.toUpdate}),o[a]=i):v(t)}(f):function(t){let{context:e,targetUrl:i,dest:n,targetPropertyName:r}=t;e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),n[r]=i)}(f):l?.portalItem&&(null==p||null!=(0,h.i)(p)||(0,s.isBlobProtocol)(p)||m)?v(f):r[a]=p}}}}(t,e,i);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:e}=h.b;return{read:t,write:e}}}}(t,i,n);for(const t of e){const e=(0,c.rM)(i,t,n);for(const t in r)e[t]=r[t]}}}function v(t){const{targetUrl:e,params:i,value:o,context:l,dest:u,targetPropertyName:c}=t;if(!l.portalItem)return;const p=(0,h.p)(e),v=_(o,e,l);if(i?.contentAddressed&&"json"!==v.type)return void l.messages?.push(new n.default("persistable:contentAddressingUnsupported",`Property "${c}" is trying to serializing a resource with content of type ${v.type} with content addressing. Content addressing is only supported for json resources.`,{content:v}));const m=i?.contentAddressed&&"json"===v.type?(0,r.d)(v.jsonString):p?.filename??(0,a.lk)(),f=(0,s.join)(i?.prefix??p?.prefix,m),y=`${f}.${(0,d.n)(v)}`;if(i?.contentAddressed&&l.resources&&"json"===v.type){const t=l.resources.toKeep.find((t=>{let{resource:e}=t;return e.path===y}))??l.resources.toAdd.find((t=>{let{resource:e}=t;return e.path===y}));if(t)return void(u[c]=t.resource.itemRelativeUrl)}const b=l.portalItem.resourceFromPath(y);(0,s.isBlobProtocol)(e)&&l.resources&&l.resources.pendingOperations.push((0,s.blobUrlToBlob)(e).then((t=>{b.path=`${f}.${(0,d.n)({type:"blob",blob:t})}`,u[c]=b.itemRelativeUrl})).catch((()=>{})));const w=i?.compress??!1;l.resources&&g({...t,resource:b,content:v,compress:w,updates:l.resources.toAdd}),u[c]=b.itemRelativeUrl}function g(t){let{object:e,propertyName:i,updates:n,resource:r,content:o,compress:s}=t;n.push({resource:r,content:o,compress:s,finish:t=>{!function(t,e,i){"string"==typeof t[e]?t[e]=i.url:t[e].url=i.url}(e,i,t)}})}function _(t,e,i){return"string"==typeof t?{type:"url",url:e}:{type:"json",jsonString:JSON.stringify(t.toJSON(i))}}},54382:(t,e,i)=>{i.d(e,{k:()=>a});var n=i(93800),r=i(79953),o=(i(50925),i(21265),i(14746),i(74719),i(75269)),s=i(88204);let a=class extends s.g{constructor(t){super(t)}initialize(){this.addHandles((0,r.watch)((()=>this.analysisViewData.visible),(t=>this.visible=t),r.syncAndInitial))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};a=(0,n._)([(0,o.$)("esri.views.interactive.AnalysisToolBase")],a)},58878:(t,e,i)=>{i.r(e),i.d(e,{default:()=>jt});var n=i(93800),r=i(6946),o=i(89129),s=i(58448),a=(i(21265),i(17741)),l=i(48602),u=i(50925),c=(i(14746),i(75269)),d=i(28473),h=i(26905),p=i(46316),v=i(58828),g=i(90834),_=i(42198),m=i(49959),f=i(79953),y=i(89227),b=i(15492),w=i(75400),C=i(96913),M=i(69681),I=i(90772),E=i(91102),O=i(41317),T=i(28058);let S=class extends r.default{constructor(t){super(t),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:(0,d.vt)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,d.vt)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,d.vt)(),targetAdjusted:(0,d.vt)()},this.computationResult={start:(0,d.vt)(),end:(0,d.vt)(),intersection:(0,d.vt)(),isValid:!1,isTargetVisible:!1},this.result=null}notifyResultChanged(){this.notifyChange("computationResult")}notifyInputPointsChanged(){this.notifyChange("inputPoints")}};(0,n._)([(0,l.MZ)()],S.prototype,"target",void 0),(0,n._)([(0,l.MZ)()],S.prototype,"elevationAlignedTargetLocation",void 0),(0,n._)([(0,l.MZ)()],S.prototype,"inputPoints",void 0),(0,n._)([(0,l.MZ)()],S.prototype,"computationResult",void 0),(0,n._)([(0,l.MZ)()],S.prototype,"result",void 0),S=(0,n._)([(0,c.$)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],S);var R,P=i(16804),A=i(1696),x=i(21899),L=i(62631),V=i(82301);let H=R=class extends r.default{constructor(t){super(t)}clone(){return new R({type:this.type,id:(0,V.clone)(this.id),mapPoint:(0,V.clone)(this.mapPoint),renderPoint:(0,d.o8)(this.renderPoint),normal:(0,V.clone)(this.normal),ray:(0,V.clone)(this.ray),graphic:this.graphic})}equals(t){return this.type===t.type&&this.id===t.id&&(0,a.CM)(this.mapPoint,t.mapPoint)&&(0,y.I)(this.renderPoint,t.renderPoint)&&(0,L.aI)(this.normal,t.normal)&&(0,E.aI)(this.ray,t.ray)&&this.graphic===t.graphic}};(0,n._)([(0,l.MZ)()],H.prototype,"type",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],H.prototype,"id",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],H.prototype,"mapPoint",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],H.prototype,"renderPoint",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],H.prototype,"normal",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],H.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],H.prototype,"ray",void 0),H=R=(0,n._)([(0,c.$)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],H);var D=i(9452),Z=i(54232),z=i(8609),F=i(92453),G=i(54407);let j=class extends r.default{constructor(t){super(t),this._terrainIntersectionOptionsLayerUids=new Set(["terrain"])}initialize(){this.intersector=(0,z.hz)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=F.oH.MIN}getScreenPointIntersection(t){const e=(0,P.WA)(t,A.oG.get()),i=(0,D.Z4)(this.view.state.camera,e,W);return this._getRayIntersection(i)}_getRayIntersection(t,e){const{view:i,intersector:n}=this;if(null==t||null==i.sceneIntersectionHelper)return null;n.options.store=F.oH.MIN,i.sceneIntersectionHelper.intersectToolIntersectorRay(t,n,e);const r=n.results.min;if(null==r.target)return null;const o=(0,d.vt)();if(!r.getIntersectionPoint(o))return null;if(null!=e?.maxDistance&&!r.withinDistance(e.maxDistance))return null;const s=i.renderCoordsHelper.fromRenderCoords(o,new w.default({spatialReference:i.spatialReference})),a=(0,d.o8)(r.normal);if((0,Z.DC)(r))return new H({type:F.dz.TERRAIN,id:r.target.lij.slice(),mapPoint:s,renderPoint:o,normal:a,ray:(0,E.C)(t),graphic:null});const l=(0,G.Gy)(r,i);if(null==l)return null;const{layer:u,sourceLayer:c}=l,h="scene"===c?.type?(0,x.RW)(l,c.objectIdField):l.uid;return new H({type:F.dz.OBJECT,id:`${u?.uid}/${h}`,mapPoint:s,renderPoint:o,normal:a,ray:(0,E.C)(t),graphic:l})}updateFromGroundIntersection(t,e,i){const n=k,r=N,o=U,s=B;(0,y.c)(r,t),this.view.renderCoordsHelper.worldUpAtPosition(r,o),(0,y.n)(o,o);const a=this.view.basemapTerrain.visibleElevationBounds,l=(e>=0?1:-1)*((a?Math.abs(a.max-a.min):100)+Math.abs(e));(0,y.h)(s,o,l),(0,y.g)(n,r,s),(0,E.Cr)(n,r,W);const u=this._getRayIntersection(W,{include:this._terrainIntersectionOptionsLayerUids,maxDistance:l});if(null!=u){const t=B;return(0,y.h)(t,o,e),(0,y.g)(i,u.renderPoint,t),(0,d.o8)(u.normal)}return(0,y.c)(i,t),null}};(0,n._)([(0,l.MZ)()],j.prototype,"view",void 0),(0,n._)([(0,l.MZ)()],j.prototype,"intersector",void 0),j=(0,n._)([(0,c.$)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],j);const k=(0,d.vt)(),N=(0,d.vt)(),U=(0,d.vt)(),B=(0,d.vt)(),W=(0,E.vt)();var $=i(66983),q=i(19565);let J=class extends(s.A.EventedMixin(r.default)){constructor(t){super(t),this.updateOnCameraChange=!0,this._observerGroundOffsetRenderSpace=0,this._effectiveObserverElevationMode="absolute-height",this._observerFeatureId=null,this._updatingHandles=new b.U,this._frameTask=q.nu,this._computationHandles=new g.default,this._externalObserverUpdate=!0}initialize(){const t=this.view.resourceController?.scheduler;this._frameTask=t?t.registerTask(q.W6.LINE_OF_SIGHT_TOOL):q.nu,this._intersector=new j({view:this.view}),this.addHandles([this._connectObserver(),this._connectComputations(),this._connectTargets()])}destroy(){this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(t){this._frameTask.priority=t}get _computations(){return this.analysisViewData.computations}get _elevationAlignedObserverPositionRenderSpace(){return this.analysisViewData.observerEngineLocation}set _elevationAlignedObserverPositionRenderSpace(t){this.analysisViewData.observerEngineLocation=t}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}_computeResult(t){const e=t.computation,{inputPoints:i,computationResult:n}=e,{observerAdjusted:r,targetAdjusted:o}=i,{start:s,end:a}=n;(0,y.c)(s,r),(0,y.c)(a,o),this._canCompute(e)?this._computeIntersection(t):function(t){let{computation:e,interpolationInfo:i}=t;const{computationResult:n,inputPoints:r}=e,{start:o,end:s,intersection:a}=n,{originalIntersection:l,originalObserver:u,originalTarget:c}=i;if((0,y.c)(a,l),r.isValid){const t=K,e=(0,y.G)(u,l)/(0,y.G)(u,c);(0,y.a)(t,o,u),(0,y.h)(t,t,1-e),(0,y.g)(a,a,t),(0,y.a)(t,s,c),(0,y.h)(t,t,e),(0,y.g)(a,a,t),n.isValid=!0}else e.result=null,n.isValid=!1,n.isTargetVisible=!1}(t),e.notifyResultChanged(),this.emit("result-changed",{target:t.computation.target,result:e.result})}_adjustStartEndPositions(t){const{view:e}=this,{inputPoints:i}=t,{observer:n,target:r,observerAdjusted:o,targetAdjusted:s}=i;(0,y.c)(o,n),(0,y.c)(s,r),(0,p.uY)(e,this._intersector.intersector,i);const{observerSurfaceNormal:a,targetSurfaceNormal:l}=i,u=this._screenPixelSize,c=K;null!=a?(0,y.c)(c,a):(0,y.d)(c,s,o);const d=u;(0,y.n)(c,c),(0,y.h)(c,c,Math.min(d,1)),(0,y.g)(o,o,c),null!=l?(0,y.c)(c,l):(0,y.d)(c,o,s);const h=e.state.camera.computeScreenPixelSizeAt(s);(0,y.n)(c,c),(0,y.h)(c,c,Math.min(h,1)),(0,y.g)(s,s,c)}_computeIntersection(t){let{computation:e,interpolationInfo:i}=t;const{view:n}=this,{sceneIntersectionHelper:r,renderCoordsHelper:o}=n;if(null==r)return;const s=this._intersector.intersector,{computationResult:a,inputPoints:l}=e,{observer:u,target:c}=l,{start:d,end:h}=a,p=(0,E.Cr)(d,h,Q);s.options.store=F.oH.MIN,r.intersectToolIntersectorRay(p,s);const v=s.results.min,g=a.intersection,_=K;let m=!0;if(null!=v&&v.getIntersectionPoint(g)){(0,y.c)(i.originalIntersection,g),(0,y.c)(i.originalObserver,d),(0,y.c)(i.originalTarget,h),o.fromRenderCoords(g,_,n.spatialReference);const t=1-(0,y.G)(h,c)/(0,y.G)(d,c);m=(0,y.G)(u,g)>=t*(0,y.G)(u,c)}const f=new w.default(_,n.spatialReference);{const{result:t,target:i}=e;null!=t?(t.target=i,t.intersectedGraphic=m?null:(0,G.Gy)(v,n),t.intersectedLocation=m?null:f,t.visible=m):e.result=new T.default({target:i,elevationAlignedTargetLocation:e.elevationAlignedTargetLocation,intersectedGraphic:m?null:(0,G.Gy)(v,n),intersectedLocation:m?null:f,visible:m})}a.isValid=l.isValid=!0,a.isTargetVisible=m}_canCompute(t){const e=this.analysisViewData.elevationAlignedObserver,i=this.view.frustum;if(null==e||null==t.elevationAlignedTargetLocation||null==i)return!1;const{observerAdjusted:n,targetAdjusted:r}=t.inputPoints,o=i.intersectsPoint(n),s=i.intersectsPoint(r);return o&&s}_onObserverPositionChange(t,e,i,n,r){if(this._externalObserverUpdate=r,null==t)return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(null==e)return(0,$.V)(this.analysis,t.spatialReference,u.A.getLogger(this)),void(this.analysisViewData.elevationAlignedObserver=null);const o=Y(e,i),{absoluteZ:s,elevation:a}=(0,O.Q5)(e.x,e.y,e.z,this.view.spatialReference,this.view,o),l=e.clone();l.z=s,this._effectiveObserverElevationMode=o.mode,this.analysisViewData.elevationAlignedObserver=l;const c=(0,d.vt)();this.view.renderCoordsHelper.toRenderCoords(l,c),this._elevationAlignedObserverPositionRenderSpace=c,this._observerGroundOffsetRenderSpace=s-a,this._observerFeatureId=(0,p.wY)(n),this.priority=q.W6.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onObserverRenderSpacePositionChangeForComputation(t,e,i,n,r){const{inputPoints:o}=t;switch((0,y.c)(o.observer,e),o.observerFeatureId=r,o.observerSurfaceNormal=null,n){case"on-the-ground":case"relative-to-ground":{const t=this._intersector.updateFromGroundIntersection(o.observer,i,o.observer);null==o.observerFeatureId&&(o.observerSurfaceNormal=t)}}this._adjustStartEndPositions(t),t.notifyInputPointsChanged(),this.priority=q.W6.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetPositionChange(t,e,i,n,r){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=t.inputPoints;if(o&&(s.isValid=!1),null==i)return null!=e&&(0,$.V)(this.analysis,e.spatialReference,u.A.getLogger(this)),t.elevationAlignedTargetLocation=null,void t.notifyInputPointsChanged();const a=Y(i,n),{absoluteZ:l,elevation:c}=(0,O.Q5)(i.x,i.y,i.z,this.view.spatialReference,this.view,a),d=i.clone();switch(d.z=l,t.elevationAlignedTargetLocation=d,this.view.renderCoordsHelper.toRenderCoords(t.elevationAlignedTargetLocation,s.target),s.targetFeatureId=(0,p.wY)(r),s.targetSurfaceNormal=null,a.mode){case"on-the-ground":case"relative-to-ground":{const t=this._intersector.updateFromGroundIntersection(s.target,l-c,s.target);null==s.targetFeatureId&&(s.targetSurfaceNormal=t)}}this._adjustStartEndPositions(t),t.notifyInputPointsChanged(),this.priority=q.W6.LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectComputationToTarget(t){return(0,_.vE)([this._updatingHandles.add((()=>({computation:t,targetPosition:t.target.position,targetElevationInfo:t.target.elevationInfo,targetFeatureInfo:t.target.feature,projectedTargetPosition:(0,C.projectOrLoad)(t.target.position,this.view.spatialReference)})),(t=>{let{computation:e,targetPosition:i,targetElevationInfo:n,targetFeatureInfo:r,projectedTargetPosition:o}=t;null==o.pending?this._onTargetPositionChange(e,i,o.geometry,n,r):this._updatingHandles.addPromise(o.pending)}),f.initial)])}_connectComputationToObserver(t){return this._updatingHandles.add((()=>({computation:t,observer:this.analysisViewData.elevationAlignedObserver})),(t=>{let{computation:e}=t;this._externalObserverUpdate&&(e.inputPoints.isValid=!1,e.notifyInputPointsChanged())}),f.initial)}_connectComputationToRenderSpaceObserver(t){return this._updatingHandles.add((()=>({computation:t,observer:this._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:this._observerGroundOffsetRenderSpace,observerElevationMode:this._effectiveObserverElevationMode,observerFeatureId:this._observerFeatureId})),(t=>{let{computation:e,observer:i,observerGroundOffset:n,observerElevationMode:r,observerFeatureId:o}=t;this._onObserverRenderSpacePositionChangeForComputation(e,i,n,r,o)}),f.initial)}_connectComputationToCamera(t){return this._updatingHandles.add((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(e=>{let{isDirty:i}=e;!this.updateOnCameraChange||t.inputPoints.isValid&&!i||t.notifyInputPointsChanged()}))}_connectComputationToSlicePlane(t){return this._updatingHandles.add((()=>this.view.slicePlane),(()=>{t.inputPoints.isValid=!1,t.notifyInputPointsChanged()}))}_connectComputationToElevation(t){const e=(i,n)=>{const r=this.analysis.observer,o=t.target;let s=null,a=null,l=null,u=null,c=null,d=null;if(null!=r?.position){const t=(0,C.projectOrLoad)(r.position,this.view.spatialReference);if(null!=t.pending)return this._updatingHandles.addPromise(t.pending),void t.pending.finally((()=>e(i,n)));s=t.geometry,a=r.elevationInfo,l=r.feature}if(null!=o.position){const t=(0,C.projectOrLoad)(o.position,this.view.spatialReference);if(null!=t.pending)return this._updatingHandles.addPromise(t.pending),void t.pending.finally((()=>e(i,n)));u=t.geometry,c=o.elevationInfo,d=o.feature}null==s&&null==u||((0,M.S)(i,n,tt,this.view.spatialReference),null!=s&&(0,I.vR)(tt,s)&&this._onObserverPositionChange(null!=r?r.position:null,s,a,l,!1),null!=u&&(0,I.vR)(tt,u)&&this._onTargetPositionChange(t,o.position,u,c,d,!1),null!=s&&null!=u&&(0,I.Mx)(tt,s,u)&&t.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(t=>{let{extent:i,spatialReference:n}=t;return e(i,n)}))}_connectComputationToTask(t){let e=null;const i={computation:t,interpolationInfo:{originalIntersection:(0,d.vt)(),originalObserver:(0,d.vt)(),originalTarget:(0,d.vt)()}};return(0,_.vE)([this._updatingHandles.add((()=>t.inputPoints),(()=>{e=(0,a.DC)(e),e=(0,v.UT)((async t=>{await(0,m.ignoreAbortErrors)(this._frameTask.schedule((()=>this._computeResult(i)),t))}))}),{initial:!0,equals:()=>!1}),(0,_.hA)((()=>e=(0,a.DC)(e)))])}_connectComputation(t){const e=this._computationHandles;e.has(t)||e.add([this._connectComputationToTarget(t),this._connectComputationToObserver(t),this._connectComputationToRenderSpaceObserver(t),this._connectComputationToCamera(t),this._connectComputationToSlicePlane(t),this._connectComputationToElevation(t),this._connectComputationToTask(t)],t)}_disconnectComputation(t){this._computationHandles.remove(t)}_onComputationCollectionChange(t){let{added:e,removed:i}=t;for(const n of i)this._disconnectComputation(n);for(const n of e)this._connectComputation(n)}_onTargetCollectionChange(t){let{added:e,removed:i}=t;for(const n of i)this._removeTarget(n);for(const n of e)this._addTarget(n)}_onCursorTargetChange(t,e){null!=e&&this._removeTarget(e),null!=t&&this._addTarget(t)}_addTarget(t){this._computations.some((e=>e.target===t))||this._computations.add(new S({target:t}))}_removeTarget(t){const e=this._computations.findIndex((e=>e.target===t));this._computations.removeAt(e)}_connectObserver(){return(0,_.vE)([this._updatingHandles.add((()=>({observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,projectedObserverPosition:(0,C.projectOrLoad)(null!=this.analysis.observer?this.analysis.observer.position:null,this.view.spatialReference),observerElevationInfo:null!=this.analysis.observer?this.analysis.observer.elevationInfo:null,observerFeatureInfo:null!=this.analysis.observer?this.analysis.observer.feature:null})),(t=>{let{observerPosition:e,projectedObserverPosition:i,observerElevationInfo:n,observerFeatureInfo:r}=t;null==i.pending?this._onObserverPositionChange(e,i.geometry,n,r,!0):this._updatingHandles.addPromise(i.pending)}),f.initial)])}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this._computations),(t=>this._onComputationCollectionChange(t)),{initial:!0,final:!0})}_connectTargets(){return(0,_.vE)([this._updatingHandles.addOnCollectionChange((()=>this.analysis.targets),(t=>this._onTargetCollectionChange(t)),{initial:!0,final:!0}),this._updatingHandles.add((()=>this.analysisViewData.cursorTarget),((t,e)=>{this._onCursorTargetChange(t,e)}))])}get _isCameraDirty(){const t=this.analysisViewData.elevationAlignedObserver,{view:e}=this,{renderCoordsHelper:i}=e;if(null==t||null==i)return!1;const n=K;i.toRenderCoords(t,n);const r=e.state.camera.computeScreenPixelSizeAt(n);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>X}};function Y(t,e){return t.hasZ?e??{mode:"absolute-height",offset:0}:{mode:"on-the-ground",offset:0}}(0,n._)([(0,l.MZ)({constructOnly:!0})],J.prototype,"analysis",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],J.prototype,"analysisViewData",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],J.prototype,"view",void 0),(0,n._)([(0,l.MZ)()],J.prototype,"updating",null),(0,n._)([(0,l.MZ)()],J.prototype,"priority",null),(0,n._)([(0,l.MZ)()],J.prototype,"updateOnCameraChange",void 0),(0,n._)([(0,l.MZ)()],J.prototype,"_computations",null),(0,n._)([(0,l.MZ)()],J.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,n._)([(0,l.MZ)()],J.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,n._)([(0,l.MZ)()],J.prototype,"_effectiveObserverElevationMode",void 0),(0,n._)([(0,l.MZ)()],J.prototype,"_observerFeatureId",void 0),(0,n._)([(0,l.MZ)()],J.prototype,"_screenPixelSize",null),(0,n._)([(0,l.MZ)({readOnly:!0})],J.prototype,"_updatingHandles",void 0),(0,n._)([(0,l.MZ)()],J.prototype,"_frameTask",void 0),(0,n._)([(0,l.MZ)()],J.prototype,"_isCameraDirty",null),J=(0,n._)([(0,c.$)("esri.views.3d.analysis.LineOfSight.LineOfSightController")],J);const X=.1,K=(0,d.vt)(),Q=(0,E.vt)(),tt=(0,I.Ie)();var et=i(88102),it=i(64880),nt=i(73043),rt=i(1277),ot=i(87730),st=i(2925);const at=new class{constructor(){this.glowWidth=8,this.innerWidth=.75}};const lt=new class{constructor(){this.size=.5}};function ut(t){return(0,st.f6)(t.accentColor,.75)}const ct=new class{constructor(){this.size=.5,this.visibleColor=new et.default([3,252,111,.75]),this.occludedColor=new et.default([252,3,69,.75]),this.undefinedColor=new et.default([127,127,127,.75])}};const dt=new class{constructor(){this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new et.default([3,252,111,1]),this.visibleOuterColor=new et.default([3,252,111,.15]),this.occludedInnerColor=new et.default([252,3,69,1]),this.occludedOuterColor=new et.default([252,3,69,.1]),this.undefinedInnerColor=new et.default([255,255,255,1]),this.undefinedOuterColor=new et.default([127,127,127,.2])}};var ht=i(49502),pt=i(3276),vt=i(9814),gt=i(70248),_t=i(86580),mt=i(54379);class ft extends ht.q{constructor(t,e){const i=(0,pt.UM)(ut(t.effectiveTheme)),n=(0,_t.CM)(i,lt.size,32,32),r=new vt.M(n);super({view:t,renderObjects:[r],metadata:e,elevationInfo:{mode:"absolute-height",offset:0}}),(0,gt.s)(this),this.themeHandle=(0,f.watch)((()=>({color:ut(t.effectiveTheme)})),(t=>{i.setParameters(t)}))}destroy(){this.themeHandle.remove(),super.destroy()}}class yt extends ht.q{constructor(t,e){const{size:i,visibleColor:n,occludedColor:r,undefinedColor:o}=ct;super({view:t,renderObjects:[bt(i,n,mt.SJ.Custom1),bt(i,r,mt.SJ.Custom2),bt(i,o,mt.SJ.Custom3)],metadata:e,elevationInfo:{mode:"absolute-height",offset:0}}),(0,gt.s)(this)}}function bt(t,e,i){return new vt.M((0,_t.CM)((0,pt.UM)(et.default.toUnitRGBA(e)),t,32,32),i)}var wt,Ct=i(48261),Mt=(i(66715),i(54382)),It=i(29331),Et=i(53605),Ot=i(75956);!function(t){t.Ready="ready",t.Creating="creating",t.Created="created"}(wt||(wt={}));let Tt=class extends Mt.k{constructor(t){super(t),this._creationMode=!1,this.removeIncompleteOnCancel=!1,this.analysisViewData=null,this._latestPointerMovePointerType=null,this._laserlineVisualElement=null,this._grabbedManipulator=null,this._analysisHandles=new g.default,this._updatingHandles=new b.U,this._manipulatorHandles=new g.default,this._targetTrackerManipulator=null}initialize(){this._intersector=new j({view:this.view}),this.addHandles((0,f.watch)((()=>this.state),(t=>{t===wt.Created&&this.finishToolCreation()}),f.syncAndInitial)),this._observerManipulator=this._createObserverManipulator(),this._createLaserLine(),this.addHandles([this._updatingHandles.add((()=>this.analysisViewData?.elevationAlignedObserver),(t=>this._onObserverLocationChange(t)),f.initial),this._updatingHandles.add((()=>function(t){const e=t.accentColor;return{glowColor:e,innerColor:(0,st.bJ)(e),globalAlpha:.75*e.a}}(this.view.effectiveTheme)),(t=>{let{glowColor:e,innerColor:i,globalAlpha:n}=t;return this._updateLaserLineStyle(e,i,n)}),f.initial),this._updatingHandles.add((()=>this._laserLineRendererDependencies()),(t=>this._updateLaserLineRenderer(t))),this._connectComputations(),this._updatingHandles.addWhen((()=>!this._shouldRenderTracker),(()=>this._clearCursorTracker()),f.initial),this._updatingHandles.add((()=>({active:this.active,hasGrabbedManipulators:this.hasGrabbedManipulators})),(t=>{let{active:e,hasGrabbedManipulators:i}=t;this._creationMode=!!e&&(this._creationMode||!i)}),f.initial)])}destroy(){this._updatingHandles=(0,a.pR)(this._updatingHandles),this._manipulatorHandles=(0,a.pR)(this._manipulatorHandles),this._analysisHandles=(0,a.pR)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeLaserLine(),this._intersector=null,this._set("analysis",null)}get state(){return this.active?!this.hasGrabbedManipulators||this._creationMode?wt.Creating:wt.Created:null!=this.analysis.observer?.position?wt.Created:wt.Ready}get cursor(){return this.active&&this._showTracker?"crosshair":null}get updating(){return null!=this.analysisViewData&&this.analysisViewData.updating||this._updatingHandles.updating}get _showTracker(){return this.active&&"mouse"===this._latestPointerMovePointerType}get _shouldRenderTracker(){return this._showTracker&&null!=this.analysis.observer?.position&&!this.hasGrabbedManipulators}continue(){this.view.activeTool=this}stop(){this.view.activeTool=null}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}onInputEvent(t){switch(t.type){case"immediate-double-click":this._doubleClickHandler(t);break;case"key-down":this._keyDownHandler(t);break;case"pointer-move":this._pointerMoveHandler(t)}}onInputEventAfter(t){"immediate-click"===t.type&&this._clickHandler(t)}onShow(){}onHide(){}onDeactivate(){this._clearCursorTracker()}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(t=>this._onComputationsCollectionChange(t)),{initial:!0,final:!0})}_onComputationsCollectionChange(t){let{added:e,removed:i}=t;for(const n of i)this._disconnectComputation(n);for(const n of e)this._connectComputation(n)}_connectComputation(t){if(this.destroyed)return void u.A.getLogger(this).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");const e=this._analysisHandles;if(e.has(t))return;const i=this._createTargetManipulator(t.target);null==this._targetTrackerManipulator&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),e.add([this._updatingHandles.add((()=>function(t){const{isValid:e,isTargetVisible:i}=t.computationResult;return{isValid:e,isTargetVisible:i}}(t)),(()=>function(t,e){const{isValid:i,isTargetVisible:n}=e.computationResult;t.state=i?n?mt.SJ.Custom1:mt.SJ.Custom2:mt.SJ.Custom3}(i,t)),f.initial),this._updatingHandles.add((()=>t.elevationAlignedTargetLocation),(t=>this._onTargetLocationChange(t,i)),f.initial)],t)}_disconnectComputation(t){if(this.destroyed)return void u.A.getLogger(this).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");this._analysisHandles.remove(t);const e=this._getTargetManipulator(t.target);null!=e&&(this.manipulators.remove(e),this._manipulatorHandles.remove(e),null!=this._targetTrackerManipulator&&this._targetTrackerManipulator===e&&(this._targetTrackerManipulator=null))}_clearCursorTracker(){this.analysisViewData.cursorTarget=(0,a.pR)(this.analysisViewData.cursorTarget)}_createTargetManipulator(t){const e={target:t,type:"target"},i=new yt(this.view,e);return this._manipulatorHandles.add([this._createTargetManipulatorDragPipeline(i),i.events.on("grab-changed",(t=>this._manipulatorGrabChanged(i,t))),i.events.on("immediate-click",(t=>this._manipulatorClick(i,t)))],i),this.manipulators.add(i),null!=t.position?i.elevationAlignedLocation=t.position:i.available=!1,i}_getTargetManipulator(t){let e=null;return this.manipulators.forEach((i=>{const n=i.manipulator;null==e&&"target"===n.metadata.type&&n.metadata.target===t&&(e=n)})),e}_createObserverManipulator(){const t=new ft(this.view,{type:"observer",intersection:null});return this._manipulatorHandles.add([this._createObserverManipulatorDragPipeline(t),t.events.on("grab-changed",(e=>this._manipulatorGrabChanged(t,e))),t.events.on("immediate-click",(e=>this._manipulatorClick(t,e)))],t),this.manipulators.add(t),t}_screenToIntersection(){return t=>{const e=this._intersector.getScreenPointIntersection(t.screenEnd);return null==e?null:{...t,intersection:e}}}_createTargetManipulatorDragPipeline(t){return(0,It.Xt)(t,((e,i,n)=>{i.next(this._screenToIntersection()).next(this._updateTargetDragStep(t)).next((()=>this._updateLaserLineRenderer())),n.next(function(t){const e=t.position?.clone();return i=>(t.position=e,i)}(t.metadata.target)).next((()=>this._updateLaserLineRenderer()))}))}_createObserverManipulatorDragPipeline(t){return(0,It.Xt)(t,((t,e,i)=>{e.next(this._screenToIntersection()).next(this._updateObserverDragStep()).next((()=>this._updateLaserLineRenderer())),i.next(this._cancelObserverDragStep()).next((()=>this._updateLaserLineRenderer()))}))}_updateObserverDragStep(){return t=>(null!=t.intersection.mapPoint?(null==this.analysis.observer&&(this.analysis.observer=new it.default),this._updateFromIntersection(this.analysis.observer,t.intersection)):this.analysis.observer=null,t)}_cancelObserverDragStep(){const t=null!=this.analysis.observer?.position?this.analysis.observer.clone():null;return e=>(this.analysis.observer=t,e)}_updateTargetDragStep(t){return e=>{this._updateFromIntersection(t.metadata.target,e.intersection);const i=e.intersection.mapPoint;return null!=i&&(t.elevationAlignedLocation=i),e}}_manipulatorGrabChanged(t,e){switch(e.action){case"start":this._grabbedManipulator=t;break;case"end":this._grabbedManipulator===t&&(this._grabbedManipulator=null)}}_laserLineRendererDependencies(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,visible:this.visible}}_updateLaserLineRenderer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies();const{laserlineVisualElement:e,grabbedManipulator:i,shouldRenderTracker:n,observerPosition:r,visible:o}=t;if(null==e)return;const s=null!=i?i:n&&null!=r?this._targetTrackerManipulator:null;null!=s&&o?(e.visible=!0,e.heightManifoldTarget=s.renderLocation,s!==this._observerManipulator?e.lineVerticalPlaneSegment=(0,rt.Cr)(this._observerManipulator.renderLocation,s.renderLocation,St):e.lineVerticalPlaneSegment=null):(e.visible=!1,e.heightManifoldTarget=null,e.lineVerticalPlaneSegment=null)}_createLaserLine(){this._removeLaserLine();const{glowWidth:t,innerWidth:e}=at;this._laserlineVisualElement=new Ct.o({view:this.view,attached:!0,visible:this.visible,style:{glowWidth:t,innerWidth:e},isDecoration:!0})}_removeLaserLine(){null!=this._laserlineVisualElement&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}_updateLaserLineStyle(t,e,i){const n=this._laserlineVisualElement;if(null==n)return;const r=n.style;n.style={...r,glowColor:et.default.toUnitRGB(t),innerColor:et.default.toUnitRGB(e),globalAlpha:i}}_onObserverLocationChange(t){null!=t?(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=t):this._observerManipulator.available=!1}_onTargetLocationChange(t,e){null!=t?(e.elevationAlignedLocation=t,e!==this._targetTrackerManipulator&&(e.available=!0)):e.available=!1}_addPointFromClickEvent(t){const e=this._intersector.getScreenPointIntersection(t);if(null!=e?.mapPoint)if(null!=this.analysis.observer?.position){this._clearCursorTracker();const t=new nt.default;this._updateFromIntersection(t,e),this.analysis.targets.add(t)}else{const t=new it.default;this._updateFromIntersection(t,e),this.analysis.observer=t}}_clickHandler(t){this.active&&t.button!==Ot.w.Right&&(this._addPointFromClickEvent((0,Et.ZV)(t)),t.stopPropagation())}_doubleClickHandler(t){this.active&&t.button!==Ot.w.Right&&(this.stop(),t.stopPropagation())}_keyDownHandler(t){this.active&&"Escape"===t.key&&(this.stop(),t.stopPropagation())}_pointerMoveHandler(t){if(this.hasGrabbedManipulators)return;if(this._latestPointerMovePointerType=t.pointerType,this._updateLaserLineRenderer(),!this._showTracker||null==this.analysis.observer?.position)return;const e=(0,Et.ZV)(t),i=this._intersector.getScreenPointIntersection(e);null!=i?.mapPoint&&(null==this.analysisViewData.cursorTarget&&(this.analysisViewData.cursorTarget=new nt.default),this._updateFromIntersection(this.analysisViewData.cursorTarget,i),this._updateLaserLineRenderer())}_updateFromIntersection(t,e){if(null==e.mapPoint)return t.position=null,t.elevationInfo=null,void(t.feature=null);switch(e.type){case F.dz.OBJECT:if(null!=e.graphic){const i=e.graphic,n=(0,O.bh)(i);"on-the-ground"===n.mode&&(n.mode="relative-to-ground",n.offset=0),t.elevationInfo=new ot.A(n),t.feature=i}else t.elevationInfo=null,t.feature=null;break;case F.dz.TERRAIN:t.elevationInfo=new ot.A({mode:"on-the-ground"}),t.feature=null;break;default:t.elevationInfo=null,t.feature=null}const i=e.mapPoint.clone();i.z=(0,O.wS)(this.view,i,{mode:"absolute-height",offset:0},t.elevationInfo),t.position=i}_manipulatorClick(t,e){if("observer"===t.metadata.type||t.grabbing||t.dragging||e.button!==Ot.w.Right||this.analysis.targets.length<=1)return;const{target:i}=t.metadata;this.analysis.targets.remove(i),e.stopPropagation()}get testInfo(){}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Tt.prototype,"view",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Tt.prototype,"analysis",void 0),(0,n._)([(0,l.MZ)()],Tt.prototype,"_creationMode",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Tt.prototype,"state",null),(0,n._)([(0,l.MZ)({readOnly:!0})],Tt.prototype,"cursor",null),(0,n._)([(0,l.MZ)()],Tt.prototype,"removeIncompleteOnCancel",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Tt.prototype,"updating",null),(0,n._)([(0,l.MZ)({constructOnly:!0})],Tt.prototype,"analysisViewData",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Tt.prototype,"_showTracker",null),(0,n._)([(0,l.MZ)()],Tt.prototype,"_latestPointerMovePointerType",void 0),(0,n._)([(0,l.MZ)()],Tt.prototype,"_shouldRenderTracker",null),(0,n._)([(0,l.MZ)()],Tt.prototype,"_laserlineVisualElement",void 0),(0,n._)([(0,l.MZ)()],Tt.prototype,"_grabbedManipulator",void 0),Tt=(0,n._)([(0,c.$)("esri.views.3d.analysis.LineOfSight.LineOfSightTool")],Tt);const St=(0,rt.vt)();var Rt=i(10382);class Pt{constructor(t,e,i,n){this.visibleLineVisualElement=t,this.occludedLineVisualElement=e,this.undefinedLineVisualElement=i,this.targetVisualElement=n}destroy(){this.visibleLineVisualElement.destroy(),this.occludedLineVisualElement.destroy(),this.undefinedLineVisualElement.destroy(),this.targetVisualElement.destroy()}}var At=i(20561),xt=i(18693);i(60984);let Lt=class extends r.default{constructor(t){super(t),this._lineOfSightVisualElements=new Array,this._computationHandles=new g.default,this._updatingHandles=new b.U}initialize(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}destroy(){this._updatingHandles=(0,a.pR)(this._updatingHandles),this._computationHandles=(0,a.pR)(this._computationHandles),this._observerVisualElement=(0,a.pR)(this._observerVisualElement)}get visible(){return this.analysisViewData.visible}get updating(){return this._updatingHandles.updating}get interactiveAndEditable(){return this.analysisViewData.interactive&&this.analysisViewData.editable}get test(){}_createLineOfSightVisualization(){const t=dt,e=this.view,i=this.isDecoration,n={view:e,attached:!0,width:t.outerWidth,innerWidth:t.innerWidth,isDecoration:i},r=et.default.toUnitRGBA(t.visibleOuterColor),o=et.default.toUnitRGBA(t.visibleInnerColor),s=et.default.toUnitRGBA(t.occludedOuterColor),a=et.default.toUnitRGBA(t.occludedInnerColor),l=et.default.toUnitRGBA(t.undefinedOuterColor),u=et.default.toUnitRGBA(t.undefinedInnerColor),c=new At.t({...n,color:r,innerColor:o}),d=new At.t({...n,color:s,innerColor:a}),h=new At.t({...n,color:l,innerColor:u}),p=new xt.l({view:e,attached:!0,...Vt,size:8,isDecoration:i}),v=new Pt(c,d,h,p);return this._lineOfSightVisualElements.push(v),v}_destroyLineOfSightVisualization(t){t.destroy(),this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(t),1)}_updateLineOfSightVisualization(t,e,i){const n=dt,{computationResult:r,inputPoints:o}=t,{start:s,end:a,intersection:l,isValid:u,isTargetVisible:c}=r,{observer:h}=o,p=zt;p[12]=h[0],p[13]=h[1],p[14]=h[2];const v=(0,y.d)(Ht,s,h),g=(0,y.d)(Dt,a,h),_=(0,y.d)(Zt,l,h),{visibleLineVisualElement:m,occludedLineVisualElement:f,undefinedLineVisualElement:b,targetVisualElement:w}=e,C=null==this.analysisViewData.elevationAlignedObserver||null==t.elevationAlignedTargetLocation,M=this.visible&&!C;m.visible=M,f.visible=M,b.visible=M,w.visible=M,w.attached=!i.interactiveAndEditable,M&&(m.geometry=null,f.geometry=null,b.geometry=null,w.geometry=t.elevationAlignedTargetLocation,u?c?(m.geometry=[[(0,d.ci)(v),(0,d.ci)(g)]],m.transform=p,m.color=et.default.toUnitRGBA(n.visibleOuterColor),w.color=et.default.toUnitRGBA(n.visibleInnerColor)):(m.geometry=[[(0,d.ci)(v),(0,d.ci)(_)]],m.transform=p,m.color=et.default.toUnitRGBA(n.occludedOuterColor),f.geometry=[[(0,d.ci)(_),(0,d.ci)(g)]],f.transform=p,w.color=et.default.toUnitRGBA(n.occludedInnerColor)):(b.geometry=[[(0,d.ci)(v),(0,d.ci)(g)]],b.transform=p,w.color=et.default.toUnitRGBA(n.undefinedInnerColor)))}_getLineOfSightVisualizationDependencies(t){const{computationResult:e}=t,{occludedOuterColor:i,visibleOuterColor:n}=dt;return{computationResult:e,occludedOuterColor:i,visibleOuterColor:n,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}_connectComputation(t){const e=this._computationHandles;if(e.has(t))return;const i=this._createLineOfSightVisualization();e.add([this._updatingHandles.add((()=>this._getLineOfSightVisualizationDependencies(t)),(e=>this._updateLineOfSightVisualization(t,i,e)),{initial:!0,equals:()=>!1}),(0,_.hA)((()=>this._destroyLineOfSightVisualization(i)))],t)}_disconnectComputation(t){this._computationHandles.remove(t)}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(t=>this._onComputationsCollectionChange(t)),{initial:!0,final:!0})}_onComputationsCollectionChange(t){let{added:e,removed:i}=t;for(const n of i)this._disconnectComputation(n);for(const n of e)this._connectComputation(n)}_createObserverVisualization(){const t=et.default.toUnitRGBA(dt.visibleInnerColor),e=new xt.l({view:this.view,color:t,...Vt,isDecoration:this.isDecoration});this._observerVisualElement=e,this.addHandles(this._updatingHandles.add((()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible})),(t=>{let{observer:i,interactiveAndEditable:n,visible:r}=t;null!=i&&!n&&r?(e.geometry=i,this._observerVisualElement.attached=!0):e.attached=!1}),f.initial))}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Lt.prototype,"analysis",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Lt.prototype,"analysisViewData",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Lt.prototype,"view",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Lt.prototype,"visible",null),(0,n._)([(0,l.MZ)({constructOnly:!0})],Lt.prototype,"isDecoration",void 0),(0,n._)([(0,l.MZ)()],Lt.prototype,"updating",null),(0,n._)([(0,l.MZ)()],Lt.prototype,"interactiveAndEditable",null),(0,n._)([(0,l.MZ)()],Lt.prototype,"test",null),Lt=(0,n._)([(0,c.$)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],Lt);const Vt={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},Ht=(0,d.vt)(),Dt=(0,d.vt)(),Zt=(0,d.vt)(),zt=(0,Rt.vt)();var Ft=i(34567);let Gt=class extends((0,h.P)(s.A.EventedMixin(r.default))){constructor(t){super(t),this.type="line-of-sight-view-3d",this.analysis=null,this.tool=null,this.computations=new o.default,this.elevationAlignedObserver=null,this.observerEngineLocation=(0,d.vt)(),this.cursorTarget=null,this.editable=!0}initialize(){const t=this.view,e=this.analysis;this._analysisController=new J({analysis:e,analysisViewData:this,view:t}),this._analysisVisualization=new Lt({analysis:e,analysisViewData:this,view:t,isDecoration:!this.parent}),this.addHandles([this._analysisController.on("result-changed",(t=>{t.target!==this.cursorTarget&&this.emit("result-changed",t)})),(0,Ft.Hd)(this,Tt)])}destroy(){(0,Ft.aS)(this),this._analysisController=(0,a.pR)(this._analysisController),this._analysisVisualization=(0,a.pR)(this._analysisVisualization)}get results(){return this.computations.map((t=>t.result))}get priority(){return this._analysisController.priority}set priority(t){this._analysisController.priority=t}get updating(){return null!=this._analysisController&&this._analysisController.updating||null!=this._analysisVisualization&&this._analysisVisualization.updating}getResultForTarget(t){return this.computations.find((e=>e.target===t))?.result}get testInfo(){}};(0,n._)([(0,l.MZ)({readOnly:!0})],Gt.prototype,"type",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Gt.prototype,"analysis",void 0),(0,n._)([(0,l.MZ)()],Gt.prototype,"tool",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Gt.prototype,"results",null),(0,n._)([(0,l.MZ)()],Gt.prototype,"priority",null),(0,n._)([(0,l.MZ)()],Gt.prototype,"computations",void 0),(0,n._)([(0,l.MZ)()],Gt.prototype,"elevationAlignedObserver",void 0),(0,n._)([(0,l.MZ)()],Gt.prototype,"observerEngineLocation",void 0),(0,n._)([(0,l.MZ)()],Gt.prototype,"cursorTarget",void 0),(0,n._)([(0,l.MZ)()],Gt.prototype,"updating",null),(0,n._)([(0,l.MZ)()],Gt.prototype,"editable",void 0),(0,n._)([(0,l.MZ)()],Gt.prototype,"_analysisController",void 0),(0,n._)([(0,l.MZ)()],Gt.prototype,"_analysisVisualization",void 0),Gt=(0,n._)([(0,c.$)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Gt);const jt=Gt},64880:(t,e,i)=>{i.r(e),i.d(e,{default:()=>g});var n=i(93800),r=i(46316),o=i(6946),s=i(85715),a=i(19455),l=i(17741),u=i(48602),c=(i(21265),i(50925),i(14746),i(75269)),d=i(46751),h=i(75400),p=i(87730);let v=class extends(a.A.JSONSupportMixin(s.A.ClonableMixin(o.default))){constructor(t){super(t),this.position=null,this.elevationInfo=null,this.feature=null}equals(t){return(0,l.CM)(this.position,t.position)&&(0,l.CM)(this.elevationInfo,t.elevationInfo)&&(0,r.xH)(this.feature,t.feature)}};(0,n._)([(0,u.MZ)({type:h.default,json:{write:{isRequired:!0}}})],v.prototype,"position",void 0),(0,n._)([(0,u.MZ)({type:p.A}),(0,d.P)()],v.prototype,"elevationInfo",void 0),(0,n._)([(0,u.MZ)(r.N1)],v.prototype,"feature",void 0),v=(0,n._)([(0,c.$)("esri.analysis.LineOfSightAnalysisObserver")],v);const g=v},66983:(t,e,i)=>{i.d(e,{B:()=>o,V:()=>s});var n=i(96913),r=i(96504);function o(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=(0,n.tryProjectWithZConversion)(t,e);return null==s?null:(s.hasZ&&!o||null==i||(s.z=(0,r.R1)(i,s)??0),s)}function s(t,e,i){i.warnOnce(`Failed to project analysis geometry (id: '${t.id}'), projection from spatial reference (wkid: '${e.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},70248:(t,e,i)=>{i.d(e,{Q:()=>o,s:()=>s});var n=i(42198),r=i(41317);function o(t,e){return function(t,e){return!!t&&"on-the-ground"!==e.mode&&!(0,r.v9)(e)}(t?.data.coordinateHelper.hasZ(),e)}function s(t,e){let i=null;const r=t.events.on("grab-changed",(n=>{null!=i&&(i.remove(),i=null),"start"===n.action?(i=t.disableDisplay(),e&&e(n)):e&&e(n)}));return(0,n.hA)((()=>{i?.remove(),r.remove()}))}},72530:(t,e,i)=>{i.d(e,{t:()=>_,z:()=>y});var n=i(32006),r=i(98080),o=i(24646),s=i(30142),a=i(68693),l=i(66028),u=i(46576),c=i(55239),d=i(51064),h=i(65069),p=i(69291),v=i(25735),g=i(22131);function _(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=[],_=e.mapPositions;!function(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:n}=t,r=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(i)&&n,o=i.length/3-(r?1:0),s=new Array(2*(o-1)),a=r?i.slice(0,-3):i;let l=0;for(let u=0;u<o-1;u++)s[l++]=u,s[l++]=u+1;e.push([g.r.POSITION,new h.n(a,s,3,r)])}(e,r);const y=r[0][1].data,b=r[0][1].indices.length,w=(0,c.EH)(b);return function(t,e,i){if(null!=t.attributeData.colorFeature)return;const n=t.attributeData.color;e.push([g.r.COLOR,new h.n(n??o.Un,i,4)])}(e,r,w),function(t,e,i){null==t.attributeData.sizeFeature&&e.push([g.r.SIZE,new h.n([t.attributeData.size??1],i,1,!0)])}(e,r,w),function(t,e,i){t.attributeData.normal&&e.push([g.r.NORMAL,new h.n(t.attributeData.normal,i,3)])}(e,r,w),function(t,e,i){null!=t.attributeData.colorFeature&&e.push([g.r.COLORFEATUREATTRIBUTE,new h.n([t.attributeData.colorFeature],i,1,!0)])}(e,r,w),function(t,e,i){null!=t.attributeData.sizeFeature&&e.push([g.r.SIZEFEATUREATTRIBUTE,new h.n([t.attributeData.sizeFeature],i,1,!0)])}(e,r,w),function(t,e,i){null!=t.attributeData.opacityFeature&&e.push([g.r.OPACITYFEATUREATTRIBUTE,new h.n([t.attributeData.opacityFeature],i,1,!0)])}(e,r,w),function(t,e,i){if(null==t.overlayInfo||t.overlayInfo.renderCoordsHelper.viewingMode!==d.RT.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=(0,l.jh)(i.length),o=(0,s.tO)(t.overlayInfo.spatialReference);for(let n=0;n<r.length;n+=3)(0,a.RC)(i,n,r,n,o);const c=i.length/3,p=(0,u.oe)(c+1);let v=m,_=f,y=0,b=0;(0,n.hZ)(v,r[b++],r[b++]),b++,p[0]=0;for(let s=1;s<c+1;++s)s===c&&(b=0),(0,n.hZ)(_,r[b++],r[b++]),b++,y+=(0,n.xg)(v,_),p[s]=y,[v,_]=[_,v];e.push([g.r.DISTANCETOSTART,new h.n(p,e[0][1].indices,1,!0)])}(e,r,y),new v.V(t,r,_,p.X.Line,i)}const m=(0,r.vt)(),f=(0,r.vt)();function y(t,e){if(null==t||0===t.length)return[];const i=[];return t.forEach((t=>{const n=t.length,r=(0,l.jh)(3*n);t.forEach(((t,e)=>{r[3*e]=t[0],r[3*e+1]=t[1],r[3*e+2]=t[2]}));const o={attributeData:{position:r,normal:e},removeDuplicateStartEnd:!1};i.push(o)})),i}},73043:(t,e,i)=>{i.r(e),i.d(e,{default:()=>v});var n=i(93800),r=i(46316),o=i(85715),s=i(19455),a=i(17741),l=i(48602),u=(i(21265),i(50925),i(14746),i(75269)),c=i(46751),d=i(75400),h=i(87730);let p=class extends(s.A.JSONSupportMixin(o.A)){constructor(t){super(t),this.position=null,this.elevationInfo=null,this.feature=null}equals(t){return(0,a.CM)(this.position,t.position)&&(0,a.CM)(this.elevationInfo,t.elevationInfo)&&(0,r.xH)(this.feature,t.feature)}};(0,n._)([(0,l.MZ)({type:d.default,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),(0,c.P)()],p.prototype,"position",void 0),(0,n._)([(0,l.MZ)({type:h.A}),(0,c.P)()],p.prototype,"elevationInfo",void 0),(0,n._)([(0,l.MZ)(r.N1)],p.prototype,"feature",void 0),p=(0,n._)([(0,u.$)("esri.analysis.LineOfSightAnalysisTarget")],p);const v=p},77783:(t,e,i)=>{i.d(e,{t:()=>o});var n,r=i(89129);!function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"}(n||(n={}));class o{constructor(){this._isToolEditable=!0,this._manipulators=new r.default,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.WhenToolEditable;this.addMany([t],e)}addMany(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.WhenToolEditable;for(const i of t){const t={manipulator:i,visibilityPredicate:e,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const t=this._manipulators.splice(e,1)[0];this._detachManipulator(t);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((t=>{let{manipulator:e}=t;return e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,(t=>{e(t)}))}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((e=>t.push(e.manipulator))),t}intersect(t,e){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach((r=>{let{manipulator:o,attached:s}=r;if(!s||!o.interactive)return;const a=o.intersectionDistance(t,e);null!=a&&a<n&&(n=a,i=o)})),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===n.Always||(this._isToolEditable?t.visibilityPredicate===n.WhenToolEditable:t.visibilityPredicate===n.WhenToolNotEditable)}}},88204:(t,e,i)=>{i.d(e,{g:()=>c});var n=i(93800),r=i(6946),o=(i(21265),i(50925),i(49959)),s=i(48602),a=(i(14746),i(75269)),l=i(54379),u=i(77783);let c=class extends r.default{constructor(t){super(t),this.manipulators=new u.t,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[l.PK.MANAGER,!0],[l.PK.USER,!0]]),this._creationFinishedResolver=(0,o.createResolver)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(l.PK.USER)}set editable(t){this.setEditableFlag(l.PK.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===l.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}endDrag(){const t=this.view.inputManager.latestPointerLocation;if(!t)return;let e=!1;this.manipulators.forEach((i=>{let{manipulator:n}=i;n.dragging&&(e=!0,n.events.emit("drag",{action:"end",start:t,screenPoint:t}))})),e&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(l.PK.USER)&&this.getEditableFlag(l.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,n._)([(0,s.MZ)({constructOnly:!0})],c.prototype,"view",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"active",null),(0,n._)([(0,s.MZ)({value:!0})],c.prototype,"visible",null),(0,n._)([(0,s.MZ)({value:!0})],c.prototype,"editable",null),(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"manipulators",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"updating",null),(0,n._)([(0,s.MZ)()],c.prototype,"cursor",null),(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"automaticManipulatorSelection",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"hasFocusedManipulators",null),(0,n._)([(0,s.MZ)()],c.prototype,"hasGrabbedManipulators",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"hasHoveredManipulators",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"firstGrabbedManipulator",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"created",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"removeIncompleteOnCancel",void 0),c=(0,n._)([(0,a.$)("esri.views.interactive.InteractiveToolBase")],c)}}]);