"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[8501,10689,30882,53263,75644],{10689:(e,t,i)=>{i.r(t),i.d(t,{default:()=>$});var s=i(93800),o=i(62631),r=i(89129),a=i(42198),n=i(49959),l=i(79953),c=i(56612),d=i(48602),h=(i(21265),i(50925),i(75269)),u=i(78139),p=i(75644),m=i(56702),v=i(83031),_=i(29287),g=i(27811),w=i(58448),b=(i(14746),i(88204));let y=class extends(w.A.EventedMixin(b.g)){constructor(e){super(e)}get cursor(){return"crosshair"}onInputEvent(e){"click"===e.type&&this._handleClick(e)}_handleClick(e){this.emit("click",e)}};(0,s._)([(0,d.MZ)({readOnly:!0})],y.prototype,"cursor",null),(0,s._)([(0,d.MZ)({constructOnly:!0})],y.prototype,"stop",void 0),y=(0,s._)([(0,h.$)("esri.widgets.Directions.DirectionsSearchTool")],y);var f=i(76614),M=i(6946);let S=class extends M.default{constructor(){super(...arguments),this.layerDetails=!0,this.saveAsButton=!0,this.saveButton=!0}};(0,s._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],S.prototype,"layerDetails",void 0),(0,s._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],S.prototype,"saveAsButton",void 0),(0,s._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],S.prototype,"saveButton",void 0),S=(0,s._)([(0,h.$)("esri.widgets.Directions.DirectionsVisibleElements")],S);const K=S;var I=i(69985),k=i(62333),E=i(49403),F=i(50821),T=(i(17745),i(76697)),A=i(87118);const C="esri-directions",D={base:C,accordion:`${C}__accordion`,actionContainer:`${C}__action-container`,addStopButton:`${C}__add-stop-button`,departureTime:`${C}__departure-time`,departureTimeOptions:`${C}__departure-time-options`,directionsHeader:`${C}__directions-header`,directionsHeaderStopName:`${C}__directions-header-stop-name`,editFooter:`${C}__edit-footer`,editToolbar:`${C}__edit-toolbar`,editToolbarContainer:`${C}__edit-toolbar-container`,flexColumn:`${C}__flex-column`,flexRow:`${C}__flex-row`,headerStops:`${C}__header-stops`,labelEmphasize:`${C}__label-emphasize`,labelNoBottomMargin:`${C}__label-no-bottom-margin`,marginInlineMedium:`${C}__margin-inline-medium`,optimizeSection:`${C}__optimize-section`,optimizeSwitches:`${C}__optimize-switches`,paddingMedium:`${C}__padding-medium`,primaryFlowItem:`${C}__primary-flow-item`,primaryFooter:`${C}__primary-footer`,primaryFooterCentered:`${C}__primary-footer-centered`,primaryFooterLoader:`${C}__primary-footer-loader`,routeItem:`${C}__route-item`,routeItemButton:`${C}__route-item-button`,routeItemButtonContent:`${C}__route-item-button-content`,routeItemLabel:`${C}__route-item-label`,routeItemDescription:`${C}__route-item-description`,saveError:`${C}__save-error`,saveErrorIcon:`${C}__save-error-icon`,saveErrorLabel:`${C}__save-error-label`,saveProcessLoader:`${C}__save-process-loader`,selectedFeatureContainer:`${C}__selected-feature-container`,separator:`${C}__separator`,solveRoute:`${C}__solve-route`,stopContainer:`${C}__stop-container`,stopList:`${C}__stop-list`,stopItem:`${C}__stop-item`};let x=class extends g.default{constructor(e,t){super(e,t),this._activeManeuver=null,this._placeholderStops=new r.default([new m.default,new m.default]),this._portalFolderCombobox=null,this._portalFolders=null,this._portalItemNameInput=null,this._portalUserName=null,this._sections=null,this._stopsToSearches=new Map,this._currentFlowItem="primary",this._parentFlowItem="primary",this._saveState="initialized",this._searchTool=null,this.headingLevel=2,this.messages=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new f.default,this.visibleElements=new K,this._solveRouteDebounced=(0,n.debounce)((()=>this._solveRoute()))}initialize(){this.addHandles([(0,l.watch)((()=>this.viewModel.layer),(()=>{try{this.viewModel.load()}catch{}}),l.initial),(0,l.watch)((()=>this.viewModel.layer?.routeInfo),(()=>{this._sections=this._getStopSections()}),l.initial),(0,l.watch)((()=>this.viewModel.layer?.stops.toArray()),(e=>{e&&this.view?.activeTool&&this._searchTool&&this.view.activeTool===this._searchTool&&!e.includes(this._searchTool.stop)&&(this.view.tools.remove(this._searchTool),this._searchTool=null)}))])}loadDependencies(){return(0,E.W)({accordion:()=>i.e(80012).then(i.bind(i,80012)),"accordion-item":()=>i.e(54530).then(i.bind(i,54530)),action:()=>i.e(88342).then(i.bind(i,88342)),"block-section":()=>i.e(6283).then(i.bind(i,6283)),button:()=>Promise.resolve().then(i.bind(i,20423)),combobox:()=>Promise.all([i.e(60382),i.e(89939),i.e(90609)]).then(i.bind(i,90609)),"combobox-item":()=>i.e(32045).then(i.bind(i,32045)),dropdown:()=>i.e(41631).then(i.bind(i,41631)),flow:()=>i.e(58739).then(i.bind(i,58739)),"flow-item":()=>Promise.all([i.e(86290),i.e(74597),i.e(99776),i.e(85326)]).then(i.bind(i,85326)),icon:()=>Promise.resolve().then(i.bind(i,92439)),input:()=>i.e(46138).then(i.bind(i,46138)),"input-date-picker":()=>Promise.all([i.e(86290),i.e(42015),i.e(57020)]).then(i.bind(i,57020)),"input-time-picker":()=>Promise.all([i.e(86290),i.e(74597),i.e(42015),i.e(40435)]).then(i.bind(i,40435)),label:()=>i.e(60216).then(i.bind(i,60216)),list:()=>Promise.all([i.e(46138),i.e(89939),i.e(18170)]).then(i.bind(i,18170)),"list-item":()=>Promise.all([i.e(73373),i.e(14960)]).then(i.bind(i,28898)),loader:()=>Promise.resolve().then(i.bind(i,23173)),notice:()=>i.e(51132).then(i.bind(i,51132)),panel:()=>Promise.all([i.e(86290),i.e(74597),i.e(99776)]).then(i.bind(i,99776)),switch:()=>i.e(92812).then(i.bind(i,92812))})}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"right"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const i=this._stopsToSearches.get(e);return i.view=t,this._overrideDefaultSources(i),i}const i=new _.default({icon:!1,popupEnabled:!1,resultGraphicEnabled:!1,view:t,...this.searchProperties});return this._normalizeSearchSources(i),this.addHandles([(0,l.on)((()=>i.allSources),"change",(()=>this._normalizeSearchSources(i))),i.on("search-clear",(()=>{e.geometry=null,e.name=null,this.viewModel.layer?.removeResult()})),i.on("select-result",(()=>{const t=i.selectedResult;e.geometry=t?.feature.geometry,e.name=t?.name,this._solveRouteDebounced()})),(0,l.watch)((()=>i.searchTerm),(t=>{e.name=t}))],i),this._stopsToSearches.set(e,i),i}getDirections(){return this.viewModel.getDirections()}render(){return(0,A.K)("div",{class:this.classes(D.base,F.D.widget,F.D.panel)},(0,A.K)("calcite-flow",null,this._renderPrimaryFlowItem(),this._renderDirectionsFlowItem(),this._renderEditFlowItem(),this._renderSaveFlowItem()))}save(){return this.viewModel.save()}saveAs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_applyLocatorSourceOverrides(e){let{allSources:t}=e;for(const i of t)"url"in i&&i.url&&(i.locationType??="street",(0,k.m$)(i.url)&&this.apiKey&&null==i.apiKey&&(i.apiKey=this.apiKey,i.url=k.jd))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_getEffectiveStops(){return this.viewModel.layer?.stops??this._placeholderStops}_getErrorDescription(){switch(this.viewModel.lastError?.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_getNetworkFeatureName(e){switch(e.type){case"stop":switch(e.locationType){case"stop":default:return this.messages.networkFeatures.stops.stop;case"waypoint":return this.messages.networkFeatures.stops.waypoint;case"break":return this.messages.networkFeatures.stops.break}case"point-barrier":return this.messages.networkFeatures.pointBarrier;case"polyline-barrier":return this.messages.networkFeatures.polylineBarrier;case"polygon-barrier":return this.messages.networkFeatures.polygonBarrier}}_getRouteCostSummary(){const e=this.viewModel.layer?.routeInfo;if(!e)return null;const t=e.totalDistance??0,i=e.totalDuration??0,{messagesUnits:s,unit:o}=this;return{distance:(0,I.BO)(s,t,o),duration:(0,I.a3)(i)}}_getStopSections(){if(!this.viewModel.layer)return null;const{directionPoints:e,directionLines:t,stops:i}=this.viewModel.layer;if(!e||!t)return null;const s=[];let o=null;for(const r of e){const{objectId:e,stopId:a}=r;if(null!=a){const e=i.find((e=>{let{objectId:t}=e;return t===a}));o&&o.stop===e||(o={stop:e,directions:[]},s.push(o));continue}if(null==o)continue;const n=t.find((t=>{let{directionPointId:i}=t;return i===e}));null!=n&&o.directions.push({directionPoint:r,directionLine:n})}return s}_handleLocateStopAction(e){const{view:t}=this;if(!t)return;const i="directions-search-tool";this.removeHandles(i),this._searchTool=new y({stop:e,view:t}),this.addHandles([this._searchTool.on("click",(async t=>{if(t.mapPoint&&this._stopsToSearches.has(e)){const i=this._stopsToSearches.get(e),s=await i.search(t.mapPoint),o=s?.results?.[0].results?.[0];if(o){const{feature:t,name:s}=o;i.searchTerm=s,e.geometry=t.geometry}}this.removeHandles(i)})),(0,a.hA)((()=>{this._searchTool&&(this.view?.tools.remove(this._searchTool),this._searchTool=null)}))],i),t.addAndActivateTool(this._searchTool)}_handleEditingDoneClick(){this.viewModel.stopEditing(),this._currentFlowItem="primary"}async _handleSaveLayerAsAction(){const e=u.default.getDefault();try{await e.signIn()}catch(t){if((0,n.isAbortError)(t)||"identity-manager:user-aborted"===t.name)return;return this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",void(this._saveState="connect-to-portal-error")}this._saveState="fetch-portal-information",this._parentFlowItem=this._currentFlowItem,this._currentFlowItem="save",this._portalUserName=e.user?.username;try{this._portalFolders=await(e.user?.fetchFolders())}catch{return void(this._saveState="fetch-portal-information-error")}this._saveState="save-layer"}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){for(const t of e.viewModel.defaultSources)t.autoNavigate=!1}_renderClearRouteAction(e){return(0,A.K)("calcite-action",{icon:"trash",key:"clear-route",onclick:()=>{this._currentFlowItem="primary",this.viewModel.reset()},...e,text:this.messages.common.clear,textEnabled:!0})}_renderDeleteStopAction(e){const t=this._getEffectiveStops();return(0,A.K)("calcite-action",{icon:"trash",onclick:()=>{t.remove(e),this._disposeSearch(e),this._solveRouteDebounced()},scale:"s",slot:"actions-end",text:this.messages.deleteStop,title:this.messages.deleteStop})}_renderDepartureTime(){const{DEPART_AT:e,NOW:t,UNSPECIFIED:i}=I.jW;return(0,A.K)("calcite-label",{class:D.departureTime,key:"departure-time"},this.messages.departureTime,(0,A.K)("calcite-combobox",{clearDisabled:!0,label:this.messages.departureTime,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:e=>{let{currentTarget:t}=e;const{selectedItems:i}=t;i.length&&(this.viewModel.departureOption=i[0].value,this._solveRouteDebounced())}},(0,A.K)("calcite-combobox-item",{heading:this.messages.leaveNow,key:t,label:this.messages.leaveNow,selected:this.viewModel.departureOption===t,value:t}),(0,A.K)("calcite-combobox-item",{heading:this.messages.departAt,key:e,label:this.messages.departAt,selected:this.viewModel.departureOption===e,value:e}),(0,A.K)("calcite-combobox-item",{heading:this.messages.timeUnspecified,key:i,label:this.messages.timeUnspecified,selected:this.viewModel.departureOption===i,value:i})))}_renderDepartureTimeOptions(){return this.viewModel.departureOption!==I.jW.DEPART_AT?null:(0,A.K)("div",{class:D.departureTimeOptions},(0,A.K)("calcite-input-date-picker",{scale:"s",value:this.viewModel.departureIsoDate,onCalciteInputDatePickerChange:e=>{let{currentTarget:{value:t}}=e;Array.isArray(t)||(this.viewModel.departureIsoDate=t,this._solveRouteDebounced())}}),(0,A.K)("calcite-input-time-picker",{scale:"s",value:this.viewModel.departureIsoTime,onCalciteInputTimePickerClose:e=>{let{currentTarget:{value:t}}=e;this.viewModel.departureIsoTime=t,this._solveRouteDebounced()}}))}_renderDirectionsFlowItem(){if("directions"!==this._currentFlowItem)return null;const e=this._getRouteCostSummary();if(!this._sections||!e)return null;const{distance:t,duration:i}=e,{formattedEta:s}=this.viewModel,o=this._sections.at(0)?.stop.name??"",r=this._sections.at(-1)?.stop.name??"";return(0,A.K)("calcite-flow-item",{key:"directions-flow-item",overlayPositioning:"fixed",selected:"directions"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem="primary"}},(0,A.K)("div",{class:D.directionsHeader,slot:"header-content"},(0,A.K)("div",{class:D.headerStops},(0,A.K)("span",null,this.messages.from)," ",(0,A.K)("span",{class:D.directionsHeaderStopName},o),(0,A.K)("span",null,this.messages.to)," ",(0,A.K)("span",{class:D.directionsHeaderStopName},r)),(0,A.K)("div",{class:D.flexColumn},(0,A.K)("span",null,`${i} (${t})`),s?(0,A.K)("span",null,s):null)),this._renderRouteLayerActions({slot:"header-menu-actions"}),(0,A.K)("calcite-accordion",{class:D.accordion,iconPosition:"start",selectionMode:"single"},this._sections.map(((e,t)=>{const{stop:i,directions:s}=e,{name:o}=i;return(0,A.K)("calcite-accordion-item",{expanded:0===t,heading:o??"",key:`stop-${t}`},(0,A.K)("calcite-action",{icon:"zoom-to-object",onclick:()=>{this.viewModel.centerAt(i)},slot:"actions-end",text:this.messages.panToStop}),this._renderDirectionTurns(s))}))))}_renderDirectionTurns(e){return(0,A.K)("calcite-list",{label:this.messages.drivingDirections,selectionMode:"none"},e.map(((e,t)=>{const{directionPoint:i,directionLine:s}=e,{distance:r,duration:a}=s,n=(0,I.BO)(this.messagesUnits,r??0,this.unit),l=(0,I.a3)(a??0),d=n&&l?`${n} | ${l}`:`${n||l}`,h=function(e){const{branchName:t,displayText:i,exitName:s,intersectingName:r,name:a,towardName:n}=e;if(null==i)return null;const l=[t,s,r,a,n].filter(o.Ru).sort(((e,t)=>t.length-e.length)).map((e=>(0,c.Cj)(e)));if(!l.length)return i;const d=new RegExp(l.join("|"),"g"),h=i.matchAll(d);let u=0;const p=[];for(const{0:o,index:c}of h)p.push(i.slice(u,c),(0,A.K)("span",{class:D.labelEmphasize,key:`maneuver-${c}`},o)),u=c+o.length;return p.push(i.slice(u)),(0,A.K)("span",null,p)}(i),u=(0,I.RU)(i.directionPointType);return(0,A.K)("calcite-list-item",{class:D.labelNoBottomMargin,key:`driving-direction-${t}`,onpointerenter:()=>{this.viewModel.highlight(s)},onpointerleave:()=>{this.viewModel.clearHighlights()},onCalciteListItemSelect:()=>{this._activeManeuver===s?this.zoomToRoute():(this._activeManeuver=s,this.viewModel.centerAt(s.geometry))}},(0,A.K)("calcite-icon",{icon:u,slot:"content-start"}),(0,A.K)("div",{slot:"content"},(0,A.K)("calcite-label",{layout:"inline",scale:"s"},h),(0,A.K)("calcite-label",{layout:"inline",scale:"s"},d)))})))}_renderEditFlowItem(){return"edit"!==this._currentFlowItem?null:(0,A.K)("calcite-flow-item",{heading:this.messages.editRoute,headingLevel:this.headingLevel,key:"edit-flow-item",loading:"routing"===this.viewModel.state,selected:"edit"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.viewModel.stopEditing(),this._currentFlowItem="primary"}},(0,A.K)("div",{class:D.flexColumn,key:"edit-container"},(0,A.K)("div",{class:D.editToolbarContainer},(0,A.K)("calcite-label",{layout:"inline",scale:"s"},this.messages.automaticallySolve,(0,A.K)("calcite-switch",{checked:this.viewModel.autoSolve,scale:"s",onCalciteSwitchChange:e=>{this.viewModel.autoSolve=e.target.checked}})),(0,A.K)("div",{class:D.editToolbar},(0,A.K)("calcite-action",{icon:"flag",onclick:()=>{this.viewModel.create("stop")},scale:"s",text:this.messages.networkFeatures.stops.stop,textEnabled:!0}),(0,A.K)("calcite-action",{icon:"line",onclick:()=>{this.viewModel.create("polyline-barrier")},scale:"s",text:this.messages.barrier,textEnabled:!0}),(0,A.K)("calcite-action",{class:D.solveRoute,disabled:this.viewModel.autoSolve,icon:"refresh",onclick:()=>{this._solveRouteDebounced()},scale:"s",text:this.messages.solve,textEnabled:!0}))),(0,A.K)("div",{class:D.selectedFeatureContainer},(0,A.K)("calcite-list",{label:this.messages.selectedNetworkFeatures,scale:"s",selectionMode:"none"},this.viewModel.selectedNetworkFeatures?.toArray().map(((e,t)=>(0,A.K)("calcite-list-item",{description:this._getNetworkFeatureName(e),key:`network-feature-${t}`,label:e.name??e.objectId?.toString()??this.messages.unnamed},(0,A.K)("calcite-action",{icon:"trash",onclick:()=>{this.viewModel.remove(e)},scale:"s",slot:"actions-end",text:this.messages.common.delete})))))),(0,A.K)("div",{class:D.editFooter},this._renderEditFooterContent())))}_renderEditFooterContent(){return this.viewModel.lastError?this._renderErrorNotice():(0,A.K)("calcite-button",{appearance:"outline-fill",bind:this,onclick:this._handleEditingDoneClick,width:"full"},this.messages.common.done)}_renderErrorNotice(){return(0,A.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0},(0,A.K)("calcite-label",{class:D.labelNoBottomMargin,slot:"message"},this._getErrorDescription()))}_renderFooter(){if(!this.viewModel.layer)return(0,A.K)("div",{class:D.primaryFooter,key:"footer-missing-layer"},(0,A.K)("calcite-notice",{icon:"information",open:!0},(0,A.K)("calcite-label",{class:D.labelNoBottomMargin,slot:"message"},this.messages.missingLayer)));if("unauthenticated"===this.viewModel.state)return(0,A.K)("div",{class:D.primaryFooterCentered,key:"footer-sign-in"},(0,A.K)("calcite-label",null,this.messages.signInRequired),(0,A.K)("calcite-button",{onclick:()=>{this.viewModel.load().catch((()=>{}))}},this.messages.common.auth.signIn));if("routing"===this.viewModel.state)return(0,A.K)("div",{class:this.classes(D.primaryFooter,D.primaryFooterLoader),key:"footer-routing"},(0,A.K)("calcite-loader",{label:this.messages.solve,scale:"s"}));if("error"===this.viewModel.state)return(0,A.K)("div",{class:D.primaryFooter,key:"footer-service-error"},this._renderErrorNotice());if(!this.viewModel.layer?.routeInfo)return(0,A.K)("div",{class:D.primaryFooter,key:"footer-unsolved-route"},(0,A.K)("calcite-notice",{icon:"information",open:!0},(0,A.K)("calcite-label",{class:D.labelNoBottomMargin,slot:"message"},this.messages.directionsPlaceholder)));const e=this._getRouteCostSummary();if(!e||!this.viewModel.layer?.directionPoints)return(0,A.K)("div",{class:D.primaryFooter,key:"footer-invalid-route"},(0,A.K)("calcite-notice",{icon:"exclamation-mark-triangle",kind:"danger",open:!0},(0,A.K)("calcite-label",{class:D.labelNoBottomMargin,slot:"message"},this.messages.invalidRoute)));const{distance:t,duration:i}=e,{formattedEta:s}=this.viewModel;return(0,A.K)("div",{class:D.routeItem,key:"footer-directions-summary"},(0,A.K)("button",{"aria-busy":"false","aria-label":this.messages.viewDrivingDirections,"aria-live":"polite",class:D.routeItemButton,onclick:()=>{this._currentFlowItem="directions"},type:"button"},(0,A.K)("div",{class:D.routeItemButtonContent},(0,A.K)("span",{class:D.routeItemLabel},`${i} (${t})`),(0,A.K)("span",{class:D.routeItemDescription},s)),(0,A.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s"})),(0,A.K)("calcite-dropdown",null,(0,A.K)("calcite-action",{icon:"ellipsis",slot:"trigger",text:"Route actions"}),this._renderRouteLayerActions()))}_renderInteractiveRouteActions(){return(0,A.K)("div",{class:D.actionContainer,key:"interactive-route-action-container"},(0,A.K)("calcite-button",{appearance:"outline",class:D.addStopButton,disabled:this._getEffectiveStops().length>=this.maxStops,iconStart:"plus",kind:"neutral",label:this.messages.addStop,onclick:()=>{const e=new v.default;this.viewModel.layer?.stops.add(new m.default({symbol:e}))},width:"half"},this.messages.addStop),(0,A.K)("calcite-button",{appearance:"outline",disabled:"2d"!==this.viewModel.view?.type,iconStart:"pencil",kind:"neutral",label:this.messages.editRoute,onclick:()=>{this._currentFlowItem="edit",this.viewModel.startEditing()},width:"half"},this.messages.editRoute))}_renderLocateStopAction(e){if(null!=e.name||null!=e.geometry)return null;const t=this._getEffectiveStops().indexOf(e),i=!!this.view?.activeTool&&this.view.activeTool===this._searchTool&&this._searchTool.stop===e;return(0,A.K)("calcite-action",{active:i,icon:"crosshair",key:`stop-location-action-${t}`,onclick:()=>this._handleLocateStopAction(e),scale:"s",slot:"actions-end",text:this.messages.pickALocationOnTheMap,title:this.messages.pickALocationOnTheMap})}_renderOptimizeStopOrder(){const{routeParameters:e}=this.viewModel,{findBestSequence:t,preserveFirstStop:i,preserveLastStop:s}=e;return(0,A.K)("calcite-block-section",{class:D.optimizeSection,text:this.messages.optimizeOrder,toggleDisplay:"switch",onCalciteBlockSectionToggle:t=>{let{target:i}=t;e.findBestSequence=i.open,i.open||this._resetStopSequence(),this._solveRouteDebounced()}},t?[(0,A.K)("calcite-label",{class:D.optimizeSwitches,key:"preserve-first-stop",layout:"inline-space-between"},this.messages.preserveFirstStop,(0,A.K)("calcite-switch",{checked:i,scale:"s",onCalciteSwitchChange:t=>{let{target:{checked:i}}=t;e.preserveFirstStop=i,this._resetStopSequence(),this._solveRouteDebounced()}})),(0,A.K)("calcite-label",{class:D.optimizeSwitches,key:"preserve-last-stop",layout:"inline-space-between"},this.messages.preserveLastStop,(0,A.K)("calcite-switch",{checked:s,scale:"s",onCalciteSwitchChange:t=>{let{target:{checked:i}}=t;e.preserveLastStop=i,this._resetStopSequence(),this._solveRouteDebounced()}}))]:null)}_renderPrimaryFlowItem(){return(0,A.K)("calcite-flow-item",{key:"primary-flow-item",loading:"initializing"===this.viewModel.state,selected:"primary"===this._currentFlowItem},(0,A.K)("calcite-panel",{class:D.primaryFlowItem,disabled:!this.viewModel.layer||"unauthenticated"===this.viewModel.state||"error"===this.viewModel.state&&!this.viewModel.serviceDescription},this._renderStops(),this._renderInteractiveRouteActions(),this._renderSeparator(),this._renderRouteSolveOptions()),this._renderFooter())}_renderRouteLayerActions(e){return[this._renderClearRouteAction(e),this._renderSaveLayerAction(e),this._renderSaveLayerAsAction(e),this._renderViewItemDetailsAction(e)]}_renderRouteSolveOptions(){return(0,A.K)("div",{class:D.marginInlineMedium,key:"route-solve-options"},this._renderTravelModes(),this._renderDepartureTime(),this._renderDepartureTimeOptions(),this._renderOptimizeStopOrder())}_renderSaveContent(){switch(this._saveState){case"initialized":return this._renderSaveInitialized();case"connect-to-portal":return this._renderSaveProcessing(this.messages.identity.lblSigning);case"connect-to-portal-error":return this._renderSaveError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderSaveProcessing(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderSaveError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayerSettings();case"saving":return this._renderSaveProcessing(this.messages.processing.saving);case"saving-error":return this._renderSaveError(this.messages.errors.saving)}}_renderSaveError(e){return(0,A.K)("calcite-panel",{class:D.paddingMedium,key:"save-layer-error"},(0,A.K)("div",{class:D.saveError},(0,A.K)("calcite-icon",{class:D.saveErrorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messages.common.errorMessage}),(0,A.K)("calcite-label",{class:D.saveErrorLabel},e)),(0,A.K)("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.close))}_renderSaveInitialized(){return(0,A.K)("calcite-panel",{class:D.paddingMedium,key:"save-layer-initialized"})}_renderSaveFlowItem(){return"save"!==this._currentFlowItem?null:(0,A.K)("calcite-flow-item",{heading:this.messages.saveLayer,headingLevel:this.headingLevel,key:"save-layer-flow-item",selected:"save"===this._currentFlowItem,onCalciteFlowItemBack:e=>{e.stopPropagation(),this._currentFlowItem=this._parentFlowItem}},this._renderSaveContent())}_renderSaveLayerAction(e){if(!this.visibleElements.saveButton)return null;const t=this.viewModel.layer,i=t?.routeInfo,s=t?.portalItem?.itemControl;return(0,A.K)("calcite-action",{disabled:!(i&&("admin"===s||"update"===s)),icon:"save",key:"save-route",onclick:()=>{this.viewModel.layer?.save()},...e,text:this.messages.common.save,textEnabled:!0})}_renderSaveLayerAsAction(e){if(!this.visibleElements.saveAsButton)return null;const t=!this.viewModel.layer?.routeInfo;return(0,A.K)("calcite-action",{disabled:t,icon:"save-as",key:"save-as-route",onclick:()=>{this._handleSaveLayerAsAction()},...e,text:this.messages.common.saveAs,textEnabled:!0})}_renderSaveLayerSettings(){if(null==this.layer||null==this._portalFolders||null==this._portalUserName)return this._renderSaveInitialized();const{stops:e}=this.layer,t=`${e.at(0).name} - ${e.at(-1).name}`,i=[(0,A.K)("calcite-combobox-item",{heading:`${this._portalUserName} (${this.messages.common.home})`,key:`${C}-folder-home`,selected:!0,value:`${C}-folder-home`}),...this._portalFolders.map((e=>(0,A.K)("calcite-combobox-item",{heading:e.title??"",key:`${C}-folder-${e.id}`,value:e.id})))];return(0,A.K)("calcite-panel",{key:"save-layer-panel"},(0,A.K)("div",{class:D.paddingMedium},(0,A.K)("calcite-label",null,this.messages.laverName,(0,A.K)("calcite-input",{afterCreate:e=>{this._portalItemNameInput=e},label:this.messages.laverName,value:t})),(0,A.K)("calcite-label",null,this.messages.saveInFolder,(0,A.K)("calcite-combobox",{afterCreate:e=>{this._portalFolderCombobox=e},clearDisabled:!0,label:this.messages.saveInFolder,overlayPositioning:"fixed",selectionMode:"single"},i))),(0,A.K)("calcite-button",{onclick:()=>{if(this._saveState="saving",null==this.layer||null==this._portalFolders)return;const e=this._portalItemNameInput?.value,t=this._portalFolderCombobox?.value,i=this._portalFolders.find((e=>{let{id:i}=e;return i===t}));this.layer.saveAs({title:e},{folder:i}).then((()=>{this._currentFlowItem=this._parentFlowItem})).catch((()=>{this._saveState="saving-error"}))},slot:"footer-actions",width:"full"},this.messages.common.save),(0,A.K)("calcite-button",{appearance:"outline",onclick:()=>{this._currentFlowItem=this._parentFlowItem},slot:"footer-actions",width:"full"},this.messages.common.cancel))}_renderSaveProcessing(e){return(0,A.K)("calcite-panel",{class:D.marginInlineMedium,key:"save-layer-processing"},(0,A.K)("calcite-loader",{class:D.saveProcessLoader,label:e,text:e}))}_renderSeparator(){return(0,A.K)("div",{class:D.separator})}_renderStop(e){const t=this.acquireSearch(e);null!=e.name&&(t.searchTerm=e.name);const i=this._getEffectiveStops(),s=this._renderLocateStopAction(e),o=i.length>2&&this._renderDeleteStopAction(e);return(0,A.K)("calcite-list-item",{key:e,value:e},s,o,(0,A.K)("div",{class:D.stopItem,slot:"content"},t.render()))}_renderStops(){const e=this._getEffectiveStops();for(const t of this._stopsToSearches.keys())e.includes(t)||this._disposeSearch(t);return(0,A.K)("div",{class:D.stopContainer,key:D.stopContainer},(0,A.K)("calcite-list",{class:D.stopList,dragEnabled:!0,label:this.messages.widgetLabel,scale:"s",onCalciteListOrderChange:t=>{let{detail:i}=t;e.reorder(i.dragEl.value,i.newIndex),this._resetStopSequence(),this._solveRouteDebounced()}},e.toArray().map((e=>this._renderStop(e)))),2===e.length&&(0,A.K)("calcite-action",{icon:"arrow-up-down",onclick:()=>{e.reverse(),this._resetStopSequence(),this._solveRouteDebounced()},scale:"s",text:this.messages.reverseStops}))}_renderTravelModes(){return this.viewModel.travelModes.length?(0,A.K)("calcite-label",{key:"travel-modes"},this.messages.mode,(0,A.K)("calcite-combobox",{clearDisabled:!0,label:this.messages.mode,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:e=>{let{currentTarget:t}=e;const{selectedItems:i}=t;i.length&&(this.viewModel.selectedTravelMode=i[0].value,this._solveRouteDebounced())}},this.viewModel.travelModes.map((e=>(0,A.K)("calcite-combobox-item",{heading:e.name,key:e.id,label:e.name,selected:this.viewModel.selectedTravelMode?.id===e.id,value:e}))))):null}_renderViewItemDetailsAction(e){if(!this.visibleElements.layerDetails)return null;const t=this.viewModel.layer?.portalItem;return(0,A.K)("calcite-action",{disabled:!t,icon:"launch",key:"open-route-details-link",onclick:()=>{t&&window.open(`${t.portal.url}/home/item.html?id=${t.id}`,"_blank")},...e,text:this.messages.viewLayerDetails,textEnabled:!0})}_resetStopSequence(){this.viewModel.layer?.stops.forEach((e=>{e.sequence=null}))}async _solveRoute(){if(this.viewModel.updateDepartureTime(),!((this.viewModel.layer?.stops.filter((e=>{let{geometry:t}=e;return!!t})).length??0)<2))try{await this.viewModel.getDirections()}catch{}}};(0,s._)([(0,d.MZ)()],x.prototype,"_currentFlowItem",void 0),(0,s._)([(0,d.MZ)()],x.prototype,"_saveState",void 0),(0,s._)([(0,d.MZ)()],x.prototype,"_searchTool",void 0),(0,s._)([(0,d.MZ)()],x.prototype,"apiKey",null),(0,s._)([(0,d.MZ)(p.q)],x.prototype,"defaultUnit",void 0),(0,s._)([(0,d.MZ)()],x.prototype,"goToOverride",null),(0,s._)([(0,d.MZ)()],x.prototype,"headingLevel",void 0),(0,s._)([(0,d.MZ)()],x.prototype,"icon",null),(0,s._)([(0,d.MZ)()],x.prototype,"label",null),(0,s._)([(0,d.MZ)({readOnly:!0})],x.prototype,"lastRoute",null),(0,s._)([(0,d.MZ)()],x.prototype,"layer",null),(0,s._)([(0,d.MZ)()],x.prototype,"maxStops",null),(0,s._)([(0,d.MZ)(),(0,T.G)("esri/widgets/Directions/t9n/Directions")],x.prototype,"messages",void 0),(0,s._)([(0,d.MZ)(),(0,T.G)("esri/core/t9n/Units")],x.prototype,"messagesUnits",void 0),(0,s._)([(0,d.MZ)()],x.prototype,"searchProperties",void 0),(0,s._)([(0,d.MZ)()],x.prototype,"unit",null),(0,s._)([(0,d.MZ)()],x.prototype,"view",null),(0,s._)([(0,d.MZ)({type:f.default})],x.prototype,"viewModel",void 0),(0,s._)([(0,d.MZ)({type:K,nonNullable:!0})],x.prototype,"visibleElements",void 0),x=(0,s._)([(0,h.$)("esri.widgets.Directions")],x);const $=x},56062:(e,t,i)=>{i.d(t,{c:()=>r});var s=i(84190),o=i(78139);function r(e){const t="metric";if(null==e)return t;const i=e.map,r=(i&&"portalItem"in i?i.portalItem?.portal:null)??o.default.getDefault();switch(r.user?.units??r.units){case t:return t;case"english":return"imperial"}return(0,s.jM)(e.spatialReference)??t}},75644:(e,t,i)=>{i.d(t,{q:()=>o});var s=i(56062);const o={readOnly:!0,get(){return(0,s.c)(this.view)}}},77783:(e,t,i)=>{i.d(t,{t:()=>a});var s,o,r=i(89129);(o=s||(s={}))[o.WhenToolEditable=0]="WhenToolEditable",o[o.WhenToolNotEditable=1]="WhenToolNotEditable",o[o.Always=2]="Always";class a{constructor(){this._isToolEditable=!0,this._manipulators=new r.default,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.WhenToolEditable;this.addMany([e],t)}addMany(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.WhenToolEditable;for(const i of e){const e={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((e=>{let{manipulator:t}=e;return t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,s=Number.MAX_VALUE;return this._manipulators.forEach((o=>{let{manipulator:r,attached:a}=o;if(!a||!r.interactive)return;const n=r.intersectionDistance(e,t);null!=n&&n<s&&(s=n,i=r)})),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===s.Always||(this._isToolEditable?e.visibilityPredicate===s.WhenToolEditable:e.visibilityPredicate===s.WhenToolNotEditable)}}},88204:(e,t,i)=>{i.d(t,{g:()=>d});var s=i(93800),o=i(6946),r=(i(21265),i(50925),i(49959)),a=i(48602),n=(i(14746),i(75269)),l=i(54379),c=i(77783);let d=class extends o.default{constructor(e){super(e),this.manipulators=new c.t,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[l.PK.MANAGER,!0],[l.PK.USER,!0]]),this._creationFinishedResolver=(0,r.createResolver)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(l.PK.USER)}set editable(e){this.setEditableFlag(l.PK.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===l.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach((i=>{let{manipulator:s}=i;s.dragging&&(t=!0,s.events.emit("drag",{action:"end",start:e,screenPoint:e}))})),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(l.PK.USER)&&this.getEditableFlag(l.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,s._)([(0,a.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],d.prototype,"active",null),(0,s._)([(0,a.MZ)({value:!0})],d.prototype,"visible",null),(0,s._)([(0,a.MZ)({value:!0})],d.prototype,"editable",null),(0,s._)([(0,a.MZ)({readOnly:!0})],d.prototype,"manipulators",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],d.prototype,"updating",null),(0,s._)([(0,a.MZ)()],d.prototype,"cursor",null),(0,s._)([(0,a.MZ)({readOnly:!0})],d.prototype,"automaticManipulatorSelection",void 0),(0,s._)([(0,a.MZ)()],d.prototype,"hasFocusedManipulators",null),(0,s._)([(0,a.MZ)()],d.prototype,"hasGrabbedManipulators",void 0),(0,s._)([(0,a.MZ)()],d.prototype,"hasHoveredManipulators",void 0),(0,s._)([(0,a.MZ)()],d.prototype,"firstGrabbedManipulator",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],d.prototype,"created",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],d.prototype,"removeIncompleteOnCancel",void 0),d=(0,s._)([(0,n.$)("esri.views.interactive.InteractiveToolBase")],d)}}]);