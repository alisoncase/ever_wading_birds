"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[94211],{605:(e,t,n)=>{n.d(t,{_:()=>i});class i{constructor(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=e,this.count=t,this.type=n,this.offset=i,this.stride=r,this.normalized=s,this.divisor=o}}},7815:(e,t,n)=>{n.d(t,{G:()=>c,V:()=>d});var i=n(60548),r=n(24646),s=n(95206),o=n(35490),a=n(94409),l=n(16878);function c(e,t){const n=e.vertex;t.hasVerticalOffset?(d(n),t.hasScreenSizePerspective&&(e.include(s.Y6),(0,s.OH)(n),(0,o.yu)(e.vertex,t)),n.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):n.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,r.vt)();function d(e){e.uniforms.add(new a.E("verticalOffset",((e,t)=>{const{minWorldLength:n,maxWorldLength:r,screenLength:s}=e.verticalOffset,o=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,i.s)(u,s*a,o,n,r)})))}},8696:(e,t,n)=>{n.d(t,{N:()=>c});var i=n(7951),r=n(93003),s=n(16434),o=n(29072),a=n(19416),l=n(12723);class c extends s.w{constructor(e,t){super(e,t,new r.$(o.a,(()=>n.e(73648).then(n.bind(n,73648)))))}initializePipeline(e){switch(e.blitMode){case a.d.None:case a.d.Depth:return(0,l.Ey)({colorWrite:l.kn});case a.d.Alpha:return(0,l.Ey)({blending:l.Ky,colorWrite:l.kn});default:(0,i.Xb)(e.blitMode);case a.d.PremultipliedAlpha:case a.d.COUNT:return(0,l.Ey)({blending:l.Os,colorWrite:l.kn})}}}},9452:(e,t,n)=>{n.d(t,{Gc:()=>l,RI:()=>u,Z4:()=>c,dk:()=>f,vr:()=>d});var i=n(16804),r=n(32006),s=n(89227),o=n(91102),a=n(1696);function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,o.vt)();return c(e,(0,i.WA)(t),n),(0,s.n)(n.direction,n.direction),n}function c(e,t,n){return u(e,e.screenToRender(t,(0,i.sc)(a.rq.get())),n)}function u(e,t,n){const o=(0,i.sc)((0,r.C)(a.rq.get(),t));if(o[2]=0,!e.unprojectFromRenderScreen(o,n.origin))return null;const l=(0,i.sc)((0,r.C)(a.rq.get(),t));l[2]=1;const c=e.unprojectFromRenderScreen(l,a.rq.get());return null==c?null:((0,s.d)(n.direction,c,n.origin),n)}function d(e,t,n){return f(e,e.screenToRender(t,(0,i.sc)(a.rq.get())),n)}function f(e,t,n){(0,s.c)(n.origin,e.eye);const i=(0,s.i)(a.rq.get(),t[0],t[1],1),r=e.unprojectFromRenderScreen(i,a.rq.get());return null==r?null:((0,s.d)(n.direction,r,n.origin),n)}},12837:(e,t,n)=>{n.d(t,{X:()=>f});var i=n(42198),r=n(22029),s=n(89129),o=n(79953),a=n(59116),l=n(34519),c=n(35130);var u=n(62791);const d=new Map;function f(e){if(!d.has(e)){const t=function(e,t){const n=new c.default({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t?.distance??l.N.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??l.N.touchSensitivityMultiplier});return{...(0,o.watch)((()=>e.map?.allLayers?.toArray()??[]),(e=>{n.featureSources=new s.default(e).map((e=>new a.default({layer:e})))}),o.syncAndInitial),options:n}}(e,{distance:10}),n=function(e,t){return new u.g({view:e,options:t})}(e,t.options);d.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=d.get(e);t.referenceCount++;const n=(0,i.hA)((()=>{return n=e,(i=t).referenceCount--,void(i.referenceCount>0||(0,r.d)((()=>{0===i.referenceCount&&(i.remove(),d.delete(n))})));var n,i}));return{snappingManager:t.snappingManager,...n}}},13473:(e,t,n)=>{function i(){return[1,0,0,0,1,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function s(e,t,n,i,r,s,o,a,l){return[e,t,n,i,r,s,o,a,l]}n.d(t,{fA:()=>s,o8:()=>r,vt:()=>i,zK:()=>o});const o=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:i,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},14960:(e,t,n)=>{n.d(t,{G:()=>i,Q:()=>r});const i={stableRendering:!1},r={rootOrigin:null}},16079:(e,t,n)=>{n.d(t,{G:()=>a});var i=n(29072),r=n(8696),s=n(19416),o=n(92156);class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.d.None;this._techniques=e,this._parameters=new i.C,this._configuration=new s.N,this._configuration.blitMode=t,e.precompile(r.N,this._configuration)}blit(e,t,n,i){e.bindFramebuffer(n.fbo),e.setClearColor(0,0,0,1),e.clear(o.NV.COLOR),this._parameters.texture=t.getTexture();const s=this._techniques.get(r.N,this._configuration);e.bindTechnique(s,i,this._parameters),e.screen.draw()}blend(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this._configuration.hasOpacityFactor=s<1;const o=this._techniques.get(r.N,this._configuration);return!!o.compiled&&(e.bindFramebuffer(n.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=s,e.bindTechnique(o,i,this._parameters),e.screen.draw(),!0)}}},19416:(e,t,n)=>{n.d(t,{N:()=>a,d:()=>i});var i,r,s=n(93800),o=n(21484);(r=i||(i={}))[r.None=0]="None",r[r.Alpha=1]="Alpha",r[r.PremultipliedAlpha=2]="PremultipliedAlpha",r[r.Depth=3]="Depth",r[r.COUNT=4]="COUNT";class a extends o.K{constructor(){super(...arguments),this.blitMode=i.None,this.hasOpacityFactor=!1}}(0,s._)([(0,o.W)({count:i.COUNT})],a.prototype,"blitMode",void 0),(0,s._)([(0,o.W)()],a.prototype,"hasOpacityFactor",void 0)},23278:(e,t,n)=>{var i;n.d(t,{n:()=>i}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))},25874:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(50925),r=n(17741),s=n(42080),o=n(92156),a=n(44480);const l=()=>i.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=n,this._buffers=i,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(this._buffers.size+(this._indexBuffer?1:0))*s.i5}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,r.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:n}=this;e||l().error("Vertex buffer dictionary is empty!");const i=this._context.gl;this._buffers.forEach(((e,n)=>{const i=t.get(n);i?(0,a.yu)(this._context,this._locations,e,i):l().error("Vertex element descriptor is empty!")})),null!=n&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},29072:(e,t,n)=>{n.d(t,{C:()=>h,a:()=>g,b:()=>p});var i=n(37379),r=n(33273),s=n(42162),o=n(15025),a=n(42403),l=n(16878),c=n(67058),u=n(19416),d=n(20783),f=n(8118);class h extends d.Y{constructor(){super(...arguments),this.opacity=1}}function p(e){const t=new f.N5;t.include(i.c),t.fragment.uniforms.add(new c.N("tex",(e=>e.texture))),e.hasOpacityFactor&&t.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity)));const n=e.blitMode===u.d.Depth;return n&&(t.fragment.uniforms.add(new o.E("nearFar",(e=>e.camera.nearFar))),t.fragment.include(r.E),t.fragment.include(s.W)),t.fragment.main.add(l.H`
    ${n?l.H`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:l.H`
          fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};`}`),t}const g=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h,build:p},Symbol.toStringTag,{value:"Module"}))},33365:(e,t,n)=>{n.d(t,{P:()=>a});var i=n(92143),r=n(60822),s=n(26266),o=n(47396);function a(e){const{spatialReference:t}=e;return(0,o.M0)(t,l,c,e)}function l(e){return(0,i.gT)(Math.abs((0,s.geodesicAreas)([e],"square-meters")[0]),"square-meters")}function c(e){try{return(0,i.gT)(Math.abs((0,r.geodesicArea)(e,"square-meters")),"square-meters")}catch(t){return null}}},34519:(e,t,n)=>{n.d(t,{N:()=>u});var i=n(93800),r=n(88102),s=n(19455),o=n(48602),a=n(75269);let l=class extends s.A{constructor(){super(...arguments),this.enabled=!0}};(0,i._)([(0,o.MZ)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,i._)([(0,a.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends s.A{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new r.default([255,127,0]),this.orangeTransparent=new r.default([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"verticalLineThresholdMeters",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:r.default,nonNullable:!0})],c.prototype,"orange",void 0),(0,i._)([(0,o.MZ)({type:r.default,nonNullable:!0})],c.prototype,"orangeTransparent",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"satisfiesConstraintScreenThreshold",void 0),c=(0,i._)([(0,a.$)("esri.views.interactive.snapping.Settings.Defaults")],c);const u=new c},38319:(e,t,n)=>{n.d(t,{W:()=>s});var i=n(60984),r=n(30051);class s extends i.im{intersect(e,t,n,i,s,o){return(0,r.Uy)(e,n,i,s,void 0,o)}}},38432:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(93800),r=n(6946),s=n(62631),o=n(85715),a=n(93633),l=n(19455),c=n(48602),u=(n(21265),n(50925),n(75269));let d=0,f=class extends(l.A.JSONSupportMixin(o.A.ClonableMixin(a.A.IdentifiableMixin(r.default)))){constructor(e){super(e),this.id=`${Date.now().toString(16)}-analysis-${d++}`,this.title=null}get parent(){return this._get("parent")}set parent(e){const t=this.parent;if(null!=t)switch(t.type){case"line-of-sight":case"dimension":case"viewshed":t.releaseAnalysis(this);break;case"2d":case"3d":t.analyses.includes(this)&&t.analyses.remove(this)}this._set("parent",e)}get isEditable(){return this.requiredPropertiesForEditing.every(s.Ru)}};(0,i._)([(0,c.MZ)({type:String,constructOnly:!0,clonable:!1})],f.prototype,"id",void 0),(0,i._)([(0,c.MZ)({type:String})],f.prototype,"title",void 0),(0,i._)([(0,c.MZ)({clonable:!1,value:null})],f.prototype,"parent",null),(0,i._)([(0,c.MZ)({readOnly:!0})],f.prototype,"isEditable",null),f=(0,i._)([(0,u.$)("esri.analysis.Analysis")],f);const h=f},41317:(e,t,n)=>{n.d(t,{$7:()=>E,B:()=>A,Fo:()=>x,M7:()=>R,NN:()=>f,Q5:()=>b,Tq:()=>C,Up:()=>O,XF:()=>S,Ze:()=>m,bK:()=>a,bh:()=>d,id:()=>y,ky:()=>u,qt:()=>T,tW:()=>N,v9:()=>h,w7:()=>l,wF:()=>o,wS:()=>_,wz:()=>g,x:()=>p,xS:()=>w,ze:()=>c});var i=n(84190),r=n(34308);function s(e){return e?T:C}function o(e,t){return t?.mode?t.mode:s(e).mode}function a(e,t){return null!=t?t:s(e)}function l(e,t){return o(null==e||(e.hasZ??!1),t)}function c(e,t){return a(null==e||(e.hasZ??!1),t)}function u(e){const t=v(e);return l(e.geometry,t)}function d(e){const t=v(e),n=l(e.geometry,t),i=null!=t&&"on-the-ground"!==n?R(t):0,r=t?.featureExpressionInfo;return{mode:n,offset:i,featureExpressionInfo:r}}function f(e){return g(d(e))}function h(e){return g(e)||p(e)}function p(e){return"0"===e?.featureExpressionInfo?.expression}function g(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function v(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function m(e,t){if(!e?.offset)return 0;const{offset:n,unit:r}=e;if("decimal-degrees"===r)return 0;const s="unknown"!==r&&r?r:"meters",o=(0,i.mq)(t);return o?(0,i.oU)(n,s,o):0}function y(e,t,n){if(!n?.mode)return;const i=e.hasZ?e.z:0,r=m(n,e.spatialReference);switch(n.mode){case"absolute-height":return i-r;case"on-the-ground":return 0;case"relative-to-ground":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"ground")??0)+r);case"relative-to-scene":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"scene")??0)+r)}}function _(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return x(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function w(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return x(e,t[0],t[1],t.length>2?t[2]:0,n,i,r)}function x(e,t,n,i,r,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==s)return;const a=null!=o?o.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=b(t,n,i,r,e,s);return function(e,t,n,i,r,s,o,a){const l=m(o,r);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((s.elevationProvider.getElevation(t,n,i,r,"ground")??0)+l);case"relative-to-scene":return e-((s.elevationProvider.getElevation(t,n,i,r,"scene")??0)+l)}}(l,t,n,i,r,e,o,a)}function b(e,t,n,i,r,s){const o=m(s,i);switch(s.mode){case"absolute-height":return{absoluteZ:n+o,elevation:0};case"on-the-ground":{const n=r.elevationProvider.getElevation(e,t,0,i,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const s=r.elevationProvider.getElevation(e,t,n,i,"ground")??0;return{absoluteZ:n+s+o,elevation:s}}case"relative-to-scene":{const s=r.elevationProvider.getElevation(e,t,n,i,"scene")??0;return{absoluteZ:n+s+o,elevation:s}}}}function O(e,t){if(null==t)return!1;const{mode:n}=t;return null!=n&&("scene"===e&&"relative-to-scene"===n||"ground"===e&&"absolute-height"!==n)}function A(e,t,n){return n&&n.mode!==t?`${e} only support ${t} elevation mode`:null}function E(e,t,n){return n?.mode===t?`${e} do not support ${t} elevation mode`:null}function N(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function S(e,t){t&&e.warn(".elevationInfo=",t)}function R(e){return(e?.offset??0)*(0,r.Ao)(e?.unit)}const T={mode:"absolute-height",offset:0},C={mode:"on-the-ground",offset:null}},42080:(e,t,n)=>{n.d(t,{$B:()=>r,Qf:()=>c,Qh:()=>a,RS:()=>s,ez:()=>f,i5:()=>h,lM:()=>o,qK:()=>d,rq:()=>u});var i=n(25048);function r(e){return 32+e.length}const s=16;function o(e){if(!e)return 0;let t=d;for(const n in e)e.hasOwnProperty(n)&&(t+=l(e[n],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return c(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return u(e,8);let n=f;for(let i=0;i<t;i++)n+=l(e[i]);return n}(e);let t=d;for(const n in e)e.hasOwnProperty(n)&&(t+=l(e[n]));return t}function l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?a(e):d;case"string":return r(e);case"number":return s;case"boolean":return 4;default:return 8}}function c(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>e+(t?(0,i.iu)(t)?t.byteLength+h:Array.isArray(t)?u(t,s):0:0)),0)}function u(e,t){return f+e.length*t}const d=32,f=16,h=145},43208:(e,t,n)=>{n.d(t,{f:()=>s});var i=n(28473);class r{constructor(e,t){this.vec3=e,this.id=t}}function s(e,t,n,s){return new r((0,i.fA)(e,t,n),s)}},43536:(e,t,n)=>{n.d(t,{m:()=>i});class i{constructor(e,t){this.isDraped=e,this.domain=t}}},44e3:(e,t,n)=>{n.d(t,{g:()=>m});n(21265);var i=n(31923),r=n(89227),s=n(28473),o=n(24646),a=n(67093),l=n(65069),c=n(69291),u=n(25735),d=n(43208),f=n(8461),h=n(14960),p=n(22131),g=n(20196),v=n(23664);class m{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,i.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=h.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,d.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const n=(0,d.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,n),n}const n=this._gridSize,i=Math.round(e[0]/n),s=Math.round(e[1]/n),o=Math.round(e[2]/n),a=`${i}/${s}/${o}`;let l=this._origins.get(a);const c=.5*n;if((0,r.d)(y,e,t.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),y[0]<c&&y[1]<c&&y[2]<c){if(l){const t=Math.max(...y);if((0,r.d)(y,e,l.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),Math.max(...y)<t)return l}return t}return l||(l=(0,d.f)(i*n,s*n,o*n,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,o.fA)(1,1,0,1);const n=window.view,i=n._stage,r=t.toString();if(!this._objects.has(r)){this._material=new v.W({width:2,color:t}),i.add(this._material);const e=new g.x(i,{pickable:!1}),n=new f.B({castShadow:!1});i.add(n),e.add(n),this._objects.set(r,n)}const s=this._objects.get(r),d=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],h=d.length,m=new Array(3*h),y=new Array,_=.5*this._gridSize;for(let o=0;o<h;o++)m[3*o]=e[0]+(1&d[o]?_:-_),m[3*o+1]=e[1]+(2&d[o]?_:-_),m[3*o+2]=e[2]+(4&d[o]?_:-_),o>0&&y.push(o-1,o);(0,a.projectBuffer)(m,this._originSR,0,m,n.renderSpatialReference,0,h);const w=new u.V(this._material,[[p.r.POSITION,new l.n(m,y,3,!0)]],null,c.X.Line);i.add(w),s.addGeometry(w)}get test(){}}const y=(0,s.vt)()},47396:(e,t,n)=>{n.d(t,{M0:()=>o,U7:()=>a,yF:()=>s});var i=n(26266),r=n(70576);function s(e){return(0,i.isSupported)(e)||(0,r.K8)(e)}function o(e,t,n){for(var s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return(0,i.isSupported)(e)?t.apply(void 0,o):(0,r.K8)(e)?n.apply(void 0,o):null}const a=1e5},49008:(e,t,n)=>{n.d(t,{Ir:()=>u});var i=n(32006),r=n(98080),s=n(60548),o=n(24646),a=n(15025),l=n(34927),c=n(16878);function u(e){e.fragment.uniforms.add(new l.I("projInfo",(e=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,s.s)(d,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,s.s)(d,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(e.camera)))),e.fragment.uniforms.add(new a.E("zScale",(e=>0===e.camera.projectionMatrix[11]?(0,i.hZ)(f,0,1):(0,i.hZ)(f,1,0)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const d=(0,o.vt)();const f=(0,r.vt)()},49315:(e,t,n)=>{n.d(t,{d:()=>p});var i,r,s=n(93800),o=n(58828),a=(n(21265),n(50925)),l=n(17741),c=n(49959),u=n(79953),d=n(48602),f=(n(14746),n(75269)),h=n(50907);(r=i||(i={}))[r.PENDING=0]="PENDING",r[r.WAIT_FOR_VIEW_READY=1]="WAIT_FOR_VIEW_READY",r[r.RUNNING=2]="RUNNING";let p=class extends h.j{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.analysisView=null,this._reconnectViewTask=null,this._parentChangeFromReconnect=!1,this._startUserOperation=null;const t=e?.analysis;null!=t?this.analysis=t:(this._set("analysis",this.constructAnalysis()),this._set("isAnalysisOwner",!0))}normalizeCtorArgs(e){const{analysis:t,...n}=e;return n}initialize(){this.addHandles([(0,u.watch)((()=>this.analysis?.parent),(e=>{this._parentChangeFromReconnect||e===this.view||this._set("isAnalysisOwner",!1);const t=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,t&&this._scheduleViewReconnect()}),u.sync),(0,u.watch)((()=>({view:this.view,ready:null!=this.view&&this.view.ready,supported:this.supported})),((e,t)=>{let{view:n}=e;const i=t?.view;n!==i&&(this._startUserOperation=(0,l.DC)(this._startUserOperation),this._disconnectFromView(i)),this._scheduleViewReconnect()}),u.syncAndInitial),(0,u.watch)((()=>this.analysis.isEditable),((e,t)=>{null!=this.analysisView&&(e&&!t&&null==this.tool?this.createTool():e||!t||null==this.tool||this.tool.active||this.removeTool())}))])}destroy(){this._reconnectViewTask=(0,l.DC)(this._reconnectViewTask),this._startUserOperation=(0,l.DC)(this._startUserOperation),null!=this.analysisView&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),null!=this.analysis&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set("analysis",null))}set analysis(e){e!==this._get("analysis")&&(this._startUserOperation=(0,l.DC)(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(e),this._scheduleViewReconnect())}get ready(){return null!=this.analysisView&&!this.connectingToView}get connectingToView(){return null!=this._reconnectViewTask}get isAnalysisOwner(){return this._get("isAnalysisOwner")}set visible(e){this._set("visible",e),null!=this.analysisView&&(this.analysisView.visible=e)}async start(){if(!this.visible)return void a.A.getLogger(this).warn("Cannot start analysis when not visible");this.clear();const e={task:null,abort:null,state:i.PENDING},t=(0,o.UT)((async t=>{e.state=i.WAIT_FOR_VIEW_READY,await(0,u.whenOnce)((()=>this.ready),t),e.state=i.RUNNING,this.createTool({interactive:!0})}));return e.task=t,e.abort=()=>t.abort(),this._startUserOperation=e,t.promise}clear(){this._startUserOperation=(0,l.DC)(this._startUserOperation),this.removeTool(),this.analysis.clear()}onConnectToAnalysisView(e){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=(0,l.DC)(this._reconnectViewTask);const e=(0,o.UT)((async t=>{try{await this._reconnectView(t)}catch(n){if((0,c.throwIfAborted)(t),!(0,c.isAbortError)(n))return void a.A.getLogger(this).warn("Failed to use analysis in view model",n);throw n}finally{e===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=e}async _reconnectView(e){const{view:t}=this,n=null!=t&&t.ready&&this.supported,i=this.analysis;if(this._startUserOperation=g(this._startUserOperation),this._disconnectFromView(t),n&&null!=t&&null!=i){if(this.isAnalysisOwner){if(null!=i.parent)return void this.logError("expected owned analysis to have null parent when connecting to view");this._parentChangeFromReconnect=!0,t.analyses.add(i)}this.analysisView=await t.whenAnalysisView(i),(0,c.isAborted)(e)?this._startUserOperation=g(this._startUserOperation):(this.analysisView.visible=this.visible,this.onConnectToAnalysisView(this.analysisView),this.createTool())}}_disconnectFromView(e){this.removeTool(),null!=e&&this.isAnalysisOwner&&(this._parentChangeFromReconnect=!0,e.analyses.remove(this.analysis),this.analysis.clear()),this.analysisView=null,this.onDisconnectFromAnalysisView()}_setExternalAnalysis(e){null==this.analysisView||this.isAnalysisOwner||(this.analysisView.visible=!0),this.analysisView=null,this._set("isAnalysisOwner",!1),this._set("analysis",e),this._parentChangeFromReconnect=!1}get testInfo(){}};function g(e){return null!=e&&e.state>=i.RUNNING?(e.abort(),null):e}(0,s._)([(0,d.MZ)({nonNullable:!0})],p.prototype,"analysis",null),(0,s._)([(0,d.MZ)()],p.prototype,"analysisView",void 0),(0,s._)([(0,d.MZ)()],p.prototype,"ready",null),(0,s._)([(0,d.MZ)()],p.prototype,"connectingToView",null),(0,s._)([(0,d.MZ)({readOnly:!0})],p.prototype,"isAnalysisOwner",null),(0,s._)([(0,d.MZ)({type:Boolean,value:!0})],p.prototype,"visible",null),(0,s._)([(0,d.MZ)()],p.prototype,"_reconnectViewTask",void 0),p=(0,s._)([(0,f.$)("esri.widgets.support.InteractiveAnalysisViewModel")],p)},50190:(e,t,n)=>{n.d(t,{I2:()=>v,Kf:()=>y,Uk:()=>x,ai:()=>w,au:()=>h,fe:()=>_,nG:()=>g,nu:()=>m,sE:()=>p,uw:()=>i});var i,r,s=n(87752),o=n(10382),a=n(28473),l=n(42276),c=n(67093),u=n(49807),d=n(96504),f=n(22131);function h(e,t,n,i,r,s,o,a,l,u,d){const f=b[d.mode];let h,p,g=0;if((0,c.projectBuffer)(e,t,n,i,l.spatialReference,r,a))return f?.requiresAlignment(d)?(g=f.applyElevationAlignmentBuffer(i,r,s,o,a,l,u,d),h=s,p=o):(h=i,p=r),(0,c.projectBuffer)(h,l.spatialReference,p,s,u.spatialReference,o,a)?g:void 0}function p(e,t,n,i,r){const s=((0,u.v)(e)?e.z:(0,d.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":{const n=(0,d.R1)(t,e,"ground")??0;return r.verticalDistanceToGround=0,r.sampledElevation=n,void(r.z=n)}case"relative-to-ground":{const o=(0,d.R1)(t,e,"ground")??0,a=n.geometryZWithOffset(s,i);return r.verticalDistanceToGround=a,r.sampledElevation=o,void(r.z=a+o)}case"relative-to-scene":{const o=(0,d.R1)(t,e,"scene")??0,a=n.geometryZWithOffset(s,i);return r.verticalDistanceToGround=a,r.sampledElevation=o,void(r.z=a+o)}case"absolute-height":{const o=n.geometryZWithOffset(s,i),a=(0,d.R1)(t,e,"ground")??0;return r.verticalDistanceToGround=o-a,r.sampledElevation=a,void(r.z=o)}default:return void(r.z=0)}}function g(e,t,n,i){return p(e,t,n,i,A),A.z}function v(e,t,n){return"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?null==t||null==n?e.definedChanged:i.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function y(e){return"absolute-height"!==e}function _(e,t,n,i,r){p(t,n,r,i,A),w(e,A.verticalDistanceToGround);const o=A.sampledElevation,a=(0,s.C)(O,e.transformation);return E[0]=t.x,E[1]=t.y,E[2]=A.z,(0,l.l)(t.spatialReference,E,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),o}function w(e,t){for(let n=0;n<e.geometries.length;++n){const i=e.geometries[n].getMutableAttribute(f.r.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[n],f.r.CENTEROFFSETANDDISTANCE))}}class x{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(r=i||(i={}))[r.NONE=0]="NONE",r[r.UPDATE=1]="UPDATE",r[r.RECREATE=2]="RECREATE";const b={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let u=0;u<r;++u){const r=e[t],s=e[t+1],o=e[t+2];n[i]=r,n[i+1]=s,n[i+2]=null==c?o+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s){let o=0;const a=s.spatialReference;t*=3,i*=3;for(let l=0;l<r;++l){const r=e[t],l=e[t+1],c=e[t+2],u=s.getElevation(r,l,c,a,"ground")??0;o+=u,n[i]=r,n[i+1]=l,n[i+2]=u,t+=3,i+=3}return o/r},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;t*=3,i*=3;for(let f=0;f<r;++f){const r=e[t],o=e[t+1],a=e[t+2],f=s.getElevation(r,o,a,d,"ground")??0;l+=f,n[i]=r,n[i+1]=o,n[i+2]=null==u?a+f+c:f+c,t+=3,i+=3}return l/r},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,i,r,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;t*=3,i*=3;for(let f=0;f<r;++f){const r=e[t],o=e[t+1],a=e[t+2],f=s.getElevation(r,o,a,d,"scene")??0;l+=f,n[i]=r,n[i+1]=o,n[i+2]=null==u?a+f+c:f+c,t+=3,i+=3}return l/r},requiresAlignment:()=>!0}},O=(0,o.vt)(),A=new x,E=(0,a.vt)()},54382:(e,t,n)=>{n.d(t,{k:()=>a});var i=n(93800),r=n(79953),s=(n(50925),n(21265),n(14746),n(74719),n(75269)),o=n(88204);let a=class extends o.g{constructor(e){super(e)}initialize(){this.addHandles((0,r.watch)((()=>this.analysisViewData.visible),(e=>this.visible=e),r.syncAndInitial))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};a=(0,i._)([(0,s.$)("esri.views.interactive.AnalysisToolBase")],a)},61073:(e,t,n)=>{n.d(t,{l:()=>o});n(21265),n(50925);var i=n(89227),r=n(23278),s=n(43536);class o extends s.m{constructor(e,t,n,i){super(i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.n.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof o&&(0,i.p)(this.previousVertex,e.previousVertex)&&(0,i.p)(this.centerVertex,e.centerVertex)&&(0,i.p)(this.nextVertex,e.nextVertex)}}},61315:(e,t,n)=>{n.d(t,{G:()=>s});var i=n(73031),r=n(826);class s extends r.n{constructor(e,t){super(e,"vec2",i.c.Pass,((n,i,r)=>n.setUniform2fv(e,t(i,r))))}}},62240:(e,t,n)=>{function i(e,t,n,i){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:i,type:"point"}}function r(e,t,n,i,r){e.x=t,e.y=n,e.z=i,e.hasZ=null!=i,e.spatialReference=r}n.d(t,{J:()=>r,T:()=>i})},65022:(e,t,n)=>{n.d(t,{c:()=>o});n(21265),n(50925);var i=n(89227),r=n(23278),s=n(43536);class o extends s.m{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.n.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,s),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,i.p)(this.lineStart,e.lineStart)&&(0,i.p)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,i.j)(this.lineStart,this.lineEnd)}}},66195:(e,t,n)=>{n.d(t,{Q:()=>f,R:()=>d});var i=n(7815),r=n(95206),s=n(35490),o=n(34927),a=n(4241),l=n(42403),c=n(16878),u=n(22131);const d=.5;function f(e,t){e.include(r.Y6),e.attributes.add(u.r.POSITION,"vec3"),e.attributes.add(u.r.NORMAL,"vec3"),e.attributes.add(u.r.CENTEROFFSETANDDISTANCE,"vec4");const n=e.vertex;(0,s.NB)(n,t),(0,s.yu)(n,t),n.uniforms.add(new o.I("viewport",(e=>e.camera.fullViewport)),new l.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.U("cameraGroundRelative",(e=>e.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,i.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add(c.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),n.code.add(c.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?c.H.float(0):c.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,s.S7)(n),t.draped||(n.uniforms.add(new a.U("perDistancePixelRatio",(e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2)))),n.code.add(c.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${c.H.float(d)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,s.Nz)(n),t.hasScreenSizePerspective&&(0,r.OH)(n),n.code.add(c.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?c.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":c.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},67095:(e,t,n)=>{n.d(t,{K:()=>s});var i=n(59139),r=n(16878);function s(e){e.uniforms.add(new i.o("alignPixelEnabled",(e=>e.alignPixelEnabled))),e.code.add(r.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(r.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},69436:(e,t,n)=>{var i;n.d(t,{D:()=>i}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}))},70755:(e,t,n)=>{n.d(t,{r:()=>o});n(21265),n(50925);var i=n(89227),r=n(23278),s=n(43536);class o extends s.m{constructor(e,t,n){super(n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.n.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&(0,i.p)(this.lineStart,e.lineStart)&&(0,i.p)(this.lineEnd,e.lineEnd)}}},71750:(e,t,n)=>{n.d(t,{KF:()=>g,MF:()=>p,VG:()=>d,g7:()=>h,gf:()=>f,hI:()=>c,o8:()=>l,q6:()=>u});var i=n(50925),r=n(49959),s=n(34156),o=n(96247);const a=()=>i.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){const t=e?.expression;if("string"==typeof t){const e=m(t);if(null!=e)return{cachedResult:e}}return null}async function u(e,t,n,i){const s=e?.expression;if("string"!=typeof s)return null;const a=m(s);if(null!=a)return{cachedResult:a};const l=await(0,o.lw)();(0,r.throwIfAborted)(n);const c=l.arcadeUtils,u=c.createSyntaxTree(s);return c.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function d(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function f(e,t){if(null!=e&&!v(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const n=t;n._geometry&&(n._geometry=(0,s.wZ)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function h(e){if(null!=e){if(v(e))return e.cachedResult;const t=e.arcade;let n=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function p(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e?.featureExpressionInfo;const i=n?.expression;return t||"0"===i||(n=null),n??null}const g={cachedResult:0};function v(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},72249:(e,t,n)=>{n.d(t,{F:()=>s});var i=n(34308),r=n(71750);class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,i.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,r.g7)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,i.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,n){if(null==e)return void(this._featureExpressionInfoContext=null);const i=e?.arcade;i&&null!=t&&null!=n?(this._featureExpressionInfoContext=(0,r.o8)(e),(0,r.gf)(this._featureExpressionInfoContext,(0,r.VG)(i.modules,t,n))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return null!=e&&t.setFromElevationInfo(e),t}}},74309:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(89227),r=n(23278),s=n(43536);class o extends s.m{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.n.ALL),this.intersectionPoint=e}equals(e){return e instanceof o&&(0,i.p)(this.intersectionPoint,e.intersectionPoint)}}},77297:(e,t,n)=>{var i,r,s;n.d(t,{O7:()=>r,Om:()=>i,sv:()=>s}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(r||(r={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(s||(s={}))},80861:(e,t,n)=>{n.d(t,{g:()=>c});var i=n(62631),r=(n(21265),n(50925)),s=n(25048),o=n(24591),a=n(92156);const l=()=>r.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,n){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,n)}static createVertex(e,t,n){return new c(e,a.NZ.ARRAY_BUFFER,t,n)}static createUniform(e,t,n){return new c(e,a.NZ.UNIFORM_BUFFER,t,n)}static createPixelPack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_READ,n=arguments.length>2?arguments[2]:void 0;const i=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return n&&i.setSize(n),i}static createPixelUnpack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_DRAW,n=arguments.length>2?arguments[2]:void 0;return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,n)}static createTransformFeedback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STATIC_DRAW,n=arguments.length>2?arguments[2]:void 0;const i=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(n),i}constructor(e,t,n,i){this._context=e,this.bufferType=t,this.usage=n,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.mg)(e)?this._indexType=a.pe.UNSIGNED_BYTE:(0,s.jq)(e)?(t/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,s.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._size=e;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),(0,o.Y2)(i),this._isVAOAware&&this._context.bindVAO(n)}setSubData(e,t,n,i){if(!e)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,n,i-n),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(r)}getSubData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n<0||r<0)return;const s=function(e){return(0,i.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((n??0)+(r??0))>e.byteLength)return;t+s*(r??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,n,r),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,n,r),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;await this._context.clientWaitAsync(),this.getSubData(e,t,n,i)}}},87688:(e,t,n)=>{n.d(t,{CL:()=>u,Gc:()=>f,OK:()=>c,s7:()=>h,uc:()=>l,zS:()=>d});var i=n(89227),r=n(28473),s=n(89476),o=n(11741),a=n(33365);function l(e,t){const n=(0,s.a)(t);(0,i.i)(n,0,0,0);for(let s=0;s<e.length;++s)(0,i.g)(n,n,e[s]);(0,i.h)(n,n,1/e.length);let r=0;for(let s=0;s<e.length;++s)r=Math.max(r,(0,i.s)(n,e[s]));t[3]=Math.sqrt(r)}function c(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");(0,o.e9)(e[0],e[1],e[2],t)}function u(e,t){return(0,i.f)(e,t)+e[3]}function d(e,t,n,r){const s=p;return(0,i.c)(s.rings[0][0],e),(0,i.c)(s.rings[0][1],t),(0,i.c)(s.rings[0][2],n),(0,i.c)(s.rings[0][3],e),s.spatialReference=r,(0,a.P)(s)}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return!1;for(let n=0;n<e.length;++n)if((0,i.f)(t,e[n])<-1e-6)return!1;return!0};if(0===e.length)return!1;if(1===e.length)return t&&(0,i.c)(t,e[0]),!0;(0,i.i)(g,0,0,0);for(let s=0;s<e.length;++s)(0,i.g)(g,g,e[s]);if((0,i.n)(g,g),r(e,g))return t&&(0,i.c)(t,g),!0;if(!n)return!1;for(let s=0;s<e.length;++s)for(let n=0;n<e.length;++n)if(s!==n&&((0,i.e)(g,e[s],e[n]),(0,i.n)(g,g),r(e,g)))return t&&(0,i.c)(t,g),!0;return!1}function h(e){return"mouse"!==e.pointerType||0===e.button}const p={hasM:!1,hasZ:!0,rings:[[(0,r.vt)(),(0,r.vt)(),(0,r.vt)(),(0,r.vt)()]],spatialReference:null,type:"polygon"},g=(0,r.vt)()},89659:(e,t,n)=>{n.d(t,{y:()=>c});var i=n(67095),r=n(69436),s=n(34927),o=n(4241),a=n(16878),l=n(73712);function c(e){e.vertex.uniforms.add(new o.U("renderTransparentlyOccludedHUD",(e=>e.hudRenderStyle===r.D.Occluded?1:e.hudRenderStyle===r.D.NotOccluded?0:.75)),new s.I("viewport",(e=>e.camera.fullViewport)),new l.x("hudVisibilityTexture",(e=>e.hudVisibility?.getTexture()))),e.vertex.include(i.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},95206:(e,t,n)=>{n.d(t,{OH:()=>c,Y6:()=>a,pM:()=>l});var i=n(89227),r=n(28473),s=n(57554),o=n(16878);function a(e){e.vertex.code.add(o.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(o.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new s.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new s.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,i.i)(d,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const d=(0,r.vt)()},96504:(e,t,n)=>{n.d(t,{R1:()=>o,aY:()=>r,cN:()=>s});var i=n(49807);class r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=n}}function s(e){return"array"in e}function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,i.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(s(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}}}]);