"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[60376,95252],{37623:(e,t,i)=>{i.d(t,{Of:()=>s,UR:()=>n,Ws:()=>l,bv:()=>a});const s=Symbol("ImageElementInstance"),n=Symbol("VideoElementInstance");function r(e){return null!=e&&"object"==typeof e&&s in e}function l(e){return null!=e&&"object"==typeof e&&n in e}function a(e){return r(e)||l(e)}},48818:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M});var s=i(93800),n=(i(79625),i(89129)),r=i(74719),l=(i(21265),i(50925)),a=i(45622),o=i(49959),h=i(79953),c=i(48602),d=(i(14746),i(75269)),u=i(12560),m=i(90772),p=i(73381),y=i(81387),_=i(92539),f=(i(99181),i(92744),i(7187),i(77751),i(2925),i(32195),i(83833),i(55601),i(15173),i(47800),i(76493),i(75400),i(65920),i(54824),i(77690),i(32557),i(70634),i(64682),i(42672),i(91345),i(70576),i(64855),i(31982),i(82604),i(14315),i(30748),i(69653),i(51181),i(67829),i(89393),i(66644),i(31206),i(31315),i(27458),i(90711),i(91032),i(20327),i(99079),i(71763),i(74653),i(24248),i(66317),i(14104),i(74715),i(42888),i(78129),i(25955),i(50693),i(58448),i(50552),i(39698),i(1021),i(92156),i(69008),i(24591),i(4064),i(94433),i(36573),i(60027),i(14727),i(40547),i(84316),i(64177),i(7835),i(91683),i(3172),i(23060),i(43103),i(24541),i(96652),i(44524),i(58621),i(90723),i(92508),i(82350),i(53889),i(45192),i(21971),i(75487),i(88102),i(93314),i(26427),i(1441),i(82137),i(25867),i(99067),i(79455),i(83531),i(47871),i(85099),i(4309),i(52537),i(83159),i(82545),i(11896),i(95338),i(10844),i(93321),i(55697),i(12723),i(16878),i(84964),i(6743),i(94814),i(8374),i(90030),i(65597),i(23311),i(13248),i(50765),i(33342),i(58828),i(15492),i(3046),i(84190),i(30142),i(93205),i(68693),i(16998),i(64226),i(60529),i(83652),i(47116)),v=i(95476),w=i(76488),g=i(83383),E=i(58023),b=i(84279),S=i(95252),R=i(19565);let C=class extends((0,E.e)((0,S.default)(b.default))){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this._interaction=null,this.layer=null,this.elements=new n.default}initialize(){this.addHandles([(0,h.watch)((()=>[this.interactive,this.suspended]),(async()=>{if(this.interactive&&!this._interaction){const{MediaLayerInteraction:e}=await i.e(83241).then(i.bind(i,83241));this._interaction=new e({view:this.view,layer:this.layer}),this.selectedElement!==this._interaction.selectedElement&&(this._interaction.selectedElement=this.selectedElement),this.interactionOptions!==this._interaction.options&&(this._interaction.options=this.interactionOptions)}this._interaction&&(this._interaction.enabled=!this.suspended&&this.interactive)}),h.syncAndInitial),(0,h.watch)((()=>this.interactionOptions),(e=>{this._interaction&&(this._interaction.options=e)}),h.syncAndInitial),(0,h.watch)((()=>this.selectedElement),(e=>{this._interaction&&(this._interaction.selectedElement=e)}),h.syncAndInitial)])}attach(){this.addAttachHandles([(0,h.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((e=>this._updateTile(e))),this.requestUpdate()})),(0,h.on)((()=>this.layer.effectiveSource),"change",(e=>{let{element:t}=e;return this._elementUpdateHandler(t)}))]),this._overlayContainer=new g.A,this.container.addChild(this._overlayContainer),this._fetchQueue=new f.A({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,t)=>this._queryElements(e,t),scheduler:this.scheduler,priority:R.W6.MAPVIEW_FETCH_QUEUE}),this._tileStrategy=new v.A({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,t){const i=[],s=e.normalize(),n=[s.x,s.y];for(const{elementView:{normalizedCoords:r,element:l}}of this._elementReferences.values())null!=r&&(0,p.t1)(r.rings,n)&&i.push({type:"media",element:l,layer:this.layer,mapPoint:e,sourcePoint:l.toSource(e)});return i.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updateTile(e)))}_acquireTile(e){const t=new A(e.clone());return this._updateTile(t),t}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then((t=>{const[i,s]=e.setElements(t);this._referenceElements(e,i),this._dereferenceElements(e,s),this.requestUpdate()}),(e=>{(0,o.isAbortError)(e)||l.A.getLogger(this).error(e)})))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,t){const i=this.layer.effectiveSource;if(null==i)return[];this.view.featuresTilingScheme.getTileBounds(T,e,!0);const s=new u.default({xmin:T[0],ymin:T[1],xmax:T[2],ymax:T[3],spatialReference:this.view.spatialReference});return i.queryElements(s,t)}_referenceElements(e,t){if(null!=this.layer.source)for(const i of t)this._referenceElement(e,i)}_referenceElement(e,t){(0,a.tE)(this._elementReferences,t.uid,(()=>{const e=new _._({element:t,spatialReference:this.view.spatialReference}),i=new w.A(e);return this._overlayContainer.addChild(i),this.elements.add(t),this._updatingHandles.addPromise(t.load().catch((e=>{l.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new r.default("element-load-error","Element cannot be displayed",{element:t,error:e}))}))),{debugGraphic:null,elementView:e,overlay:i,tiles:new Set}})).tiles.add(e)}_dereferenceElements(e,t){for(const i of t)this._dereferenceElement(e,i)}_dereferenceElement(e,t){const i=this._elementReferences.get(t.uid);i.tiles.delete(e),i.tiles.size||(this._overlayContainer.removeChild(i.overlay),i.overlay.destroy(),i.elementView.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),this._debugGraphicsView?.graphics.remove(i.debugGraphic))}_elementUpdateHandler(e){let t=this._elementReferences.get(e.uid);if(t){const i=t.elementView.normalizedCoords;if(null==i)return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.elementView.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(t.debugGraphic);const s=[],n=[];for(const e of this._tileStrategy.tiles){const r=x(this.view.featuresTilingScheme,e,i);t.tiles.has(e)?r||n.push(e):r&&s.push(e)}for(const t of s)this._referenceElement(t,e);for(const t of n)this._dereferenceElement(t,e);return t=this._elementReferences.get(e.uid),void(t?.debugGraphic&&(t.debugGraphic.geometry=t.elementView.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"})))}const i=new _._({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=i)for(const s of this._tileStrategy.tiles)x(this.view.featuresTilingScheme,s,i)&&this._referenceElement(s,e)}};(0,s._)([(0,c.MZ)()],C.prototype,"layer",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"elements",void 0),C=(0,s._)([(0,d.$)("esri.views.2d.layers.MediaLayerView2D")],C);const T=(0,m.vt)(),V={xmin:0,ymin:0,xmax:0,ymax:0};function x(e,t,i){return e.getTileBounds(T,t.key,!0),V.xmin=T[0],V.ymin=T[1],V.xmax=T[2],V.ymax=T[3],(0,y.fA)(V,i)}class A{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const t=[],i=new Set(this.elements);this.elements=e;for(const s of e)i.has(s)?i.delete(s):t.push(s);return this.isReady=!0,[t,Array.from(i)]}destroy(){}}const M=C},95252:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h});var s=i(93800),n=i(48602),r=(i(21265),i(50925),i(14746),i(75269)),l=i(6946);let a=class extends l.default{constructor(e){super(e),this.editSourcePoints=!1}};(0,s._)([(0,n.MZ)()],a.prototype,"editSourcePoints",void 0),a=(0,s._)([(0,r.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions.ReshapeOptions")],a);let o=class extends l.default{constructor(e){super(e),this.tool="transform",this.reshapeOptions=new a}};(0,s._)([(0,n.MZ)()],o.prototype,"tool",void 0),(0,s._)([(0,n.MZ)({type:a})],o.prototype,"reshapeOptions",void 0),o=(0,s._)([(0,r.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions")],o);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.layer=null,this.interactive=!1,this.interactionOptions=new o,this.selectedElement=null}highlight(e,t){throw new Error("missing implementation")}};return(0,s._)([(0,n.MZ)()],t.prototype,"layer",void 0),(0,s._)([(0,n.MZ)()],t.prototype,"interactive",void 0),(0,s._)([(0,n.MZ)({type:o})],t.prototype,"interactionOptions",void 0),(0,s._)([(0,n.MZ)()],t.prototype,"selectedElement",void 0),t=(0,s._)([(0,r.$)("esri.views.layers.MediaLayerView")],t),t}}}]);