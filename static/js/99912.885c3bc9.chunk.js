"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[99912],{605:(e,t,n)=>{n.d(t,{_:()=>r});class r{constructor(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=e,this.count=t,this.type=n,this.offset=r,this.stride=i,this.normalized=o,this.divisor=s}}},2925:(e,t,n)=>{n.d(t,{$:()=>w,IB:()=>l,Iy:()=>j,KV:()=>B,N2:()=>E,QP:()=>I,RH:()=>A,Vl:()=>F,Ws:()=>C,ZD:()=>O,_L:()=>U,bJ:()=>T,e$:()=>P,f6:()=>G,hw:()=>V,pW:()=>N,pf:()=>M,rs:()=>R,sn:()=>H,we:()=>D});var r=n(88102),i=n(62631),o=n(82301),s=n(64682),a=n(60548),c=n(24646);function l(e){return"r"in e&&"g"in e&&"b"in e}function u(e){return"h"in e&&"s"in e&&"v"in e}function f(e){return"l"in e&&"a"in e&&"b"in e}function d(e){return"l"in e&&"c"in e&&"h"in e}const h=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],p=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function g(e,t){const n=[];let r,i;if(e[0].length!==t.length)throw new Error("dimensions do not match");const o=e.length,s=e[0].length;let a=0;for(r=0;r<o;r++){for(a=0,i=0;i<s;i++)a+=e[r][i]*t[i];n.push(a)}return n}function v(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),n=g(h,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function m(e){const t=g(p,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function x(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function y(e){const t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function b(e){return function(e){const t=e.l,n=e.a,r=e.b,i=Math.sqrt(n*n+r*r);let o=Math.atan2(r,n);return o=o>0?o:o+2*Math.PI,{l:t,c:i,h:o}}(x(v(e)))}function _(e){return m(y(function(e){const t=e.l,n=e.c,r=e.h;return{l:t,a:n*Math.cos(r),b:n*Math.sin(r)}}(e)))}function w(e){return l(e)?e:d(e)?_(e):f(e)?function(e){return m(y(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?m(e):u(e)?function(e){const t=(e.h+360)%360/60,n=e.s/100,r=e.v/100*255,i=r*n,o=i*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:i,g:o,b:0};break;case 1:s={r:o,g:i,b:0};break;case 2:s={r:0,g:i,b:o};break;case 3:s={r:0,g:o,b:i};break;case 4:s={r:o,g:0,b:i};break;case 5:case 6:s={r:i,g:0,b:o};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+r-i),s.g=Math.round(s.g+r-i),s.b=Math.round(s.b+r-i),s}(e):e}function E(e){return u(e)?e:function(e){const t=e.r,n=e.g,r=e.b,i=Math.max(t,n,r),o=i-Math.min(t,n,r);let s=i,a=0===o?0:i===t?(n-r)/o%6:i===n?(r-t)/o+2:(t-n)/o+4,c=0===o?0:o/s;return a<0&&(a+=6),a*=60,c*=100,s*=100/255,{h:a,s:c,v:s}}(w(e))}function O(e){return f(e)?e:function(e){return x(v(e))}(w(e))}function A(e){return d(e)?e:b(w(e))}function R(e){return S(e).isBright?"light":"dark"}function S(e){let{r:t,g:n,b:i,a:o}=e;return o<1&&(t=Math.round(o*t+255*(1-o)),n=Math.round(o*n+255*(1-o)),i=Math.round(o*i+255*(1-o))),new r.default({r:t,g:n,b:i})}function C(e,t){const{r:n,g:r,b:i}=t?.ignoreAlpha?e:S(e);return.2126*n+.7152*r+.0722*i}var N,z;function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.High;return C(e,{ignoreAlpha:!0})>t?new r.default([0,0,0,e.a]):new r.default([255,255,255,e.a])}function P(e,t){const n=O(e);n.l*=1-t;const r=w(n),i=e.clone();return i.setColor(r),i.a=e.a,i}function U(e,t){const n=e.clone();return n.a*=t,n}function F(e,t){const n=E(e);n.s*=t;const r=w(n),i=e.clone();return i.setColor(r),i.a=e.a,i}function I(e){return r.default.toUnitRGBA(e)}function V(e,t){return e===t||null!=e&&e.equals(t)}function D(e,t){return e===t||null!=e&&null!=t&&(0,a.e)(e,t)}function M(e){return(0,c.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function B(e){return e[0]??=0,e[1]??=0,e[2]??=0,e}function H(e){return e.length=4,B(e),e[3]??=1,(0,s.qE)(e[3],0,1),e}function G(e,t){const n=r.default.toUnitRGBA(e);return n[3]*=t,n}function j(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length||t<=0)return[];if(1===(e=e.map((e=>"string"==typeof e?new r.default(e):e))).length||1===t){const n=[],r=e[0];for(let e=0;e<t;e++)n.push(r.clone());return n}if(n.shuffle&&(e=(0,i.k4)((0,o.clone)(e),n.seed)),e.length>=t){const n=[],r=(e.length-1)/(t-1);for(let i=0;i<t;i++){const t=Math.round(i*r);n.push(e[t].clone())}return n}return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=[],o=e.length-1,s=Math.ceil((t-e.length)/o);e:for(let i=0;i<o;i++){const o=e[i],a=e[i+1];for(let i=1;i<=s;i++){const c=i/(s+1);if(r.push(Z(o,a,c,n)),r.length+e.length===t)break e}}return[...e.map((e=>e.clone())),...(0,i.k4)(r,n.seed??1)]}(e,t,n)}(z=N||(N={}))[z.Low=160]="Low",z[z.High=225]="High";const L=(e,t)=>{const n=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+n))};function Z(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=e.r,a=e.g,c=e.b,l=t.r,u=t.g,f=t.b,d=Math.round(s+(l-s)*n),h=Math.round(a+(u-a)*n),p=Math.round(c+(f-c)*n);if(!o.offset)return new r.default([d,h,p]);const g=(0,i.Mo)(o.seed);return new r.default([L(d,g),L(h,g),L(p,g)])}},3115:(e,t,n)=>{n.r(t),n.d(t,{InternalRenderCategory:()=>i,RenderCategory:()=>r,fromRenderCoordinates:()=>u,renderCoordinateTransformAt:()=>f,toRenderCoordinates:()=>l});var r,i,o,s=n(10382),a=n(42276),c=n(67093);function l(e,t,n,r,i,o,s){return r=r||e.spatialReference,(0,c.projectBuffer)(t,r,n,i,e.renderCoordsHelper.spatialReference,o,s)?i:null}function u(e,t,n,r,i,o,s){return o=o||e.spatialReference,(0,c.projectBuffer)(t,e.renderCoordsHelper.spatialReference,n,r,o,i,s)?r:null}function f(e,t,n,r){return r||(r=(0,s.vt)()),n=n||e.spatialReference,(0,a.l)(n,t,r,e.renderCoordsHelper.spatialReference)?r:null}(o=r||(r={})).OPAQUE="opaque-color",o.TRANSPARENT="transparent-color",o.COMPOSITE="composite-color",o.FINAL="final-color",function(e){e.SSAO="ssao",e.LASERLINES="laserline-color",e.ANTIALIASING="aa-color",e.HIGHLIGHTS="highlight-color",e.MAGNIFIER="magnifier-color",e.OCCLUDED="occluded-color",e.VIEWSHED="viewshed-color",e.OPAQUE_ENVIRONMENT="opaque-environment-color",e.TRANSPARENT_ENVIRONMENT="transparent-environment-color",e.FOCUSAREA="focus-area"}(i||(i={}))},7815:(e,t,n)=>{n.d(t,{G:()=>l,V:()=>f});var r=n(60548),i=n(24646),o=n(95206),s=n(35490),a=n(94409),c=n(16878);function l(e,t){const n=e.vertex;t.hasVerticalOffset?(f(n),t.hasScreenSizePerspective&&(e.include(o.Y6),(0,o.OH)(n),(0,s.yu)(e.vertex,t)),n.code.add(c.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?c.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:c.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?c.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:c.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):n.code.add(c.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,i.vt)();function f(e){e.uniforms.add(new a.E("verticalOffset",((e,t)=>{const{minWorldLength:n,maxWorldLength:i,screenLength:o}=e.verticalOffset,s=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,r.s)(u,o*a,s,n,i)})))}},8696:(e,t,n)=>{n.d(t,{N:()=>l});var r=n(7951),i=n(93003),o=n(16434),s=n(29072),a=n(19416),c=n(12723);class l extends o.w{constructor(e,t){super(e,t,new i.$(s.a,(()=>n.e(73648).then(n.bind(n,73648)))))}initializePipeline(e){switch(e.blitMode){case a.d.None:case a.d.Depth:return(0,c.Ey)({colorWrite:c.kn});case a.d.Alpha:return(0,c.Ey)({blending:c.Ky,colorWrite:c.kn});default:(0,r.Xb)(e.blitMode);case a.d.PremultipliedAlpha:case a.d.COUNT:return(0,c.Ey)({blending:c.Os,colorWrite:c.kn})}}}},9369:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(25874);class i extends r.Z{}},9452:(e,t,n)=>{n.d(t,{Gc:()=>c,RI:()=>u,Z4:()=>l,dk:()=>d,vr:()=>f});var r=n(16804),i=n(32006),o=n(89227),s=n(91102),a=n(1696);function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.vt)();return l(e,(0,r.WA)(t),n),(0,o.n)(n.direction,n.direction),n}function l(e,t,n){return u(e,e.screenToRender(t,(0,r.sc)(a.rq.get())),n)}function u(e,t,n){const s=(0,r.sc)((0,i.C)(a.rq.get(),t));if(s[2]=0,!e.unprojectFromRenderScreen(s,n.origin))return null;const c=(0,r.sc)((0,i.C)(a.rq.get(),t));c[2]=1;const l=e.unprojectFromRenderScreen(c,a.rq.get());return null==l?null:((0,o.d)(n.direction,l,n.origin),n)}function f(e,t,n){return d(e,e.screenToRender(t,(0,r.sc)(a.rq.get())),n)}function d(e,t,n){(0,o.c)(n.origin,e.eye);const r=(0,o.i)(a.rq.get(),t[0],t[1],1),i=e.unprojectFromRenderScreen(r,a.rq.get());return null==i?null:((0,o.d)(n.direction,i,n.origin),n)}},10323:(e,t,n)=>{n.d(t,{Aw:()=>l,Jb:()=>c,Q5:()=>d,W3:()=>h,d:()=>s,db:()=>f,kV:()=>u,rb:()=>a});var r=n(92453),i=n(15828),o=n(27464);class s extends i.R6{constructor(e,t,n,r){super(t,n),this.point=e,this.createGraphic=r}}function a(e){return(0,o.i3)(e)&&e.intersector===r.dz.PCL&&!!e.target}class c extends i.HE{constructor(e,t,n,r,i){super(e),this.layerUid=e,this.sublayerUid=t,this.nodeIndex=n,this.componentIndex=r,this.triangleNr=i}}class l extends i.R6{constructor(e,t,n){super(t,null),this.point=e,this.createVoxelGraphic=n}}class u extends i.R6{constructor(e,t){super(e,null),this.createTiles3DGraphic=t}}function f(e){return(0,o.i3)(e)&&e.intersector===r.dz.I3S&&!!e.target}function d(e){return(0,o.i3)(e)&&e.intersector===r.dz.VOXEL&&!!e.target}function h(e){return(0,o.i3)(e)&&e.intersector===r.dz.TILES3D&&!!e.target}},13473:(e,t,n)=>{function r(){return[1,0,0,0,1,0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function o(e,t,n,r,i,o,s,a,c){return[e,t,n,r,i,o,s,a,c]}n.d(t,{fA:()=>o,o8:()=>i,vt:()=>r,zK:()=>s});const s=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:i,create:r,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:o},Symbol.toStringTag,{value:"Module"}))},16079:(e,t,n)=>{n.d(t,{G:()=>a});var r=n(29072),i=n(8696),o=n(19416),s=n(92156);class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.d.None;this._techniques=e,this._parameters=new r.C,this._configuration=new o.N,this._configuration.blitMode=t,e.precompile(i.N,this._configuration)}blit(e,t,n,r){e.bindFramebuffer(n.fbo),e.setClearColor(0,0,0,1),e.clear(s.NV.COLOR),this._parameters.texture=t.getTexture();const o=this._techniques.get(i.N,this._configuration);e.bindTechnique(o,r,this._parameters),e.screen.draw()}blend(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this._configuration.hasOpacityFactor=o<1;const s=this._techniques.get(i.N,this._configuration);return!!s.compiled&&(e.bindFramebuffer(n.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=o,e.bindTechnique(s,r,this._parameters),e.screen.draw(),!0)}}},18162:(e,t,n)=>{n.d(t,{F:()=>o});n(96913);var r=n(93321),i=n(31183);function o(e,t,n,r,o){return!(null==t||null==r||e.length<2)&&(s.x=e[0],s.y=e[1],s.z=e[2],s.spatialReference=t,(0,i.g)(s,n,r,o))}const s=(0,n(62240).T)(0,0,0,r.default.WGS84)},19416:(e,t,n)=>{n.d(t,{N:()=>a,d:()=>r});var r,i,o=n(93800),s=n(21484);(i=r||(r={}))[i.None=0]="None",i[i.Alpha=1]="Alpha",i[i.PremultipliedAlpha=2]="PremultipliedAlpha",i[i.Depth=3]="Depth",i[i.COUNT=4]="COUNT";class a extends s.K{constructor(){super(...arguments),this.blitMode=r.None,this.hasOpacityFactor=!1}}(0,o._)([(0,s.W)({count:r.COUNT})],a.prototype,"blitMode",void 0),(0,o._)([(0,s.W)()],a.prototype,"hasOpacityFactor",void 0)},25874:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(50925),i=n(17741),o=n(42080),s=n(92156),a=n(44480);const c=()=>r.A.getLogger("esri.views.webgl.VertexArrayObject");let l=class{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=n,this._buffers=r,this._indexBuffer=i,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(this._buffers.size+(this._indexBuffer?1:0))*o.i5}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,i.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&c().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:n}=this;e||c().error("Vertex buffer dictionary is empty!");const r=this._context.gl;this._buffers.forEach(((e,n)=>{const r=t.get(n);r?(0,a.yu)(this._context,this._locations,e,r):c().error("Vertex element descriptor is empty!")})),null!=n&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},29072:(e,t,n)=>{n.d(t,{C:()=>h,a:()=>g,b:()=>p});var r=n(37379),i=n(33273),o=n(42162),s=n(15025),a=n(42403),c=n(16878),l=n(67058),u=n(19416),f=n(20783),d=n(8118);class h extends f.Y{constructor(){super(...arguments),this.opacity=1}}function p(e){const t=new d.N5;t.include(r.c),t.fragment.uniforms.add(new l.N("tex",(e=>e.texture))),e.hasOpacityFactor&&t.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity)));const n=e.blitMode===u.d.Depth;return n&&(t.fragment.uniforms.add(new s.E("nearFar",(e=>e.camera.nearFar))),t.fragment.include(i.E),t.fragment.include(o.W)),t.fragment.main.add(c.H`
    ${n?c.H`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:c.H`
          fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};`}`),t}const g=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h,build:p},Symbol.toStringTag,{value:"Module"}))},31183:(e,t,n)=>{n.d(t,{W:()=>a,g:()=>s});var r=n(28473),i=n(96913),o=n(67093);function s(e,t,n,r){if((0,i.canProjectWithoutEngine)(e.spatialReference,n)){c[0]=e.x,c[1]=e.y;const i=e.z;return c[2]=i??r??0,(0,o.projectBuffer)(c,e.spatialReference,0,t,n,0)}const s=(0,i.tryProjectWithZConversion)(e,n);return!!s&&(t[0]=s?.x,t[1]=s?.y,t[2]=s?.z??r??0,!0)}async function a(e,t,n,r,o){return await(0,i.initializeProjection)(e.spatialReference,n,null,o),s(e,t,n,r)}const c=(0,r.vt)()},37379:(e,t,n)=>{n.d(t,{c:()=>o});var r=n(16878),i=n(22131);function o(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.attributes.add(i.r.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.main.add(r.H`
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?r.H`uv = position * 0.5 + vec2(0.5);`:""}
  `)}},41317:(e,t,n)=>{n.d(t,{$7:()=>A,B:()=>O,Fo:()=>_,M7:()=>C,NN:()=>d,Q5:()=>w,Tq:()=>z,Up:()=>E,XF:()=>S,Ze:()=>m,bK:()=>a,bh:()=>f,id:()=>x,ky:()=>u,qt:()=>N,tW:()=>R,v9:()=>h,w7:()=>c,wF:()=>s,wS:()=>y,wz:()=>g,x:()=>p,xS:()=>b,ze:()=>l});var r=n(84190),i=n(34308);function o(e){return e?N:z}function s(e,t){return t?.mode?t.mode:o(e).mode}function a(e,t){return null!=t?t:o(e)}function c(e,t){return s(null==e||(e.hasZ??!1),t)}function l(e,t){return a(null==e||(e.hasZ??!1),t)}function u(e){const t=v(e);return c(e.geometry,t)}function f(e){const t=v(e),n=c(e.geometry,t),r=null!=t&&"on-the-ground"!==n?C(t):0,i=t?.featureExpressionInfo;return{mode:n,offset:r,featureExpressionInfo:i}}function d(e){return g(f(e))}function h(e){return g(e)||p(e)}function p(e){return"0"===e?.featureExpressionInfo?.expression}function g(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function v(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function m(e,t){if(!e?.offset)return 0;const{offset:n,unit:i}=e;if("decimal-degrees"===i)return 0;const o="unknown"!==i&&i?i:"meters",s=(0,r.mq)(t);return s?(0,r.oU)(n,o,s):0}function x(e,t,n){if(!n?.mode)return;const r=e.hasZ?e.z:0,i=m(n,e.spatialReference);switch(n.mode){case"absolute-height":return r-i;case"on-the-ground":return 0;case"relative-to-ground":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"ground")??0)+i);case"relative-to-scene":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"scene")??0)+i)}}function y(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,r)}function b(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return _(e,t[0],t[1],t.length>2?t[2]:0,n,r,i)}function _(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==o)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:c}=w(t,n,r,i,e,o);return function(e,t,n,r,i,o,s,a){const c=m(s,i);switch(a){case"absolute-height":return e-c;case"relative-to-ground":return e-((o.elevationProvider.getElevation(t,n,r,i,"ground")??0)+c);case"relative-to-scene":return e-((o.elevationProvider.getElevation(t,n,r,i,"scene")??0)+c)}}(c,t,n,r,i,e,s,a)}function w(e,t,n,r,i,o){const s=m(o,r);switch(o.mode){case"absolute-height":return{absoluteZ:n+s,elevation:0};case"on-the-ground":{const n=i.elevationProvider.getElevation(e,t,0,r,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const o=i.elevationProvider.getElevation(e,t,n,r,"ground")??0;return{absoluteZ:n+o+s,elevation:o}}case"relative-to-scene":{const o=i.elevationProvider.getElevation(e,t,n,r,"scene")??0;return{absoluteZ:n+o+s,elevation:o}}}}function E(e,t){if(null==t)return!1;const{mode:n}=t;return null!=n&&("scene"===e&&"relative-to-scene"===n||"ground"===e&&"absolute-height"!==n)}function O(e,t,n){return n&&n.mode!==t?`${e} only support ${t} elevation mode`:null}function A(e,t,n){return n?.mode===t?`${e} do not support ${t} elevation mode`:null}function R(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function S(e,t){t&&e.warn(".elevationInfo=",t)}function C(e){return(e?.offset??0)*(0,i.Ao)(e?.unit)}const N={mode:"absolute-height",offset:0},z={mode:"on-the-ground",offset:null}},42080:(e,t,n)=>{n.d(t,{$B:()=>i,Qf:()=>l,Qh:()=>a,RS:()=>o,ez:()=>d,i5:()=>h,lM:()=>s,qK:()=>f,rq:()=>u});var r=n(25048);function i(e){return 32+e.length}const o=16;function s(e){if(!e)return 0;let t=f;for(const n in e)e.hasOwnProperty(n)&&(t+=c(e[n],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return l(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return u(e,8);let n=d;for(let r=0;r<t;r++)n+=c(e[r]);return n}(e);let t=f;for(const n in e)e.hasOwnProperty(n)&&(t+=c(e[n]));return t}function c(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?a(e):f;case"string":return i(e);case"number":return o;case"boolean":return 4;default:return 8}}function l(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>e+(t?(0,r.iu)(t)?t.byteLength+h:Array.isArray(t)?u(t,o):0:0)),0)}function u(e,t){return d+e.length*t}const f=32,d=16,h=145},49008:(e,t,n)=>{n.d(t,{Ir:()=>u});var r=n(32006),i=n(98080),o=n(60548),s=n(24646),a=n(15025),c=n(34927),l=n(16878);function u(e){e.fragment.uniforms.add(new c.I("projInfo",(e=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,o.s)(f,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,o.s)(f,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(e.camera)))),e.fragment.uniforms.add(new a.E("zScale",(e=>0===e.camera.projectionMatrix[11]?(0,r.hZ)(d,0,1):(0,r.hZ)(d,1,0)))),e.fragment.code.add(l.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const f=(0,s.vt)();const d=(0,i.vt)()},50190:(e,t,n)=>{n.d(t,{I2:()=>v,Kf:()=>x,Uk:()=>_,ai:()=>b,au:()=>h,fe:()=>y,nG:()=>g,nu:()=>m,sE:()=>p,uw:()=>r});var r,i,o=n(87752),s=n(10382),a=n(28473),c=n(42276),l=n(67093),u=n(49807),f=n(96504),d=n(22131);function h(e,t,n,r,i,o,s,a,c,u,f){const d=w[f.mode];let h,p,g=0;if((0,l.projectBuffer)(e,t,n,r,c.spatialReference,i,a))return d?.requiresAlignment(f)?(g=d.applyElevationAlignmentBuffer(r,i,o,s,a,c,u,f),h=o,p=s):(h=r,p=i),(0,l.projectBuffer)(h,c.spatialReference,p,o,u.spatialReference,s,a)?g:void 0}function p(e,t,n,r,i){const o=((0,u.v)(e)?e.z:(0,f.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":{const n=(0,f.R1)(t,e,"ground")??0;return i.verticalDistanceToGround=0,i.sampledElevation=n,void(i.z=n)}case"relative-to-ground":{const s=(0,f.R1)(t,e,"ground")??0,a=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=a,i.sampledElevation=s,void(i.z=a+s)}case"relative-to-scene":{const s=(0,f.R1)(t,e,"scene")??0,a=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=a,i.sampledElevation=s,void(i.z=a+s)}case"absolute-height":{const s=n.geometryZWithOffset(o,r),a=(0,f.R1)(t,e,"ground")??0;return i.verticalDistanceToGround=s-a,i.sampledElevation=a,void(i.z=s)}default:return void(i.z=0)}}function g(e,t,n,r){return p(e,t,n,r,O),O.z}function v(e,t,n){return"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?null==t||null==n?e.definedChanged:r.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function x(e){return"absolute-height"!==e}function y(e,t,n,r,i){p(t,n,i,r,O),b(e,O.verticalDistanceToGround);const s=O.sampledElevation,a=(0,o.C)(E,e.transformation);return A[0]=t.x,A[1]=t.y,A[2]=O.z,(0,c.l)(t.spatialReference,A,a,r.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function b(e,t){for(let n=0;n<e.geometries.length;++n){const r=e.geometries[n].getMutableAttribute(d.r.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[n],d.r.CENTEROFFSETANDDISTANCE))}}class _{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(i=r||(r={}))[i.NONE=0]="NONE",i[i.UPDATE=1]="UPDATE",i[i.RECREATE=2]="RECREATE";const w={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,a){const c=a.calculateOffsetRenderUnits(s),l=a.featureExpressionInfoContext;t*=3,r*=3;for(let u=0;u<i;++u){const i=e[t],o=e[t+1],s=e[t+2];n[r]=i,n[r+1]=o,n[r+2]=null==l?s+c:c,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o){let s=0;const a=o.spatialReference;t*=3,r*=3;for(let c=0;c<i;++c){const i=e[t],c=e[t+1],l=e[t+2],u=o.getElevation(i,c,l,a,"ground")??0;s+=u,n[r]=i,n[r+1]=c,n[r+2]=u,t+=3,r+=3}return s/i},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,a){let c=0;const l=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,f=o.spatialReference;t*=3,r*=3;for(let d=0;d<i;++d){const i=e[t],s=e[t+1],a=e[t+2],d=o.getElevation(i,s,a,f,"ground")??0;c+=d,n[r]=i,n[r+1]=s,n[r+2]=null==u?a+d+l:d+l,t+=3,r+=3}return c/i},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,a){let c=0;const l=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,f=o.spatialReference;t*=3,r*=3;for(let d=0;d<i;++d){const i=e[t],s=e[t+1],a=e[t+2],d=o.getElevation(i,s,a,f,"scene")??0;c+=d,n[r]=i,n[r+1]=s,n[r+2]=null==u?a+d+l:d+l,t+=3,r+=3}return c/i},requiresAlignment:()=>!0}},E=(0,s.vt)(),O=new _,A=(0,a.vt)()},54232:(e,t,n)=>{n.d(t,{DC:()=>s,MQ:()=>a,mi:()=>c});var r=n(92453),i=n(15828),o=n(27464);function s(e){return(0,o.i3)(e)&&e.intersector===r.dz.TERRAIN&&!!e.target}class a extends i.R6{constructor(e,t,n){super(e,t),this.triangleNr=n}}function c(e){return(0,o.i3)(e)&&e.intersector===r.dz.OVERLAY&&!!e.target}},54407:(e,t,n)=>{n.d(t,{FI:()=>h,FV:()=>f,Gy:()=>d,QS:()=>m,SM:()=>v});var r=n(87752),i=n(28473),o=n(4309),s=n(89476),a=n(10323),c=n(54232),l=n(27464),u=n(99855);function f(e,t){return(0,l.$I)(e)||(0,l.hH)(e)?g(e.target?.object,t):(0,c.DC)(e)?t.map?.ground:(0,a.rb)(e)||(0,a.db)(e)||(0,c.mi)(e)||(0,a.Q5)(e)?g(e.target,t):null}function d(e,t){const n=h(e,t);return null!=n&&"graphic"===n.type?n.graphic:null}function h(e,t){if(null==e)return null;if((0,l.$I)(e)||(0,l.hH)(e))return p(e.target?.object,t);if((0,a.rb)(e)){const t=e.target.createGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.Q5)(e)){const t=e.target.createVoxelGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.W3)(e)){const t=e.target.createTiles3DGraphic();return{type:"graphic",graphic:t,layer:t.layer}}return(0,c.mi)(e)||(0,u.H)(e)?p(e.target,t):(0,a.db)(e)?function(e,t){const n=g(e,t);if(null==n)return null;const r=t.allLayerViews.find((e=>e.layer===n));return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?function(e){return null!=e?{type:"graphic",graphic:e,layer:e.layer}:null}(r.getGraphicFromIntersectorTarget(e)):null}(e.target,t):null}function p(e,t){if(null==e?.graphicUid)return null;const n=g(e,t);if(null==n)return null;if(n===t.graphics)return null==t.graphicsView||"number"!=typeof e.graphicUid?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find((e=>e.layer===n));return!r||r.suspended||null==e.graphicUid?null:"getHit"in r?r.getHit(e.graphicUid):null}function g(e,t){return null==e?.layerUid?null:null!=t.graphicsView&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.allLayers.find((t=>t.uid===e.layerUid))}function v(e,t){if((0,l.$I)(e)||(0,l.hH)(e))return(0,s.g)(e.target.object.boundingVolumeWorldSpace.bounds);if((0,u.H)(e)){(0,r.IL)(x,e.transformation);const t=Math.max(x[0],x[1],x[2]);return e.target.baseBoundingSphere.radius*t}if((0,a.db)(e)){const n=function(e,t){const n=g(e,t);if(null==n)return null;const r=t.allLayerViews.find((e=>e.layer===n));return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}(e.target,t);return n?.5*(0,o._F)(n):null}return null}function m(e){return!(0,l.$I)(e)&&!(0,l.hH)(e)&&((0,u.H)(e)?e.target.numLodLevels>1:!!(0,a.db)(e))}const x=(0,i.vt)()},59139:(e,t,n)=>{n.d(t,{o:()=>o});var r=n(73031),i=n(826);class o extends i.n{constructor(e,t){super(e,"bool",r.c.Bind,((n,r)=>n.setUniform1b(e,t(r))))}}},61315:(e,t,n)=>{n.d(t,{G:()=>o});var r=n(73031),i=n(826);class o extends i.n{constructor(e,t){super(e,"vec2",r.c.Pass,((n,r,i)=>n.setUniform2fv(e,t(r,i))))}}},62240:(e,t,n)=>{function r(e,t,n,r){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:r,type:"point"}}function i(e,t,n,r,i){e.x=t,e.y=n,e.z=r,e.hasZ=null!=r,e.spatialReference=i}n.d(t,{J:()=>i,T:()=>r})},62650:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r=n(93800),i=n(6946),o=n(74719),s=n(79953),a=n(48602),c=n(75269),l=n(3115),u=n(71723);let f=class extends i.default{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=l.RenderCategory.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([(0,s.watch)((()=>this.view.ready),(e=>{e&&this.view._stage?.renderer.addRenderNode(this)}),s.initial)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new o.default("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}get techniques(){return this.view._stage.renderView.techniques}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===u.C7.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){return this.view._stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find((e=>{let{name:t}=e;return t===this.produces}));try{return this.render(e)}finally{this._frameBuffer=null}}};(0,r._)([(0,a.MZ)({constructOnly:!0})],f.prototype,"view",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],f.prototype,"consumes",void 0),(0,r._)([(0,a.MZ)()],f.prototype,"produces",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],f.prototype,"techniques",null),f=(0,r._)([(0,c.$)("esri.views.3d.webgl.RenderNode")],f);const d=f},66195:(e,t,n)=>{n.d(t,{Q:()=>d,R:()=>f});var r=n(7815),i=n(95206),o=n(35490),s=n(34927),a=n(4241),c=n(42403),l=n(16878),u=n(22131);const f=.5;function d(e,t){e.include(i.Y6),e.attributes.add(u.r.POSITION,"vec3"),e.attributes.add(u.r.NORMAL,"vec3"),e.attributes.add(u.r.CENTEROFFSETANDDISTANCE,"vec4");const n=e.vertex;(0,o.NB)(n,t),(0,o.yu)(n,t),n.uniforms.add(new s.I("viewport",(e=>e.camera.fullViewport)),new c.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.U("cameraGroundRelative",(e=>e.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,r.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add(l.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),n.code.add(l.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?l.H.float(0):l.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,o.S7)(n),t.draped||(n.uniforms.add(new a.U("perDistancePixelRatio",(e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2)))),n.code.add(l.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${l.H.float(f)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,o.Nz)(n),t.hasScreenSizePerspective&&(0,i.OH)(n),n.code.add(l.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?l.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":l.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},67095:(e,t,n)=>{n.d(t,{K:()=>o});var r=n(59139),i=n(16878);function o(e){e.uniforms.add(new r.o("alignPixelEnabled",(e=>e.alignPixelEnabled))),e.code.add(i.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(i.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},69436:(e,t,n)=>{var r;n.d(t,{D:()=>r}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},69681:(e,t,n)=>{n.d(t,{S:()=>a});var r=n(28473),i=n(67093),o=n(90772),s=n(70576);function a(e,t,n,r){return null!=e&&((0,s.aI)(t,r)?((0,o.C)(n,e),!0):(c[0]=e[0],c[1]=e[1],c[2]=0,!!(0,i.projectBuffer)(c,t,0,c,r,0)&&(n[0]=c[0],n[1]=c[1],c[0]=e[2],c[1]=e[3],c[2]=0,!!(0,i.projectBuffer)(c,t,0,c,r,0)&&(n[2]=c[0],n[3]=c[1],!0))))}const c=(0,r.vt)()},71750:(e,t,n)=>{n.d(t,{KF:()=>g,MF:()=>p,VG:()=>f,g7:()=>h,gf:()=>d,hI:()=>l,o8:()=>c,q6:()=>u});var r=n(50925),i=n(49959),o=n(34156),s=n(96247);const a=()=>r.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function c(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function l(e){const t=e?.expression;if("string"==typeof t){const e=m(t);if(null!=e)return{cachedResult:e}}return null}async function u(e,t,n,r){const o=e?.expression;if("string"!=typeof o)return null;const a=m(o);if(null!=a)return{cachedResult:a};const c=await(0,s.lw)();(0,i.throwIfAborted)(n);const l=c.arcadeUtils,u=l.createSyntaxTree(o);return l.dependsOnView(u)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:l.createFunction(u),context:l.createExecContext(null,{sr:t}),modules:c}}}function f(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function d(e,t){if(null!=e&&!v(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const n=t;n._geometry&&(n._geometry=(0,o.wZ)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function h(e){if(null!=e){if(v(e))return e.cachedResult;const t=e.arcade;let n=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function p(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e?.featureExpressionInfo;const r=n?.expression;return t||"0"===r||(n=null),n??null}const g={cachedResult:0};function v(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},72249:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(34308),i=n(71750);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,r.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,i.g7)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,r.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,n){if(null==e)return void(this._featureExpressionInfoContext=null);const r=e?.arcade;r&&null!=t&&null!=n?(this._featureExpressionInfoContext=(0,i.o8)(e),(0,i.gf)(this._featureExpressionInfoContext,(0,i.VG)(r.modules,t,n))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return null!=e&&t.setFromElevationInfo(e),t}}},80861:(e,t,n)=>{n.d(t,{g:()=>l});var r=n(62631),i=(n(21265),n(50925)),o=n(25048),s=n(24591),a=n(92156);const c=()=>i.A.getLogger("esri.views.webgl.BufferObject");class l{static createIndex(e,t,n){return new l(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,n)}static createVertex(e,t,n){return new l(e,a.NZ.ARRAY_BUFFER,t,n)}static createUniform(e,t,n){return new l(e,a.NZ.UNIFORM_BUFFER,t,n)}static createPixelPack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_READ,n=arguments.length>2?arguments[2]:void 0;const r=new l(e,a.NZ.PIXEL_PACK_BUFFER,t);return n&&r.setSize(n),r}static createPixelUnpack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_DRAW,n=arguments.length>2?arguments[2]:void 0;return new l(e,a.NZ.PIXEL_UNPACK_BUFFER,t,n)}static createTransformFeedback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STATIC_DRAW,n=arguments.length>2?arguments[2]:void 0;const r=new l(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return r.setSize(n),r}constructor(e,t,n,r){this._context=e,this.bufferType=t,this.usage=n,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,s.Y2)(this._context.gl),r&&this.setData(r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&c().warn("Leaked WebGL buffer object")}setSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,o.mg)(e)?this._indexType=a.pe.UNSIGNED_BYTE:(0,o.jq)(e)?(t/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,o.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._size=e;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const r=this._context.gl;null!=t?r.bufferData(this.bufferType,t,this.usage):r.bufferData(this.bufferType,e,this.usage),(0,s.Y2)(r),this._isVAOAware&&this._context.bindVAO(n)}setSubData(e,t,n,r){if(!e)return;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,n,r-n),(0,s.Y2)(o),this._isVAOAware&&this._context.bindVAO(i)}getSubData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(n<0||i<0)return;const o=function(e){return(0,r.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(o*((n??0)+(i??0))>e.byteLength)return;t+o*(i??0)>this.usedMemory&&c().warn("Potential problem getting subdata: requested data exceeds buffer size!");const s=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),s.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,n,i),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),s.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,n,i),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;await this._context.clientWaitAsync(),this.getSubData(e,t,n,r)}}},89659:(e,t,n)=>{n.d(t,{y:()=>l});var r=n(67095),i=n(69436),o=n(34927),s=n(4241),a=n(16878),c=n(73712);function l(e){e.vertex.uniforms.add(new s.U("renderTransparentlyOccludedHUD",(e=>e.hudRenderStyle===i.D.Occluded?1:e.hudRenderStyle===i.D.NotOccluded?0:.75)),new o.I("viewport",(e=>e.camera.fullViewport)),new c.x("hudVisibilityTexture",(e=>e.hudVisibility?.getTexture()))),e.vertex.include(r.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},95206:(e,t,n)=>{n.d(t,{OH:()=>l,Y6:()=>a,pM:()=>c});var r=n(89227),i=n(28473),o=n(57554),s=n(16878);function a(e){e.vertex.code.add(s.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(s.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(s.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(s.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function c(e){e.uniforms.add(new o.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function l(e){e.uniforms.add(new o.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,r.i)(f,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const f=(0,i.vt)()},96504:(e,t,n)=>{n.d(t,{R1:()=>s,aY:()=>i,cN:()=>o});var r=n(49807);class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=n}}function o(e){return"array"in e}function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,r.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(o(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,t.spatialReference??e.spatialReference,n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}},99855:(e,t,n)=>{n.d(t,{H:()=>a,h:()=>s});var r=n(92453),i=n(15828),o=n(27464);class s extends i.R6{constructor(e,t,n,r,i){super(e,t),this.layerUid=e,this.graphicUid=t,this.triangleNr=n,this.baseBoundingSphere=r,this.numLodLevels=i}}function a(e){return(0,o.i3)(e)&&e.intersector===r.dz.LOD&&!!e.target}}}]);