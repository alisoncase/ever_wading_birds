"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[80945],{43579:(e,n,t)=>{t.d(n,{G2:()=>b,Lb:()=>h,Xj:()=>F,bF:()=>v,gS:()=>I,lm:()=>x});var i=t(62631),l=(t(21265),t(53957)),a=t(99961),r=t(95011),s=(t(76519),t(62155),t(83014),t(23621),t(45608)),o=(t(36917),t(19609),t(7282)),u=(t(12969),t(56488)),f=t(26964),p=t(67823),d=t(88171),c=t(71237),m=t(66809);let y=0;const v="expression/";function b(e){return"hasVisualVariables"in e&&e.hasVisualVariables()?e.visualVariables.filter((e=>!c.viewScaleRE.test(e.valueExpression)&&(!("target"in e)||"outline"!==e.target))):[]}function T(e,n){if(!n)return null;const t=(0,m.Rm)(e);return t?.find((e=>e.name.toLowerCase()===n.toLowerCase()))}function x(e,n,t){let i=null;if(t&&"featureReduction"in e){const n=e.featureReduction;n&&"popupTemplate"in n&&n.popupTemplate&&(i=n.popupTemplate.fieldInfos)}else"popupTemplate"in e&&e.popupTemplate&&(i=e.popupTemplate.fieldInfos);const l=t?T(e,n):e.getField(n);let a=null;if(i&&i.some((e=>!(!e||e.fieldName?.toLowerCase()!==l?.name.toLowerCase())&&(a=e.clone(),!0))),!a){const e=r.numericTypes.includes(l.type),n="integer"===l.type||"small-integer"===l.type;a=new f.default({fieldName:l.name,isEditable:l.editable,visible:!0,format:e?new p.default({places:n?0:2,digitSeparator:!0}):void 0})}return a.label||(a.label=l.alias),a}function g(e){const{expression:n,title:t,returnType:i}=e;return new u.default({name:"expr"+y++,expression:n,title:t,returnType:i})}function w(e){const n="number"===e.returnType?new p.default({places:2,digitSeparator:!0}):void 0;return new f.default({fieldName:`${v}${e.name}`,visible:!0,format:n})}async function F(e){const n=await(0,l.ud)("esri/smartMapping/t9n/smartMapping"),{renderer:t,layer:r,normFieldExpressionTemplate:s,isFeatureReduction:o}=e,u=[],f=[],p=(0,d.getAttributes)(t,b);for(const i of p)if("field"===i.type)u.push(x(r,i.field,o));else if("normalized-field"===i.type){const e=o?T(r,i.field):r.getField(i.field),t=o?T(r,i.normalizationField):r.getField(i.normalizationField),l=g({type:"expression",expression:`\n      $feature["${e.name}"];\n      $feature["${t.name}"];\n      ${"percentage"===s?`($feature["${e.name}"] / $feature["${t.name}"]) * 100;`:`$feature["${e.name}"] / $feature["${t.name}"];`}\n      `,title:(0,a.V)("percentage"===s?n.normFieldLabelAsPercent:n.normFieldLabel,{expression1:e.alias,expression2:t.alias}),returnType:"number"});u.push(w(l),x(r,i.field,o),x(r,i.normalizationField,o)),f.push(l)}else if("expression"===i.type){const e=g(i);u.push(w(e)),f.push(e)}return{fieldInfos:(0,i.Am)(u,((e,n)=>e.fieldName===n.fieldName)),expressionInfos:(0,i.Am)(f,((e,n)=>e.expression===n.expression))}}async function h(e,n,t){const{fieldInfos:i,expressionInfos:r}=n,u=await(0,l.ud)("esri/smartMapping/t9n/smartMapping");if(i.length>2)return[new s.default({fieldInfos:i})];const f=[];for(const l of i){const n=l.fieldName||"";let i=l.label;if(!i){const l=t?T(e,n):e.getField(n);if(l)i=l.alias||n;else if(r){const e=n.split(v)[1],t=r[r.findIndex((n=>n.name===e))];t&&(i=t.title||t.name)}}f.push(new o.default({text:(0,a.V)(u.fieldInfo,{fieldLabel:i,fieldValue:`{${n}}`})}))}return f}function I(e){return!(!("normalizationField"in e)||!e.normalizationField)||"hasVisualVariables"in e&&e.hasVisualVariables()&&e.visualVariables.some((e=>!(!("normalizationField"in e)||!e.normalizationField)))}},44320:(e,n,t)=>{t.d(n,{Dv:()=>p,Qb:()=>o,Wx:()=>y,eU:()=>T,pq:()=>u});var i=t(62631),l=t(99521),a=t(85074),r=t(43579),s=t(79538);const o="cluster_count";function u(e,n){return e.split(`cluster_${n}_`).pop()}function f(e,n){const t=function(e){if(!e)return null;const{field:n,valueExpression:t,normalizationField:i,normalizationType:l,normalizationTotal:r}=e;let o=null;if(t)o=t;else if(n){const e=(0,s.Wy)({normalizationType:l,normalizationField:i,normalizationTotal:r});if(e){const t=e.toLowerCase();if(o=n.toLowerCase()+",norm:"+t,i)o+=","+i.toLowerCase();else if("percent-of-total"===t){let e=r;(0,a.gf)(e)&&0!==e||(e=null),o+=","+e}}}return o}(e);return`${n}_${null!=t?function(e){return(0,l.d)(e)}(t):e.field}`}function p(e,n){return`cluster_${f(e,n)}`}function d(e,n){const t=n.getField(e);return t?.type}function c(e,n){const t="rotation"===n.type?n.rotationType:null,i=n.legendOptions?.title,l=n.field,a=l?d(l,e):null;return{field:l,fieldType:null!=a?a:null,rotationType:t,valueExpression:n.valueExpression,valueExpressionTitle:n.valueExpressionTitle||n.valueExpression&&i,normalizationField:"normalizationField"in n?n.normalizationField:null,vvType:n.type}}function m(e){return e?e.replaceAll('"','\\"'):""}function y(e,n,t){return`\n  var uvInfos = [${function(e){return e.map((e=>`{\n        "value": "${String(e.value)}",\n        "label": "${m(String(e.label))}"\n      }`))}(e).join(", ")}];\n  var predominantType = Text($feature["${n}"]);\n  var label = "${m(t)}";\n\n  for (var i = 0; i < Count(uvInfos); i++) {\n    if (uvInfos[i].value == predominantType) {\n      label = uvInfos[i].label;\n      break;\n    }\n  }\n\n  return label;\n  `}function v(e,n){const t=[f(e,n)];return"date"===e.fieldType&&t.push(e.fieldType.toLowerCase()),e.rotationType&&t.push(e.rotationType.toLowerCase()),t.join("_")}function b(e,n){return{statisticHash:v(e,n),attributeInfo:e,statisticType:n}}function T(e,n){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=[],a=function(e,n){const t="field"in n?n.field:null,i=t?d(t,e):null;return{field:t,fieldType:null!=i?i:null,valueExpression:"valueExpression"in n?n.valueExpression:null,valueExpressionTitle:"valueExpressionTitle"in n?n.valueExpressionTitle:null,normalizationField:"normalizationField"in n?n.normalizationField:null,normalizationType:"normalizationType"in n?n.normalizationType:null,normalizationTotal:"normalizationTotal"in n?n.normalizationTotal:null}}(e,n);"class-breaks"===n.type?l.push(b(a,"avg")):"unique-value"===n.type&&l.push(b(a,"type"));const s=(0,r.G2)(n);for(const i of s){const n=c(e,i);l.push(b(n,"avg"))}return t?(0,i.Am)(l,((e,n)=>e.statisticHash===n.statisticHash)):l}},80945:(e,n,t)=>{t.r(n),t.d(n,{getTemplates:()=>F});var i=t(35377),l=t(74719),a=t(53957),r=t(99961),s=t(95011),o=(t(76519),t(62155),t(83014),t(23621),t(45608),t(36917),t(19609),t(7282)),u=(t(12969),t(56488)),f=t(26964),p=t(67823),d=t(43579),c=t(44320),m=t(14915);function y(e){const{fieldName:n,label:t,type:i}=e,l=null!=i&&s.numericTypes.includes(i),a=new f.default({fieldName:n,label:t,visible:!0,format:l?new p.default({places:"integer"===i||"small-integer"===i?0:2,digitSeparator:!0}):void 0});return"date"===i&&(a.format=new p.default({dateFormat:"short-date-short-time"})),a}function v(e,n){const t=e?n.getField(e):null;return null!=t?t.alias||t.name:void 0}function b(e,n,t){const{attributeInfo:i,statisticType:l}=n,{field:a,normalizationField:s}=i;let o,u="";if("avg"===l?o=s?t.clusters.avgNormFieldLabel:t.clusters.avgFieldLabel:"type"===l&&(o=t.clusters.predominantFieldLabel),o){const n=i.valueExpression?i.valueExpressionTitle:v(a,e),t=s&&v(s,e);u=(0,r.V)(o,{fieldLabel:n||"",normFieldLabel:t||""})}return u}function T(e,n,t,i){const{attributeInfo:l,statisticType:a}=n,{field:s,normalizationField:o}=l;let u,f="";if("avg"===a?u=o?i.clusters.avgNormFieldSummary:i.clusters.avgFieldSummary:"type"===a&&(u=i.clusters.predominantFieldSummary),u){const n=l.valueExpression?l.valueExpressionTitle:v(s,e),i=o&&v(o,e);f=(0,r.V)(u,{fieldLabel:n||"",normFieldLabel:i||"",fieldValue:"{"+t+"}"})}return f}function x(e){return{fieldInfo:y({fieldName:c.Qb,label:e.clusters.numFeatures,type:"integer"}),fieldSummary:new o.default({text:(0,r.V)(e.clusters.countSummary,{count:`{${c.Qb}}`})})}}async function g(e,n,t){if(!(0,m.k)(n))return null;const i=(0,c.eU)(e,n),l=t.clusters.predominantNoneValue,a="unique-value"===n.type?n.uniqueValueInfos??[]:[],{fieldInfo:r,fieldSummary:s}=x(t),f=[s],p=[r],d=[];for(const m of i){const{statisticType:n,attributeInfo:i}=m,r=(0,c.Dv)(i,n),s=b(e,m,t);if("avg"===n)f.push(new o.default({text:T(e,m,r,t)})),p.push(y({fieldName:r,label:s,type:"double"}));else if("type"===n){const n=`expression/${r}`;f.push(new o.default({text:T(e,m,n,t)})),d.push(new u.default({name:r,title:s,returnType:"string",expression:(0,c.Wx)(a,r,l)})),p.push(y({fieldName:n}))}}return{fieldInfos:p,expressionInfos:d,content:f}}async function w(e){const{layer:n,renderer:t}=e;await n.load();const i=t??("renderer"in n?n.renderer:void 0);if(!(0,m.k)(i))throw new l.default("clusters-popup:invalid-parameters","'renderer' is not valid");return{layer:n,renderer:i}}async function F(e){const[{renderer:n,layer:t},l]=await Promise.all([w(e),(0,a.ud)("esri/smartMapping/t9n/smartMapping")]),r=await g(t,n,l);if(null==r)return null;const s={name:"clusters",title:l.clusters.templateTitle,value:new i.default({fieldInfos:r.fieldInfos,expressionInfos:r.expressionInfos,content:r.content,title:l.clusters.clusterPopupTitle})},o=[],u=t.featureReduction,f=u&&"renderer"in u?u.renderer:null;if("pie-chart"===f?.type){const e=await async function(e,n,t){if(!(0,m.k)(n))return null;const{fieldInfo:i,fieldSummary:l}=x(t),a=[l],r=[i],s=[],{fieldInfos:o,expressionInfos:u}=await(0,d.Xj)({renderer:n,layer:e,isFeatureReduction:!0}),f=await(0,d.Lb)(e,{fieldInfos:o,expressionInfos:u},!0);return a.push(...f),r.push(...o),s.push(...u),{fieldInfos:r,expressionInfos:s,content:a}}(t,f,l);null!=e&&o.push({name:"clusters-pie-chart",title:"clusters-pie-chart",value:new i.default({fieldInfos:e.fieldInfos,expressionInfos:e.expressionInfos,content:e.content,title:l.clusters.clusterPopupTitle})})}return{primaryTemplate:s,secondaryTemplates:o}}}}]);