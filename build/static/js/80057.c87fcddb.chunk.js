"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[80057],{80057:(t,e,s)=>{s.r(e),s.d(e,{OperatorShapePreservingProject:()=>L});var i=s(22290),n=s(9270),o=s(12834),r=s(45204),h=s(65889),m=s(54256),a=s(61853),l=s(75646),c=s(95188);function u(t){const e=t.getInputSR(),s=t.getOutputSR();let i=!1;do{if(e.equals(s)){i=!1;break}if(!d(e)||!d(s)){i=!1;break}if(2===e.getCoordinateSystemType()){i=!0;break}if(2===s.getCoordinateSystemType()){i=!0;break}const n=t.getGeographicTransformations();if(null!==n&&n.count()>0){i=!0;break}}while(0);return i}class f{constructor(t,e,s,i){this.m_horizon2Env=new r.Envelope2D,this.m_horizon2=t,this.m_sr=e,this.m_bInclusive2=s,this.m_pannableExtent=i.clone(),this.m_segIter=null,this.m_qtIter=null,null!==t?(t.queryEnvelope(this.m_horizon2Env),this.m_gcs360=i.width(),this.m_gcs180=.5*this.m_gcs360,this.m_gcs90=.25*this.m_gcs360,this.m_pannableFactor=1,this.m_horizon2Env.width()-this.m_gcs360>0&&(this.m_pannableFactor+=Math.ceil((this.m_horizon2Env.width()-this.m_gcs360)/this.m_gcs360)),this.m_period=this.m_gcs360):(this.m_horizon2Env.setEmpty(),this.m_gcs360=Number.NaN,this.m_gcs180=Number.NaN,this.m_gcs90=Number.NaN,this.m_pannableFactor=Number.NaN,this.m_period=Number.NaN),this.m_gcsTolerance=null!=e?e.getTolerance(0):Number.NaN}isPointStartInHorizon(t,e){if(!this.m_horizon2)return!0;let s=N(new o.P(t),this.m_horizon2,!0,this.m_period);do{const e=t.clone();if(e.x-=s*this.m_period,this.m_horizon2.getGeometryType()===n.G.enumPolygon){let t;if(t=this.m_horizon2Env.contains(e)?(0,l.i)(this.m_horizon2,e,0):0,this.m_bInclusive2){if(0===t)return!1}else if(1===t)return!1}else{const t=this.m_horizon2Env.contains(e);if(this.m_bInclusive2){if(!t)return!1}else if(t)return!1}}while(this.m_horizon2Env.xmin+ ++s*this.m_period<t.x);return!0}isAdjoiningLineInHorizon(t,e,s){if(!this.m_horizon2)return!0;const i=new m.P,o=new m.P;w(t,e,this.m_gcs90,this.m_gcs180,this.m_gcs360,i,o);const a=Math.max(i.x,o.x),l=new h.L;l.setStart2D(i),l.setEnd2D(o);let c=N(l,this.m_horizon2,!0,this.m_period);do{const t=i.clone(),e=o.clone();if(t.x-=c*this.m_period,e.x-=c*this.m_period,this.m_horizon2.getGeometryType()===n.G.enumPolygon){const s=new h.L;s.setStartXY(t),s.setEndXY(e);const i=new r.Envelope2D,o=new r.Envelope2D;if(s.queryEnvelope(i),o.setCoords({env2D:i}),o.inflateCoords(this.m_gcsTolerance,this.m_gcsTolerance),this.m_horizon2Env.isIntersecting(o)){const t=this.m_horizon2.getImpl(),e=t.getAccelerators();null!==e&&null!==e.getRasterizedGeometry()&&(0,n.g)(0);{let i=null;if(null!==e&&(i=e.getQuadTree()),null!==i){this.m_qtIter||(this.m_qtIter=i.getIteratorForQT()),this.m_qtIter.resetIterator(s,this.m_gcsTolerance),this.m_segIter||(this.m_segIter=t.querySegmentIterator());for(let t=this.m_qtIter.next();-1!==t;t=this.m_qtIter.next()){const e=i.getElement(t);if(this.m_segIter.resetToVertex(e,-1),this.m_segIter.nextSegment().isIntersecting(s,this.m_gcsTolerance))return!1}}else for(this.m_segIter||(this.m_segIter=t.querySegmentIterator()),this.m_segIter.resetToFirstPath();this.m_segIter.nextPath();)for(;this.m_segIter.hasNextSegment();){const t=this.m_segIter.nextSegment(),e=new r.Envelope2D;if(t.queryEnvelope(e),e.isIntersecting(o)&&t.isIntersecting(s,this.m_gcsTolerance))return!1}}}}else if(this.m_bInclusive2){const s=this.m_horizon2Env.contains(t),i=this.m_horizon2Env.contains(e);if(s&&i)return!0}else{const s=this.m_horizon2Env.clone();if(s.inflateCoords(this.m_gcsTolerance,this.m_gcsTolerance),0!==s.clipLine(t,e))return!1}}while(this.m_horizon2Env.xmin+ ++c*this.m_period<a);return!this.m_bInclusive2||!1}isEnvelopeInHorizon(t,e){if(!this.m_horizon2)return!0;const s=new o.E({env2D:t});let i=N(s,this.m_horizon2,!0,this.m_period);do{const n=t.clone();if(n.move(-i*this.m_period,0),s.setCoords(n.xmin,n.ymin,n.xmax,n.ymax),!C(s,this.m_horizon2,this.m_sr,this.m_bInclusive2,e))return!1}while(this.m_horizon2Env.xmin+ ++i*this.m_period<t.xmax);return!0}}class g{constructor(t,e,s){this.m_splitLines2=null,this.m_scalars=[],this.m_splitIter=null,this.m_splitLines2=t,this.m_transform1=e,this.m_pannableExtent=s.clone(),this.m_gcs360=s.width(),this.m_gcs180=.5*this.m_gcs360,this.m_gcs90=.25*this.m_gcs360,null!==e?(this.m_gcsTolerance=this.m_transform1.getOutputSR().getTolerance(0),this.m_halfGcsTolerance=.5*this.m_gcsTolerance,this.m_gcsToleranceSq=this.m_gcsTolerance*this.m_gcsTolerance):(this.m_gcsTolerance=Number.NaN,this.m_halfGcsTolerance=Number.NaN,this.m_gcsToleranceSq=Number.NaN)}hasSplitLines(){return null!=this.m_splitLines2}getSplitLineFactorEx(t,e,s,i,n,o){const a=new m.P,l=new m.P;w(i,n,this.m_gcs90,this.m_gcs180,this.m_gcs360,a,l);const c=new h.L;for(c.setStartXY(a),c.setEndXY(l),this.m_splitIter?this.m_splitIter.resetToFirstPath():this.m_splitIter=this.m_splitLines2.getImpl().querySegmentIterator();this.m_splitIter.nextPath();)for(;this.m_splitIter.hasNextSegment();){const i=this.m_splitIter.nextSegment(),n=.5*(i.getStartX()+i.getEndX());x(this.m_gcs180,this.m_gcs360,n,c);const h=new r.Envelope2D;c.queryEnvelope(h),h.inflateCoords(this.m_gcsTolerance,this.m_gcsTolerance);const m=new r.Envelope2D;if((i.queryEnvelope(m),h.isIntersecting(m))&&(this.m_scalars.length<2&&(this.m_scalars.length=2),1===c.intersect(i,null,this.m_scalars,null,this.m_gcsTolerance)&&this.m_scalars[0]>0&&this.m_scalars[0]<1)){const n=k(e,s,this.m_scalars[0]),r=b(t.getCoord2D(n),this.m_transform1);return i.isIntersectingPoint(r,this.m_halfGcsTolerance)?n:this.getSplitLineFactor(t,e,s,i,o)}}return-1}getSplitLineFactor(t,e,s,i,n){let o=e,r=s;const a=.5*(i.getStartX()+i.getEndX()),l=new h.L,c=t.getCoord2D(o),u=t.getCoord2D(r),f=b(c,this.m_transform1),g=b(u,this.m_transform1);for(;o<r;){const e=new m.P,s=new m.P;w(f,g,this.m_gcs90,this.m_gcs180,this.m_gcs360,e,s),l.setStartXY(e),l.setEndXY(s),x(this.m_gcs180,this.m_gcs360,a,l);const n=m.P.sqrDistance(l.getStartXY(),l.getEndXY());if(n<=this.m_gcsToleranceSq)break;if(Number.isNaN(n))return Number.NaN;let h=k(o,r,this.m_scalars[0]);if(o<h&&h<r||(h=.5*(r+o)),o===h||h===r)return h;const _=t.getCoord2D(h),d=b(_,this.m_transform1),p=new m.P;w(f,d,this.m_gcs90,this.m_gcs180,this.m_gcs360,e,p),l.setStartXY(e),l.setEndXY(p),x(this.m_gcs180,this.m_gcs360,a,l);let P=l.intersect(i,null,this.m_scalars,null,this.m_halfGcsTolerance);if(0!==P){if(1===this.m_scalars[0])return h;r=h,u.setCoordsPoint2D(_),g.setCoordsPoint2D(d)}else{if(w(d,g,this.m_gcs90,this.m_gcs180,this.m_gcs360,p,s),l.setStartXY(p),l.setEndXY(s),x(this.m_gcs180,this.m_gcs360,a,l),P=l.intersect(i,null,this.m_scalars,null,this.m_halfGcsTolerance),0===P)return h;if(0===this.m_scalars[0])return h;o=h,c.setCoordsPoint2D(_),f.setCoordsPoint2D(d)}}return.5*(r+o)}}class _{constructor(){this.m_bPrepared=!1,this.m_bNeedsShapePreservingProject=!1,this.m_inputTransform=null,this.m_transform1=null,this.m_transform2=null,this.m_extentFrom=null,this.m_horizon1=null,this.m_horizon2=null,this.m_pannableExtentFrom=new r.Envelope2D,this.m_pannableExtentTo=new r.Envelope2D,this.m_pannableExtentGcsTo=new r.Envelope2D,this.m_bClipTopBottomFrom=!1,this.m_bNeedsGeoTransform=!1,this.m_bIsPannableFrom=!1,this.m_bIsPannableTo=!1,this.m_bInclusive1=!1,this.m_bInclusive2=!1,this.m_bSrFromIsPcs=!1,this.m_bSrToIsPcs=!1,this.m_fromTolerance=Number.NaN,this.m_toTolerance=Number.NaN,this.m_gcsToTolerance=Number.NaN,this.m_aFrom=Number.NaN,this.m_mpuFrom=Number.NaN,this.m_rpuFrom=Number.NaN,this.m_rpuGcsTo=Number.NaN,this.m_aTo=Number.NaN,this.m_mpuTo=Number.NaN,this.m_stages=0}prepare(t,e,s){this.m_bPrepared&&(0,n.m)(""),t||(0,n.t)("");const i=t.getInputSR(),o=t.getOutputSR();d(i)&&d(o)||(0,n.t)("shape preserving project requires PCS or GCS");const r=i.getCoordinateSystemType(),h=o.getCoordinateSystemType();this.m_bSrFromIsPcs=2===r,this.m_bSrToIsPcs=2===h;let m=null,a=null,c=null,u=null;this.m_bSrFromIsPcs?(m=i,c=i.getGCS(),this.m_aFrom=z(c),this.m_mpuFrom=G(m),this.m_rpuFrom=Number.NaN):(c=i,this.m_rpuFrom=y(c),this.m_aFrom=Number.NaN),this.m_bSrToIsPcs?(a=o,u=o.getGCS(),this.m_aTo=z(u),this.m_mpuTo=G(a)):(u=o,this.m_aTo=Number.NaN,this.m_mpuTo=Number.NaN),this.m_rpuGcsTo=y(u);const f=t.getGeographicTransformations();this.m_bNeedsGeoTransform=null!==f&&f.count()>0;const g=i.equals(o);if(this.m_bNeedsShapePreservingProject=!g&&(this.m_bSrFromIsPcs||this.m_bSrToIsPcs||this.m_bNeedsGeoTransform),!this.m_bNeedsShapePreservingProject)return this.m_inputTransform=t,this.m_extentFrom=e?e.clone():null,void(this.m_bPrepared=!0);if(this.m_bIsPannableFrom=i.isPannable(),this.m_bIsPannableTo=o.isPannable(),this.m_bIsPannableFrom&&(this.m_pannableExtentFrom=i.getPannableExtent()),this.m_bIsPannableTo&&(this.m_pannableExtentTo=o.getPannableExtent()),this.m_bSrToIsPcs){this.m_pannableExtentGcsTo=u.getPannableExtent();const t=a.getCentralMeridian(),e=this.m_pannableExtentGcsTo.getCenter();e.x=t,this.m_pannableExtentGcsTo.centerAt(e)}else this.m_pannableExtentGcsTo=this.m_pannableExtentTo.clone();this.m_fromTolerance=i.getTolerance(0),this.m_toTolerance=o.getTolerance(0),this.m_gcsToTolerance=u.getTolerance(0);{const i=t.getExtendedParams(),n=i.clipWithInputHorizon,o=i.clipWithOutputHorizon;n&&this.setHorizon1(t,e,s),o&&this.setHorizon2(t,s),this.checkAndSetStages(t,s)}const _=(0,l.aa)();_.setFlag(1073741824,!0),_.setFlag(536870912,!0);const p=(0,l.ab)();if(p.clipWithInputHorizon=!1,p.clipWithOutputHorizon=!1,1===this.m_stages)this.m_transform1=(0,l.a8)(!1,i,o,f,p,_);else if(2===this.m_stages){_.setFlag(2147483648,!0),this.m_transform1=(0,l.a8)(!1,i,u,f,p,_);const t=(0,l.aa)();this.m_transform2=(0,l.a8)(!1,u,o,null,p,t)}else{(0,n.g)(null!=a),p.centralMeridianOfOutputGCS=a.getCentralMeridian(),this.m_transform1=(0,l.a8)(!1,i,u,f,p,_);const t=(0,l.aa)();t.setFlag(2147483648,!0),this.m_transform2=(0,l.a8)(!1,u,o,null,p,t)}this.m_inputTransform=t,this.m_extentFrom=e?e.clone():null,this.m_bPrepared=!0}execute(t,e,s,i){return this.m_bPrepared||(0,n.m)(""),(0,n.g)(!t.hasAttribute(10)),this.execute_(t,e,s,i)}checkIfNeedsReset(t,e){return(0,n.g)(0),!1}setHorizon1(t,e,s){const i=t.getInputSR();let n,h=null;const m=new r.Envelope2D;if(this.m_bSrFromIsPcs){n=!0,h=i.getPCSHorizon(),h.queryEnvelope(m),this.m_bIsPannableFrom&&(h=new o.E({xmin:this.m_pannableExtentFrom.xmin,ymin:m.ymin,xmax:this.m_pannableExtentFrom.xmax,ymax:m.ymax}));let t=!1;null!=e&&(t=function(t,e,s,i,n,o,r){const h=[!1];return v(t,s,e,i,n,o,!0,Number.NaN,h,r),h[0]}(e,h,i,n,this.m_bIsPannableFrom,this.m_pannableExtentFrom,s)),t||(this.m_horizon1=h,this.m_bInclusive1=n)}else this.m_bClipTopBottomFrom=!0,this.m_bInclusive1=!0}setHorizon2(t,e){const s=t.getOutputSR();if(1===s.getCoordinateSystemType())return this.m_horizon2=null,void(this.m_bInclusive2=!1);let i=null;const n=new r.Envelope2D,h=s.getGCSHorisonIsInclusive();i=s.getGCSHorizon(),i.queryEnvelope(n);const m=s.getCentralMeridian();if(this.m_bIsPannableTo){const t=new o.E({xmin:this.m_pannableExtentGcsTo.xmin,ymin:n.ymin,xmax:this.m_pannableExtentGcsTo.xmax,ymax:n.ymax});t.centerAt(m,0),i=t}this.m_horizon2=i,this.m_bInclusive2=h}checkAndSetStages(t,e){const s=t.getOutputSR().getGCSSplitLines();if(this.m_horizon2||s){if(this.m_horizon2.getGeometryType()===n.G.enumEnvelope){const t=new r.Envelope2D;this.m_horizon2.queryEnvelope(t);const e=t.width(),s=t.height();e>=m.k/this.m_rpuGcsTo&&s>=Math.PI/this.m_rpuGcsTo&&(this.m_horizon2=null)}if(this.m_horizon2||s){if(null!==this.m_horizon2&&!this.m_bNeedsGeoTransform&&!this.m_bSrFromIsPcs){const e=t.getOutputSR().getGCS();return t.getInputSR().equals(e)?(this.m_horizon1=this.m_horizon2,this.m_bInclusive1=this.m_bInclusive2,this.m_bClipTopBottomFrom=!1,this.m_horizon2=null,this.m_bInclusive2=!1,void(this.m_stages=1)):void(this.m_stages=2)}this.m_stages=3}else this.m_stages=1}else this.m_stages=1}execute_(t,e,s,i){if(!this.m_bNeedsShapePreservingProject)return(new l.v).execute(t,this.m_inputTransform,i);if(!t)return null;(0,n.d)(t),(0,n.l)(t);let o,r=t.getGeometryType();return(0,n.f)(r)?(o=function(t){const e=new h.P({vd:t.getDescription()});return e.addSegment(t,!0),e}(t),r=n.G.enumPolyline):o=t,o.isEmpty()?o:(0,n.h)(r)?this.executeEx(t,e,s,i):(new l.v).execute(t,this.m_inputTransform,i)}executeEx(t,e,s,i){let o;t.hasNonLinearSegments()&&(0,n.b)(""),o=this.m_bIsPannableFrom?(new l.v).foldInto360Range(t,this.m_transform1.getInputSR()):t;let r,h=s;return h>0||(h=100*this.m_toTolerance),r=1===this.m_stages?this.executeGood(o,e,h,i):2===this.m_stages?this.executeBad(o,e,h,i):this.executeUgly(o,e,h,i),this.filterOverDensification(r,this.m_inputTransform.getOutputSR(),h,i)}executeGood(t,e,s,i){const n=s*s;let o,r;return o=e>0?this.getMinLengthInSrFrom(e):this.getMinLengthInSrFrom(1e-5),r=this.m_bClipTopBottomFrom?(0,l.w)(t,this.m_transform1.getInputSR()):F(t,this.m_transform1.getInputSR(),this.m_horizon1,this.m_bInclusive1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,!0,Number.NaN,i),r=(0,l.a9)(r,this.m_transform1.getOutputSR(),i),r=p(r,this.m_transform1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,this.m_bIsPannableTo,this.m_pannableExtentTo,null,null,null,null,o,n,i),r=(new l.v).execute(r,this.m_transform1,i),r}executeBad(t,e,s,i){let n;n=e>0?e*(Math.PI/180/this.m_rpuGcsTo):Math.PI/180/this.m_rpuGcsTo*1e-5;const o=s*s;let r;return r=this.m_bClipTopBottomFrom?(0,l.w)(t,this.m_transform1.getInputSR()):t,r=(new l.v).execute(r,this.m_transform1,i),r=F(r,this.m_transform2.getInputSR(),this.m_horizon2,this.m_bInclusive2,!0,this.m_pannableExtentGcsTo,!0,Number.NaN,i),r=(0,l.a9)(r,this.m_transform2.getOutputSR(),i),r=p(r,this.m_transform2,!0,this.m_pannableExtentGcsTo,this.m_bIsPannableTo,this.m_pannableExtentTo,null,null,null,null,n,o,i),r=(new l.v).execute(r,this.m_transform2,i),r}executeUgly(t,e,s,i){const n=s*s;let o;o=e>0?this.getMinLengthInSrFrom(e):this.getMinLengthInSrFrom(1e-5);let r=null;r=this.m_bClipTopBottomFrom?(0,l.w)(t,this.m_transform1.getInputSR()):F(t,this.m_transform1.getInputSR(),this.m_horizon1,this.m_bInclusive1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,!0,Number.NaN,i);let h=r;const m=new f(this.m_horizon2,this.m_transform2.getInputSR(),this.m_bInclusive2,this.m_pannableExtentGcsTo),a=this.m_transform2.getOutputSR().getGCSSplitLines(),c=new g(a,this.m_transform1,this.m_pannableExtentGcsTo);if(r=p(r,this.m_transform1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,this.m_bIsPannableTo,this.m_pannableExtentTo,this.m_transform2,m,this.m_pannableExtentGcsTo,c,o,n,i),null!==r){h=null,r=(new l.v).execute(r,this.m_transform1,i);const t=Math.PI/180/this.m_rpuGcsTo*2;return r=F(r,this.m_transform2.getInputSR(),this.m_horizon2,this.m_bInclusive2,!0,this.m_pannableExtentGcsTo,!1,t,i),r=(new l.v).execute(r,this.m_transform2,i),r}let u=Number.NaN;u=s>0?s:100*this.m_toTolerance,u/=this.m_rpuGcsTo*this.m_aTo/this.m_mpuTo;const _=u*u;let d;return r=p(h,this.m_transform1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,!0,this.m_pannableExtentGcsTo,null,null,null,null,o,_,i),h=null,r=(new l.v).execute(r,this.m_transform1,i),d=e>0?e*(Math.PI/180/this.m_rpuGcsTo):Math.PI/180/this.m_rpuGcsTo*1e-5,r=F(r,this.m_transform2.getInputSR(),this.m_horizon2,this.m_bInclusive2,!0,this.m_pannableExtentGcsTo,!1,Number.NaN,i),r=(0,l.a9)(r,this.m_transform2.getOutputSR(),i),r=p(r,this.m_transform2,!0,this.m_pannableExtentGcsTo,this.m_bIsPannableTo,this.m_pannableExtentTo,null,null,null,null,d,n,i),r=(new l.v).execute(r,this.m_transform2,i),r}getMinLengthInSrFrom(t){let e;return e=this.m_bSrFromIsPcs?this.m_aFrom*(t*Math.PI/180)/this.m_mpuFrom:t*Math.PI/180*(1/this.m_rpuFrom),e}filterOverDensification(t,e,s,i){let r=function(t,e){if(t.isEmpty()||!t.hasAttribute(10))return t;const s=e*e;let i=t.getAttributeStreamRef(10),n=!1;const r=new h.L,a=[];let l=!1;for(let o=0,h=t.getPathCount();o<h;o++){const e=t.getPathStart(o),h=t.getPathEnd(o),c=t.isClosedPath(o);if(!(h>e))continue;{const t=c?e:h-1;0===i.read(e)&&0===i.read(t)||(n||(i=i.clone(),n=!0),i.write(e,0),i.write(t,0))}const u=c?h+1:h;let f=e;for(let o=e;o<u;o++){const c=o===h?e:o;if(0===i.read(c)){if(o-f>1){a.push({from:f,to:o});const c=new m.P;for(;a.length>0;){const o=a.at(-1);a.pop(),r.setStartXY(t.getXY(o.from));const u=o.to===h?e:o.to;r.setEndXY(t.getXY(u));let f=s,g=-1;for(let e=o.from+1,s=o.to;e<s;e++){const s=t.getXY(e),i=r.getClosestCoordinate(s,!1);r.queryCoord2D(i,c);const n=m.P.sqrDistance(c,s);f<n&&(f=n,g=e)}g>=0?(n||(i=i.clone(),n=!0),i.write(g,0),g-o.from>1&&a.push({from:o.from,to:g}),o.to-g>1&&a.push({from:g,to:o.to})):l=!0}}f=c}}}if(!l)return t;const c=function(t,e,s){const i=t.createInstance(),n=new o.P;for(let o=0,r=t.getPathCount();o<r;o++){let r=!0,h=0,m=0;const a=t.getPathStart(o),l=t.getPathEnd(o);let c=!0;for(let u=a;u<l;u++)e.read(u)===s?(!c&&m>0&&(i.addSegmentsFromPath(t,o,h-a,m,r),m=0),c=!0):c?(c=!1,t.getPointByVal(u,n),r?(i.startPathPoint(n),r=!1):i.lineToPoint(n),h=u):m++;m>0&&i.addSegmentsFromPath(t,o,h-a,m,r)}return i}(t,i,1);return c.dropAttribute(10),c}(t,s);return r.dropAttribute(10),r!==t&&r.getGeometryType()===n.G.enumPolygon&&(r=(new l.g).execute(r,e,!1,i)),r}}function d(t){if(!t)return!1;const e=t.getCoordinateSystemType();return 2===e||1===e}function p(t,e,s,i,n,o,r,m,a,l,c,u,f){const g=t.createInstance();g.addAttribute(10);const _=t.querySegmentIterator(),d=[],p=[],b=new h.S,D=t.getDescription().getAttributeCount()>1,x=new q(e,s,i,n,o,r,m,l,c,u,D?p:null,d,f);for(;_.nextPath();)for(;_.hasNextSegment();){const t=_.nextSegment(),e=t.getStartXY(),s=t.getEndXY(),i=e.compare(s)>0,n=S(i,t,b);if(d.length=0,p.length=0,!x.densifySegment(_.isFirstSegmentInPath(),n))return null;i&&I(D?p:null,d),d.at(-1).setCoordsPoint2D(t.getEndXY());const o=g.getPointCount();if(D){const e=S(i,t,b);T(_.isFirstSegmentInPath(),_.isLastSegmentInPath()&&!_.isPathClosed(),t,e,p,d,g)}else P(_.isFirstSegmentInPath(),_.isLastSegmentInPath()&&!_.isPathClosed(),d,g);if(x.needsPostFiltering()){g.addAttribute(10);const t=g.getAttributeStreamRef(10);for(let e=1,s=d.length-1;e<s;e++)t.write(e+o,1)}}return g}function P(t,e,s,i){t&&i.insertPath2D(-1,null,0,0,!0);const n=i.getPathCount()-1;e?i.insertPointsFromPoints(n,-1,s,0,s.length,!0):i.insertPointsFromPoints(n,-1,s,0,s.length-1,!0)}function T(t,e,s,i,n,r,h){h.reserve(h.getPointCount()+r.length-1);const m=new o.P;if(s.queryStart(m),t?h.startPathPoint(m):h.lineToPoint(m),r.length>2){const t=i.calculateLength2D();for(let e=1;e<r.length-1;e++){const s=i.lengthToT(n[e]*t);i.queryCoord(s,m),m.setXY(r[e]),h.lineToPoint(m)}}e&&(s.queryEnd(m),h.lineToPoint(m))}function b(t,e){const s=e.getInputSR(),i=e.getOutputSR(),n=new m.P;2===s.getCoordinateSystemType()?(n.setCoordsPoint2D(t),(0,l.S)(s,0,[n],1)):n.setCoordsPoint2D(t);const o=new m.P;o.setCoordsPoint2D(n),(0,l.ac)(e,[o],null,1,!1);const r=new m.P;return 2===i.getCoordinateSystemType()?(r.setCoordsPoint2D(o),(0,l.R)(i,[r],1,!1)):r.setCoordsPoint2D(o),r}function D(t,e,s,i,n,o,r,h){if(n){const n=o.width(),a=.5*n;if(i){const i=.25*n;let o=!1;const l=new m.P,c=new m.P;if(Math.abs(t.y)===i?(l.setCoords(s.x,t.y),c.setCoordsPoint2D(s),o=!0):Math.abs(s.y)===i&&(c.setCoords(t.x,s.y),l.setCoordsPoint2D(t),o=!0),Math.abs(e.y)===i&&(o||(l.setCoordsPoint2D(t),c.setCoordsPoint2D(s),o=!0),l.x=e.x),o)return E(e,l,a,n,r),E(e,c,a,n,h),!0}let l=0;t.x-e.x>a&&s.x-e.x>a?l-=n:e.x-t.x>a&&e.x-s.x>a&&(l+=n),Math.abs(e.x-(t.x+l))<a?(r.setCoordsPoint2D(t),E(r,s,a,n,h),r.x+=l,h.x+=l):(r.setCoordsPoint2D(s),E(r,t,a,n,h),r.x+=l,h.x+=l)}else r.setCoordsPoint2D(t),h.setCoordsPoint2D(s);return!1}function S(t,e,s){return t?(s.create(e.getGeometryType()),e.copyTo(s.get()),s.get().reverse(),s.get()):e}function I(t,e){e.reverse(),null!==t&&t.reverse()}function x(t,e,s,i){const n=.5*(i.getStartX()+i.getEndX());if(n-s>t){const t=new a.T;t.setShiftCoords(-e,0),i.applyTransformation(t)}else if(s-n>t){const t=new a.T;t.setShiftCoords(e,0),i.applyTransformation(t)}}function F(t,e,s,i,n,o,h,m,l){const c=[!1];h&&v(t,e,s,i,n,o,!0,m,c,l);let u=t;return c[0]||(u=v(u,e,s,i,n,o,!1,m,null,l)),u=function(t,e,s,i){let n;if(!e)return t;const o=s.getCenter().x,h=s.width(),m=.5*h,l=new r.Envelope2D;t.queryEnvelope(l);const c=l.getCenter().x;let u=0;c-o>m?u=-Math.ceil((c-o-m)/h)*h:o-c>m&&(u=Math.ceil((o-c-m)/h)*h);if(0!==u){n=i?t:t.clone();const e=new a.T;e.setShiftCoords(u,0),n.applyTransformation(e)}else n=t;return n}(u,n,o,u!==t),u}function v(t,e,s,i,o,h,m,u,f,g){if(m&&(f[0]=!1),null==s)return t;const _=new r.Envelope2D,d=new r.Envelope2D;s.queryEnvelope(_),t.queryEnvelope(d);const p=t.getGeometryType(),P=s.getGeometryType(),T=e.getTolerance(0);if(!o){if(m)return f[0]=C(t,s,e,i,g),null;let o;return o=i?P===n.G.enumEnvelope?(0,c.c)(t,_,T,u,g):(new l.f).execute(t,s,e,g):(new l.e).execute(t,s,e,g),o===s&&(o=s.clone()),o}const b=h.width(),D=b*Math.ceil(_.width()/b);let S=null;if(i){let h=N(t,s,o,D),I=0;const x=new a.T;do{let o=null;if(P===n.G.enumEnvelope){const n=s.clone();if(x.setShiftCoords(h*D,0),n.applyTransformation(x),m){if(f[0]=C(t,n,e,i,g),!f[0])return null}else{const e=new r.Envelope2D;n.queryEnvelope(e),o=(0,c.c)(t,e,T,u,g)}}else{const n=t.clone();if(x.setShiftCoords(-h*D,0),n.applyTransformation(x),m){if(f[0]=C(n,s,e,i,g),!f[0])return null}else o=(new l.f).execute(n,s,e,g),o===s&&(o=s.clone())}if(!m){if(o.isEmpty())continue;if(p===n.G.enumPolygon){const t=new r.Envelope2D;if(o.queryEnvelope(t),t.width()<=T)continue}P===n.G.enumEnvelope&&(x.setShiftCoords(-h*D,0),o===t&&(o=o.clone()),o.applyTransformation(x)),null===S?S=o===t?o.clone():o:S.add(o,!1)}I++}while(_.xmin+ ++h*D<d.xmax);if(m)return null;null===S&&(S=t.createInstance()),p===n.G.enumPolygon&&I>1&&b-d.width()<=10*T&&(S=(new l.g).execute(S,e,!0,g))}else{let n=N(t,s,o,D);if(S=t.clone(),0!==n){const t=new a.T;t.setShiftCoords(-n*D,0),S.applyTransformation(t)}do{if(m){if(f[0]=C(S,s,e,i,g),!f[0])return null}else if(S=(new l.e).execute(S,s,e,g),S===s&&(S=s.clone()),S.isEmpty())break;const t=new a.T;t.setShiftCoords(-D,0),S.applyTransformation(t)}while(_.xmin+ ++n*D<d.xmax);if(m)return null;if(!S.isEmpty()&&0!==n){const t=new a.T;t.setShiftCoords(n*D,0),S.applyTransformation(t)}}return S}function C(t,e,s,i,o){let h;if(e.getGeometryType()===n.G.enumPolygon)h=i?(0,l.r)(e,t,s,64,o):(0,l.r)(e,t,s,4,o);else if(i){const s=new r.Envelope2D,i=new r.Envelope2D;e.queryEnvelope(s),t.queryEnvelope(i),h=s.containsEnvelope(i)}else h=(0,l.r)(e,t,s,4,o);return h}function N(t,e,s,i){if(!s)return 0;let n=0;const o=new r.Envelope2D;e.queryEnvelope(o);const h=new r.Envelope2D;t.queryEnvelope(h);const m=o.xmin+i;for(;m+i+n*i>h.xmin;)n--;for(;m+n*i<h.xmin;)n++;return n}function E(t,e,s,i,n){e.x-t.x>s?n.setCoords(e.x-i,e.y):t.x-e.x>s?n.setCoords(e.x+i,e.y):n.setCoordsPoint2D(e)}function w(t,e,s,i,n,o,r){Math.abs(t.y)===s?(o.setCoords(e.x,t.y),r.setCoordsPoint2D(e)):Math.abs(e.y)===s?(o.setCoordsPoint2D(t),r.setCoords(t.x,e.y)):(o.setCoordsPoint2D(t),E(o,e,i,n,r))}function y(t){return t.getUnit().getUnitToBaseFactor()}function G(t){return t.getUnit().getUnitToBaseFactor()}function z(t){return t.getPECoordSys().getDatum().getSpheroid().getAxis()}function k(t,e,s){return s<=.5?t+(e-t)*s:e-(e-t)*(1-s)}class q{checkSegment(){for(let t=0;t<this.n;t++){if(null!==this.pSplitLines2Info&&this.pSplitLines2Info.hasSplitLines()&&!this.bCheckIfNoDensificationNeededForCurve){const t=this.pSplitLines2Info.getSplitLineFactorEx(this.rectifiedSegment,this.leftFactor,this.rightFactor,this.leftGcsToDensifiedPoint,this.rightGcsToDensifiedPoint,this.progressTracker);if(Number.isNaN(t))return-1;if(-1!==t&&this.leftFactor<t&&t<this.rightFactor)return this.cutFactor=t,this.cutFromDensifiedPoint.assign(this.rectifiedSegment.getCoord2D(this.cutFactor)),this.cutToDensifiedPoint.assign(b(this.cutFromDensifiedPoint,this.transform)),this.cutGcsToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.cutToDensifiedPoint.assign(b(this.cutGcsToDensifiedPoint,this.transform2)),this.midFactor=this.cutFactor,this.midFromDensifiedPoint.setCoordsPoint2D(this.cutFromDensifiedPoint),this.midToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.midGcsToDensifiedPoint.setCoordsPoint2D(this.cutGcsToDensifiedPoint),1}if(this.cutFactor=k(this.leftFactor,this.rightFactor,this.scalars[t]),this.cutFromDensifiedPoint.assign(this.rectifiedSegment.getCoord2D(this.cutFactor)),this.cutToDensifiedPoint.assign(b(this.cutFromDensifiedPoint,this.transform)),null!==this.transform2&&(this.cutGcsToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.cutToDensifiedPoint.assign(b(this.cutGcsToDensifiedPoint,this.transform2))),0===t&&(this.midFactor=this.cutFactor,this.midFromDensifiedPoint.setCoordsPoint2D(this.cutFromDensifiedPoint),this.midToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.midGcsToDensifiedPoint.setCoordsPoint2D(this.cutGcsToDensifiedPoint)),this.bIsPannableFrom&&!this.bCheckIfNoDensificationNeededForCurve&&Math.abs(this.leftFromDensifiedPoint.x-this.rightFromDensifiedPoint.x)>=.25*this.pannableExtentFrom.width())return 1;let e;if(this.bCheckIfNoDensificationNeededForCurve){const t=this.projCurveSegment.get().getClosestCoordinate(this.cutToDensifiedPoint,!1),s=this.projCurveSegment.get().getCoord2D(t);e=m.P.sqrDistance(this.cutToDensifiedPoint,s)}else{const s=new m.P,i=new m.P,n=D(this.leftToDensifiedPoint,this.cutToDensifiedPoint,this.rightToDensifiedPoint,this.bSrToIsGcs,this.bIsPannableTo,this.pannableExtentTo,s,i);this.line.setStartXY(s),this.line.setEndXY(i);const o=this.line.getClosestCoordinate(this.cutToDensifiedPoint,!0);if(n||t>0||Math.abs(o-this.scalars[t])<.3){const t=this.line.getCoord2D(o);e=m.P.sqrDistance(this.cutToDensifiedPoint,t)}else e=2*this.maxDeviationInSrToSq,this.bNeedPostFiltering=!0}if(e>this.maxDeviationInSrToSq)return this.bCheckIfNoDensificationNeededForCurve=!1,1}return 0}constructor(t,e,s,i,n,o,a,l,c,u,f,g,_){this.leftFromDensifiedPoint=new m.P,this.rightFromDensifiedPoint=new m.P,this.cutFromDensifiedPoint=new m.P,this.midFromDensifiedPoint=new m.P,this.leftToDensifiedPoint=new m.P,this.rightToDensifiedPoint=new m.P,this.cutToDensifiedPoint=new m.P,this.midToDensifiedPoint=new m.P,this.line=new h.L,this.leftGcsToDensifiedPoint=new m.P,this.rightGcsToDensifiedPoint=new m.P,this.cutGcsToDensifiedPoint=new m.P,this.midGcsToDensifiedPoint=new m.P,this.bSrToIsGcs=!1,this.bIsCurve=!1,this.leftFactor=0,this.rightFactor=0,this.bIsFirstInPath=!1,this.rectifiedSegment=null,this.transform=null,this.bIsPannableFrom=!1,this.pannableExtentFrom=new r.Envelope2D,this.bIsPannableTo=!1,this.bNeedPostFiltering=!1,this.pannableExtentTo=new r.Envelope2D,this.transform2=null,this.pHorizon2Info=null,this.pSplitLines2Info=null,this.minLengthInSrFrom=0,this.maxDeviationInSrToSq=0,this.cutFactor=0,this.midFactor=0,this.pDensifiedFactors=null,this.pDensifiedPoints=[],this.rightFromDensifiedPointsStack=[],this.rightToDensifiedPointsStack=[],this.rightGcsToDensifiedPointsStack=[],this.rightFactorsStack=[],this.projCurveSegment=new h.S,this.n=0,this.bCheckIfNoDensificationNeededForCurve=!1,this.scalars=(0,m.d)(7,Number.NaN),this.progressTracker=_,this.transform=t,this.bIsPannableFrom=e,this.pannableExtentFrom.assign(s),this.bIsPannableTo=i,this.pannableExtentTo.assign(n),this.transform2=o,this.pHorizon2Info=a,this.pSplitLines2Info=l,this.minLengthInSrFrom=c,this.maxDeviationInSrToSq=u,this.pDensifiedFactors=f,this.pDensifiedPoints=g,this.progressTracker=_,this.bNeedPostFiltering=!1}needsPostFiltering(){return this.bNeedPostFiltering}densifySegment(t,e){if(this.bIsFirstInPath=t,this.rectifiedSegment=e,this.leftGcsToDensifiedPoint.setNAN(),this.rightGcsToDensifiedPoint.setNAN(),this.cutGcsToDensifiedPoint.setNAN(),this.midGcsToDensifiedPoint.setNAN(),this.bSrToIsGcs=null!=this.transform2?1===this.transform2.getOutputSR().getCoordinateSystemType():1===this.transform.getOutputSR().getCoordinateSystemType(),this.bIsCurve=this.rectifiedSegment.isCurve(),this.leftFactor=0,this.rightFactor=1,this.leftFromDensifiedPoint.assign(this.rectifiedSegment.getStartXY()),this.rightFromDensifiedPoint.assign(this.rectifiedSegment.getEndXY()),this.leftToDensifiedPoint.assign(b(this.leftFromDensifiedPoint,this.transform)),this.rightToDensifiedPoint.assign(b(this.rightFromDensifiedPoint,this.transform)),null!==this.transform2&&(this.leftGcsToDensifiedPoint.setCoordsPoint2D(this.leftToDensifiedPoint),this.rightGcsToDensifiedPoint.setCoordsPoint2D(this.rightToDensifiedPoint),this.leftToDensifiedPoint.assign(b(this.leftGcsToDensifiedPoint,this.transform2)),this.rightToDensifiedPoint.assign(b(this.rightGcsToDensifiedPoint,this.transform2)),this.bIsFirstInPath&&!this.pHorizon2Info.isPointStartInHorizon(this.leftGcsToDensifiedPoint,this.progressTracker)))return!1;this.rightFromDensifiedPointsStack.length=0,this.rightToDensifiedPointsStack.length=0,this.rightGcsToDensifiedPointsStack.length=0,this.rightFactorsStack.length=0,this.rightFromDensifiedPointsStack.push(this.rightFromDensifiedPoint.clone()),this.rightToDensifiedPointsStack.push(this.rightToDensifiedPoint.clone()),this.rightFactorsStack.push(this.rightFactor),null!=this.transform2&&this.rightGcsToDensifiedPointsStack.push(this.rightGcsToDensifiedPoint.clone()),null!==this.pDensifiedPoints&&this.pDensifiedPoints.push(this.leftFromDensifiedPoint.clone()),null!==this.pDensifiedFactors&&this.pDensifiedFactors.push(this.leftFactor),this.bIsCurve?this.rectifiedSegment.getGeometryType()===n.G.enumBezier?this.n=7:this.n=5:this.n=3,function(t,e){for(let s=0;s<t;s++){let i=Math.ceil(s/2)/(t+1);s%2!=0&&(i=-i);const n=.5+i;e[s]=n}}(this.n,this.scalars);const s=this.rectifiedSegment.calculateLength2D();if(this.bCheckIfNoDensificationNeededForCurve=!1,this.bIsCurve){const t=new h.P({vd:this.rectifiedSegment.getDescription()});let e=(new l.v).execute(t,this.transform,this.progressTracker);if(null!==this.transform2){const t=new r.Envelope2D;if(e.queryEnvelope(t),!this.pHorizon2Info.isEnvelopeInHorizon(t,this.progressTracker))return!1;e=(new l.v).execute(e,this.transform2,this.progressTracker)}e.getSegmentBuffer(0,this.projCurveSegment,!1),this.bCheckIfNoDensificationNeededForCurve=!0}for(;this.rightFromDensifiedPointsStack.length>0;){let t=!1;if(this.cutFactor=Number.NaN,this.midFactor=Number.NaN,this.midFromDensifiedPoint.setNAN(),this.midToDensifiedPoint.setNAN(),(this.rightFactor-this.leftFactor)*s>this.minLengthInSrFrom){const e=this.checkSegment();if(-1===e)return!1;t=0!==e}if(t)this.rightFromDensifiedPoint.setCoordsPoint2D(this.midFromDensifiedPoint),this.rightToDensifiedPoint.setCoordsPoint2D(this.midToDensifiedPoint),this.rightFactor=this.midFactor,this.rightFromDensifiedPointsStack.push(this.rightFromDensifiedPoint.clone()),this.rightToDensifiedPointsStack.push(this.rightToDensifiedPoint.clone()),this.rightFactorsStack.push(this.rightFactor),null!==this.transform2&&(this.rightGcsToDensifiedPoint.setCoordsPoint2D(this.midGcsToDensifiedPoint),this.rightGcsToDensifiedPointsStack.push(this.rightGcsToDensifiedPoint.clone()));else{if(null!==this.transform2&&!this.pHorizon2Info.isAdjoiningLineInHorizon(this.leftGcsToDensifiedPoint,this.rightGcsToDensifiedPoint,this.progressTracker))return!1;if(this.rightFromDensifiedPointsStack.pop(),this.rightToDensifiedPointsStack.pop(),this.rightFactorsStack.pop(),null!==this.transform2&&this.rightGcsToDensifiedPointsStack.pop(),null!==this.pDensifiedPoints&&this.pDensifiedPoints.push(this.rightFromDensifiedPoint.clone()),null!==this.pDensifiedFactors&&this.pDensifiedFactors.push(this.rightFactor),this.rightFromDensifiedPointsStack.length>0){this.leftFromDensifiedPoint.setCoordsPoint2D(this.rightFromDensifiedPoint),this.leftToDensifiedPoint.setCoordsPoint2D(this.rightToDensifiedPoint),this.leftFactor=this.rightFactor;const t=this.rightFromDensifiedPointsStack.at(-1),e=this.rightToDensifiedPointsStack.at(-1);if(this.rightFromDensifiedPoint.setCoordsPoint2D(t),this.rightToDensifiedPoint.setCoordsPoint2D(e),this.rightFactor=this.rightFactorsStack.at(-1),null!==this.transform2){this.leftGcsToDensifiedPoint.setCoordsPoint2D(this.rightGcsToDensifiedPoint);const t=this.rightGcsToDensifiedPointsStack.at(-1);this.rightGcsToDensifiedPoint.setCoordsPoint2D(t)}}}}return!0}}class L{getOperatorType(){return 10315}supportsCurves(){return!1}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,i,n,o){return u(s)?new R(t,e,s,i,n,o):(new l.v).executeMany(t,s,o)}execute(t,e,s,i,n){if(!u(e))return(new l.v).execute(t,e,n);const o=new _;return o.prepare(e,null,n),o.execute(t,s,i,n)}}class R extends i.G{constructor(t,e,s,i,o,r){super(),this.m_spp=null,this.m_index=-1,t||(0,n.t)(""),this.m_progressTracker=r,this.m_geometries=t,this.m_geometriesExtent=e?e.clone():null,this.m_transform=s,this.m_minSegmentLengthInDegrees=i,this.m_maxDeviationInSrTo=o}tock(){return!0}getRank(){return 1}next(){this.m_spp||(this.m_spp=new _,this.m_spp.prepare(this.m_transform,this.m_geometriesExtent,this.m_progressTracker));const t=this.m_geometries.next();return(0,n.d)(t),(0,n.l)(t),null!=t?(this.m_index=this.m_geometries.getGeometryID(),this.m_spp.execute(t,this.m_minSegmentLengthInDegrees,this.m_maxDeviationInSrTo,this.m_progressTracker)):null}getGeometryID(){return this.m_index}}}}]);