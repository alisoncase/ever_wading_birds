"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[33737,78184],{39652:(e,t,n)=>{function r(e){const{attributes:t,sourceLayer:n}=e??{},r=n&&"displayField"in n?n.displayField:null,i=r?t?.[r]:null,o=null!=i?JSON.stringify(i):null,a=e?.getObjectId()?.toString();return o||a||""}n.d(t,{R:()=>r})},41327:(e,t,n)=>{n.d(t,{Au:()=>I,CU:()=>$,Et:()=>b,Gq:()=>M,H1:()=>j,HG:()=>O,Iy:()=>v,Kl:()=>z,Kn:()=>H,LZ:()=>Z,TN:()=>T,U3:()=>B,Ve:()=>D,XI:()=>N,bx:()=>_,cU:()=>C,k_:()=>w,lB:()=>G,l_:()=>P,n4:()=>Q,nT:()=>F,oc:()=>S,qG:()=>V,rf:()=>g,s9:()=>U,t6:()=>L,tM:()=>R,vp:()=>k,wr:()=>A});n(88677);var r=n(62631),i=n(7951),o=n(82301),a=n(50925),s=n(56612),l=n(96299),u=n(7249),c=n(95011),d=n(78076),y=n(79538),f=n(53826),p=n(82368),m=n(39652),h=n(99961);const g=e=>"field"===e?.type,b=e=>"group"===e?.type,F=e=>"relationship"===e?.type,w=e=>"text"===e.type,I=e=>"utilityNetworkAssociations"===e.type,_=e=>!b(e)&&null!=e.group,A=e=>e.reduce(((e,t)=>b(t)?[...e,...t.inputs]:[...e,t]),[]),v=e=>A(e).filter(g),C=e=>A(e).filter(F),T=e=>A(e).filter(I),N=e=>null!=e&&(O(e,"combo-box")||O(e,"radio-buttons")),O=(e,t)=>null!=e&&e.input?.type===t,M=e=>{let{domain:t,inputType:n="text-box",dataType:r}=e;return"number"===r&&"text-box"===n&&(!t||"coded-value"!==t.type)};function k(e,t){const{title:n,feature:r}=e??{};return n||(r?(0,m.R)(r):null)||t||""}function Z(e){const{attributes:t,fieldsIndex:n,label:i,timeZone:o}=e;if(!t||"object"!=typeof t)return i;const a=Object.keys(t).filter((e=>(0,s.mk)(i,e))),l=a.map((e=>t[e])),u=a.map((e=>n.get(e))).filter(r.Ru);return function(e,t){return(0,s.HC)((0,s.HC)(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[t.toLowerCase(),n]}))))}(i,D({values:l,fields:u,timeZone:o}))}const q="expression/",E="expr/",x="field/";function S(e){const[t,n]=e.split(q);return""===t&&n?n:(a.A.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${q}/expressionName'`),"")}function L(e){return`${q}${e}`}function j(e){return`${x}${e}`}function U(e){return e.startsWith(q)}function V(e){return e.startsWith(E)}function D(e){const{fields:t,values:n}=e,r=e.timeZone??void 0,i=t.map(((e,t)=>{let i=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===i));t?.name&&(i=t.name)}return((0,y.fs)(e)||(0,c.isTimeOnlyField)(e))&&(i=(0,f.ZP)(e,i,{timeZone:r,...(0,f.ZT)(e)})),[e.name,i]}));return Object.fromEntries(i)}const $=e=>{const t={typeFieldName:null,types:[]};return e?((0,d.Sv)(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map((e=>{let{id:t,name:n,domains:r}=e;return{code:t,name:n,domains:r}}))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},R=(e,t,n)=>{const{dataType:r,error:i,minLength:o}=e,a=t?.validationErrors;if(!a||!i)return null;if(i===p.gK.CANNOT_BE_EMPTY)return a.cannotBeNull;if(i===u.Mh.VALUE_OUT_OF_RANGE||i===c.NumericRangeValidationError.OUT_OF_RANGE){const{field:t,range:i}=e,o={type:"date",intlOptions:{timeZone:"date"===t.type&&n?n:void 0,...(0,f.ZT)(t)}},s=(0,p.hQ)(i,a);return(0,h.V)(s,i,{format:{max:"date"===r?o:null!=i.max&&(0,p.qn)(i.max)?p.Qv:p.PA,min:"date"===r?o:null!=i.min&&(0,p.qn)(i.min)?p.Qv:p.PA}})}return i===u.Mh.INVALID_CODED_VALUE?a.invalidCodedValue:i===c.TypeValidationError.INVALID_TYPE?a.invalidType:i===p.gK.TOO_SHORT?(0,h.V)(a.tooShort,{min:o}):(p.gK.TOO_LONG,null)},P=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":"mesh"===r||"mesh"===n||"multipatch"===n?"cube":"multipoint"===r||"multipoint"===n?"point":r||n||"table"},Q=e=>{const t=[];if(e.formTemplate){const{description:n,title:r}=e.formTemplate;e.fields?.forEach((e=>{const i=r&&(0,s.mk)(r,e.name),o=n&&(0,s.mk)(n,e.name);(i||o)&&t.push(e.name)}))}return t};function G(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(l.jt)??[]).some((t=>{let{fieldName:n}=t;return!e.fieldsIndex.get(n)}))}function H(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function z(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return(0,i.Xb)(t.objectType),!1}}function B(e,t,n){const r=(0,d.fV)(e),i=r?.find((e=>e.code===n));if(!i)return!1;const a=r?.find((e=>e.code===t));return!(0,o.equalsShallow)(i.defaultValues,a?.defaultValues)&&Object.values(i.defaultValues).some((e=>null!=e))}},53826:(e,t,n)=>{n.d(t,{Ng:()=>A,OM:()=>g,Q0:()=>w,T8:()=>F,ZP:()=>_,ZT:()=>I,eX:()=>T,fD:()=>M,fb:()=>p,fl:()=>f,iP:()=>O,oh:()=>v,rX:()=>k,sH:()=>m,yk:()=>Z});n(88677),n(21265);var r=n(74719),i=n(64682),o=n(66845),a=n(72520),s=n(69943),l=n(73210),u=n(51536),c=n(12711);const d=l.n$,y={date:null,time:null,timeZoneOffset:null},f=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),p="latn",m=new Set(["date-only","time-only","timestamp-offset"]),h=e=>"valueAsDate"in e;function g(e){return{locale:(0,c.JK)(),numberingSystem:p,zone:e??d}}function b(e,t){return null==e?null:u.c9.fromMillis(e,g(t))}function F(e,t){if(null==e||!(0,s.Kg)(e)||""===e){if(t){const e=u.c9.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return y}const n=u.c9.fromISO(e,{setZone:!0});return{date:n.toFormat(a.mo,g()),time:n.toFormat(a.Uq.HMS_MS,g()),timeZoneOffset:n.offset.toString()}}function w(e,t){if(null==e||!(0,s.Et)(e)||isNaN(e))return y;const n=b(e,t);return n?{date:n.toFormat(a.mo,g(t)),time:n.toFormat(a.Fj,g(t))}:y}function I(e){switch(e.type){case"date":default:return(0,o.J2)("short-date-short-time");case"date-only":return(0,o.J2)("short-date");case"time-only":return(0,o.J2)("short-time");case"timestamp-offset":return{...(0,o.J2)("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function _(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return(0,o.Yq)(t,n);case"date-only":return(0,o.iS)(t,n);case"time-only":return(0,o.F8)(t,n);case"timestamp-offset":return(0,o.Ey)(t,n);default:return null}}function A(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:r,timeZoneComponent:i,oldValue:o}=e;if(!t?.value)return null;const{year:s,month:c,day:d}=u.c9.fromFormat(t.value,a.mo),{hour:y,minute:f,second:p,millisecond:m}=C(r,l.n$)??u.c9.now(),h=F(o,n),g=i?.value?parseInt(i.value,10):null!=h.timeZoneOffset?parseInt(h.timeZoneOffset,10):(new Date).getTimezoneOffset(),b=u.mQ.instance(g),w=u.c9.fromObject({year:s,month:c,day:d,hour:y,minute:f,second:p,millisecond:m},{zone:b});return w.isValid?w.toISO({includeOffset:!0}):null}function v(e){const{dateComponent:t,timeComponent:n,timeZone:r,max:i,min:o,oldValue:a}=e,s=C(t,r);let l=!!e.applyRange;if(!s)return null;let c=null;if(null!=n?.value){const e=C(n,r),t=Date.now(),o=null!=i&&i<t?i:t,a=u.c9.fromMillis(o,g(r)),l=s||a,{year:d,month:y,day:f}=l,{hour:p,minute:m,second:h,millisecond:b}=e||a;c=l.set({year:d,month:y,day:f,hour:p,minute:m,second:h,millisecond:b})}else{const e=b(N({value:a??Date.now(),max:i,min:o}),r),{year:t,month:n,day:u}=s,{hour:d,minute:y,second:f,millisecond:p}=e;l=!0,c=s.set({year:t,month:n,day:u,hour:d,minute:y,second:f,millisecond:p})}if(!c.isValid)return null;const d=c.toMillis();return l?N({value:d,max:i,min:o}):d}function C(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=h(e)?u.c9.fromFormat(e.value,a.mo,g(t)):(0,a.UE)(e.value),n?.isValid?n:null}function T(e){const{max:t,min:n,value:r}=e;return!isNaN(r)&&!(null!=t&&r>t)&&!(null!=n&&r<n)}function N(e){const{max:t,min:n,value:r}=e;return null!=t&&null!=n?(0,i.qE)(r,n,t):null!=t&&r>t?t:null!=n&&r<n?n:r}function O(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new r.default("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),i=new Array(3);for(let r=0;r<3;r++){const e=n.at(r)??"";i[r]=e.padStart(2,"0")}return i.join(":")}function M(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return O(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function k(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function Z(e){const{type:t,range:n,value:r}=e;if(null==r||!n||r===n.min||r===n.max)return!0;if("date"===t)return T({value:r,min:n.min,max:n.max});const{rawMax:i,rawMin:o}=n;let s=null,l=null,u=null;switch(t){case"date-only":s=(0,a.Xi)(i),l=(0,a.Xi)(o),u=(0,a.Xi)(r);break;case"time-only":s=(0,a.UE)(i),l=(0,a.UE)(o),u=(0,a.UE)(r);break;case"timestamp-offset":s=(0,a.gz)(i),l=(0,a.gz)(o),u=(0,a.gz)(r)}return!u||T({value:u.valueOf(),min:l?.valueOf(),max:s?.valueOf()})}},81558:(e,t,n)=>{n.d(t,{A:()=>I});var r=n(93800),i=n(79625),o=n(6946),a=n(85715),s=n(89129),l=n(93633),u=n(49959),c=n(90450),d=n(79953),y=n(48602),f=(n(21265),n(50925),n(14746),n(75269)),p=n(78076),m=n(48362),h=n(53512);const g="assetgroup",b="assettype";var F=n(92471);let w=class extends(a.A.ClonableMixin(l.A.IdentifiableMixin(o.default))){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.networkSourceIdsInUse=new Set,this.source="popup",this.description=null,this.graphic=null,this.layer=null,this.map=null,this.featureCount=0,this.associationTypes=null,this.showAllEnabled=!1,this.title=null,this.attachmentsFeatureCount=0,this.structureFeatureCount=0,this.contentFeatureCount=0,this.containerFeatureCount=0,this.connectivityFeatureCount=0,this._queryOpenAssociationType=async()=>{this.activeAssociationType&&await this._queryDebounced(this.activeAssociationType)},this._cancelQuery=()=>{const{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._queryController=async e=>{this._cancelQuery();const t=new AbortController;this._queryAbortController=t,await(0,u.ignoreAbortErrors)(this._query(e)),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const e=new AbortController;this._queryFeatureCountAbortController=e,await(0,u.ignoreAbortErrors)(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryDebounced=(0,u.debounce)(this._queryController,100),this._queryFeatureCountDebounced=(0,u.debounce)(this._queryFeatureCountController,100)}initialize(){this.addHandles([(0,d.watch)((()=>[this.graphic,this.layer,this.map,this.associationTypes,this.objectId,this.globalId,this.canQuery]),(()=>this.refresh()),d.initial),(0,d.watch)((()=>this.activeAssociationType),(e=>this._queryDebounced(e)),d.initial)])}destroy(){this._cancelQuery(),this._cancelQueryFeatureCount(),this._destroyAssociatedFeatureViewModels()}get supportsCacheHint(){return!!this.layer?.capabilities?.query?.supportsCacheHint}get canLoad(){return!!this.map&&!!this.associationTypes&&"string"==typeof this.globalId}get canQuery(){const e=this.layer?.capabilities?.query;return!!this.associationTypes&&"string"==typeof this.globalId&&!!e?.supportsPagination}set displayCount(e){this._set("displayCount",Math.max(e??3,0))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get globalId(){return(this.globalIdField&&this.graphic?.attributes?.[this.globalIdField])??null}get globalIdField(){const{layer:e}=this;return e?.globalIdField}get activeAssociationType(){return this._get("activeAssociationType")}set activeAssociationType(e){e&&!this.associationTypes.includes(e)||this._set("activeAssociationType",e)}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:n,canQuery:r,_loaded:i,canLoad:o,source:a}=this;return t||o&&!i?"loading":e||n?"querying":!r||"popup"===a&&0===this.featureCount?"disabled":"ready"}get utilityNetwork(){const{layer:e,map:t}=this;if(!e?.loaded||!t)return null;const n=(0,p.Sv)(e)?e.parent:e;return(0,F.findUtilityNetwork)(t,n)}get attachmentsAssociations(){return this._get("attachmentsAssociations")||new s.default}get structureAssociations(){return this._get("structureAssociations")||new s.default}get contentAssociations(){return this._get("contentAssociations")||new s.default}get containerAssociations(){return this._get("containerAssociations")||new s.default}get connectivityAssociations(){return this._get("connectivityAssociations")||new s.default}get associationFeatures(){return this._get("associationFeatures")||new c.A}get associationViewModels(){return this._get("associationViewModels")||new Map}async refresh(){await this._queryFeatureCountDebounced(),await this._queryOpenAssociationType()}getFeatureCountForAssociationType(e){switch(e){case"attachment":return this.attachmentsFeatureCount;case"structure":return this.structureFeatureCount;case"content":return this.contentFeatureCount;case"container":return this.containerFeatureCount;case"connectivity":return this.connectivityFeatureCount}}_destroyAssociatedFeatureViewModels(){this.associationViewModels.forEach((e=>e.destroyAll()))}async _loadUtiltyNetworks(){const e=this.map;if(!e)return;await Promise.allSettled(e.utilityNetworks?.map((async e=>{await e.load()}))??[]);const t=this.utilityNetwork;if(t){const n=e=>{if("layerId"in e&&t.isUtilityLayer(e)){const n=t.getSourceIdByLayerId(e.layerId);null!==n&&this.networkSourceIdsInUse.add(n)}};this._set("networkSourceIdsInUse",new Set),e.allLayers.forEach(n),e.allTables.forEach(n)}}async _findLayersBySourceId(e){const{utilityNetwork:t,map:n}=this,r=e=>{const n=e;return!!e.url&&(n.layerId===i&&e.url.replace(/\/\d+$/,"")===t?.featureServiceUrl)};await(t?.load());const i=t.getLayerIdBySourceId(e),o=n.allLayers.filter(r),a=n.allTables.filter(r),s=o.concat(a).toArray();return await Promise.allSettled(s.map((e=>e.load()))),s}_clearAssociations(){this.attachmentsAssociations.removeAll(),this.structureAssociations.removeAll(),this.contentAssociations.removeAll(),this.containerAssociations.removeAll(),this.connectivityAssociations.removeAll()}_clearFeatures(){this.associationFeatures.forEach((e=>e.removeAll())),this.associationFeatures.clear()}_getAssociationsByType(e){switch(e){case"attachment":return this.attachmentsAssociations;case"structure":return this.structureAssociations;case"connectivity":return this.connectivityAssociations;case"container":return this.containerAssociations;case"content":return this.contentAssociations}}async _queryLayer(e,t,n,r,i){const o=e.fieldsIndex.get(g),a=e.fieldsIndex.get(b),s=null!=n,l=null!=r,u="("+t.map((e=>`'${e}'`)).join(", ")+")",c=s?` AND ${o?.name} = ${n}`:"",d=s&&l?` AND ${a?.name} = ${r}`:"",y=`${e.globalIdField} IN ${u}`+c+d,f=new h.default({outFields:["*"],cacheHint:this.supportsCacheHint,where:y});return await this._queryAll(f,e,{signal:i?.signal})}async _createAssociationFeatureObjects(e,t,n,r,i,o){if(0===e.length)return[];const a=new Map;for(const[l,u]of t){const e=await this._findLayersBySourceId(l);for(const t of e)(await this._queryLayer(t,u,r,i,o)).forEach((e=>{if("popup"===this.source?e.layer&&e.getEffectivePopupTemplate():e.layer){const n=a.get(e.attributes[t.globalIdField])??[];n.push(e),a.set(e.attributes[t.globalIdField],n)}}))}const s=[];return await Promise.all(e.toArray().map((async e=>{const{fromNetworkElement:t,toNetworkElement:r}=e,i=t.globalId===n?r:t,o=a.get(i.globalId)??[];await Promise.all(o.map((async t=>{const n=this.utilityNetwork?.getTerminalById(i?.terminalId)?.name;if(t.layer&&"getFeatureTitle"in t.layer){const r=await t.layer.getFeatureTitle(t);s.push({title:r,association:e,feature:t,terminalName:n})}else s.push({association:e,feature:t,terminalName:n})})))}))),s}_parseFeatureObjects(e,t){e.forEach((e=>{const n=e?.feature,r=n.layer,i=t.get(r)??new s.default;i.add(e),t.set(r,i)}))}async _queryAll(e,t,n){const r=[];let i=0,o=!1;e.num=t.sourceJSON?.maxRecordCount??2e3;do{e.start=i;const a=await t.queryFeatures(e,n);r.push(...a.features),o=a.exceededTransferLimit,o&&(i+=a.features.length)}while(o);return r}async _queryAssociations(e){const{layer:t,globalId:n,associationTypes:r,utilityNetwork:i,canQuery:o}=this;if(await Promise.allSettled([t?.load(),i?.load()]),this._clearAssociations(),!(o&&t&&r&&i&&n))return;const a=(0,p.Sv)(t)?t.parent:t,s=new m.default({globalId:n,networkSourceId:i.getSourceIdByLayerId(a.layerId)}),l=new Set;r.forEach((e=>{switch(e.type){case"attachment":case"structure":l.add("attachment");break;case"container":case"content":l.add("containment");break;case"connectivity":l.add("connectivity"),l.add("junction-junction-connectivity"),l.add("junction-edge-from-connectivity"),l.add("junction-edge-midspan-connectivity"),l.add("junction-edge-to-connectivity")}}));const u=await(i?.queryAssociations({elements:[s],types:Array.from(l)},{signal:e?.signal})),c=new Map,d=new Map;r.forEach((e=>{d.set(e.type,e),c.set(e.type,[])})),u.forEach((e=>{const{toNetworkElement:t,fromNetworkElement:r}=e;switch(e.associationType){case"connectivity":case"junction-junction-connectivity":case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":if(r?.globalId===n){if(this._shouldDiscardNetworkElement(t,"connectivity",d))break;c.get("connectivity")?.push(t.globalId)}else{if(this._shouldDiscardNetworkElement(r,"connectivity",d))break;c.get("connectivity")?.push(r.globalId)}this.connectivityAssociations.add(e);break;case"containment":if(r?.globalId===n){if(this._shouldDiscardNetworkElement(t,"content",d))break;c.get("content")?.push(t.globalId),this.contentAssociations.add(e)}else{if(this._shouldDiscardNetworkElement(r,"container",d))break;c.get("container")?.push(r.globalId),this.containerAssociations.add(e)}break;case"attachment":if(r?.globalId===n){if(this._shouldDiscardNetworkElement(t,"attachment",d))break;c.get("attachment")?.push(t.globalId),this.attachmentsAssociations.add(e)}else{if(this._shouldDiscardNetworkElement(r,"structure",d))break;c.get("structure")?.push(r.globalId),this.structureAssociations.add(e)}}}));const y=r.map((async t=>{const{associatedNetworkSourceId:n,associatedAssetGroup:r,associatedAssetType:i}=t,o=c.get(t.type),a=null!=r?await this._countAssociatedFeatures(n,o,r,i,e):o.length;switch(t.type){case"attachment":this._set("attachmentsFeatureCount",a);break;case"structure":this._set("structureFeatureCount",a);break;case"content":this._set("contentFeatureCount",a);break;case"container":this._set("containerFeatureCount",a);break;case"connectivity":this._set("connectivityFeatureCount",a)}}));await Promise.allSettled(y)}async _countAssociatedFeatureCount(e,t,n,r,i){const o=e.fieldsIndex.get(g),a=e.fieldsIndex.get(b),s=null!=r,l="("+t.map((e=>`'${e}'`)).join(", ")+")",u=` AND ${o?.name} = ${n}`,c=s?` AND ${a?.name} = ${r}`:"",d=`${e.globalIdField} IN ${l}`+u+c;return e.queryFeatureCount({where:d,outFields:["*"],returnGeometry:!1},{signal:i?.signal})}async _countAssociatedFeatures(e,t,n,r,i){if(0===t.length)return 0;const o=(await this._findLayersBySourceId(e)).map((async e=>this._countAssociatedFeatureCount(e,t,n,r,i)));return(await Promise.all(o)).reduce(((e,t)=>e+t),0)}async _queryAssociatedFeatures(e,t){const{layer:n,globalId:r,associationTypes:i,utilityNetwork:o,canQuery:a,associationFeatures:s}=this;if(await Promise.allSettled([n?.load(),o?.load()]),!(a&&n&&i&&o))return;const l=this._getAssociationsByType(e.type),{associatedAssetGroup:u,associatedAssetType:c}=e,d=new Map;l.forEach((e=>{const{fromNetworkElement:t,toNetworkElement:n}=e,{networkSourceId:i,elementGlobalId:o}=t.globalId===r?{networkSourceId:n.networkSourceId,elementGlobalId:n.globalId}:{networkSourceId:t.networkSourceId,elementGlobalId:t.globalId},a=d.get(i)||[];a.push(o),d.set(i,a)}));const y=await this._createAssociationFeatureObjects(l,d,r,u,c,t);this._parseFeatureObjects(y,s)}async _queryFeatureCount(){await this._loadUtiltyNetworks();const{_queryFeatureCountAbortController:e,canQuery:t}=this;t?(await this._queryAssociations(e),this._set("featureCount",this.attachmentsFeatureCount+this.structureFeatureCount+this.contentFeatureCount+this.containerFeatureCount+this.connectivityFeatureCount)):this._set("featureCount",0)}async _query(e){if(!e)return;await this._loadUtiltyNetworks();const{_queryAbortController:t}=this;this._destroyAssociatedFeatureViewModels(),this._clearFeatures(),0!==this.featureCount&&(this.destroyed||await this._queryAssociatedFeatures(e,{signal:t?.signal}))}_shouldDiscardNetworkElement(e,t,n){if(!e)return!1;const{networkSourceIdsInUse:r}=this,{networkSourceId:i}=e,o=n.get(t)?.associatedNetworkSourceId,a=r.has(i);return null!=o&&o!==i||!a}};(0,r._)([(0,y.MZ)()],w.prototype,"_loaded",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"_queryAbortController",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"_queryPageAbortController",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"_queryFeatureCountAbortController",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"supportsCacheHint",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"canLoad",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"canQuery",null),(0,r._)([(0,y.MZ)()],w.prototype,"networkSourceIdsInUse",void 0),(0,r._)([(0,y.MZ)({constructOnly:!0})],w.prototype,"source",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"description",void 0),(0,r._)([(0,y.MZ)({value:3})],w.prototype,"displayCount",null),(0,r._)([(0,y.MZ)({type:i.default})],w.prototype,"graphic",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"layer",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"map",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"objectId",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"objectIdField",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"globalId",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"globalIdField",null),(0,r._)([(0,y.MZ)()],w.prototype,"featureCount",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"associationTypes",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"activeAssociationType",null),(0,r._)([(0,y.MZ)()],w.prototype,"showAllEnabled",void 0),(0,r._)([(0,y.MZ)()],w.prototype,"state",null),(0,r._)([(0,y.MZ)()],w.prototype,"title",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"utilityNetwork",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"attachmentsFeatureCount",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"structureFeatureCount",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"attachmentsAssociations",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"structureAssociations",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"contentFeatureCount",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"containerFeatureCount",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"contentAssociations",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"containerAssociations",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"connectivityFeatureCount",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"connectivityAssociations",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"associationFeatures",null),(0,r._)([(0,y.MZ)({readOnly:!0})],w.prototype,"associationViewModels",null),w=(0,r._)([(0,f.$)("esri.widgets.support.UtilityNetworkAssociations.FeatureUtilityNetworkAssociationsViewModel")],w);const I=w},82368:(e,t,n)=>{n.d(t,{$$:()=>I,D_:()=>y,Gd:()=>d,Kx:()=>r,PA:()=>g,Po:()=>f,Qv:()=>b,gK:()=>i,hQ:()=>w,jl:()=>m,of:()=>c,qn:()=>F,zU:()=>p});var r,i,o,a=n(96299),s=n(7249),l=n(95011),u=n(53826);(o=r||(r={})).Text="text",o.Number="number",o.Date="date",o.Unsupported="unsupported",function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(i||(i={}));const c=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};function d(e,t){const{dataType:n,domain:r,field:o,maxLength:a,minLength:c,range:d,required:y}=t;if(null==e)return y?i.CANNOT_BE_EMPTY:null;if("text"===n&&"string"==typeof e){if(c>-1&&e.length<c)return i.TOO_SHORT;if(a>-1&&e.length>a)return i.TOO_LONG}return"date"!==n||(0,u.yk)({type:o.type,range:d,value:e})?r?(0,s.wb)(o,e,r):(0,l.validateFieldValue)(o,e)??(0,s.wb)(o,e):l.NumericRangeValidationError.OUT_OF_RANGE}function y(e,t){return!(!f(e)||!f(t))||e===t}function f(e){return null==e||""===e}function p(e){let{dataType:t,field:n,input:i}=e;if(t===r.Date)return-1;const o=h(n.length);if(!i||!(0,a.AI)(i))return o;const s=h(i.maxLength);return-1===s?o:-1===o?s:Math.min(o,s)}function m(e){let{dataType:t,field:n,input:i}=e;if(t===r.Date)return-1;if(!i||!(0,a.AI)(i))return-1;const o=h(i.minLength);if(o<0)return-1;const s=h(n.length);return s>-1&&s<o?-1:o}function h(e){return"number"==typeof e&&e>-1?e:-1}const g={type:"number"},b={type:"number",intlOptions:{notation:"scientific"}};function F(e){return e>=1e7||e<=-1e7}function w(e,t){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}const I=e=>e&&!Number.isNaN(e.valueOf())},92471:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>J,createFieldInfoMap:()=>z,findRelatedLayer:()=>se,findUtilityNetwork:()=>le,fixTokens:()=>L,formatAttributes:()=>Y,formatEditInfo:()=>H,formatValueToFieldInfo:()=>P,getAllFieldInfos:()=>B,getFieldInfo:()=>G,getFieldInfoLabel:()=>O,getFixedFieldName:()=>M,getFixedFieldNames:()=>k,getHighlightKeyForFeature:()=>de,getSourceLayer:()=>v,graphicCallback:()=>C,htmlEntities:()=>K,isAssociatedFeatureSupportedLayer:()=>$,isExpressionField:()=>N,isFeatureSupportedLayer:()=>U,isGraphicForRelatableFeatureSupportedLayer:()=>R,isRelatableFeatureSupportedLayer:()=>D,isRelatableLayer:()=>V,isRelatedField:()=>te,preLayerQueryCallback:()=>oe,preRequestCallback:()=>ae,querySourceLayer:()=>W,queryUpdatedFeature:()=>ee,shouldOpenInNewTab:()=>T,substituteAttributes:()=>x,substituteFieldsInLinksAndAttributes:()=>E});var r=n(21265),i=n(50925),o=n(56612),a=n(66845),s=n(23224),l=n(95011),u=n(78076),c=n(79538),d=n(96247),y=n(40731);const f=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),p=/href=(""|'')/gi,m=/(\{([^{\r\n]+)\})/g,h=/'/g,g=/^\s*expression\//i,b=/(\n)/gi,F=/[\u00A0-\u9999<>&]/gim,w=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,I=/^(?:mailto:|tel:)/,_="relationships/",A=(0,a.J2)("short-date-short-time");function v(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function C(e){let{type:t,value:n,event:r}=e;try{return"function"==typeof n?n(r):await n}catch(i){return void f().error("error",`An error occurred when calling the "${t}" function`,{error:i,graphic:r.graphic,value:n})}}function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!I.test(e.trim().toLowerCase())}function N(e){return!!e&&g.test(e)}function O(e,t){const n=function(e,t){if(!t||!N(t)||!e)return;const n=t.replace(g,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===n}))}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function M(e,t){const n=Z(t,e);return n?n.name:e}function k(e,t){return e&&e.map((e=>M(e,t)))}function Z(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function q(e){return`${e}`.trim()}function E(e){let{attributes:t,globalAttributes:n,layer:r,text:i,expressionAttributes:o,fieldInfoMap:a}=e;return i?x({formattedAttributes:n,template:j(i,{...n,...o,...t},r),fieldInfoMap:a}):""}function x(e){let{formattedAttributes:t,template:n,fieldInfoMap:r}=e;return q(function(e){return e.replaceAll(p,"")}((0,o.HC)((0,o.HC)(n,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,r))),t)))}function S(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t[e];if("string"==typeof r){const i="%27",o=(n?encodeURIComponent(r):r).replaceAll(h,i);t[e]=o}}(e,n,t))),n}function L(e,t){return e.replaceAll(m,((e,n,r)=>{const i=Z(t,r);return i?`{${i.name}}`:n}))}function j(e,t,n){const r=L(e,n);return r?r.replaceAll(w,((e,n,r)=>function(e,t,n){const r=(t=q(t))&&"{"!==t[0];return(0,o.HC)(e,S(n,r||!1))}(e,n||r,t))):r}function U(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function V(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function D(e){return U(e)&&V(e)}function $(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function R(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&D(e.sourceLayer)}function P(e,t){const{fieldInfos:n,fieldName:r,preventPlacesFormatting:i,layer:o,timeZone:a}=t,u=G(n,r),d=Z(o,r);if(u&&!(0,l.isRasterPixelValueField)(r)){const t=d?.type,n=u.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,c.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:a,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}})}const y=u?.format;return"string"==typeof e&&(0,l.isRasterPixelValueField)(r)&&y?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?Q(e,",",", ",t):e.includes(";")?Q(e,";","; ",t):e.includes(" ")?Q(e," "," ",t):(0,s.ZV)(Number(e),(0,s.yx)(t))}(e,y):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,y))||null==e||null==y?J(e):(0,s.ZV)(e,i?{...(0,s.yx)(y),minimumFractionDigits:0,maximumFractionDigits:20}:(0,s.yx)(y))}function Q(e,t,n,r){return e.trim().split(t).map((e=>(0,s.ZV)(Number(e),(0,s.yx)(r)))).join(n)}function G(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function H(e,t,n,r){const{creatorField:i,creationDateField:o,editorField:s,editDateField:l}=e;if(!t)return;const u=(0,y.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,n,A,"date"),c={...A,...u},d=t[l];if("number"==typeof d){const e=t[s];return{type:"edit",date:(0,a.Yq)(d,c),user:e}}const f=t[o];if("number"==typeof f){const e=t[i];return{type:"create",date:(0,a.Yq)(f,c),user:e}}return null}function z(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=M(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function B(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}})),t):t}function K(e){return e.replaceAll(F,(e=>`&#${e.charCodeAt(0)};`))}function J(e){return"string"==typeof e?e.replaceAll(b,'<br class="esri-text-new-line" />'):e}function X(e){const{value:t,fieldName:n,fieldInfos:i,fieldInfoMap:o,layer:a,graphic:s,timeZone:u}=e;if(null==t)return"";const d=function(e){let{fieldName:t,value:n,graphic:i,layer:o}=e;if(te(t))return null;if(!o||"function"!=typeof o.getFieldDomain)return null;const a=i&&o.getFieldDomain(t,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(n):null}({fieldName:n,value:t,graphic:s,layer:a});if(d)return d;const y=function(e){let{fieldName:t,graphic:n,layer:r}=e;if(te(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const o=r.getFeatureType(n);return o?o.name:null}({fieldName:n,graphic:s,layer:a});if(y)return y;if(o.get(n.toLowerCase()))return P(t,{fieldInfos:i||Array.from(o.values()),fieldName:n,layer:a,timeZone:u});const f=a?.fieldsIndex?.get(n);return f&&((0,c.fs)(f)||(0,l.isTimeOnlyField)(f))?(0,c.i0)(t,{fieldType:f.type,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:u,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}}):J(t)}function Y(e){let{fieldInfos:t,attributes:n,layer:r,graphic:i,fieldInfoMap:o,relatedInfos:a,timeZone:s}=e;const l={};return a?.forEach((e=>function(e){let{attributes:t,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:a}=e;t&&n&&(n.relatedFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:a}))),n.relatedStatsFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:a}))))}({attributes:l,relatedInfo:e,fieldInfoMap:o,fieldInfos:t,layer:r,timeZone:s}))),n&&Object.keys(n).forEach((e=>{const a=n[e];l[e]=X({fieldName:e,fieldInfos:t,fieldInfoMap:o,layer:r,value:a,graphic:i,timeZone:s})})),l}async function W(e,t){const{layer:n,graphic:r,outFields:i,objectIds:o,returnGeometry:a,spatialReference:s}=e,l=o[0];if("number"!=typeof l&&"string"!=typeof l){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:r,objectId:l,requiredFields:i};return f().warn(e,t),null}if(!(0,u.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:r,requiredFields:i,returnGeometry:a};return f().warn(e,t),null}const c=n.createQuery();return c.objectIds=o,c.outFields=i?.length?i:[n.objectIdField],c.returnGeometry=!!a,c.returnZ=!!a,c.returnM=!!a,c.outSpatialReference=s,(await n.queryFeatures(c,t)).features[0]}async function ee(e,t){let{graphic:n,popupTemplate:r,layer:i,spatialReference:o}=e;if(!i||!r)return;if("function"==typeof i.load&&await i.load(t),!n.attributes)return;const a=i.objectIdField,s=n.attributes[a];if(null==s)return;const u=[s],c=await r.getRequiredFields(i.fieldsIndex),y=(0,l.featureHasFields)(c,n),f=y?[]:c.includes(a)?c:[...c,a],p=r.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,d.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(r);if(y&&!p)return;const m=await W({layer:i,graphic:n,outFields:f,objectIds:u,returnGeometry:p,spatialReference:o},t);m&&(m.geometry&&(n.geometry=m.geometry),m.attributes&&(n.attributes={...n.attributes,...m.attributes}))}function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(_)}function ne(e){let{attributes:t,graphic:n,relatedInfo:r,fieldInfos:i,fieldInfoMap:o,layer:a,timeZone:s}=e;t&&n&&r&&Object.keys(n.attributes).forEach((e=>{const l=function(e){return`${_}${e.layerId}/${e.fieldName}`}({layerId:r.relation.id.toString(),fieldName:e}),u=n.attributes[e];t[l]=X({fieldName:l,fieldInfos:i,fieldInfoMap:o,layer:a,value:u,graphic:n,timeZone:s})}))}const re=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ie=e=>{let{layer:t,method:n,query:r,definitionExpression:i}=e;if(!t.capabilities?.query?.supportsCacheHint||"attachments"===n)return;const o=null!=r.where?r.where:null,a=null!=r.geometry?r.geometry:null;re(i)||re(o)||"extent"===a?.type||"tile"===r.resultType||(r.cacheHint=!0)},oe=e=>{let{query:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})},ae=e=>{let{queryPayload:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})};function se(e,t,n){return e&&t&&n?"sublayer"===t.type?ce({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:n})||ce({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):ce({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||ce({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function le(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function ue(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function ce(e){let{map:t,relationship:n,relationship:{relatedTableId:r},relatedLayer:i,layers:o}=e;if(!o)return null;for(const a of o){if("map-image"===a.type){const e=ce({layers:a.sublayers,map:t,relatedLayer:i,relationship:n})||ce({layers:a.subtables,map:t,relatedLayer:i,relationship:n});if(e)return e;continue}if(!D(a))continue;if("sublayer"===i.type){if(a!==i&&a.id===r)return a.isTable?ue(t,a):a;continue}const e="scene"===i.type&&i.associatedLayer?i.associatedLayer.url:i.url;if(!e)return null;if("sublayer"!==a.type){if(a!==i&&a.url===e&&a.layerId===r)return a}else if(a!==i&&a.layer?.url===e&&a.id===r)return a.isTable?ue(t,a):a}return null}function de(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}}}]);