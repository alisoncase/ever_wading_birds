"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[35539],{151:(e,t,n)=>{n.d(t,{Dt:()=>h,Ir:()=>d,QE:()=>l,RH:()=>u,Zd:()=>a,cN:()=>o,fy:()=>c,xU:()=>f});var s=n(32006),i=n(98080),r=n(93665);const o=Object.freeze({left:0,center:.5,right:1}),a=Object.freeze({"bottom-left":(0,i.fA)(0,0),bottom:(0,i.fA)(.5,0),"bottom-right":(0,i.fA)(1,0),left:(0,i.fA)(0,.5),center:(0,i.fA)(.5,.5),right:(0,i.fA)(1,.5),"top-left":(0,i.fA)(0,1),top:(0,i.fA)(.5,1),"top-right":(0,i.fA)(1,1)});function l(e){switch(e){case"left":return r.lV.Left;case"right":return r.lV.Right;default:return r.lV.Center}}function h(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function c(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function d(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function u(e){return"middle"===e?"center":e}function f(e,t){switch(e){case"top":return(0,s.hZ)(t,0,r.Xd);case"bottom":return(0,s.hZ)(t,0,-1);default:return(0,s.C)(t,i.uY)}}},6639:(e,t,n)=>{n.d(t,{z:()=>i});var s=n(87210);function i(e){const{size:t}=e.definition,n=e.fontString(t);let i=r.get(n);if(!i){const h=(0,s.y)(a,0,0).getContext("2d");e.setFontProperties(h,t);const c=h.measureText(l);i=new o(c.actualBoundingBoxAscent,c.actualBoundingBoxDescent),r.set(n,i)}return i}const r=new Map;class o{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,t){this.maxAscent=e,this.maxDescent=t}}const a={canvas:null},l=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})()},12288:(e,t,n)=>{n.d(t,{Wq:()=>s,lO:()=>u,oR:()=>f});var s,i,r=n(8374),o=n(91345),a=n(53053),l=n(66028),h=n(55239),c=n(79787),d=n(28983);function u(e){const t=f(e.rings,e.hasZ,s.CCW_IS_HOLE,e.spatialReference),n=new Array;let i=0,o=0;for(const s of t.polygons){const e=s.count,a=s.index,c=(0,l.l5)(t.position,3*a,3*e),d=s.holeIndices.map((e=>e-a)),u=(0,h.Dg)((0,r.e)(c,d,3));n.push({position:c,faces:u}),i+=c.length,o+=u.length}const a=function(e,t,n){if(1===e.length)return e[0];const s=(0,l.jh)(t),i=new Array(n);let r=0,o=0,a=0;for(const l of e){for(let e=0;e<l.position.length;e++)s[r++]=l.position[e];for(const e of l.faces)i[o++]=e+a;a=r/3}return{position:s,faces:(0,h.Dg)(i)}}(n,i,o),c=Array.isArray(a.position)?(0,d.b)(a.position,3,{originalIndices:a.faces}):(0,d.b)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,l.xm)(new Float64Array(c.buffer)),a.faces=c.indices,a}function f(e,t,n,i){const r=e.length,o=new Array(r),a=new Array(r),h=new Array(r);let c=0;for(let s=0;s<r;++s)c+=e[s].length;let d=0,u=0,f=0;const _=(0,l.jh)(3*c);let m=0;for(let l=r-1;l>=0;l--){const c=e[l],y=n===s.CCW_IS_HOLE&&p(c,t,i);if(y&&1!==r)o[d++]=c;else{let e=c.length;for(let t=0;t<d;++t)e+=o[t].length;const n={index:m,pathLengths:new Array(d+1),count:e,holeIndices:new Array(d)};n.pathLengths[0]=c.length,c.length>0&&(h[f++]={index:m,count:c.length}),m=y?g(c,c.length-1,-1,_,m,c.length,t):g(c,0,1,_,m,c.length,t);for(let s=0;s<d;++s){const e=o[s];n.holeIndices[s]=m,n.pathLengths[s+1]=e.length,e.length>0&&(h[f++]={index:m,count:e.length}),m=g(e,0,1,_,m,e.length,t)}d=0,n.count>0&&(a[u++]=n)}}for(let s=0;s<d;++s){const e=o[s];e.length>0&&(h[f++]={index:m,count:e.length}),m=g(e,0,1,_,m,e.length,t)}return a.length=u,h.length=f,{position:_,polygons:a,outlines:h}}function g(e,t,n,s,i,r,o){i*=3;for(let a=0;a<r;++a){const r=e[t];s[i++]=r[0],s[i++]=r[1],s[i++]=o&&r[2]?r[2]:0,t+=n}return i/3}function p(e,t,n){if(!t)return!(0,a.$3)(e);const s=e.length-1;switch((0,c.S)(e,s,n)){case o._.X:return!(0,a.$3)(e,o._.Y,o._.Z);case o._.Y:return!(0,a.$3)(e,o._.X,o._.Z);case o._.Z:return!(0,a.$3)(e,o._.X,o._.Y)}}(i=s||(s={}))[i.NONE=0]="NONE",i[i.CCW_IS_HOLE=1]="CCW_IS_HOLE"},13141:(e,t,n)=>{n.d(t,{T:()=>X,C:()=>Z});var s=n(93800),i=n(6946),r=n(89129),o=n(17741),a=n(79953),l=n(48602),h=(n(21265),n(50925),n(14746),n(75269)),c=n(8374),d=n(10382),u=n(89227),f=n(28473),g=n(75400),p=n(42276),_=n(66028),m=n(55239),y=n(40753),v=n(51064),x=n(72249),w=n(67159),b=n(12770),A=n(77890),R=n(3115),S=n(62650),M=n(93003),T=n(16434),P=n(75006),C=n(12723);class E extends T.w{constructor(e,t){super(e,t,new M.$(P.a,(()=>n.e(40382).then(n.bind(n,40382)))))}initializePipeline(){return(0,C.Ey)({colorWrite:C.kn})}}let O=class extends S.default{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[R.RenderCategory.COMPOSITE,R.InternalRenderCategory.FOCUSAREA]},this.produces=R.RenderCategory.COMPOSITE,this._passParameters=new P.F}precompile(){this.techniques.precompile(E)}render(e){const t=this.techniques.get(E),n=e.find((e=>{let{name:t}=e;return t===R.RenderCategory.COMPOSITE}));if(!t.compiled)return this.requestRender(),n;const s=this.bindParameters,i=s.camera,r=i.fullViewport[2],o=i.fullViewport[3],a=e.find((e=>{let{name:t}=e;return t===R.InternalRenderCategory.FOCUSAREA})),l=this.fboCache.acquire(r,o,this.produces),h=this.renderingContext;return h.gl.clear(h.gl.STENCIL_BUFFER_BIT),h.bindFramebuffer(l.fbo),this._passParameters.color=n.getTexture(),this._passParameters.focusArea=a.getTexture(),this._passParameters.effect=L[this.focusAreas.style],h.bindTechnique(t,s,this._passParameters),h.screen.draw(),l.attachDepth(n.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),l}};var k,I;(0,s._)([(0,l.MZ)()],O.prototype,"consumes",void 0),(0,s._)([(0,l.MZ)()],O.prototype,"produces",void 0),(0,s._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"focusAreas",void 0),O=(0,s._)([(0,h.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],O),(I=k||(k={}))[I.NONE=0]="NONE",I[I.BRIGHT=1]="BRIGHT",I[I.DARK=2]="DARK";const L={none:k.NONE,bright:k.BRIGHT,dark:k.DARK};var B=n(15500),z=n(98463),D=n(92156);class U extends T.w{constructor(e,t){super(e,t,new M.$(z.a,(()=>n.e(58047).then(n.bind(n,58047)))))}initializePipeline(){return(0,C.Ey)({colorWrite:C.kn,depthTest:{func:D.MT.LEQUAL}})}}var N=n(69586),H=n(34289),W=n(9369),F=n(80861),G=n(20783);let j=class extends S.default{constructor(e){super({...e,view:e.focusAreas.view}),this.consumes={required:[R.InternalRenderCategory.FOCUSAREA,R.RenderCategory.TRANSPARENT]},this.produces=R.InternalRenderCategory.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new z.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(U)}render(e){const t=this.techniques.get(U),n=this.bindParameters,s=n.camera,i=s.fullViewport[2],r=s.fullViewport[3],o=this.fboCache.acquire(i,r,R.InternalRenderCategory.FOCUSAREA,B.N.RGBA);if(!t.compiled||!this._vaos)return this.requestRender(),o;const a=e.find((e=>{let{name:t}=e;return t===R.RenderCategory.TRANSPARENT})),l=this.renderingContext;o.attachDepth(a.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),l.bindFramebuffer(o.fbo),l.clear(D.NV.COLOR|D.NV.STENCIL),l.setViewport(0,0,i,r),l.gl.clearStencil(0),l.gl.clear(l.gl.STENCIL_BUFFER_BIT),l.setClearStencil(0);const h=l.bindTechnique(t,n);l.setFaceCullingEnabled(!1),l.setStencilTestEnabled(!0),l.setStencilOpSeparate(D.Y7.FRONT,D.eA.KEEP,D.eA.INCR_WRAP,D.eA.KEEP),l.setStencilOpSeparate(D.Y7.BACK,D.eA.KEEP,D.eA.DECR_WRAP,D.eA.KEEP),l.setDepthWriteEnabled(!1);for(let c=0;c<this._vaos.length;c++){const e=this._vaos[c],t=this._counts[c];this._maskParameters.origin=this._origins[c],h.bindDraw(n,G.m,this._maskParameters),l.bindVAO(e),l.setStencilWriteMask(255),l.setStencilFunction(D.MT.ALWAYS,0,255),l.setColorMask(!1,!1,!1,!1),l.drawArrays(D.WR.TRIANGLES,0,t),l.setStencilWriteMask(0),l.setStencilFunction(D.MT.NOTEQUAL,0,255),l.setColorMask(!0,!0,!0,!0),l.drawArrays(D.WR.TRIANGLES,0,t)}return o}updateGeometries(){if(!this.view._stage)return;this._vaos.forEach((e=>e.dispose())),this._vaos.length=this._counts.length=this._origins.length=0;const e=this.focusAreas.geometries;for(const t of e){const e=new Array,n=t.indicesBottom;for(let o=0;o<n.length;o++)e.push(t.positions[3*(n[o]-1)]),e.push(t.positions[3*(n[o]-1)+1]),e.push(t.positions[3*(n[o]-1)+2]);const s=t.indicesExtruded;for(let o=0;o<s.length;o++)e.push(t.positions[3*s[o]]),e.push(t.positions[3*s[o]+1]),e.push(t.positions[3*s[o]+2]);const i=new Float32Array(e),r=new W.Z(this.renderingContext,N.D,new Map([["geometry",H.SL]]),new Map([["geometry",F.g.createVertex(this.renderingContext,D._U.STATIC_DRAW,i)]]));this._vaos.push(r),this._counts.push(n.length+s.length),this._origins.push(t.origin)}this.requestRender()}};(0,s._)([(0,l.MZ)()],j.prototype,"consumes",void 0),(0,s._)([(0,l.MZ)()],j.prototype,"produces",void 0),(0,s._)([(0,l.MZ)({constructOnly:!0})],j.prototype,"focusAreas",void 0),j=(0,s._)([(0,h.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],j);class q{constructor(e,t,n,s,i,r){this.positions=e,this.indicesBottom=t,this.indicesExtruded=n,this.height=s,this.origin=i,this.color=r}}var V;!function(e){e[e.NONE=0]="NONE",e[e.BRIGHT=1]="BRIGHT",e[e.DARK=2]="DARK"}(V||(V={}));const Y=.42,$=.32;function Z(e,t){if(e){if("bright"===t){const t=(e[0]+e[1]+e[2])/3;return[t*$+(1-$),t*$+(1-$),t*$+(1-$),e[3]*$]}return"dark"===t?[e[0]*Y,e[1]*Y,e[2]*Y,e[3]*Y]:e}}let X=class extends i.default{constructor(e){super(e),this.style="dark",this.geometries=new Array,this._areas=new r.default,this._elevationContext=new x.F}initialize(){this.addHandles([(0,a.watch)((()=>this.style),(()=>this._updateRenderNodes()),a.syncAndInitial)]),this.addHandles([(0,a.watch)((()=>this.activePolygons),(()=>this._updateFocusAreaGeometries()),a.syncAndInitial)])}get activePolygons(){const e=new r.default;for(const t of this.areas)if(t.enabled)for(const n of t.geometries)e.push(n);return e}add(e){this.areas.add(e),this._updateFocusAreaGeometries()}addMany(e){this.areas.addMany(e),this._updateFocusAreaGeometries()}remove(e){this.areas.remove(e),this._updateFocusAreaGeometries()}removeMany(e){this.areas.removeMany(e),this._updateFocusAreaGeometries()}removeAll(){this.areas.removeAll(),this._updateFocusAreaGeometries()}containsGeometry(e){let t=!0;const n=new g.default(e);return t=this.areas.some((e=>!!e.enabled&&!!e?.geometries.length&&e.geometries.some((e=>e.contains(n))))),t}get areas(){return this._areas}_updateFocusAreaGeometries(){this._extrudePolygons(),this._updateRenderNodes()}_extrudePolygons(){if(!this.view.renderCoordsHelper)return;this.geometries.length=0;const e=5e6,t=(0,f.vt)(),n=this.view.renderCoordsHelper.viewingMode===v.RT.Global,s=(0,d.vt)(),i=(0,d.vt)();n||this.view.renderCoordsHelper.worldUpAtPosition([0,0,0],t);for(const r of this.areas)if(r.enabled)for(const o of r.geometries){const a=(0,b.W$)(o);if(null==a)continue;(0,p.l)(o.spatialReference,[a.x,a.y,0],s,this.view.renderCoordsHelper.spatialReference);const l=(0,u.n)(K,[s[12]-0*t[0],s[13]-0*t[1],s[14]-0*t[2]]);i[12]=-s[12],i[13]=-s[13],i[14]=-s[14];const h=(0,A.C8)(o,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:d,mapPositions:f,position:g}=h;for(const o of d){const a=o.count,h=(0,c.e)(o.mapPositions,o.holeIndices,3);if(0===h.length)continue;const d=h.length,u=6*a,p=(0,m.my)(u+d),v=(0,m.my)(d),x=(0,_.jh)(3*u),b=(0,_.jh)(3*u),A=(0,_.jh)(3*u),R=(0,_.jh)(u);(0,w.K)(g,f,h,o,x,A,b,R,p,v,e,t,n),(0,y.t)(x,x,i);const S=new q(x,v,p,e,[s[12]+0*l[0],s[13]+0*l[1],s[14]+0*l[2]],r.outline?.color);this.geometries.push(S)}}this._maskRenderNode?.updateGeometries()}_updateRenderNodes(){this.view._stage&&("none"===this.style||0===this.geometries.length?(this._maskRenderNode=(0,o.pR)(this._maskRenderNode),this._colorRenderNode=(0,o.pR)(this._colorRenderNode)):(this._maskRenderNode??=new j({focusAreas:this}),this._colorRenderNode??=new O({focusAreas:this})))}};(0,s._)([(0,l.MZ)()],X.prototype,"activePolygons",null),(0,s._)([(0,l.MZ)()],X.prototype,"style",void 0),(0,s._)([(0,l.MZ)()],X.prototype,"geometries",void 0),(0,s._)([(0,l.MZ)({constructOnly:!0})],X.prototype,"view",void 0),(0,s._)([(0,l.MZ)()],X.prototype,"_areas",void 0),X=(0,s._)([(0,h.$)("esri.views.FocusAreas")],X);const K=(0,f.vt)()},16849:(e,t,n)=>{n.d(t,{n:()=>i});var s=n(16878);function i(e,t){t.spherical?e.vertex.code.add(s.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(s.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(s.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(s.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},28983:(e,t,n)=>{n.d(t,{b:()=>r});var s=n(64682),i=n(55239);function r(e,t,n){const r=Array.isArray(e),c=r?e.length/t:e.byteLength/(4*t),d=r?e:new Uint32Array(e,0,c*t),u=n?.minReduction??0,f=n?.originalIndices||null,g=f?f.length:0,p=n?.componentOffsets||null;let _=0;if(p)for(let s=0;s<p.length-1;s++){const e=p[s+1]-p[s];e>_&&(_=e)}else _=c;const m=Math.floor(1.1*_)+1;(null==h||h.length<2*m)&&(h=new Uint32Array((0,s.cU)(2*m)));for(let s=0;s<2*m;s++)h[s]=0;let y=0;const v=!!p&&!!f,x=v?g:c;let w=(0,i.my)(c);const b=new Uint32Array(g),A=1.96;let R=0!==u?Math.ceil(4*A*A/(u*u)*u*(1-u)):x,S=1,M=p?p[1]:x;for(let s=0;s<x;s++){if(s===R){const e=1-y/s;if(e+A*Math.sqrt(e*(1-e)/s)<u)return null;R*=2}if(s===M){for(let e=0;e<2*m;e++)h[e]=0;if(f)for(let e=p[S-1];e<p[S];e++)b[e]=w[f[e]];M=p[++S]}const e=v?f[s]:s,n=e*t,i=l(d,n,t);let r=i%m,a=y;for(;0!==h[2*r+1];){if(h[2*r]===i){const e=h[2*r+1]-1;if(o(d,n,e*t,t)){a=w[e];break}}r++,r>=m&&(r-=m)}a===y&&(h[2*r]=i,h[2*r+1]=e+1,y++),w[e]=a}if(0!==u&&1-y/c<u)return null;if(v){for(let e=p[S-1];e<b.length;e++)b[e]=w[f[e]];w=(0,i.Dg)(b)}const T=r?new Array(y):new Uint32Array(y*t);y=0;for(let s=0;s<x;s++)w[s]===y&&(a(d,(v?f[s]:s)*t,T,y*t,t),y++);if(f&&!v){const e=new Uint32Array(g);for(let t=0;t<e.length;t++)e[t]=w[f[t]];w=(0,i.Dg)(e)}return{buffer:Array.isArray(T)?T:T.buffer,indices:w,uniqueCount:y}}function o(e,t,n,s){for(let i=0;i<s;i++)if(e[t+i]!==e[n+i])return!1;return!0}function a(e,t,n,s,i){for(let r=0;r<i;r++)n[s+r]=e[t+r]}function l(e,t,n){let s=0;for(let i=0;i<n;i++)s=e[t+i]+s|0,s=s+(s<<11)+(s>>>2)|0;return s>>>0}let h=null},40753:(e,t,n)=>{n.d(t,{a:()=>d,b:()=>a,c:()=>o,d:()=>i,e:()=>u,f:()=>c,l:()=>h,n:()=>f,t:()=>r});var s=n(8601);n(21265),n(50925);function i(e,t,n){r(e.typedBuffer,t.typedBuffer,n,e.typedBufferStride,t.typedBufferStride)}function r(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s;if(e.length/s!==Math.ceil(t.length/i))return e;const r=e.length/s,o=n[0],a=n[1],l=n[2],h=n[4],c=n[5],d=n[6],u=n[8],f=n[9],g=n[10],p=n[12],_=n[13],m=n[14];let y=0,v=0;for(let x=0;x<r;x++){const n=t[y],r=t[y+1],x=t[y+2];e[v]=o*n+h*r+u*x+p,e[v+1]=a*n+c*r+f*x+_,e[v+2]=l*n+d*r+g*x+m,y+=i,v+=s}return e}function o(e,t,n){a(e.typedBuffer,t.typedBuffer,n,e.typedBufferStride,t.typedBufferStride)}function a(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s;if(e.length/s!==Math.ceil(t.length/i))return;const r=e.length/s,o=n[0],a=n[1],l=n[2],h=n[3],c=n[4],d=n[5],u=n[6],f=n[7],g=n[8];let p=0,_=0;for(let m=0;m<r;m++){const n=t[p],r=t[p+1],m=t[p+2];e[_]=o*n+h*r+u*m,e[_+1]=a*n+c*r+f*m,e[_+2]=l*n+d*r+g*m,p+=i,_+=s}}function l(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s;const r=Math.min(e.length/s,t.length/i);let o=0,a=0;for(let l=0;l<r;l++)e[a]=n*t[o],e[a+1]=n*t[o+1],e[a+2]=n*t[o+2],o+=i,a+=s;return e}function h(e,t,n,s){c(e.typedBuffer,t.typedBuffer,n,s,e.typedBufferStride,t.typedBufferStride)}function c(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:r;const a=Math.min(e.length/r,t.length/o);let l=0,h=0;const c=1/s.Tf;for(let s=0;s<a;s++)e[h]=i*(n*t[l])**c,e[h+1]=i*(n*t[l+1])**c,e[h+2]=i*(n*t[l+2])**c,l+=o,h+=r}function d(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s;const r=e.length/s;if(r!==Math.ceil(t.length/i))return e;let o=0,a=0;for(let l=0;l<r;l++)e[a]=t[o]+n[0],e[a+1]=t[o+1]+n[1],e[a+2]=t[o+2]+n[2],o+=i,a+=s;return e}function u(e,t){f(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;const i=Math.min(e.length/n,t.length/s);let r=0,o=0;for(let a=0;a<i;a++){const i=t[r],a=t[r+1],l=t[r+2],h=i*i+a*a+l*l;if(h>0){const t=1/Math.sqrt(h);e[o]=t*i,e[o+1]=t*a,e[o+2]=t*l}r+=s,o+=n}}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:c,linearToSRGBView:h,normalize:f,normalizeView:u,scale:l,scaleView:function(e,t,n){l(e.typedBuffer,t.typedBuffer,n,e.typedBufferStride,t.typedBufferStride)},shiftRight:function(e,t,n){const s=Math.min(e.count,t.count),i=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;let l=0,h=0;for(let c=0;c<s;c++)i[h]=o[l]>>n,i[h+1]=o[l+1]>>n,i[h+2]=o[l+2]>>n,l+=a,h+=r},transformMat3:a,transformMat3View:o,transformMat4:r,transformMat4View:i,translate:d},Symbol.toStringTag,{value:"Module"}))},40824:(e,t,n)=>{n.d(t,{JQ:()=>m,SY:()=>p,a4:()=>g,dE:()=>_,v7:()=>f});var s=n(8374),i=n(12560),r=n(65920),o=n(91345),a=n(55239),l=n(79787),h=n(65069),c=n(69291),d=n(25735),u=n(22131);function f(e,t,n){const i=(t.length>0?t[0]:e.length/3)-1,r=(0,l.S)(e,i,n);if(r!==o._.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+r]=e[t+2]}return(0,s.e)(e,t,3)}function g(e){const t=[[u.r.POSITION,new h.n(e.attributeData.position,e.indices,3,!0)]],n=(0,a.EH)(e.indices.length);return null!=e.attributeData.colorFeature?t.push([u.r.COLORFEATUREATTRIBUTE,new h.n([e.attributeData.colorFeature],n,1,!0)]):e.attributeData.color&&t.push([u.r.COLOR,new h.n(e.attributeData.color,n,4,!0)]),e.attributeData.uvMapSpace&&t.push([u.r.UVMAPSPACE,new h.n(e.attributeData.uvMapSpace,e.indices,4,!0)]),e.attributeData.boundingRect&&t.push([u.r.BOUNDINGRECT,new h.n(e.attributeData.boundingRect,e.indices,9,!0)]),new d.V(e.material,t,e.mapPositions,c.X.Mesh,e.attributeData.objectAndLayerIdColor)}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[[u.r.POSITION,new h.n(e.attributeData.position,e.indices,3,!0)],[u.r.UV0,new h.n(e.attributeData.uv0,e.indices,2,!0)]];return new d.V(e.material,n,e.mapPositions,c.X.Mesh,t)}function _(e){switch(e.type){case"extent":if(e instanceof i.default)return r.default.fromExtent(e);break;case"polygon":return e}return null}class m{constructor(e,t,n){this.renderData=e,this.layerUid=t,this.graphicUid=n,this.outGeometries=new Array}}},43353:(e,t,n)=>{n.d(t,{A:()=>o,J:()=>a});var s=n(98080),i=n(28473),r=n(24646);class o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,s.vt)(),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,r.fA)(0,0,0,-1),l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,i.vt)(),c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;this.verticalOffset=e,this.anchor=t,this.hasLabelVerticalOffset=n,this.screenOffset=o,this.centerOffset=a,this.centerOffsetUnits=l,this.translation=h,this.elevationOffset=c}}class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,s.vt)(),o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];this.placement=e,this.horizontalPlacement=t,this.verticalPlacement=n,this.text=i,this.displaySize=r,this.isFocused=o}}},55411:(e,t,n)=>{n.d(t,{d:()=>s});class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0;this.near=e,this.far=t}set(e,t){this.near=e,this.far=t}union(e){null!=e&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}}s.zero=new s(0,0)},67159:(e,t,n)=>{n.d(t,{K:()=>j,t:()=>F});n(21265);var s=n(74719),i=n(82301),r=n(84190),o=n(8374),a=n(67965),l=n(13473),h=n(87752),c=n(10382),d=n(89227),u=n(28473),f=n(42276),g=n(4309),p=n(66028),_=n(55239),m=n(40753),y=n(90684),v=n(48845),x=n(51064),w=n(50190),b=n(26324),A=n(21540),R=n(12770),S=n(23543),M=n(40824),T=n(77520),P=n(4794),C=n(96504),E=n(77890),O=n(16213),k=n(65069),I=n(71723),L=n(69291),B=n(25735),z=n(46383),D=n(75093),U=n(8461),N=n(22131),H=n(9789);const W=["polygon","extent"];class F extends A.U{constructor(e,t,n,s){super(e,t,n,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,R.Hj)(this._getSymbolSize());if(e)throw new s.default("graphics3dextrudesymbollayer:invalid-size",e)}const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacityAndColor(e),n=(0,u.ci)(t),i=t[3],r=i<1||this.needsDrivenTransparentPass,o=this.symbolLayer?.material?.emissiveFactor,a=o?(0,d.F)((0,u.o8)(o)):u.uY,l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:n,ambient:n,opacity:i,transparent:r,cullFace:r?I.s2.None:I.s2.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:a,offsetTransparentBackfaces:!0,normalType:O.W.Compressed};this._materials[ue.Main]=new H.$U(l,this._context),this._materials[ue.Bottom]=new H.$U({...l,cullFace:I.s2.Back},this._context),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,W,this.symbolLayer.type))return null;const n=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(t);return this._createAs3DShape(t,e.renderingInfo,n,s,t.uid)}layerOpacityChanged(e,t){const n=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(n),i=s<1||this.needsDrivenTransparentPass;this._materials[ue.Main]?.setParameters({opacity:s,transparent:i}),this._materials[ue.Bottom]?.setParameters({opacity:s,transparent:i});const r=this._getLayerOpacity();e.forEach((e=>t(e)?.layerOpacityChanged(r,this._context.isAsync)))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,w.Kf)}slicePlaneEnabledChanged(e,t){return this._materials[ue.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[ue.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((e=>{const n=t(e);null!=n&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[ue.Main]?.setParameters(e),this._materials[ue.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?(0,v.kg)(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?S.w.RecreateSymbol:S.w.RecreateGraphics}async queryForSnapping(e,t,n,s){const o=this._getExtrusionSize(n)*this._context.renderCoordsHelper.unitInMeters/(0,r.G9)(t),{objectId:a,target:l}=e,h=(0,i.clone)(l);switch(h.z=(h.z??0)+o,e.type){case"edge":{const{start:t,end:n}=e,s=(0,i.clone)(t),r=(0,i.clone)(n);return s.z=(s.z??0)+o,r.z=(r.z??0)+o,[(0,y.P)(a,h,1/0,s,r)]}case"vertex":return[(0,y.k)(a,h,1/0),(0,y.P)(a,l,1/0,l,h)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,n,s,i){const r=(0,M.dE)(e.geometry);if(null==r)return null;if(0===r.rings.length||!r.rings.some((e=>e.length>0)))return this._logGeometryValidationWarnings(r.rings,"rings","ExtrudeSymbol3DLayer"),null;const y=(0,E.C8)(r,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(y,r.rings,"rings","ExtrudeSymbol3DLayer");const v=(0,R.W$)(r);if(null==v)return null;const A=new Array,S=new Array,O=(0,g.vt)(),k=(0,c.vt)(),I=(0,u.vt)(),L=this._context.renderCoordsHelper.viewingMode===x.RT.Global;L||this._context.renderCoordsHelper.worldUpAtPosition(null,I),(0,f.l)(r.spatialReference,[v.x,v.y,0],k,this._context.renderCoordsHelper.spatialReference);const B=(0,c.vt)();(0,h.B8)(B,k);const H=(0,l.vt)();(0,a.Ge)(H,B);const{polygons:W,mapPositions:F,position:q}=y,V=new Map,Y=this._materials[ue.Main];for(const a of W){const e=a.count;if(this._context.clippingExtent&&((0,g.vY)(a.mapPositions,O),!(0,g.KG)(O,this._context.clippingExtent)))continue;const s=(0,o.e)(a.mapPositions,a.holeIndices,3);if(0===s.length)continue;const r=s.length,l=6*e,h=(0,_.my)(l+r),c=(0,_.my)(r),d=(0,p.jh)(3*l),u=(0,p.jh)(3*l),f=(0,p.jh)(3*l),y=(0,p.jh)(l);j(q,F,s,a,d,f,u,y,h,c,this._getExtrusionSize(t),I,L),(0,m.t)(d,d,B);const v=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),x=new ge(d,f,(0,D.fA)(u),y),w=G(Y,h,h.length-c.length,x,n,v),b=e,R=e,M=2*a.count,T=new pe(b,R,M,r/3);te(w,T,k),V.set(w,T),A.push(w,G(this._materials[ue.Bottom],c,0,x,n,v)),S.push(x.heights)}if(0===A.length)return null;const $=new U.B({geometries:A,layerUid:this._context.layer.uid,graphicUid:i,isElevationSource:!0});$.transformation=k;const Z=(0,T.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),X=Z?new b.H(this._materials[ue.Main],Z,this._context.slicePlaneEnabled):null,K=new b.Y(this,$,A,null,null,((e,t,n,s,i)=>function(e,t,n,s,i,r,o){const a=e.stageObject,l=a.geometries,u=l.length,f="absolute-height"!==t.mode;let g=0;const p=a.transformation,_=(0,h.Qw)((0,c.vt)(),p);for(let h=0;h<u;h+=2){const e=l[h];if(!(0,z.p)(e))continue;const t=e.getMutableAttribute(N.r.POSITION).data,c=r[h/2],u=new C.aY(e.mapPositions),m=t.length/3;let y=!1,v=0;{let e=0;for(let r=0;r<m;r++){ee[0]=t[e],ee[1]=t[e+1],ee[2]=t[e+2],s(u,ie),f&&(v+=ie.sampledElevation),P.b.TESTS_DISABLE_OPTIMIZATIONS?((0,d.i)(ne,u.array[u.offset],u.array[u.offset+1],ie.z+c[e/3]),null!=n&&i.toRenderCoords(ne,n,ne),(0,d.t)(ne,ne,_)):((0,d.i)(ne,t[e],t[e+1],t[e+2]),(0,d.t)(ne,ne,p),i.setAltitude(ne,ie.z+c[e/3]),(0,d.t)(ne,ne,_)),t[e]=ne[0],t[e+1]=ne[1],t[e+2]=ne[2];const r=ae/i.unitInMeters;(Math.abs(ee[0]-t[e])>=r||Math.abs(ee[1]-t[e+1])>=r||Math.abs(ee[2]-t[e+2])>=r)&&(y=!0),u.offset+=3,e+=3}}if(y){const t=o.get(e);t&&te(e,t,p),a.geometryVertexAttributeUpdated(l[h],N.r.NORMALCOMPRESSED),e.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[h],N.r.POSITION),l[h+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[h+1],N.r.POSITION)}g+=v/m}return g/u}(e,t,n,s,i,S,V)),s,X);return K.alignedSampledElevation=y.sampledElevation,K.needsElevationUpdates=(0,w.Kf)(s.mode),K}}function G(e,t,n,s,i,r){const o=(0,_.EH)(t.length),a=[[N.r.POSITION,new k.n(s.positions,t,3,!0)],[N.r.NORMALCOMPRESSED,new k.n(s.normals,t,2,!0)],[N.r.COLOR,new k.n(i,o,4,!0)]];return new B.V(e,a,s.elevation,L.X.Mesh,r,n)}function j(e,t,n,s,i,r,o,a,l,h,c,u,f){{const g=n.length/3,p=2*s.count;!function(e,t,n,s,i,r,o,a,l,h,c,u,f,g,p,_,m){(0,d.c)(se,_);{const i=p>0?1:-1;let r=3*n,o=0,u=3*o,f=s,g=3*f;for(let n=0;n<s;++n){const n=e[r],s=e[r+1],_=e[r+2];m&&(se[0]=n,se[1]=s,se[2]=_,(0,d.n)(se,se)),a[u+0]=n,a[u+1]=s,a[u+2]=_;const y=t[r+0],v=t[r+1],x=t[r+2];l[u+0]=y,l[u+1]=v,l[u+2]=x,h[u+0]=-i*se[0],h[u+1]=-i*se[1],h[u+2]=-i*se[2],c[o]=0,a[g+0]=n+p*se[0],a[g+1]=s+p*se[1],a[g+2]=_+p*se[2],l[g+0]=y,l[g+1]=v,l[g+2]=x,c[f]=p,u+=3,g+=3,r+=3,o+=1,f+=1}}{let e=3*r,t=0,n=3*g;const a=p<0?oe:re,l=p<0?re:oe;for(let r=0;r<o;++r)f[t]=i[e+a[0]],f[t+1]=i[e+a[1]],f[t+2]=i[e+a[2]],u[n]=i[e+l[0]]+s,u[n+1]=i[e+l[1]]+s,u[n+2]=i[e+l[2]]+s,t+=3,n+=3,e+=3}}(e,t,s.index,s.count,n,0,g,i,r,o,a,l,h,p,c,u,f)}{let e=0,t=2*s.count,n=0;const h=s.pathLengths[0];Y(i,r,a,o,e,h,s.count,t,l,n,c),t+=4*h,n+=2*h,e+=h;for(let d=1;d<s.pathLengths.length;++d){const h=s.pathLengths[d];Y(i,r,a,o,e,h,s.count,t,l,n,c),t+=4*h,n+=2*h,e+=h}}}function q(e,t,n,s,i,r,o){s[r]=s[o],o*=3,e[r*=3]=e[o],e[r+1]=e[o+1],e[r+2]=e[o+2],t[r]=t[o],t[r+1]=t[o+1],t[r+2]=t[o+2],n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2]}const V=(0,u.vt)();function Y(e,t,n,s,i,r,o,a,l,h,c){let d=i,u=i+1,f=i+o,g=i+o+1,p=a,_=a+1,m=a+2*r,y=a+2*r+1;c<0&&(d=i+o+1,g=i);let v=3*h;for(let x=0;x<r;++x)x===r-1&&(u=i,c>0?g=i+o:d=i+o),Q(e,d,u,f,V),q(e,t,s,n,V,p,d),q(e,t,s,n,V,_,u),q(e,t,s,n,V,m,f),q(e,t,s,n,V,y,g),l[v]=p,l[v+1]=m,l[v+2]=y,l[v+3]=p,l[v+4]=y,l[v+5]=_,v+=6,d++,u++,f++,g++,p+=2,_+=2,m+=2,y+=2}const $=(0,u.vt)(),Z=(0,u.vt)(),X=(0,u.vt)(),K=(0,u.vt)(),J=(0,u.vt)();function Q(e,t,n,s,i){t*=3,n*=3,s*=3,(0,d.i)($,e[t++],e[t++],e[t++]),(0,d.i)(Z,e[n++],e[n++],e[n++]),(0,d.i)(X,e[s++],e[s++],e[s++]),(0,d.d)(K,Z,$),(0,d.d)(J,X,$),(0,d.e)(i,J,K),(0,d.n)(i,i)}const ee=(0,u.vt)();function te(e,t,n){const s=e.getMutableAttribute(N.r.POSITION),i=e.getMutableAttribute(N.r.NORMALCOMPRESSED).data,{topVertexStart:r,topVertexCount:o,topFaceStart:a,topFaceCount:l}=t,h=s.data,c=o,u=e.attributes.get(N.r.POSITION).indices,f=a+l,g=r+o,_=(0,p.jh)(3*c);for(let d=0;d<c;++d){const e=3*d;_[e+0]=0,_[e+1]=0,_[e+2]=0}const m=le,y=he,v=ce,x=de,w=se;for(let p=a;p<f;++p){const e=3*p;for(let t=0;t<3;++t){const s=u[e+t];x[t]=s;const i=3*s;(0,d.i)(ne,h[i+0],h[i+1],h[i+2]),(0,d.t)(m[t],ne,n)}(0,d.a)(y,m[1],m[0]),(0,d.a)(v,m[2],m[0]),(0,d.e)(w,y,v),(0,d.n)(w,w);for(let t=0;t<3;++t){const e=3*(x[t]-r);_[e+0]+=w[0],_[e+1]+=w[1],_[e+2]+=w[2]}}for(let d=r;d<g;++d){const e=3*(d-r),t=_[e+0],n=_[e+1],s=_[e+2],o=Math.sqrt(t*t+n*n+s*s);(0,D.aT)(i,d,t/o,n/o,s/o)}}const ne=(0,u.vt)(),se=(0,u.vt)(),ie=new w.Uk,re=[0,2,1],oe=[0,1,2],ae=.01,le=[(0,u.vt)(),(0,u.vt)(),(0,u.vt)()],he=(0,u.vt)(),ce=(0,u.vt)(),de=[0,0,0];var ue,fe;(fe=ue||(ue={}))[fe.Main=0]="Main",fe[fe.Bottom=1]="Bottom";class ge{constructor(e,t,n,s){this.positions=e,this.elevation=t,this.normals=n,this.heights=s}}class pe{constructor(e,t,n,s){this.topVertexStart=e,this.topVertexCount=t,this.topFaceStart=n,this.topFaceCount=s}}},75006:(e,t,n)=>{n.d(t,{F:()=>h,a:()=>d,b:()=>c});var s=n(37379),i=n(16878),r=n(7683),o=n(67058),a=n(20783),l=n(8118);class h extends a.Y{}function c(){const e=new l.N5;return e.include(s.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new o.N("colorTexture",(e=>e.color)),new o.N("focusArea",(e=>e.focusArea)),new r.c("focusAreaEffectMode",(e=>e.effect??1))).main.add(i.H`float mask = texture( focusArea, uv, 0.0 ).r;
vec4 color = texture( colorTexture, uv, 0.0 );
vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
if (focusAreaEffectMode == 1) {
fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
} else {
fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:h,build:c},Symbol.toStringTag,{value:"Module"}))},75093:(e,t,n)=>{n.d(t,{Tz:()=>h,_l:()=>l,aT:()=>o,fA:()=>a});var s=n(64682),i=n(89227),r=n(28473);n(46576);function o(e,t,n,s,i){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;const o=1/(Math.abs(n)+Math.abs(s)+Math.abs(i)),a=n*o,l=s*o,h=i<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,d=i<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,u=t*r;e[u]=c(h),e[u+1]=c(d)}function a(e){const t=e.length/3,n=new Int16Array(2*t);let s=0;for(let i=0;i<t;++i)o(n,i,e[s++],e[s++],e[s++]);return n}function l(e,t){const n=e.length/3,s=new Int16Array(2*n);let a=0;const l=(0,r.vt)();for(let r=0;r<n;++r)l[0]=e[a++],l[1]=e[a++],l[2]=e[a++],(0,i.q)(l,l,t),o(s,r,l[0],l[1],l[2]);return s}function h(e,t,n){const s=n*(arguments.length>3&&void 0!==arguments[3]?arguments[3]:2),r=d(t[s]),o=d(t[s+1]),a=1-Math.abs(r)-Math.abs(o);e[2]=a,a<0?(e[0]=(r>=0?1:-1)*(1-Math.abs(o)),e[1]=(o>=0?1:-1)*(1-Math.abs(r))):(e[0]=r,e[1]=o),(0,i.n)(e,e)}function c(e){return(0,s.qE)(Math.round(32767*e),-32767,32767)}function d(e){return(0,s.qE)(e/32767,-1,1)}},77890:(e,t,n)=>{n.d(t,{AK:()=>h,C8:()=>l});var s=n(67093),i=n(66028),r=n(12288),o=n(50190),a=n(84654);function l(e,t,n,s){const a=(0,r.oR)(e.rings,!!e.hasZ&&"on-the-ground"!==s.mode,r.Wq.CCW_IS_HOLE,e.spatialReference),l=(0,i.jh)(a.position.length),h=(0,o.au)(a.position,e.spatialReference,0,l,0,a.position,0,a.position.length/3,t,n,s),u=null!=h;return new _(a.position,l,d(a.polygons,a.position,l),c(a.outlines,a.position,l),u,h)}function h(e,t){const n=(0,r.oR)(e.rings,!1,r.Wq.CCW_IS_HOLE),i=(0,s.projectBuffer)(n.position,e.spatialReference,0,n.position,t,0);for(let s=2;s<n.position.length;s+=3)n.position[s]=a.bi;return{position:n.position,polygons:d(n.polygons,n.position),outlines:c(n.outlines,n.position),projectionSuccess:i}}function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.filter((e=>{let{count:t}=e;return t>1})).map((e=>{let{index:s,count:r}=e;const o=3*s,a=3*r;return null!=n?new f(s,r,(0,i.l5)(t,o,a),(0,i.l5)(n,o,a)):new u(s,r,(0,i.l5)(t,o,a))}))}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new Array;for(const{index:r,count:o,holeIndices:a,pathLengths:l}of e){if(o<=1)continue;const e=3*r,h=3*o,c=a.map((e=>e-r)),d=null!=n?new g(r,o,(0,i.l5)(t,3*r,3*o),(0,i.l5)(n,e,h),c,l):new p(r,o,(0,i.l5)(t,3*r,3*o),c,l);s.push(d)}return s}class u{constructor(e,t,n){this.index=e,this.count=t,this.position=n}}class f extends u{constructor(e,t,n,s){super(e,t,n),this.mapPositions=s}}class g extends f{constructor(e,t,n,s,i,r){super(e,t,n,s),this.holeIndices=i,this.pathLengths=r}}class p extends u{constructor(e,t,n,s,i){super(e,t,n),this.holeIndices=s,this.pathLengths=i}}class _{constructor(e,t,n,s,i,r){this.position=e,this.mapPositions=t,this.polygons=n,this.outlines=s,this.projectionSuccess=i,this.sampledElevation=r}}},79787:(e,t,n)=>{n.d(t,{S:()=>l});var s=n(64682),i=n(84190),r=n(89227),o=n(91345),a=n(10872);function l(e,t,n){const l=function(e,t,n,s){const o=(e=>!Array.isArray(e[0]))(t)?(e,n)=>t[3*e+n]:(e,n)=>t[e][n],l=s?(0,i.GA)(s)/(0,i.G9)(s):1;return(0,a.lU)(e,((e,t)=>(0,r.i)(e,o(t,0)*l,o(t,1)*l,o(t,2))),n)}(h,e,t,n)?(0,a.Qj)(h):[0,0,1];return Math.abs(l[2])>Math.cos((0,s.kU)(80))?o._.Z:Math.abs(l[1])>Math.abs(l[0])?o._.Y:o._.X}const h=(0,a.vt)()},82192:(e,t,n)=>{n.d(t,{C:()=>w});var s=n(93800),i=n(6946),r=n(58448),o=(n(21265),n(17741)),a=n(31923),l=n(48602),h=(n(50925),n(14746),n(75269)),c=n(60548),d=n(24646),u=n(69291),f=n(14960),g=n(85293),p=n(19565),_=n(38729),m=n(92156),y=n(64177),v=n(77936);const x=4096;let w=class extends i.default{constructor(e){super(e),this.type=u.X.Texture,this.id=(0,a.c)(),this.events=new r.A,this._glTexture=null,this._atlas=new S(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=(0,o.WD)(this._glTexture),this._frameWorker=(0,o.xt)(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return T=f.G.stableRendering?b:0,[x-b-T,x-b-T-A]}load(e){if(this._glTexture)return this._glTexture;const t=new v.R;return t.wrapMode=m.pF.CLAMP_TO_EDGE,t.samplingMode=m.Cj.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.preMultiplyAlpha=!0,t.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new y.g(e,t,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(p.W6.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,o.xt)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,o.WD)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.width=e.width,this._canvas.height=e.height}_resizeAtlas(e,t){const{width:n,height:s}=this._atlas;n===e&&s===t||(this._atlas.width=e,this._atlas.height=t,this._glTexture?.resize(e,t),this._glTexture?.updateData(0,0,0,n,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((e=>this._uvCallbacks.get(e.textRenderer.key)?.forEach((t=>t(e.uv))))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,t,n,s){const i=this._atlas;if(i.width<n||i.height<s)return!1;let r=i.cursors.get(s);if(!r){if(i.height<i.nextY+s)return!1;r=[new M(i.nextY)],i.cursors.set(s,r),i.nextY+=s}let o=r.find((e=>i.width>=e.x+n));if(null==o){if(i.height<i.nextY+s)return!1;o=new M(i.nextY),i.nextY+=s,r.push(o)}return e.setNewPosition(o),this._elements.set(t,e),this._elementsToRender.set(t,e),o.x+=n,!0}_ensureCallbacks(e){const t=this._uvCallbacks.get(e);if(t)return t;const n=new Set;return this._uvCallbacks.set(e,n),n}_addCallback(e,t){this._ensureCallbacks(e).add(t)}_removeCallback(e,t){const n=this._uvCallbacks.get(e);return!(!n?.delete(t)||0!==n.size)&&(this._uvCallbacks.delete(e),!0)}_processAddition(e){const t=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(t,e);const n=this._atlas,s=e.textRenderer.renderedWidth,i=e.textRenderer.renderedHeight,r=s+b,o=i+b+A;if(!this._addAtlasElement(e,t,r,o)){if(this._canRepack)this._reset();else if(n.width<r){const e=Math.min((0,g.Mv)(Math.max(r,1.5*n.width)),x);this._resizeAtlas(e,n.height)}else{const e=n.nextY+o,t=Math.min((0,g.Mv)(Math.max(e,1.5*n.height)),x);if(t>n.height)this._resizeAtlas(n.width,t);else if(n.width<x){const e=Math.min((0,g.Mv)(1.5*n.width),x);this._resizeAtlas(e,n.height)}}this._elements.set(t,e)}}_renderElement(e){const t=e.commitNewPosition(),n=e.textRenderer;this._ctx.clearRect(t[0]-b,t[1]-b,n.renderedWidth+2*b,n.renderedHeight+2*b),n.render(this._ctx,t[0],t[1]),this._uvCallbacks.get(n.key)?.forEach((t=>t(e.uv)))}get running(){return this.updating}runTask(e){if(null==this._glTexture)return _.G;for(;this._needsRepack&&(this._canRepack||this._atlas.height<x&&this._atlas.height<x);){this._canRepack=this._needsRepack=!1;const t=this._elements;this._elements=new Map,t.forEach((e=>this._processAddition(e))),e.madeProgress()}if(this._elementsToRender.size>0){for(const[t,n]of this._elementsToRender){if(e.done)break;this._renderElement(n),this._elementsToRender.delete(t),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(e,t){const n=e.key;this._addCallback(n,t);let s=this._elements.get(n);return s?(0,c.a)(s.uv,d.uY)||t(s.uv):(s=new R(this._atlas,e),this._processAddition(s),this.setDirty()),{remove:()=>this._removeText(e,t)}}_removeText(e,t){const n=e.key;this._elements.get(n)&&this._removeCallback(n,t)&&(this._elements.delete(n),this._elementsToRender.delete(n),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};(0,s._)([(0,l.MZ)({constructOnly:!0})],w.prototype,"view",void 0),(0,s._)([(0,l.MZ)({type:Boolean})],w.prototype,"updating",void 0),w=(0,s._)([(0,h.$)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],w);const b=2,A=2;class R{constructor(e,t){this._atlas=e,this.textRenderer=t,this._uv=(0,d.vt)(),this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return d.uY;const{renderedWidth:e,renderedHeight:t}=this.textRenderer;return(0,c.s)(this._uv,this._xOffset/this._atlas.width,(this._yOffset+t)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class S{constructor(e,t){this.width=e,this.height=t,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=T}}class M{constructor(e){this.y=e,this.x=T}}let T=0},87210:(e,t,n)=>{function s(e,t,n){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=n,e.canvas}n.d(t,{y:()=>s})},88796:(e,t,n)=>{n.d(t,{R:()=>l});var s=n(23060),i=n(58828),r=n(74719),o=n(49959),a=n(43103);class l{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return(0,a.isDataProtocol)(e)?((0,o.throwIfAborted)(t),(0,a.dataToArrayBuffer)(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,n){if(null==this._streamDataRequester)return(await(0,s.default)(t,{responseType:h[e]})).data;const a=await(0,i.Ke)(this._streamDataRequester.request(t,e,n));if(!0===a.ok)return a.value;throw(0,o.throwIfAbortError)(a.error),new r.default("glt-loader-request-error",`Request for resource failed: ${a.error}`)}}const h={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},90218:(e,t,n)=>{n.d(t,{G:()=>l});var s=n(88102),i=n(26903),r=n(50925),o=n(16804),a=n(24646);class l{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=h(e.color),this.haloStyle=function(e){return`rgb(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()})`}(e.halo.color),this.backgroundStyle=0!==e.background.color[3]?h(e.background.color):null}fontString(e){const t=this.definition.font;return`${t.style} ${t.weight} ${e}px ${t.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,t){e.font=this.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,t){const n=e?.material?.color,h=s.default.toUnitRGBA(n)??a.uY,d=null!=e.size?(0,o.Lz)(e.size):12,u=e.lineHeight,f=null!=e.background?s.default.toUnitRGBA(e.background.color):a.uY,g={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},p=e.halo,_=null!=p?.color&&p.size>0?{size:(0,o.Lz)(p.size),color:s.default.toUnitRGBA(p.color)}:{size:0,color:a.uY},m=new l({color:h,size:d,background:{color:f,padding:null!=e.background?[.65*d,.5*d]:[0,0],borderRadius:null!=e.background?d*(6/16):0},lineSpacingFactor:u,font:g,halo:_,pixelRatio:t});if(e.font){let t=!1;const n=m.fontString(d);try{t=(await document.fonts.load(n)).some((e=>!(0,i.NZ)(e)))}catch(y){r.A.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${n}'. Some text symbology may be rendered using the default browser font.`)}if(!t&&!c.has(e.font.family))try{await(0,i.Al)(e.font)}catch(y){}}return m}}function h(e){return`rgba(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()},${e[3]})`}const c=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"])},90684:(e,t,n)=>{function s(e,t,n){return{objectId:e,target:t,distance:n,type:"vertex"}}function i(e,t,n,s,i){return{objectId:e,target:t,distance:n,type:"edge",start:s,end:i,draped:arguments.length>5&&void 0!==arguments[5]&&arguments[5]}}n.d(t,{P:()=>i,k:()=>s})},91315:(e,t,n)=>{n.d(t,{FJ:()=>T,Hh:()=>R});var s=n(23060),i=n(58828),r=n(74719),o=n(50925),a=n(42080),l=n(57942),h=n(49959),c=n(13997),d=n(28473),u=n(4309),f=n(55239),g=n(72538),p=n(65069),_=n(71723),m=n(25735),y=n(51446),v=n(22131),x=n(9789),w=n(92156);const b=()=>o.A.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class A{constructor(e,t,n){this.resource=e,this.textures=t,this.cachedMemory=n}}async function R(e,t){const n=await async function(e,t){const n=t?.streamDataRequester;if(n)return async function(e,t,n){const s=await(0,i.Ke)(t.request(e,"json",n));if(!0===s.ok)return s.value;(0,h.throwIfAbortError)(s.error),S(s.error.details.url)}(e,n,t);const r=await(0,i.Ke)((0,s.default)(e,t));if(!0===r.ok)return r.value.data;(0,h.throwIfAbortError)(r.error),S(r.error)}(e,t),r=await async function(e,t){const n=new Array;for(const r in e){const s=e[r],i=s.images[0].data;if(!i){b().warn("Externally referenced texture data is not yet supported");continue}const o=s.encoding+";base64,"+i,a="/textureDefinitions/"+r,l="rgba"===s.channels?s.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:w.pF.REPEAT,t:w.pF.REPEAT},preMultiplyAlpha:C(l)!==_.sf.Opaque},c=t?.disableTextures?Promise.resolve(null):(0,g.D)(o,t);n.push(c.then((e=>({refId:a,image:e,parameters:h,alphaChannelUsage:l}))))}const s=await Promise.all(n),i={};for(const r of s)i[r.refId]=r;return i}(n.textureDefinitions??{},t);let o=0;for(const s in r)if(r.hasOwnProperty(s)){const e=r[s];o+=e?.image?e.image.width*e.image.height*4:0}return new A(n,r,o+(0,a.Qh)(n))}function S(e){throw new r.default("",`Request for object resource failed: ${e}`)}function M(e){const t=e.params,n=t.topology;let s=!0;switch(t.vertexAttributes||(b().warn("Geometry must specify vertex attributes"),s=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const n in t.vertexAttributes){const t=e[n];t?.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(b().warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),s=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(b().warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),s=!1)):(b().warn(`Indexed geometry does not specify face indices for '${n}' attribute`),s=!1)}}else b().warn("Indexed geometries must specify faces"),s=!1;break}default:b().warn(`Unsupported topology '${n}'`),s=!1}e.params.material||(b().warn("Geometry requires material"),s=!1);const i=e.params.vertexAttributes;for(const r in i)i[r].values||(b().warn("Geometries with externally defined attributes are not yet supported"),s=!1);return s}function T(e,t){const n=new Array,s=new Array,i=new Array,r=new l.O,o=e.resource,a=c.R.parse(o.version||"1.0","wosr");O.validate(a);const h=o.model.name,u=o.model.geometries,g=o.materialDefinitions??{},w=e.textures;let b=0;const A=new Map;for(let l=0;l<u.length;l++){const e=u[l];if(!M(e))continue;const o=E(e),a=e.params.vertexAttributes,h=[],c=t=>{if("PerAttributeArray"===e.params.topology)return null;const n=e.params.faces;for(const e in n)if(e===t)return n[e].values;return null},R=a[v.r.POSITION],S=R.values.length/R.valuesPerElement;for(const t in a){const e=a[t],n=e.values,s=c(t)??(0,f.tM)(S);h.push([t,new p.n(n,s,e.valuesPerElement,!0)])}const T=o.texture,P=w&&w[T];if(P&&!A.has(T)){const{image:e,parameters:t}=P,n=new y.g(e,t);s.push(n),A.set(T,n)}const O=A.get(T),k=O?O.id:void 0,I=o.material;let L=r.get(I,T);if(null==L){const e=g[I.slice(I.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const n=P&&P.alphaChannelUsage,s=e.transparency>0||"transparency"===n||"maskAndTransparency"===n,i=P?C(P.alphaChannelUsage):void 0,o={ambient:(0,d.ci)(e.diffuse),diffuse:(0,d.ci)(e.diffuse),opacity:1-(e.transparency||0),transparent:s,textureAlphaMode:i,textureAlphaCutoff:.33,textureId:k,doubleSided:!0,cullFace:_.s2.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:P?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(o,t.materialParameters),L=new x.$U(o,t),r.set(I,T,L)}i.push(L);const B=new m.V(L,h);b+=h.find((e=>e[0]===v.r.POSITION))?.[1]?.indices.length??0,n.push(B)}return{engineResources:[{name:h,stageResources:{textures:s,materials:i,geometries:n},pivotOffset:o.model.pivotOffset,numberOfVertices:b,lodThreshold:null}],referenceBoundingBox:P(n)}}function P(e){const t=(0,u.Ie)();return e.forEach((e=>{const n=e.boundingInfo;null!=n&&((0,u.iT)(t,n.bbMin),(0,u.iT)(t,n.bbMax))})),t}function C(e){switch(e){case"mask":return _.sf.Mask;case"maskAndTransparency":return _.sf.MaskBlend;case"none":return _.sf.Opaque;default:return _.sf.Blend}}function E(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const O=new c.R(1,2,"wosr")},93665:(e,t,n)=>{n.d(t,{Js:()=>l,Xd:()=>a,lV:()=>c});var s=n(64682),i=n(4794),r=n(6639),o=n(87210);const a=1;class l{constructor(e,t,n,s){this.text=e,this._alignment=t,this._parameters=n,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","\xa0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const e=(0,o.y)(u,g,g).getContext("2d"),t=this._parameters.definition.pixelRatio,n=this._fontSize*t;this._parameters.setFontProperties(e,n);let s=2*this._haloSize;const i=this._parameters.definition.font;"italic"!==i.style&&"oblique"!==i.style&&"bold"!==i.weight&&"bolder"!==i.weight||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let a=0,l=0,h=0,c=0,d=0;this._lines.forEach(((n,i)=>{const r=e.measureText(n),o=r.width/t,u=o+s;this._textWidths.push(o),this._lineWidths.push(u),a=Math.max(a,u),c=Math.max(c,r.actualBoundingBoxAscent/t),d=Math.max(d,r.actualBoundingBoxDescent/t),0===i&&(l=r.actualBoundingBoxAscent/t),i===this._lines.length-1&&(h=r.actualBoundingBoxDescent/t)}));const f=(0,r.z)(this._parameters),p=Math.max(c,f.maxAscent),m=Math.max(d,f.maxDescent),y=l,v="underline"===this._parameters.definition.font.decoration?m:h,x=a;this._metricsCached=new _(y,v,p,m,x)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*f}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,a)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case c.Left:return this._horizontalPadding;case c.Center:return(this.displayWidth-this._lineWidths[e])/2;case c.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,t,n){e.save();const s=t/=this.renderPixelRatio,r=n/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;t+=o,n+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,r,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let i=0;i<this._lines.length;++i){const s=this._lines[i],r=this._getLineXOffset(i);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,s,t+r,n),this._renderLineDecoration(e,t+r,n,this._textWidths[i])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,s,t+this._getLineXOffset(i),n),this._renderLineDecoration(e,t+r,n,this._textWidths[i]),n+=this._lineSpacing}if(i.b.TEXT_SHOW_BASELINE){e.strokeStyle=p,e.setLineDash([2,2]),e.lineWidth=1;let t=r+a;for(let n=0;n<this._lines.length;++n)this._drawLine(e,[s,t],[s+this.displayWidth,t]),t+=this._lineSpacing}if(i.b.TEXT_SHOW_BORDER&&(e.strokeStyle=p,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,r],[this.displayWidth,this.displayHeight])),this._hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,r,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("none"===this._parameters.definition.font.decoration||0===s)return;const r=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":n+=2*r;break;case"line-through":n-=.33*this._midLineAscent}const o=i?this._haloSize:0;e.strokeStyle=i?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(r+2*o),e.beginPath(),e.moveTo(this._toRenderUnit(t-o),this._toRenderUnit(n)),e.lineTo(this._toRenderUnit(t+s+o),this._toRenderUnit(n)),e.stroke()}_roundedRect(e,t,n,i){t=this._toRenderUnit(t),n=this._toRenderUnit(n);const r=this.renderedWidth,o=this.renderedHeight;0!==i?(i=(0,s.qE)(i,0,Math.floor(o/2)),e.beginPath(),e.moveTo(t,n+i),e.arcTo(t,n,t+i,n,i),e.lineTo(t+r-i,n),e.arcTo(t+r,n,t+r,n+i,i),e.lineTo(t+r,n+o-i),e.arcTo(t+r,n+o,t+r-i,n+o,i),e.lineTo(t+i,n+o),e.arcTo(t,n+o,t,n+o-i,i),e.closePath()):e.rect(t,n,r,o)}_renderHalo(e,t,n,s,i){const r=this.renderedWidth,a=this.renderedHeight,l=(0,o.y)(u,Math.max(r,g),Math.max(a,g)),h=l.getContext("2d");h.clearRect(0,0,r,a),this._parameters.setFontProperties(h,this._renderedFontSize),h.fillStyle=this._parameters.haloStyle,h.strokeStyle=this._parameters.haloStyle;const c=this._renderedHaloSize<3;h.lineJoin=c?"miter":"round",c?this._renderHaloEmulated(h,s,i):this._renderHaloNative(h,s,i);let d=i;for(let o=0;o<this._lines.length;++o){const e=this._getLineXOffset(o);this._renderLineDecoration(h,s+e,d,this._textWidths[o],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,r,a,this._toRenderUnit(t),this._toRenderUnit(n),r,a),e.globalAlpha=1}_renderHaloEmulated(e,t,n){for(let s=0;s<this._lines.length;++s){const i=this._lines[s],r=this._getLineXOffset(s);for(const[s,o]of h)this._fillText(e,i,t+r+this._haloSize*s,n+this._haloSize*o);n+=this._lineSpacing}}_renderHaloNative(e,t,n){const s=2*this._haloSize;for(let i=0;i<this._lines.length;++i){const r=this._lines[i],o=this._getLineXOffset(i),a=5,l=.1;for(let i=0;i<a;i++){const h=1-(a-1)*l+i*l;e.lineWidth=this._toRenderUnit(h*s),this._strokeText(e,r,t+o,n)}n+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,n,s){e.fillText(t,this._toRenderUnit(n),this._toRenderUnit(s))}_strokeText(e,t,n,s){e.strokeText(t,this._toRenderUnit(n),this._toRenderUnit(s))}_drawLine(e,t,n){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(n[0])+.5,this._toRoundedRenderUnit(n[1])+.5),e.stroke()}_drawBox(e,t,n){const s=this._toRenderUnit(t[0]),i=this._toRenderUnit(t[1]),r=this._toRenderUnit(n[0]),o=this._toRenderUnit(n[1]),a=Math.floor(s)+.5,l=Math.ceil(s+r)-.5,h=Math.floor(i)+.5,c=Math.ceil(i+o)-.5;e.beginPath(),e.moveTo(a,h),e.lineTo(l,h),e.lineTo(l,c),e.lineTo(a,c),e.lineTo(a,h),e.stroke()}}const h=[];{const e=16;for(let t=0;t<360;t+=360/e)h.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var c,d;(d=c||(c={}))[d.Left=0]="Left",d[d.Center=1]="Center",d[d.Right=2]="Right";const u={canvas:null},f=.2,g=512,p="rgb(255, 0, 255, 0.5)";class _{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,t,n,s,i){this.firstLineAscent=e,this.lastLineDescent=t,this.maxLineAscent=n,this.maxLineDescent=s,this.displayWidth=i}}},98463:(e,t,n)=>{n.d(t,{F:()=>u,a:()=>p,b:()=>f});var s=n(87752),i=n(10382),r=n(28473),o=n(16878),a=n(38950),l=n(12901),h=n(22131),c=n(20783),d=n(8118);class u extends c.Y{constructor(){super(...arguments),this.origin=r.uY}}function f(){const e=new d.N5;return e.attributes.add(h.r.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new a.F("proj",(e=>e.camera.projectionMatrix)),new l.S("view",((e,t)=>(0,s.Tl)(g,t.camera.viewMatrix,e.origin)))).main.add(o.H`gl_Position = proj * view * vec4(position, 1.0);`),e.fragment.main.add(o.H`fragColor = vec4(1., 0., 0., 1.);`),e}const g=(0,i.vt)(),p=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:u,build:f},Symbol.toStringTag,{value:"Module"}))},99610:(e,t,n)=>{n.d(t,{c:()=>i});var s=n(71723);class i{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,n){const i=this._material.produces.get(t);if(!i?.(n))return null;this._map.has(n)||this._map.set(n,this._repository.acquire(this._material,t,n));const r=this._map.get(n);if(null!=r){if(r.ensureResources(e)===s.Am.LOADED)return r;this._repository.requestRender()}return null}}}}]);