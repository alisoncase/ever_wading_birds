"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[44827,50782,53856,70674,79906,86434],{6135:(e,t,n)=>{n.d(t,{$4:()=>b,O0:()=>v,O1:()=>M,Sw:()=>I,eH:()=>g,rc:()=>w});var i=n(21772),a=n(88102),r=n(23060),o=n(76612),s=n(16804),l=n(44827);const c="picture-fill",u="simple-fill",d="simple-line",p="simple-marker",h="text",f="cim",y=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),m=new o.q(1e3);function g(e){const t=e.style;let n=null;if(e)switch(e.type){case p:"cross"!==t&&"x"!==t&&(n=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):n=e.color;break;case c:n={type:"pattern",src:e.url,width:(0,s.Lz)(e.width)*e.xscale,height:(0,s.Lz)(e.height)*e.yscale,x:(0,s.Lz)(e.xoffset),y:(0,s.Lz)(e.yoffset)};break;case h:n=e.color;break;case f:n=(0,l.getCIMSymbolColor)(e)}return n}function w(e,t){const n=e+"-"+t;return void 0!==m.get(n)?Promise.resolve(m.get(n)):(0,r.default)(e,{responseType:"image"}).then((e=>{const i=e.data,a=i.naturalWidth,r=i.naturalHeight,o=document.createElement("canvas");o.width=a,o.height=r;const s=o.getContext("2d");s.fillStyle=t,s.fillRect(0,0,a,r),s.globalCompositeOperation="destination-in",s.drawImage(i,0,0);const l=o.toDataURL();return m.put(n,l),l}))}function b(e){if(!e)return null;let t=null;switch(e.type){case u:case c:case p:t=b(e.outline);break;case d:{const n=(0,s.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:M(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,s.Lz)(e.miterLimit):e.join},t.dashArray=v(t).join(",")||"none");break}default:t=null}return t}function v(e){if(!e?.style)return[];const{dashArray:t,style:n,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const a=i??0,r=y.has(n)?y.get(n).map((e=>e*a)):[];if("butt"!==e.cap)for(const[o,s]of r.entries())r[o]=o%2==1?s+a:Math.max(s-a,1);return r}const M=(()=>{const e={};return t=>{if(e[t])return e[t];const n=t.replaceAll("-","");return e[t]=n,n}})(),I=new a.default([128,128,128])},17508:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(93800),a=n(6946),r=n(49959),o=n(48602),s=(n(21265),n(50925),n(14746),n(75269)),l=n(35920),c=n(82368);let u=class extends a.default{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null,this.submittable=!1,this.displayTitle=null,this.isAssociation=!1,this._debouncedRefreshDisplayTitle=(0,r.debounce)(this._refreshDisplayTitle.bind(this),100)}get attributesModified(){return!function(e,t){const n=e??{},i=t??{},a=new Set(Object.keys(n));(0,l.FB)(a,Object.keys(i));for(const r of a){const e=n[r],t=i[r];if(!(0,c.D_)(e,t))return!1}return!0}(this.initialFeature?.attributes,this.feature?.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}set timeZone(e){this._set("timeZone",e),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.feature;this.initialFeature=e?.clone(),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateAttributes(e){const{feature:t}=this;t&&(t.attributes=e,this.notifyChange("attributesModified")),(0,r.ignoreAbortErrors)(this._debouncedRefreshDisplayTitle())}updateGeometry(e){const{feature:t}=this;t&&(t.geometry=e,this.notifyChange("geometryModified"))}_stringifyGeometry(e){const t=e?.geometry;return function(e){return null==e?null:JSON.stringify(e)}("mesh"===t?.type?{transform:t.transform,vertexSpace:t.vertexSpace}:t)}async _refreshDisplayTitle(e){const t=this.feature,n=t?.sourceLayer;if(!n||!("getFeatureTitle"in n))return;const i=await n.getFeatureTitle(t,{fetchMissingFields:!1,timeZone:this.timeZone});e.aborted||(this.displayTitle=""===i?null:i)}};(0,i._)([(0,o.MZ)()],u.prototype,"_stagedForDelete",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"attributesModified",null),(0,i._)([(0,o.MZ)()],u.prototype,"feature",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"geometryModified",null),(0,i._)([(0,o.MZ)()],u.prototype,"initialFeature",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"modified",null),(0,i._)([(0,o.MZ)()],u.prototype,"submittable",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"displayTitle",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"isAssociation",void 0),(0,i._)([(0,o.MZ)()],u.prototype,"timeZone",null),u=(0,i._)([(0,s.$)("esri.widgets.Editor.Edits")],u);const d=u},18162:(e,t,n)=>{n.d(t,{F:()=>r});n(96913);var i=n(93321),a=n(31183);function r(e,t,n,i,r){return!(null==t||null==i||e.length<2)&&(o.x=e[0],o.y=e[1],o.z=e[2],o.spatialReference=t,(0,a.g)(o,n,i,r))}const o=(0,n(62240).T)(0,0,0,i.default.WGS84)},19983:(e,t,n)=>{n.d(t,{E5:()=>s,JU:()=>o,Of:()=>a,Uk:()=>r,WK:()=>l,g7:()=>c,lO:()=>u,lQ:()=>d});var i=n(74719);function a(e){return e&&"function"==typeof e.highlight}function r(e){return e&&"function"==typeof e.maskOccludee}function o(e,t,n){return null==e||e>=n&&(0===t||e<=t)}function s(e,t){if(t&&e){const{minScale:n,maxScale:i}=e;if(l(n,i))return o(t,n,i)}return!0}function l(e,t){return null!=e&&e>0||null!=t&&t>0}function c(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}function u(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatures"in e&&"layer"in e&&"view"in e}function d(e,t,n){return new i.default("layerview:spatial-reference-incompatible",`The spatial reference of this ${e}${t?`(wkid:${t})`:""} is incompatible with the spatial reference of the view${n?`(wkid:${n})`:""}.`,{})}},23278:(e,t,n)=>{var i;n.d(t,{n:()=>i}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))},31183:(e,t,n)=>{n.d(t,{W:()=>s,g:()=>o});var i=n(28473),a=n(96913),r=n(67093);function o(e,t,n,i){if((0,a.canProjectWithoutEngine)(e.spatialReference,n)){l[0]=e.x,l[1]=e.y;const a=e.z;return l[2]=a??i??0,(0,r.projectBuffer)(l,e.spatialReference,0,t,n,0)}const o=(0,a.tryProjectWithZConversion)(e,n);return!!o&&(t[0]=o?.x,t[1]=o?.y,t[2]=o?.z??i??0,!0)}async function s(e,t,n,i,r){return await(0,a.initializeProjection)(e.spatialReference,n,null,r),o(e,t,n,i)}const l=(0,i.vt)()},34519:(e,t,n)=>{n.d(t,{N:()=>u});var i=n(93800),a=n(88102),r=n(19455),o=n(48602),s=n(75269);let l=class extends r.A{constructor(){super(...arguments),this.enabled=!0}};(0,i._)([(0,o.MZ)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,i._)([(0,s.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends r.A{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new a.default([255,127,0]),this.orangeTransparent=new a.default([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"verticalLineThresholdMeters",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:a.default,nonNullable:!0})],c.prototype,"orange",void 0),(0,i._)([(0,o.MZ)({type:a.default,nonNullable:!0})],c.prototype,"orangeTransparent",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"satisfiesConstraintScreenThreshold",void 0),c=(0,i._)([(0,s.$)("esri.views.interactive.snapping.Settings.Defaults")],c);const u=new c},36043:(e,t,n)=>{n.d(t,{V:()=>o,t:()=>s});var i=n(84190),a=n(12560),r=n(49222);function o(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.default,o=0;if("2d"===n.type)o=t*(n.resolution??0);else if("3d"===n.type){const a=n.overlayPixelSizeInMapUnits(e),r=n.basemapSpatialReference;o=null==r||r.equals(n.spatialReference)?t*a:(0,i.GA)(r)/(0,i.GA)(n.spatialReference)}const s=e.x-o,l=e.y-o,c=e.x+o,u=e.y+o,{spatialReference:d}=n;return r.xmin=Math.min(s,c),r.ymin=Math.min(l,u),r.xmax=Math.max(s,c),r.ymax=Math.max(l,u),r.spatialReference=d,r}function s(e,t,n){const i=n.toMap(e);return null!=i&&o(i,(0,r.o)(),n,l).intersects(t)}const l=new a.default},39262:(e,t,n)=>{n.d(t,{bn:()=>be,nv:()=>Se,ON:()=>Fe,Xm:()=>W,z4:()=>we,Zs:()=>le,mU:()=>ue,Z5:()=>se,nc:()=>ae,sE:()=>Te,_3:()=>xe,uh:()=>X,EH:()=>K,EO:()=>D,Ks:()=>Ie,bl:()=>G,sy:()=>ee,r8:()=>Me,O:()=>Ae,vM:()=>fe,Pi:()=>$,cY:()=>pe,Pz:()=>ke,AP:()=>q,J_:()=>de,z7:()=>ye,FC:()=>U,EA:()=>he,QZ:()=>_e});var i=n(88102),a=n(79625),r=n(62631),o=n(58828),s=(n(21265),n(74719)),l=n(42198),c=n(82301),u=n(50925),d=n(45622),p=n(49959),h=n(79953),f=n(16804),y=n(92012),m=n(42985),g=n(63738),w=n(78012),b=n(70674),v=n(95011),M=n(78076),I=n(49222),_=n(8299),S=n(85074),F=n(71237),k=n(92744),T=n(99071),A=n(83031),x=n(83799),C=n(26286),P=n(48485),E=n(55834),Z=n(49282),L=n(36043),V=n(54404);function O(e,t){const n={};t=t||{continueOnCircularDependency:!1};const i=[],a={};e.forEach((e=>{const t=e[0];let i;(i=n[t])||(i=n[t]=new z(t)),e.forEach((e=>{e!==t&&(n[e]||(n[e]=new z(e)),i.afters.push(e))}))}));const r=Object.keys(n);return r.sort(R),r.forEach((function e(r,o){const s=n[r],l=s.id;if(a[r])return;const c=Array.isArray(o)?o:[];c.push(l),a[r]=!0,s.afters.sort(R),s.afters.forEach((n=>{if(c.includes(n)){if(t?.continueOnCircularDependency)return;throw new Error("Circular chain found: "+l+" must be before "+n+" due to a direct order specification, but "+n+" must be before "+l+" based on other specifications.")}e(n,c.slice())})),i.push(l)})),i.reverse()}class z{constructor(e){this.id=e,this.afters=[]}}function R(e,t){return e<t?1:e>t?-1:0}var H=n(42265);const N=()=>u.A.getLogger("esri.widgets.Editor.workflowUtils");function G(e){return"update"===e.type}function D(e){const t=e.sourceLayer;if(!t||"feature"!==t.type||!function(e){switch(e?.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}(t.renderer))return{rotation:null,size:null};let i=null,a=null;const r=t.renderer.getVisualVariablesForType("rotation").filter((t=>(!t.axis||"heading"===t.axis)&&t.field&&!t.valueExpression&&null!=(0,F.getRotationAngle)(t,e)));1===r.length&&(i=function(e,t){const n="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,i=e.field,a=t.fields&&t.fields.filter((e=>e.name===i)),r=a&&1===a.length?a[0].type:"double",o={initial:0,current:0};return{field:i,fieldType:r,getDefault:()=>Promise.resolve(0),getValue:e=>(o.current=o.initial-n*e,j((o.current+360)%360,r)),setInitialValue:e=>{o.initial=e,o.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}(r[0],t));const o=t.renderer.getVisualVariablesForType("size").filter((t=>t.field&&!t.useSymbolValue&&!t.valueExpression&&(0,S.KZ)(t)===S._w.RealWorldSize&&null!=(0,F.getSize)(t,e)));return 1===o.length&&(a=function(e,t){const i=e.field,a=e.axis,r=t.fields&&t.fields.filter((e=>e.name===i)),o=r&&1===r.length?r[0].type:"double",s={initial:0,current:0},l=_.j[e.valueUnit]??1;let c;return c="area"===e.valueRepresentation?e=>(e*l/2)**2*Math.PI:"radius"===e.valueRepresentation||"distance"===e.valueRepresentation?e=>e*l/2:e=>e*l,{field:i,fieldType:o,getDefault:async(e,t)=>j(c(await async function(e,t,i){if(null==t)return 0;const{symbol:a}=(0,x.t)(t);if(null==a||"web-style"===a.type||"cim"===a.type)return 0;const r=a.symbolLayers.at(0);if(!r)return 0;switch(r.type){case"icon":{const{computeIconLayerResourceSize:e}=await n.e(28897).then(n.bind(n,28897));return r.size||Math.min(ge.icon,(await e(r,ge.icon))[0])||ge.icon}case"text":return r.size||ge.text;case"line":return r.size||ge.line;case"object":{const{computeObjectLayerResourceSize:t}=await n.e(28897).then(n.bind(n,28897));return function(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}(await t(r,e.scale/ge.viewScaleSizeFactor),i)}case"path":return(null!=r.width?r.width:r.height)||e.scale/ge.viewScaleSizeFactor;case"extrude":return r.size||e.scale/ge.viewScaleSizeFactor;default:return 0}}(t,e,a)),o),getValue:(e,t)=>(s.initial||(s.initial=t.pixelSizeAt(t.center)),s.current=s.initial*e,j(s.current,o)),setInitialValue:e=>{s.initial=e,s.current=0},isUpdatingInteractively:!1,displayUnit:ve(e.valueUnit),axis:e.axis}}(o[0],t)),{rotation:i,size:a}}function j(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}async function U(e,t,n){const i=await(0,C.getDisplayedSymbol)(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:n});null!=(0,y.Ui)(e.symbol,i)&&(e.symbol=i)}function W(e,t){if(!e||!t)throw new Error("no geometry type");if("multipatch"===e)return{tool:"mesh",createOptions:{mode:"hybrid"}};const n=new Map;n.set("circle",{mode:"freehand"}),n.set("rectangle",{mode:"freehand"});const i={mode:Z.t,optionsPerTool:n};if((0,m.w2)(t)){const a=t.defaultTool,r=(0,m.Dt)(t)?t.definition?.inputGeometryType??e:e;switch(a){case"freehand":case"stream-line":return{tool:"polyline"===r?"freehandPolyline":"freehandPolygon",createOptions:i};case"autocomplete-freehand-polygons":case"stream-polygon":return{tool:"freehandPolygon",createOptions:i};case"autocomplete-polygons":case"difference-polygon":case"create-structures":case"polygon":case"trace":return{tool:"polygon"===r?"polygon":"polyline",createOptions:i};case"circle":return n.get("circle").preserveAspectRatio=!0,{tool:"circle",createOptions:i};case"ellipse":return n.get("circle").preserveAspectRatio=!1,{tool:"circle",createOptions:i};case"create-points-along-line":case"multipoint":return{tool:"multipoint",createOptions:i};case"line":case"radial-line":case"right-angle-line":case"split":case"two-point-line":return{tool:"polyline",createOptions:i};case"rectangle":case"regular-polygon":case"right-angle-polygon":return{tool:"rectangle",createOptions:i};case"elevation-point-from-contour":case"elevation-point-from-dem":case"parcel-seed":case"point":case"point-and-rotation":case"point-at-end-of-line":return{tool:"point",createOptions:i}}}else{const a=t.drawingTool;if("circle"===a||"ellipse"===a)return n.get("circle").preserveAspectRatio="circle"===a,{tool:"circle",createOptions:i};if("rectangle"===a)return{tool:"rectangle",createOptions:i};if("freehand"===a)return{tool:"polygon"===e?"freehandPolygon":"freehandPolyline",createOptions:i}}return{tool:e,createOptions:i}}async function q(e,t,n){const{creationInfo:i,fullTemplate:a}=t;if(!i)throw new s.default("No creation info provided.");const r=i.layer,o=ae(a,i.attributeOverrides),{view:l}=e,c="2d"===l?.type;(0,m.Dt)(a)||(0,m.JC)(a)||await re(e,r,o,n,c?l.scale:null);const{capabilities:u}=r;e.layer.elevationInfo=r.elevationInfo;const d=W(r.geometryType,a);e.defaultCreateOptions={graphicProperties:{attributes:o,sourceLayer:r},mode:d.createOptions.mode,optionsPerTool:d.createOptions.optionsPerTool,preserveAspectRatio:d.createOptions.preserveAspectRatio,hasZ:u.data.supportsZ,defaultZ:(c?u.editing.zDefault:null)??e.defaultCreateOptions.defaultZ},null==i.geometryToPlace?await e.create(d.tool):await e.place(i.geometryToPlace,{graphicProperties:{attributes:o,sourceLayer:r}})}async function $(e){return(0,l.vE)([await B(e),await J(e)])}async function B(e){let{creationAttributes:t,data:n,sketchViewModel:i,view:a,webStyleCache:r}=e;const{creationInfo:o}=n,{fullTemplate:s}=n;if(!o||"2d"!==a?.type||(0,m.Dt)(s)||(0,m.JC)(s))return null;const l=(0,p.debounce)((e=>re(i,o.layer,t,r,e)));return(0,h.watch)((()=>a.scale),(e=>l(e)))}async function J(e){let{data:t,sketchViewModel:n,view:a}=e;const{templateExecutorInfo:o}=t;if(!o)return null;const c=n.activeComponent;if(!a||!(0,H.xJ)(c))return N().error(new s.default("Failed to set up template feedback.")),null;const u=new b.default({effect:"saturate(0.6) opacity(0.8)",listMode:"hide",title:"Shared Template Feedback Graphics"});a.map?.add(u);const{executor:d,serviceLayersById:f}=o,y=a.theme?.accentColor??new i.default([255,165,0,1]);return(0,l.vE)([(0,h.on)((()=>c),["cursor-update","vertex-add"],(()=>{u.removeAll();const e=c.graphic?.geometry;if(!e||!function(e){switch(e.type){case"point":case"multipoint":return!0;case"polyline":return e.paths[0].length>1;case"polygon":{const t=e.rings[0];return(0,r.aI)(t.at(0),t.at(-1))?t.length>2:t.length>1}default:return!1}}(e))return;const t=d(e,"digitizing");if(!(0,p.isPromiseLike)(t))for(const n of t.edits){const e=f.get(n.id);if(e&&n.addFeatures&&0!==n.addFeatures.length)for(const t of e)if(!t.isTable)for(const e of n.addFeatures){const t=Y(e,y);t&&u.add(t)}}})),(0,l.hA)((()=>{a.map.remove(u),u.destroy()}))])}function Y(e,t){let n=null;switch(e.geometry?.type){case"point":case"multipoint":n=new A.default({angle:0,color:t,outline:new T.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:1}),path:"undefined",size:8,style:"circle",xoffset:0,yoffset:0});break;case"polygon":n=new k.default({color:t,outline:new T.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:3}),style:"none"});break;case"polyline":n=new T.default({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:2});break;default:return null}return new a.default({geometry:e.geometry,symbol:n,attributes:{...e.attributes}})}async function X(e,t){const n=await(0,P.Z)(t).load(),i=(0,M.Sv)(e)?e.parent:e;return n.tablesAndLayersLookup.get(i)}async function K(e,t){const n=await X(e,t);if(!n)return new Map;const i=new Map;for(const a of n.layersAndTables)(0,d.tE)(i,a.layerId,(()=>[])).push(a);return i}function Q(e){const t=e.objectIdField,n=e.globalIdField??"";return{id:e.layerId,identifierFields:{objectIdField:t,globalIdField:n},addFeatures:[],deleteAttachments:[],addAttachments:[],deleteFeatures:[],updateFeatures:[]}}function ee(e){const{edits:t,serviceInfo:n,view:i,findOriginalFeature:a}=e,o=function(e){const t=new Map;for(const n of e)t.set(n.layerId,n);return t}(n.layersAndTables),l=n.layersAndTables.toArray(),{allEditData:c,editDataByLayerIdMap:u,editDataByIdMap:d}=function(e,t,n){const i=new Map,a=[],r=new Map;let o=1;for(const l of e){const e=[],c=t.get(l.id);if(!c)throw new s.default(`Failed to prepare applyEdits payload. Layer with id ${l.id} not found.`);for(const t of l.addFeatures??[])e.push({uniqueId:"T"+o++,operationType:"add",layer:c,after:t});for(const t of l.deleteFeatures??[])e.push({uniqueId:"T"+o++,operationType:"delete",before:t,layer:c});for(const t of l.deleteAttachments??[])e.push({uniqueId:"T"+o++,operationType:"deleteAttachment",attachmentId:t,layer:c});for(const t of l.addAttachments??[])e.push({uniqueId:"T"+o++,operationType:"addAttachment",attachment:t,layer:c});for(const t of l.updateFeatures??[])e.push({uniqueId:"T"+o++,operationType:"modify",before:n(t),after:t,layer:c});i.set(c.layerId,e);for(const t of e)a.push(t),r.set(t.uniqueId,t)}return{allEditData:a,editDataByIdMap:r,editDataByLayerIdMap:i}}(t,o,a),p=function(e,t,n){const i=[];for(const a of e){const e=a.layer.relationships??[],{uniqueId:r}=a;for(const o of e){const e=o.keyField;if("origin"===o.role){const s=n.get(o.relatedTableId);if(!s||0===s.length)continue;const l=te(a.layer,o),c=t.get(l);if(void 0===c||""===c)continue;switch(a.operationType){case"add":for(const t of s)t!==a&&("add"!==t.operationType&&"modify"!==t.operationType||t.after.attributes[c]===a.after.attributes[e]&&i.push([r,t.uniqueId]));break;case"modify":if(a.before.attributes[e]!==a.after.attributes[e])for(const t of s){const n=t.uniqueId;t!==a&&("delete"===t.operationType?t.before.attributes[c]===a.before.attributes[e]?i.push([n,r]):t.before.attributes[c]===a.after.attributes[e]&&i.push([r,n]):"add"===t.operationType?t.after.attributes[c]===a.after.attributes[e]?i.push([r,n]):t.after.attributes[c]===a.before.attributes[e]&&i.push([n,r]):"modify"===t.operationType&&(t.before.attributes[c]!==t.after.attributes[c]?t.after.attributes[c]===a.after.attributes[e]?i.push([r,n]):i.push([n,r]):i.push([r,n])))}break;case"delete":for(const t of s)t!==a&&("delete"!==t.operationType&&"modify"!==t.operationType||t.before.attributes[c]===a.before.attributes[e]&&i.push([t.uniqueId,r]))}}}}return i}(c,function(e,t){const n=new Map;for(const i of e)for(const e of i.relationships??[])if(n.set(te(i,e),""),t.has(e.relatedTableId)){const a=t.get(e.relatedTableId);if(a.length>0)for(const t of a[0].layer.relationships??[])if(t.id===e.id){n.set(te(i,e),t.keyField);break}}return n}(l,u),u);if(function(e,t,n){const i=[];for(const r of e)ne(r.layer,n)&&i.push(r);if(0===i.length)return;let a=[];for(const r of i){const n=r.layer;switch(r.operationType){case"delete":a=[...ie(r.before.attributes[n.fieldsIndex.get("fromglobalid").name],e),...ie(r.before.attributes[n.fieldsIndex.get("toglobalid").name],e)];for(const e of a)t.push([r.uniqueId,e.uniqueId]);break;case"add":a=[...ie(r.after.attributes[n.fieldsIndex.get("fromglobalid").name],e),...ie(r.after.attributes[n.fieldsIndex.get("toglobalid").name],e)];for(const e of a)t.push([e.uniqueId,r.uniqueId])}}}(c,p,i),0===p.length)return t;const h=O(p,{continueOnCircularDependency:!0}).map((e=>d.get(e))).filter(r.Ru),f=new Map;for(const r of h)f.set(r.uniqueId,r);const y=[];for(const r of c)f.has(r.uniqueId)||y.push(r);const m=[];let g=null;for(const r of h){const{layer:e}=r;switch(null==g?g=Q(e):g.id!==e.layerId&&(m.push(g),g=Q(e)),r.operationType){case"add":case"modify":g.addFeatures.push(r.after);break;case"delete":g.deleteFeatures.push(r.before)}}null!==g&&m.push(g);for(const r of y){const e=r.layer.layerId,t=m.find((t=>t.id===e))??Q(r.layer);switch(m.includes(t)||m.push(t),r.operationType){case"add":t.addFeatures.push(r.after);break;case"modify":t.updateFeatures.push(r.after);break;case"delete":t.deleteFeatures.push(r.before);break;case"deleteAttachment":t.deleteAttachments.push(r.attachmentId);break;case"addAttachment":t.addAttachments.push(r.attachment)}}for(const r of m)void 0!==r.deleteAttachments&&0===r.deleteAttachments.length&&delete r.deleteAttachments,void 0!==r.addAttachments&&0===r.addAttachments.length&&delete r.addAttachments;return m}function te(e,t){return`${e.layerId}:${t.id}`}function ne(e,t){return!!(t?.map&&"utilityNetworks"in t.map&&t.map.utilityNetworks?.length&&t.map.utilityNetworks.some((t=>!(!t.loaded||!e.url?.startsWith(t.featureServiceUrl)||e.layerId!==t.networkSystemLayers.associationsTableId))))}function ie(e,t){const n=[],i=t.filter((e=>{let{layer:t}=e;return""!==t.globalIdField&&null!=t.globalIdField}));for(const a of i){const t=a.layer.globalIdField;("before"in a&&a.before?.attributes[t]===e||"after"in a&&a.after?.attributes[t]===e)&&n.push(a)}return n}function ae(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.Dt)(e)||(0,m.JC)(e)?{}:(0,m.gZ)(e)?{...e.prototype.attributes,...t}:(0,m.Cq)(e)?{...e.definition?.defaultValues,...t}:{...t}}async function re(e,t,n,i,r){const o=new a.default({sourceLayer:t,attributes:n}),{rotation:s,size:l}=D(o);let c=await(0,C.getDisplayedSymbol)(o,{useSourceLayer:!0,webStyleCache:i,scale:r}),u=!1;for(const a of[l,s])null!=a&&null==n[a.field]&&(n[a.field]=await a.getDefault(c,e.view),u=!0);switch(u&&(c=await(0,C.getDisplayedSymbol)(o,{useSourceLayer:!0,webStyleCache:i,scale:r})),c?.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=c;break;case"simple-line":case"line-3d":e.polylineSymbol=c;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=c;break;case"mesh-3d":e.meshSymbol=c}oe(e.tooltipOptions,l,s)}function oe(e,t,n){e.visualVariables=null!=t||null!=n?{size:null!=t?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:null!=n?{valueType:n.fieldType,rotationType:n.rotationType??"geographic"}:null}:null}function se(e,t){return e?.find((e=>e.layer===t))}async function le(e,t,n,i){switch(t.type){case"3d":return async function(e,t,n,i){if(0===e.length)return[];const{updatable:a,graphicsByLayer:o}=await n.async((async()=>{const{results:a}=await(0,p.whenOrAbort)((0,V.oZ)(t,n),i),r=new Map,o=e=>{const t=e.layer,n=r.get(t);if(!n){const e=new Array;return r.set(t,e),e}return n};(0,V.h$)(a).forEach((e=>{let{graphic:t}=e;return o(t).push(t)}));const s=e.filter((e=>{let{capabilities:t,layer:n}=e;return t.update.enabled&&r.has(n)}));return 0!==s.length&&n.stopPropagation(),{updatable:s,graphicsByLayer:r}}));return(0,p.whenOrAbort)(Promise.allSettled(a.map((async e=>{let{layer:t}=e;const n=o.get(t),a=ce(t);if(n.every((e=>(0,v.featureHasFields)(a,e))))return n;const s=[];for(const i of n){s.push(i.getObjectId());const e=Object.keys(i.attributes);(0,r.FB)(a,e)}const l=t.createQuery();return l.returnGeometry=!1,l.objectIds=s,l.outFields=(0,v.fixFields)(t.fieldsIndex,a),t.queryFeatures(l,{signal:i}).then((e=>{let{features:t}=e;return t}))}))),i)}(e,t,n,i);case"2d":return async function(e,t,n,i){if(0===e.length)return[];const{mapPoint:a}=n;if(null==a)return[];let r=null;const o=await n.async((async()=>{const{results:a}=await(0,p.whenOrAbort)(t.hitTest(n),i);if(0===a.length)return[];const o=new Set;r=(0,V.h$)(a),r.forEach((e=>{let{graphic:t}=e;return t&&o.add(t.layer)}));const s=e.filter((e=>o.has(e.layer)&&e.supportsUpdateWorkflow));return s.length>0&&n.stopPropagation(),s}));return(0,p.whenOrAbort)(Promise.allSettled(o.map((async e=>{let{layer:o}=e;const s=o.createQuery();s.returnGeometry=!0,s.outFields=ce(o);const l="renderer"in o?(0,I.o)({renderer:o.renderer,pointerType:n.pointerType}):0;s.geometry=(0,L.V)(a,l,t),s.outSpatialReference=t.spatialReference;const{features:c}=await o.queryFeatures(s,{signal:i});return r?.forEach((e=>{let{graphic:t}=e;t.layer!==o||c.some((e=>e.getObjectId()===t.getObjectId()))||c.push(t)})),c}))),i)}(e,t,n,i)}}function ce(e){return(0,v.fixFields)(e.fieldsIndex,[e.objectIdField,(0,v.getDisplayFieldName)({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function ue(e,t,n){const{sourceLayer:i}=e,a=i.createQuery();a.objectIds=[e.getAttribute(i.objectIdField)],a.outFields=["*"],a.returnM=i.capabilities.data.supportsM,a.returnZ=i.capabilities.data.supportsZ,"scene"===i.type&&null!=i.infoFor3D||(a.outSpatialReference=t);const r=await i.queryFeatures(a,{signal:n});return(0,p.throwIfAborted)(n),r.features[0]}async function de(e){const{graphic:t,sketchViewModel:n,sourceLayer:i,visualVariables:a}=e;await pe(e);const r={multipleSelectionEnabled:!1};return"point"===i.geometryType&&(r.enableRotation=null!=a.rotation,r.enableScaling=null!=a.size),n.update(t,r)}async function pe(e){const{graphic:t,sketchViewModel:n,sourceLayer:i,visualVariables:a,webStyleCache:r}=e;let o=!1;const{rotation:s,size:l}=a;if([s,l].forEach((async e=>{if(null==e)return;const i=t.getAttribute(e.field);if(null!=i)e.setInitialValue(i);else{const i=await e.getDefault(t.symbol,n.view);e.setInitialValue(i),t.setAttribute(e.field,i),o=!0}})),o){const e="2d"===n.view?.type?n.view.scale:null;await U(t,r,e)}oe(n.tooltipOptions,l,s),n.layer.elevationInfo=i.elevationInfo}async function he(e,t,n,i,a){if(null==t.geometry||"point"!==t.geometry?.type)return;const r=i.rotation,o=function(e){return null==e||"rotate-start"!==e.type&&"rotate"!==e.type&&"rotate-stop"!==e.type?null:e}(n.toolEventInfo);if(null!=r&&null!=o){const{field:n,getValue:i}=r;"rotate-stop"===o.type?(r.isUpdatingInteractively=!1,r.setInitialValue(t.getAttribute(n))):(r.isUpdatingInteractively=!0,t.setAttribute(n,i(o.angle,e)))}const s=i.size,l=function(e){return null==e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}(n.toolEventInfo);if(null!=s&&null!=l){const{field:n,getValue:i}=s;"scale-stop"===l.type?(s.isUpdatingInteractively=!1,s.setInitialValue(t.getAttribute(n))):(s.isUpdatingInteractively=!0,t.setAttribute(n,i(l.xScale,e)))}await U(t,a,"2d"===e.type?e.scale:null)}async function fe(e){let{feature:t,featureClone:n,visualVariableAttributes:i,sketchViewModel:a,view:r,onUpdate:o,webStyleCache:s,addUpdatingPromise:c,addHandle:u}=e;await U(n,s,"2d"===r.type?r.scale:null);let d=null;if("2d"===a?.view?.type){const e=(0,p.debounce)((e=>U(n,s,e)));d=(0,h.watch)((()=>a?.view?.scale),(t=>e(t)))}const f=n.sourceLayer,y=_e(r,f);await de({graphic:n,sketchViewModel:a,sourceLayer:f,visualVariables:i,webStyleCache:s});let m=null;y.then((e=>m=e)).catch((()=>{}));const g=i.size,w=i.rotation,b=(0,h.watch)((()=>t.attributes),(async e=>{let t=!1;for(const i in e){const a=e[i];a!==n.getAttribute(i)&&(n.setAttribute(i,a),null==g||g.isUpdatingInteractively||g.field!==i||g.setInitialValue(a),null==w||w.isUpdatingInteractively||w.field!==i||w.setInitialValue(a),(null==m||m.requiredFields.includes(i))&&(t=!0))}t&&await U(n,s,"2d"===r.type?r.scale:null)})),v=a.on("update",(async e=>{const t=e.graphics[0],n={graphic:t,sketchViewModel:a,sourceLayer:f,visualVariables:i,webStyleCache:s};if("complete"===e.state){if(null===r.activeTool)return de(n);const e=new AbortController,t=(0,l.rE)(e);return u(t),c((0,h.whenOnce)((()=>null===r.activeTool),e.signal).then((()=>(e.abort(),de(n)))))}await he(r,t,e,i,s),o(Fe(t),e)})),M=a.on(["undo","redo"],(async e=>{o(Fe(e.graphics[0]),e)}));return(0,l.vE)([M,v,(0,l.hA)((()=>a.cancel())),b,d])}async function ye(e,t,n){const i=e.view;e.layer.add(n);const a=t.sourceLayer,r=t.layer,s=t.getAttribute(r.objectIdField);let c=null;function u(e){c?.abort(),c=(0,o.UT)((async t=>{const n=await _e(i,a);(0,p.throwIfAborted)(t),n.setVisibility?.(s,e)}))}return await async function(e,t){if("3d"===e.type){const n=new E.y({graphic:t}),i=e.trackGraphicState(n);await(0,h.whenOnce)((()=>n.displaying||n.error)),i.remove()}else await(0,h.whenOnce)((()=>t.visible))}(i,n),u(!1),(0,l.vE)([me(i,n,(e=>u(!e))),(0,l.hA)((async()=>{u(!0);try{const e=await _e(i,a);await(0,h.whenOnce)((()=>!e.updating))}finally{e.layer.remove(n)}}))])}function me(e,t,n){if("3d"===e.type){const i=new E.y({graphic:t});return(0,l.vE)([e.trackGraphicState(i),(0,h.watch)((()=>i.displaying),n)])}return(0,h.watch)((()=>t.visible),n)}const ge={icon:(0,f.PN)(24),text:(0,f.PN)(12),line:(0,f.PN)(1),viewScaleSizeFactor:100};function we(e,t,n){let i=!1;return e.filter((e=>!!i||(i=e===t,i))).map((e=>n[e]()))}function be(e,t){e.viewModel.syncFeatureTemplates();const n=e.creationInfo;if("awaiting-feature-creation-info"===t[0].id&&n){const i=n.layer,a=e.viewModel.getTemplatesForLayer(i);1===a.length&&"scene"!==i.type&&(n.template=a[0],t.shift())}return t}function ve(e){return"unknown"===e?null:e}function Me(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const Ie=e=>/-stop/.test(e)||/vertex-/.test(e),_e=(e,t)=>{const n="subtype-sublayer"===t.type?t.parent:t;return e.whenLayerView(n)};function Se(e){return"createInteractiveEditSession"in e}function Fe(e){const t=e.geometry;if("mesh"===t?.type){const n=e.cloneShallow();return n.attributes=(0,c.clone)(e.attributes),n.geometry=t.cloneShallow(),n.geometry.transform=t.transform?.clone()??null,n}return e.clone()}function ke(e){const t=e.cursor;return e.cursor="progress",(0,l.hA)((()=>e.cursor=t))}async function Te(e,t){const{template:n}=e;if(null==n)return null;if((0,m.Sf)(n))return n.load();if((0,m.w2)(n)){const e=(0,w.B)(t,{makeSharedTemplateFromJSON:Ce}),i=await e.getTemplates({templateIds:[n.templateId],featureService:n.featureService});if(0===i.length)throw new s.default("editor:failed-to-load-template","Unable to load the provided template");return i[0].load()}return n}function Ae(e){for(const t of e){const{destinationGraphic:e,destinationField:n,sourceGraphic:i,sourceField:a}=t;e.setAttribute(n,i.getAttribute(a))}}function xe(e){const t=e.templateExecutorInfo?.completionResults;return t?.length?(t.forEach((e=>Ae(e.relationships))),t.flatMap((e=>e.edits))):null}const Ce=e=>g.default.fromJSON(e)},41317:(e,t,n)=>{n.d(t,{$7:()=>F,B:()=>S,Fo:()=>M,M7:()=>A,NN:()=>p,Q5:()=>I,Tq:()=>C,Up:()=>_,XF:()=>T,Ze:()=>g,bK:()=>s,bh:()=>d,id:()=>w,ky:()=>u,qt:()=>x,tW:()=>k,v9:()=>h,w7:()=>l,wF:()=>o,wS:()=>b,wz:()=>y,x:()=>f,xS:()=>v,ze:()=>c});var i=n(84190),a=n(34308);function r(e){return e?x:C}function o(e,t){return t?.mode?t.mode:r(e).mode}function s(e,t){return null!=t?t:r(e)}function l(e,t){return o(null==e||(e.hasZ??!1),t)}function c(e,t){return s(null==e||(e.hasZ??!1),t)}function u(e){const t=m(e);return l(e.geometry,t)}function d(e){const t=m(e),n=l(e.geometry,t),i=null!=t&&"on-the-ground"!==n?A(t):0,a=t?.featureExpressionInfo;return{mode:n,offset:i,featureExpressionInfo:a}}function p(e){return y(d(e))}function h(e){return y(e)||f(e)}function f(e){return"0"===e?.featureExpressionInfo?.expression}function y(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function m(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function g(e,t){if(!e?.offset)return 0;const{offset:n,unit:a}=e;if("decimal-degrees"===a)return 0;const r="unknown"!==a&&a?a:"meters",o=(0,i.mq)(t);return o?(0,i.oU)(n,r,o):0}function w(e,t,n){if(!n?.mode)return;const i=e.hasZ?e.z:0,a=g(n,e.spatialReference);switch(n.mode){case"absolute-height":return i-a;case"on-the-ground":return 0;case"relative-to-ground":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"ground")??0)+a);case"relative-to-scene":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"scene")??0)+a)}}function b(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return M(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function v(e,t,n,i){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return M(e,t[0],t[1],t.length>2?t[2]:0,n,i,a)}function M(e,t,n,i,a,r){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==r)return;const s=null!=o?o.mode:"absolute-height";if("on-the-ground"===s)return 0;const{absoluteZ:l}=I(t,n,i,a,e,r);return function(e,t,n,i,a,r,o,s){const l=g(o,a);switch(s){case"absolute-height":return e-l;case"relative-to-ground":return e-((r.elevationProvider.getElevation(t,n,i,a,"ground")??0)+l);case"relative-to-scene":return e-((r.elevationProvider.getElevation(t,n,i,a,"scene")??0)+l)}}(l,t,n,i,a,e,o,s)}function I(e,t,n,i,a,r){const o=g(r,i);switch(r.mode){case"absolute-height":return{absoluteZ:n+o,elevation:0};case"on-the-ground":{const n=a.elevationProvider.getElevation(e,t,0,i,"ground")??0;return{absoluteZ:n,elevation:n}}case"relative-to-ground":{const r=a.elevationProvider.getElevation(e,t,n,i,"ground")??0;return{absoluteZ:n+r+o,elevation:r}}case"relative-to-scene":{const r=a.elevationProvider.getElevation(e,t,n,i,"scene")??0;return{absoluteZ:n+r+o,elevation:r}}}}function _(e,t){if(null==t)return!1;const{mode:n}=t;return null!=n&&("scene"===e&&"relative-to-scene"===n||"ground"===e&&"absolute-height"!==n)}function S(e,t,n){return n&&n.mode!==t?`${e} only support ${t} elevation mode`:null}function F(e,t,n){return n?.mode===t?`${e} do not support ${t} elevation mode`:null}function k(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function T(e,t){t&&e.warn(".elevationInfo=",t)}function A(e){return(e?.offset??0)*(0,a.Ao)(e?.unit)}const x={mode:"absolute-height",offset:0},C={mode:"on-the-ground",offset:null}},43536:(e,t,n)=>{n.d(t,{m:()=>i});class i{constructor(e,t){this.isDraped=e,this.domain=t}}},44827:(e,t,n)=>{n.r(t),n.d(t,{applyCIMSymbolColor:()=>h,applyCIMSymbolRotation:()=>m,getCIMSymbolColor:()=>u,getCIMSymbolRotation:()=>y,getCIMSymbolSize:()=>r,getCIMSymbolType:()=>g,scaleCIMMarker:()=>l,scaleCIMSymbol:()=>s,scaleCIMSymbolTo:()=>o});var i=n(88102),a=n(61154);function r(e){const t=(0,a.lW)(e);if("CIMTextSymbol"===t?.type)return t.height??0;let n=0;if(t?.symbolLayers)for(const i of t.symbolLayers)(0,a.MM)(i)&&null!=i.size&&i.size>n?n=i.size:(0,a.mA)(i)&&null!=i.width&&i.width>n?n=i.width:(0,a.jn)(i);return n}function o(e,t,n){if(!e)return;const i=(0,a.lW)(e),o=r(e);0!==o?s(i,t/o,!1,n):function(e,t){if(e)if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const n of e.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":n.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":n.width=t}}else e.height=t}(i,t)}function s(e,t,n,i){if(e)if("CIMTextSymbol"!==e.type){if(n&&e.effects)for(const n of e.effects)c(n,t);if(e.symbolLayers)for(const n of e.symbolLayers){switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":l(n,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!i?.preserveOutlineWidth&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":s(n.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}if(n.effects)for(const e of n.effects)c(e,t)}}else null!=e.height&&(e.height*=t)}function l(e,t,n){if(e&&(e.markerPlacement&&function(e,t){switch((0,a.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||s(i.symbol,t,!0,n)}function c(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const n=e.dashTemplate.map((e=>e*t));e.dashTemplate=n}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function u(e){const t=[];return d((0,a.lW)(e),t),t.length?new i.default((0,a.e6)(t[0])):null}function d(e,t){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(n?.symbolLayers)for(const r of n.symbolLayers)if(!(r.colorLocked||i&&((0,a.mA)(r)||(0,a.MM)(r)&&r.markerPlacement&&(0,a.zr)(r.markerPlacement))))switch(r.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":r.tintColor&&p(t,r.tintColor);break;case"CIMVectorMarker":r.markerGraphics?.forEach((e=>{d(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":p(t,r.color);break;case"CIMHatchFill":d(r.lineSymbol,t)}}function p(e,t){for(const n of e)if(n.join(".")===t.join("."))return;e.push(t)}function h(e,t,n){t instanceof i.default||(t=new i.default(t));const r=(0,a.lW)(e);r&&f(r,t,n)}function f(e,t,n){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const o of i.symbolLayers){if(o.colorLocked)continue;if(r)if(n){const{layersToColor:e}=n;if(((0,a.mA)(o)||(0,a.MM)(o)&&o.markerPlacement&&(0,a.zr)(o.markerPlacement))&&"fill"===e||(0,a.jn)(o)&&"outline"===e)continue}else if((0,a.mA)(o)||(0,a.MM)(o)&&o.markerPlacement&&(0,a.zr)(o.markerPlacement))continue;const e=t.toArray();switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor=e;break;case"CIMVectorMarker":o.markerGraphics?.forEach((e=>{f(e.symbol,t,n)}));break;case"CIMSolidStroke":case"CIMSolidFill":o.color=e;break;case"CIMHatchFill":f(o.lineSymbol,t,n)}}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,a.lW)(e);if("CIMTextSymbol"===n?.type||"CIMPointSymbol"===n?.type){const e=n.angle;return null!=e&&t?360-e:e??0}return 0}function m(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=(0,a.lW)(e);if(n&&(t=360-t),"CIMTextSymbol"!==i?.type){if("CIMPointSymbol"===i?.type&&i.symbolLayers){const e=t-(i.angle||0);for(const t of i.symbolLayers)if((0,a.MM)(t)){let n=t.rotation||0;t.rotateClockwise?n-=e:n+=e,t.rotation=n}i.angle=t}}else i.angle=t}function g(e){const t=(0,a.lW)(e);if(!t)return null;switch(t.type){case"CIMPointSymbol":return"CIMPointSymbol";case"CIMLineSymbol":return"CIMLineSymbol";case"CIMPolygonSymbol":return"CIMPolygonSymbol";case"CIMTextSymbol":return"CIMTextSymbol";case"CIMMeshSymbol":return"CIMMeshSymbol";default:return null}}},49222:(e,t,n)=>{function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,n=0;for(let i=0;i<e.length;i++){const a=e[i].size;"number"==typeof a&&(t+=a,n++)}return t/n}(e.stops):t}function r(e,t){if(!t)return e;const n=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:n,minSize:i}=t;return(a(n,e)+a(i,e))/2}));let i=0;const r=n.length;if(0===r)return e;for(let a=0;a<r;a++)i+=n[a];const o=Math.floor(i/r);return Math.max(o,e)}function o(e){const t=e?.renderer,n=e?.pointerType,a="touch"===n?9:6;if(!t)return a;const o="visualVariables"in t?r(a,t.visualVariables):a;if("simple"===t.type)return i(o,t.symbol);if("unique-value"===t.type){let e=o;return t.uniqueValueInfos?.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=o;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return"dot-density"===t.type||t.type,o}n.d(t,{o:()=>o})},49282:(e,t,n)=>{n.d(t,{t:()=>a,x:()=>i});const i=["freehand","hybrid","click"],a="click"},53856:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(93800),a=n(74719),r=n(58448),o=n(49959),s=n(48602),l=(n(21265),n(50925),n(14746),n(75269)),c=n(15492);let u=class extends r.A.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new c.U,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter((e=>!e.parent)).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,t=e&&e[this._stepIndex];return t&&t.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Promise.resolve(!0);this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!0};return!1!==e.force?this._cancel(e):new Promise(((t,n)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...e,force:!0}).then(t)},deny:()=>n(new a.default("workflow:cancel-denied","Request to cancel workflow was denied."))}})}))}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:t}=this,n=t.findIndex((t=>t.id===e));this._indexHistory.push(this._stepIndex),await this._go(n)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cancelCurrentStep:!1};await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=-1===this._stepIndex?0:this._stepIndex;await this._go(e)}async _cancel(){let{emitCancelEvent:e=!0,error:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&(this._set("started",!1),await this._transaction((()=>this.steps[this._stepIndex]?.tearDown({canceled:!0})))),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:t})}_go(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._transaction((async()=>{const{steps:n}=this;if(!(e<=-1||e>=n.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await n[this._lastStepIndex].tearDown({canceled:t});try{await n[e].setUp()}catch(i){(0,o.throwIfNotAbortError)(i)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}}))}async _transaction(e){const t=this._pendingOperation,n=(0,o.createResolver)(),i=(t??Promise.resolve()).then((()=>n.promise));this._pendingOperation=i,this._updatingHandles.addPromise(i);try{t&&await t,await e()}finally{n.resolve(),i===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};(0,i._)([(0,s.MZ)()],u.prototype,"data",void 0),(0,i._)([(0,s.MZ)()],u.prototype,"hasNextStep",null),(0,i._)([(0,s.MZ)()],u.prototype,"hasPreviousStep",null),(0,i._)([(0,s.MZ)()],u.prototype,"onCommit",void 0),(0,i._)([(0,s.MZ)()],u.prototype,"reliesOnOwnerAdminPrivileges",null),(0,i._)([(0,s.MZ)()],u.prototype,"hasInvalidFormTemplate",null),(0,i._)([(0,s.MZ)()],u.prototype,"shouldShowAttachments",null),(0,i._)([(0,s.MZ)()],u.prototype,"shouldAllowAttachmentEditing",null),(0,i._)([(0,s.MZ)()],u.prototype,"started",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],u.prototype,"stepId",null),(0,i._)([(0,s.MZ)()],u.prototype,"steps",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,s.MZ)()],u.prototype,"helpMessage",null),(0,i._)([(0,s.MZ)()],u.prototype,"hasPendingEdits",null),(0,i._)([(0,s.MZ)()],u.prototype,"keyboardCancellationEnabled",null),(0,i._)([(0,s.MZ)()],u.prototype,"updating",null),u=(0,i._)([(0,l.$)("esri.widgets.Editor.Workflow")],u);const d=u},54404:(e,t,n)=>{async function i(e,t){if("2d"===e.type)return e.hitTest(t);const n=await e.hitTest(t);if(0===n.results.length)return n;const i=n.results[0],r=(i.distance??0)*(1+a),o=n.results.findIndex((e=>(e.distance??0)>r));return-1!==o&&(n.results=n.results.slice(0,o)),i&&n.ground.distance>r&&(n.ground.mapPoint=null),n}n.d(t,{h$:()=>s,oZ:()=>i,zF:()=>o});const a=.05;function r(e){return"graphic"===e?.type}function o(e){return e.find(r)??null}function s(e){return e.filter(r)}},55834:(e,t,n)=>{n.d(t,{y:()=>s});var i=n(93800),a=n(58448),r=n(48602),o=(n(21265),n(50925),n(14746),n(75269));let s=class extends a.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}};(0,i._)([(0,r.MZ)({constructOnly:!0})],s.prototype,"graphic",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"tracking",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"displaying",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"error",void 0),(0,i._)([(0,r.MZ)()],s.prototype,"isDraped",void 0),s=(0,i._)([(0,o.$)("esri.views.3d.layers.graphics.GraphicState")],s)},58648:(e,t,n)=>{function i(e,t,n){if(null==e)return"noTool";switch(e){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function(e,t){const n=null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0;return"freehand"===t?n<2?"freehandStart":"freehandEnd":n<2?"polylineZeroVertices":"polylineOneVertex"}(t,n);case"polygon":return function(e,t){const n=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(n<4)return"freehand"===t?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(t,n);case"rectangle":case"circle":return function(e,t){if((null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(t,n);default:return}}n.d(t,{$:()=>i})},60757:(e,t,n)=>{n.d(t,{AO:()=>c,Bi:()=>s,Cg:()=>r,Rg:()=>l,Vi:()=>d,fT:()=>o,zE:()=>u});var i=n(45622),a=n(12560);const r=100;function o(e){return"point"===e.type}function s(e){return"polygon"===e.type}function l(e){return"polyline"===e.type}function c(e){return!!e&&"radial"===e.type}function u(e){let t=null;for(const n of e)if(n.graphic.geometry){const e=n.graphic.geometry,i=o(e)?new a.default({spatialReference:e.spatialReference,xmin:e.x,xmax:e.x,ymax:e.y,ymin:e.y}):e.extent;t=null==t?i?.clone():t.union(i.extent)}return t}function d(e){const t=new Map;for(const n of e)(0,i.tE)(t,n.id,(()=>({addFeatures:[],id:n.id,identifierFields:{globalIdField:n.layer.globalIdField,objectIdField:n.layer.objectIdField}}))).addFeatures?.push(n.graphic);return[...t.values()]}},61073:(e,t,n)=>{n.d(t,{l:()=>o});n(21265),n(50925);var i=n(89227),a=n(23278),r=n(43536);class o extends r.m{constructor(e,t,n,i){super(i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.n.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof o&&(0,i.p)(this.previousVertex,e.previousVertex)&&(0,i.p)(this.centerVertex,e.centerVertex)&&(0,i.p)(this.nextVertex,e.nextVertex)}}},62240:(e,t,n)=>{function i(e,t,n,i){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:i,type:"point"}}function a(e,t,n,i,a){e.x=t,e.y=n,e.z=i,e.hasZ=null!=i,e.spatialReference=a}n.d(t,{J:()=>a,T:()=>i})},64053:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(93800),a=n(6946),r=n(48602),o=(n(21265),n(50925),n(14746),n(75269));let s=class extends a.default{constructor(e){super(e),this.enabled=!1}};(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],s.prototype,"enabled",void 0),s=(0,i._)([(0,o.$)("esri.views.interactive.sketch.SketchLabelOptions")],s);const l=s},65022:(e,t,n)=>{n.d(t,{c:()=>o});n(21265),n(50925);var i=n(89227),a=n(23278),r=n(43536);class o extends r.m{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.n.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,r),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=s}equals(e){return e instanceof o&&this.type===e.type&&(0,i.p)(this.lineStart,e.lineStart)&&(0,i.p)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,i.j)(this.lineStart,this.lineEnd)}}},68947:(e,t,n)=>{n.d(t,{A:()=>p});var i=n(93800),a=n(6946),r=n(48602),o=(n(21265),n(50925),n(14746),n(75269)),s=n(22093),l=n(50330),c=n(19983),u=n(92471);let d=class extends a.default{constructor(e){super(e),this.view=null,this.highlightName=l.Tv}add(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._highlight(e)))}remove(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._removeHighlight(e)))}removeAll(){this.removeAllHandles()}_highlight(e){const t=(0,s.i)(this.view,e.layer);(0,c.Of)(t)&&this.addHandles(t.highlight(e,{name:this.highlightName}),(0,u.getHighlightKeyForFeature)(e))}_removeHighlight(e){e&&this.removeHandles((0,u.getHighlightKeyForFeature)(e))}};(0,i._)([(0,r.MZ)()],d.prototype,"view",void 0),(0,i._)([(0,r.MZ)({constructOnly:!0})],d.prototype,"highlightName",void 0),d=(0,i._)([(0,o.$)("esri.views.draw.support.HighlightHelper")],d);const p=d},70674:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var i=n(93800),a=n(48602),r=(n(21265),n(50925),n(14746),n(75269)),o=n(21),s=n(57457),l=n(24203),c=n(75215),u=n(33580),d=n(87730);let p=class extends((0,l.dM)((0,c.j)(s.default))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i._)([(0,a.MZ)({type:d.A})],p.prototype,"elevationInfo",void 0),(0,i._)([(0,a.MZ)((0,o.C)(u.Y,"graphics"))],p.prototype,"graphics",void 0),(0,i._)([(0,a.MZ)({type:["show","hide"]})],p.prototype,"listMode",void 0),(0,i._)([(0,a.MZ)()],p.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],p.prototype,"type",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],p.prototype,"internal",void 0),p=(0,i._)([(0,r.$)("esri.layers.GraphicsLayer")],p);const h=p},70755:(e,t,n)=>{n.d(t,{r:()=>o});n(21265),n(50925);var i=n(89227),a=n(23278),r=n(43536);class o extends r.m{constructor(e,t,n){super(n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.n.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&(0,i.p)(this.lineStart,e.lineStart)&&(0,i.p)(this.lineEnd,e.lineEnd)}}},72787:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var i=n(93800),a=n(79625),r=n(74719),o=n(42198),s=(n(21265),n(50925)),l=n(17741),c=n(49959),u=n(79953),d=n(12130),p=n(48602),h=(n(14746),n(75269)),f=n(42985),y=n(45622),m=n(83874),g=n(60757);const w={"buffer-line-to-polygon":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(51526),n.e(90465)]).then(n.bind(n,12846)),"buffer-point-to-polygon":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(51526),n.e(11511)]).then(n.bind(n,11511)),"buffer-polygon-to-polygon":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(51526),n.e(66559)]).then(n.bind(n,66559)),"connection-point":()=>n.e(77942).then(n.bind(n,77942)),"equally-spaced":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(25649)]).then(n.bind(n,25649)),"offset-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(623)]).then(n.bind(n,623)),"offset-primary-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(43457)]).then(n.bind(n,43457)),"point-at-all-vertices-of-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(96128)]).then(n.bind(n,96128)),"point-at-beginning-of-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(30563)]).then(n.bind(n,30563)),"point-at-beginning-of-radial":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(20662)]).then(n.bind(n,20662)),"point-at-end-of-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(15785)]).then(n.bind(n,15785)),"point-at-interior-vertices":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(2032)]).then(n.bind(n,2032)),"point-at-intersection-vertices-of-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(13858)]).then(n.bind(n,13858)),"point-at-not-beginning-of-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(65648)]).then(n.bind(n,65648)),"point-at-not-end-of-line":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(93449),n.e(98682)]).then(n.bind(n,98682)),"point-at-polygon-centroid":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(85993)]).then(n.bind(n,85993)),"point-at-polygon-not-start":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(94206)]).then(n.bind(n,94206)),"point-at-polygon-start":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(40389)]).then(n.bind(n,40389)),"point-identity":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(77372)]).then(n.bind(n,77372)),"point-primary-identity":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(77104)]).then(n.bind(n,77104)),"polygon-boundary":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(64744)]).then(n.bind(n,64744)),"polygon-boundary-two-point":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(49736)]).then(n.bind(n,49736)),"polygon-identity":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(11812)]).then(n.bind(n,11812)),"polygon-primary-identity":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(11128)]).then(n.bind(n,11128)),"polygon-vertices":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(60989)]).then(n.bind(n,60989)),"radial-lines":()=>n.e(21854).then(n.bind(n,21854)),"two-point-lines":()=>Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(72512),n.e(21579)]).then(n.bind(n,21579))};var b=n(78629),v=n(85322),M=n(79580);const I=()=>s.A.getLogger("esri.editing.sharedTemplates.executor.createTemplateExecutor"),_="globalid";async function S(e){if(!(0,f.xZ)(e))throw new r.default("template-executor:template-not-loaded","The template must be loaded before it can be executed.");if((0,f.Cq)(e))return function(e){return t=>{const n=[],i=[];(0,m.i)({geometry:t,template:e,edits:n,relationships:i});const a=(0,g.zE)(n);return{edits:(0,g.Vi)(n),relationships:i,primary:n[0]??null,featureExtent:a,rotationPoint:a?.center??null}}}(e);if((0,f.Dt)(e))return async function(e){const{definition:t}=e,n=await Promise.all(t.allParts.map(F));return(i,a)=>{const r=[],o=[],s=new Set,l=()=>{if(t.createUtilityNetworkAssociations&&"completion"===a){const{utilityNetwork:e,utilityNetworkAssociationsTable:n}=t;e&&n?function(e){const{edits:t,utilityNetworkHelper:n}=e,i=new Map;for(const a of t)""!==a.tag&&n.layerIdToSourceIdLookup.has(a.id)&&(0,y.tE)(i,a.tag,(()=>[])).push(a);for(const a of i.values())if(!(a.length<2))for(let t=0;t<a.length;t++){const n=a[t];for(let i=t+1;i<a.length;i++)k(n,a[i],e)}}({associationGraphics:s,associationsTable:n,edits:r,relationships:o,utilityNetworkHelper:e}):I().warn("Unable to create utility network associations between group template features. The utility network or its associations table is unavailable.")}const e=(0,g.zE)(r);return{associationGraphics:s,edits:(0,g.Vi)(r),relationships:o,primary:r[0]??null,featureExtent:e,rotationPoint:e?.center??null}};if(null==i)return I().warn("No geometry provided to group template executor. Result will be empty."),l();const u=n.map((t=>t({edits:r,mode:a,parentTemplate:e,relationships:o,shape:i}))).filter(c.isPromiseLike);return 0===u.length?l():Promise.all(u).then((()=>l()))}}(e);if((0,f.JC)(e))return async function(e){const{createPresetServiceEdit:t}=await Promise.all([n.e(54256),n.e(12834),n.e(61853),n.e(75646),n.e(5410),n.e(13369)]).then(n.bind(n,13369));return function(n,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(0,b.isPoint)(n))throw new r.default("template-executor:invalid-input-geometry","The input goemetry for a preset template must be a point.");const o=[],s=[],l=t({geometry:n,template:e,edits:o,relationships:s,rotation:a,mode:i});return{edits:(0,g.Vi)(o),relationships:s,primary:o[0]??null,featureExtent:(0,g.zE)(o),rotationPoint:l}}}(e);throw new r.default("template-executor:unsupported-template-type","The template type is not supported.")}async function F(e){const t=await function(e){const t=w[e];if(!t)throw new Error(`Builder type ${e} is not supported.`);return t()}(e.builderType);return n=>t.execute({...n,templatePart:e})}function k(e,t,n){const{associationGraphics:i,associationsTable:r,edits:o,utilityNetworkHelper:s,relationships:l}=n,c=s.findAgat(e.graphic,e.layer),u=s.findAgat(t.graphic,t.layer);if(!c||!u)return;const p=s.findRules(c).map((n=>n.fromNetworkSource?.sourceId!==c.networkSourceId||n.fromAssetGroup?.assetGroupCode!==c.assetGroup||null!==n.fromAssetType?.assetTypeCode&&n.fromAssetType?.assetTypeCode!==c.assetType||n.toNetworkSource.sourceId!==u.networkSourceId||n.toAssetGroup?.assetGroupCode!==u.assetGroup||null!==n.toAssetType&&n.toAssetType?.assetTypeCode!==u.assetType?n.toNetworkSource.sourceId!==c.networkSourceId||n.toAssetGroup?.assetGroupCode!==c.assetGroup||null!==n.toAssetType&&n.toAssetType?.assetTypeCode!==c.assetType||n.fromNetworkSource.sourceId!==u.networkSourceId||n.fromAssetGroup?.assetGroupCode!==u.assetGroup||null!==n.fromAssetType?.assetTypeCode&&n.fromAssetType?.assetTypeCode!==u.assetType?null:{rule:n,from:{agat:u,item:t},to:{agat:c,item:e}}:{rule:n,from:{agat:c,item:e},to:{agat:u,item:t}})).filter((e=>e?.rule.ruleType===M.D2.RTJunctionEdgeConnectivity||e?.rule.ruleType===M.D2.RTEdgeJunctionEdgeConnectivity||e?.rule.ruleType===M.D2.RTContainment?null:e)).filter((e=>null!==e));if(0===p.length)return;const h=(0,v.E)(r),f=new Set;for(const y of p){const e={};e[h.fromNetworkSourceId]=y.rule.fromNetworkSource.sourceId,e[h.fromGlobalId]=y.from.item.graphic.attributes[y.from.item.layer.globalIdField??_],e[h.fromTerminalId]=null,y.rule.fromTerminal&&(e[h.fromTerminalId]=y.rule.fromTerminal.terminalId),e[h.toNetworkSourceId]=y.rule.toNetworkSource.sourceId,e[h.toGlobalId]=y.to.item.graphic.attributes[y.to.item.layer.globalIdField??_],e[h.toTerminalId]=null,y.rule.toTerminal&&(e[h.toTerminalId]=y.rule.toTerminal.terminalId),e[h.associationType]=y.rule.ruleType,e[h.percentAlong]=null,e[h.isContentVisible]=y.rule.ruleType===M.D2.RTContainment?1:0,e[h.status]=0,e[h.globalId]=(0,d.yS)();const t=`${e[h.fromNetworkSourceId]}-${e[h.fromGlobalId]}-${e[h.toNetworkSourceId]}-${e[h.toGlobalId]}-${e[h.associationType]}`;if(f.has(t))continue;f.add(t);const n=new a.default({attributes:e,sourceLayer:r});i.add(n),o.push({id:r.layerId,graphic:n,tag:"",layer:r}),l.push({sourceGraphic:y.to.item.graphic,sourceLayerId:y.to.item.layer.layerId,destinationGraphic:n,destinationLayerId:r.layerId,sourceField:y.to.item.layer.globalIdField??_,destinationField:h.toGlobalId??_}),l.push({sourceGraphic:y.from.item.graphic,sourceLayerId:y.from.item.layer.layerId,destinationGraphic:n,destinationLayerId:r.layerId,sourceField:y.from.item.layer.globalIdField??_,destinationField:h.fromGlobalId??_})}}var T,A=n(70674),x=n(78076),C=n(26286),P=n(58648),E=n(68947),Z=n(91690),L=n(59116),V=n(50330),O=n(98555),z=n(83908),R=n(53856),H=n(39262),N=n(94495),G=n(17577);const D=Symbol(),j=Symbol(),U=Symbol(),W=Symbol(),q={point:["point"],multipoint:["multipoint"],polygon:["polygon","freehandPolygon","rectangle","circle"],polyline:["polyline","freehandPolyline"],mesh:[],multipatch:[]};let $=T=class extends R.default{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._webStyleCache=new Map,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new N.default,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._isActive=!0}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){if(this.pendingFeatures.some((e=>!!this.data.getEditsForPendingFeature(e)?.modified)))return!0;const{creationInfo:e,upload:t}=this.data,n=this._sketchViewModel,{activeComponent:i}=n,a=n.createGraphic?.geometry?.type;return!("polyline"!==a&&"polygon"!==a&&"multipoint"!==a||"draw-2d"!==i?.type&&"draw-3d"!==i?.type)&&i.drawOperation.committedVertices.length>0||!(!t||"pending"!==t.state&&"success"!==t.state)||!!e?.geometryToPlace}get hasPreviousStep(){return this._stepIndex>0||"update-pending"===this.createFeatureState&&!!this.data.selectedPendingFeature&&!this.parent&&!(0,z.v)(this.data.creationInfo)}get helpMessage(){const{creationInfo:e,viewModel:t}=this.data;if("creating-features"!==this.stepId||!e)return;const i=e.layer.geometryType,a=this._sketchViewModel.createGraphic;if("mesh"===i){this._getDrawMeshHelpMessage||n.e(73867).then(n.bind(n,73867)).then((e=>{this._getDrawMeshHelpMessage=e.getDrawMeshHelpMessage}));const{view:e}=t;return"3d"===e?.type?this._getDrawMeshHelpMessage?.(a,e):void 0}const r=this._sketchViewModel.activeCreateToolDrawMode,o=this._sketchViewModel.activeTool;return(0,P.$)("rectangle"===o?"rectangle":"circle"===o?"circle":i,a?.geometry,r)}get layer(){return this.data.creationInfo?.layer}get numPendingFeatures(){return this.pendingFeatures.length}get numPendingFeaturesExcludingHidden(){return this.pendingFeatures.filter((e=>this.data.isDisplayable(e))).length}get parent(){return this.data.parent}get parentLayer(){return this.parent?.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return 0===this.numPendingFeatures}get reliesOnOwnerAdminPrivileges(){return this.data.editorItem?.capabilities.create.reliesOnOwnerAdminPrivileges??!1}get shouldShowAttachments(){return(this.data.selectedPendingFeature&&this.data.editorItem?.capabilities.create.attachments.enabled)??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}get availableCreateTools(){const e=this.data.creationInfo?.layer.geometryType,t=this.data.viewModel.view;if(!e)return[];if(this.data.creationInfo?.maxFeatures&&this.data.creationInfo.maxFeatures<=this.numPendingFeatures)return[];if((0,f.w2)(this.data.fullTemplate)){const{tool:t}=(0,H.Xm)(e,this.data.fullTemplate);return[t]}return"2d"!==t?.type&&"multipoint"===e?[]:[...q[e]]}get _attachmentsActive(){const e=this.data.viewModel.attachmentsViewModel.mode,t=this.stepId;return this.shouldShowAttachments&&("add"===e||"edit"===e||"adding-attachment"===t||"editing-attachment"===t)}async enter(){this._isActive=!0,"awaiting-feature-creation-info"!==this.stepId&&await this._updatingHandles.addPromise(this._setUpCreatingFeaturesStep())}exit(){this._isActive=!1,this.removeHandles([U])}async updatePendingFeature(e){if(e!==this.data.selectedPendingFeature)return this._sketchViewModel.cancel(),this._startUpdating({feature:e})}async start(){return await super.start(),(0,x.bI)(this.data.creationInfo?.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}async save(){const{featureFormViewModel:e}=this;if(e.pendingSubtypeChoice)return;e.submit(),this._stashValidationState();const t=this.data.selectedPendingFeature,n=this._hasValidationErrors(t)?t:this.data.pendingFeatures.find((e=>this._hasValidationErrors(e)));return n?(await this._startUpdating({feature:n}),void e?.submit()):super.save()}back(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||(0,z.v)(this.data.creationInfo)||this._attachmentsActive||this.parent?super.back(e):this._clearSelectedFeature()}previous(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||(0,z.v)(this.data.creationInfo)||this._attachmentsActive?super.previous(e):this._clearSelectedFeature()}cancelFeature(e){this.data.isSharedTemplateWorkflow?s.A.getLogger(this).warn("Cannot cancel individual features created by shared templates."):(this.data.removePendingFeature(e),this.sketchViewModel.layer.graphics.remove(e))}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:n,applyEditsFeatureServiceCallback:i,isNested:a,creationInfo:r,parent:o,snappingManager:s,startAt:l,viewModel:c}=e,u=e.sketchOptions??new Z.A,p=r?.layer,h=p?c.findEditorItemForLayer(p):void 0,y=new T({data:new O.default({creationInfo:r,editorItem:h,parent:o,sketchOptions:u,snappingManager:s,viewModel:c}),isNested:a,onCommit:async e=>{const{creationInfo:a}=e;if(!a)return;y._sketchViewModel.cancel();const r=e.pendingFeatures.toArray(),{layer:o}=a,s=o.capabilities?.editing.supportsGlobalId&&"globalIdField"in o,l=y._attachmentFileInfos,{fullTemplate:u}=e,p=(0,H._3)(y.data),h=(0,f.Sf)(u)&&p;if(s){if(function(e){for(const t of e){const{sourceLayer:e}=t;e&&"globalIdField"in e&&null!=e.globalIdField&&(t.attributes[e.globalIdField]??=(0,d.yS)())}}(r),h){let t=function(e,t){return e.map((e=>{const{addFeatures:n}=e;if(!n||0===n.length)return e;const i=[];for(const a of n){const e=t.get(a);if(e)for(const{file:t}of e)i.push({feature:a,attachment:{globalId:(0,d.yS)(),data:t}})}return i.length?{...e,addAttachments:i}:e}))}(p,l);const n=await(0,H.uh)(o,c.view);n&&(t=(0,H.sy)({edits:t,serviceInfo:n,view:c.view,findOriginalFeature:t=>e.getEditsForPendingFeature(t)?.initialFeature??t})),await i(u.featureService,t,{globalIdUsed:!0,gdbVersion:u.layer.gdbVersion??void 0})}else{const e=function(e,t){const n=[];if(!t||0===t.size)return{addFeatures:e};for(const[i,a]of t)for(const{file:e}of a)n.push({feature:i,attachment:{globalId:(0,d.yS)(),data:e}});return n.length?{addFeatures:e,addAttachments:n}:{addFeatures:e}}(r,l);await n(o,e,{globalIdUsed:!0})}return}const m=h?await i(u.featureService,p,{gdbVersion:u.layer.gdbVersion??void 0}):[await n(o,{addFeatures:r})];m&&l.size>0&&await Promise.all(m.map((e=>{if(e?.addFeatureResults)return t(o,function(e,t,n,i){const a=[];return t.forEach(((t,r)=>{if(!t.error){const o=e[r],s=i.get(o)||[];o.attributes[n.objectIdField]=t.objectId,s.forEach((e=>{let{form:t}=e;return a.push({feature:o,attachment:t})}))}})),a}(r,e.addFeatureResults,o,l))})))}});return y._set("steps",this._createWorkflowSteps(y,l)),y}_fadeExistingFeatures(e){if("effect"in e){const t=e.effect;return e.effect="saturate(0.6) opacity(0.8)",(0,o.hA)((()=>e.effect=t))}const t=e.opacity;return e.opacity=.7,(0,o.hA)((()=>e.opacity=t))}async _initializeFullTemplateAndExecutorInfo(e){const{creationInfo:t}=e,{view:n}=e.viewModel;if(!t||!n)return null;const i=await(0,H.sE)(t,n);if(e.fullTemplate=i,i&&(0,f.Sf)(i)){const a={completionResults:[],executor:await S(i),serviceLayersById:await(0,H.EH)(t.layer,n)};e.templateExecutorInfo=a}return i}async _startCreating(){this.removeHandles(j);const{data:e}=this;if(!e.creationInfo)return;const t=this.data.creationInfo?.maxFeatures;if(t&&this.numPendingFeatures>=t)return this.sketchViewModel.cancel(),void(this.numPendingFeatures&&await this._startUpdating({feature:this.pendingFeatures.at(-1)}));this.createFeatureState="create-new",await(0,H.AP)(this._sketchViewModel,e,this._webStyleCache)}async _clearSelectedFeature(){const e=this._featureFormViewModel.pendingSubtypeChoice;e&&(e.resolve("undo"),await e.promise),this._stashValidationState(),this.sketchViewModel.cancel(),this.data.selectedPendingFeature=null,this._featureFormHandle=(0,l.xt)(this._featureFormHandle),this._featureFormViewModel.feature=null;const t=this.data.viewModel.attachmentsViewModel;"add"!==t.mode&&"edit"!==t.mode||this.data.viewModel.activeWorkflow?.previous()}_stashValidationState(){const e=this._featureFormViewModel.feature,t=e&&this.data.getEditsForPendingFeature(e);t&&(t.submittable=this._featureFormViewModel.submittable)}async _selectFeatureForUpdate(e){let{feature:t,initialFeature:n=t}=e;this._stashValidationState();const{data:i,pendingFeatures:a,_webStyleCache:r}=this;a.includes(t)||i.addPendingFeature(t,n),i.selectedPendingFeature=t;const{_featureFormViewModel:s,_sketchViewModel:c}=this,{creationInfo:d,viewModel:p}=i,{attachmentsViewModel:h,layerInfos:f,view:y}=p;if(!y||!d)return;(0,l.xt)(this._featureFormHandle);const m=t.sourceLayer,g=(0,H.Z5)(f,m),w=g?.formTemplate,b=y.spatialReference;s.set({arcadeEditType:"INSERT",feature:t,formTemplate:w,spatialReference:b,map:y.map}),"add"!==h.mode&&"edit"!==h.mode||p.activeWorkflow?.previous(),h.graphic=t,h.fileInfos.removeAll(),h.mode="view",(this._attachmentFileInfos.get(t)||[]).forEach((e=>{let{file:t,form:n}=e;return h.addFile(t,n)})),await(0,H.FC)(t,r,"2d"===y.type?y.scale:null);const v=i.getEditsForPendingFeature(t);this._featureFormHandle=(0,o.vE)([s.on("value-change",(async()=>{v?.updateAttributes(s.getValues()),await(0,H.FC)(t,r,"2d"===y.type?y.scale:null)})),c.on(["update","undo","redo"],(e=>{("undo"===e.type||"redo"===e.type||"update"===e.type&&null!=e.toolEventInfo&&(0,H.Ks)(e.toolEventInfo.type))&&s.notifyFeatureGeometryChanged()})),(0,u.watch)((()=>s.feature?.sourceLayer),(e=>t.sourceLayer=e)),(0,u.watch)((()=>[s.feature,s.submittable]),(()=>this._stashValidationState()))]),this.createFeatureState="update-pending"}async _startUpdating(e){let{feature:t,initialFeature:n=t}=e;await this._selectFeatureForUpdate({feature:t,initialFeature:n});const{_sketchViewModel:i,data:a}=this,{creationInfo:r,viewModel:o}=a,{view:s}=o;if(!s||!r)return;const l=t.sourceLayer??r.layer;return(0,x.bI)(l)?void 0:(this._visualVariableAttributes=(0,H.EO)(t),(0,H.J_)({graphic:t,sketchViewModel:i,sourceLayer:l,visualVariables:this._visualVariableAttributes,webStyleCache:this._webStyleCache}))}static _createWorkflowSteps(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";const{data:n}=e,i=(0,H.z4)(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:t,viewModel:i}=n,{view:a}=i;a&&((0,z.v)(t)?e.addHandles(await(0,z.P)({view:a,data:n,next:()=>e.next(),cancel:()=>i.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(n.parent&&t&&e.addHandles(i.restrictFeatureTemplatesViewModelToLayer(t.layer),this.id),e.addHandles(i.featureTemplatesViewModel.on("select",(t=>{let{item:i}=t;i&&(n.creationInfo={...n.creationInfo,layer:i.layer,template:i.template},e.next())})),this.id)))},async tearDown(){e.removeHandles(this.id)}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(t){const{viewModel:i}=n;t.canceled&&(e.removeHandles([U,D,j,W]),i.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=n.viewModel,{graphic:i,fileInfos:a}=t;e._attachmentFileInfos.set(i,a.toArray()),t.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=n.viewModel,{graphic:i,fileInfos:a}=t;e._attachmentFileInfos.set(i,a.toArray()),t.mode="view"}})});return(0,H.bn)(n,i)}static _configureSketchViewModel(e){const{data:t}=e,n=e._webStyleCache,{creationInfo:i,viewModel:a}=t,{view:r}=a,s=e._sketchViewModel,d=[];if(!r)return(0,o.hA)();if("2d"===r.type){i&&d.push(e._fadeExistingFeatures(i.layer));const t=(0,c.debounce)(((e,t)=>Promise.all(e.map((e=>(0,H.FC)(e,n,t))))));d.push((0,u.watch)((()=>r.scale),(e=>t(s.layer.graphics,e))))}const p=(0,H.nc)(t.fullTemplate,i?.attributeOverrides),h=(0,u.watch)((()=>s.createGraphic),(i=>{i&&!e.hasHandles(j)&&e._updatingHandles.addPromise((0,H.Pi)({creationAttributes:p,data:t,sketchViewModel:s,view:r,webStyleCache:n}).then((t=>e.addHandles(t,j))))})),f=async n=>{const{attachmentsViewModel:o}=a,{_featureFormViewModel:l}=e;if(n.graphics.length>1)return void await e._clearSelectedFeature();const c=n.graphics[0];if("complete"===n.state){const{submittable:t}=l;if(e.numPendingFeatures!==i?.maxFeatures&&t||l.submit(),await e._clearSelectedFeature(),"add"!==o.mode&&"edit"!==o.mode||a.activeWorkflow?.previous(),!n.aborted&&r.activeTool===e.sketchViewModel.activeComponent&&(await e.sketchViewModel.wait(),"ready"===e.sketchViewModel.state&&"mesh"!==e.data.creationInfo?.layer.geometryType))return e._startCreating()}else{if("start"===n.state)return c.sourceLayer??=t.creationInfo?.layer,await(0,H.cY)({sketchViewModel:s,graphic:c,visualVariables:e._visualVariableAttributes,webStyleCache:e._webStyleCache,sourceLayer:c.sourceLayer}),e._selectFeatureForUpdate({feature:c});if("active"===n.state){await e.updatePendingFeature(c);const t=e._visualVariableAttributes;await(0,H.EA)(r,c,n,t,e._webStyleCache);const i=c.attributes,{rotation:a,size:o}=t;if(null!=a){const{field:e}=a;l.setValue(e,i[e])}if(null!=o){const{field:e}=o;l.setValue(e,i[e])}}}},y=async n=>{if(n.graphics.forEach((e=>{t.removePendingFeature(e)})),!(0,z.v)(t.creationInfo))return e._startCreating()};d.push(h,s.on("create",(t=>e._updatingHandles.addPromise((async t=>{if("cancel"!==t.state&&"complete"!==t.state||e.removeHandles(j),"cancel"===t.state&&null!==r.activeTool&&r.activeTool!==e.sketchViewModel.activeComponent&&(await e._waitForActiveToolCleared(),await e._startCreating()),"complete"===t.state&&t.graphic){const n=await e._processEdits(t.graphic,{scale:"2d"===r.type?r.scale:null,useSourceLayer:!0,webStyleCache:e._webStyleCache});n&&(await e._waitForActiveToolCleared(),await e._startUpdating({feature:n}))}})(t)))),s.on("update",(t=>e._updatingHandles.addPromise(f(t)))),s.on("delete",(t=>e._updatingHandles.addPromise(y(t)))),(0,u.when)((()=>!e.numPendingFeatures),(()=>e._updatingHandles.addPromise((async()=>{if((0,z.v)(t.creationInfo))try{await e.data.viewModel.back()}catch{}return e._startCreating()})()))),(0,o.hA)((()=>{s.cancel()})),function(e,t){let n=null;const i=()=>e.snappingOptions.featureSources,a=()=>(n=new L.default({layer:e.layer}),i().add(n),n),r=()=>{null!=n&&(i().remove(n),n=(0,l.pR)(n))};return(0,o.vE)([(0,u.watch)((()=>{const e=t.creationInfo?.layer,n=i().find((t=>t.layer===e));return{hasFeatureLayerSource:!!n,enabled:n?.enabled??!1}}),(e=>{let{hasFeatureLayerSource:t,enabled:i}=e;if(!t)return r();n??=a(),n.enabled=i}),u.syncAndInitial),(0,o.hA)(r)])}(s,t),...function(e){const t=e.viewModel.view;if(!t)return[];const n=[];if("3d"===t.type){const i=new E.A({view:t});n.push((0,u.watch)((()=>e.selectedPendingFeature),((e,t)=>{i.remove(e),i.add(t)})),(0,o.hA)((()=>i.destroy())))}const i=new E.A({view:t,highlightName:V.n4});return n.push((0,u.watch)((()=>e.temporaryHighlightFeature),(e=>{i.removeAll(),i.add(e)})),(0,o.hA)((()=>i.destroy()))),n}(t));const m=(0,o.vE)(d);return s.addHandles(m),m}_initializeSketchViewModel(){const{data:e}=this,{view:t}=e.viewModel,n=new A.default({elevationInfo:e.creationInfo?.layer.elevationInfo,internal:!0,listMode:"hide",title:"createFeaturesWorkflow-internal"}),i=new G.default({layer:n,creationMode:"single",sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},view:t});this._sketchViewModel=i,t?.map.add(n),this.addHandles([(0,o.hA)((()=>{t?.destroyed||t?.map.remove(n),n.destroy()})),(0,u.watch)((()=>this.numPendingFeatures>0),(e=>this._sketchViewModel.updateOnGraphicClick=e),u.initial)])}_hasValidationErrors(e){return!!e&&(!this.data.isSubmittable(e)||!!this._featureFormViewModel.validateContingencyConstraints(e.attributes,{includeIncompleteViolations:!0})?.length)}async _processEdits(e,t){const{data:n}=this,{layerInfos:i,view:a}=n.viewModel,r=this._featureFormViewModel,{templateExecutorInfo:o}=n;if(!o){const t=e.clone();return t.geometry=null,n.addPendingFeature(e,t),e}const s=this.sketchViewModel.layer;s.remove(e);const{executor:l}=o,d=l(e.geometry,"completion"),p=(0,c.isPromiseLike)(d)?await d:d;o.completionResults.push(p),(0,H.O)(p.relationships),r.arcadeEditType="INSERT",r.map=a?.map,r.spatialReference=a?.spatialReference,p.primary&&n.creationInfo?.attributeOverrides&&(p.primary.graphic.attributes={...p.primary.graphic.attributes,...n.creationInfo.attributeOverrides});for(const c of p.edits){let e=null;if(c.addFeatures)for(const a of c.addFeatures){const o=a.clone();o.geometry=null,null!=a.geometry&&(a.symbol=await(0,C.getDisplayedSymbol)(a,t),s.add(a));const l=n.addPendingFeature(a,o,{isAssociation:!!p.associationGraphics?.has(a)});a.sourceLayer!==e?.layer&&(e=(0,H.Z5)(i,a.sourceLayer)),r.feature=a,r.formTemplate=e?.formTemplate,await(0,u.whenOnce)((()=>!r.updating)),l.submittable=r.submittable}}return r.feature=null,await(0,u.whenOnce)((()=>!r.updating)),p.edits.reduce(((e,t)=>e+(t.addFeatures?.length??0)),0)>1?null:p.primary?.graphic}async _setUpCreatingFeaturesStep(){if(this.hasHandles(U))return;const{data:e,sketchViewModel:t}=this,{creationInfo:n,viewModel:i}=e,{attachmentsViewModel:s,view:c}=i;if(!c||!n?.layer)throw new r.default("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:d,layer:p}=n,h=[],y=[];this._featureFormHandle=(0,l.xt)(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},e.editorItem=i.findEditorItemForLayer(n.layer),n.template&&(null==e.fullTemplate&&await this._initializeFullTemplateAndExecutorInfo(e),y.push((0,o.hA)((()=>{e.templateExecutorInfo&&(e.templateExecutorInfo.completionResults=[])})))),t.allowDeleteKey=!e.isSharedTemplateWorkflow,(0,H.r8)(s),h.push((0,u.watch)((()=>s.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})));const m=(0,H.Pz)(c);h.push(m);const g=(0,x.bI)(n.layer),{template:w}=n,b=!w||(0,f.gZ)(w)||(0,f.w2)(w)&&"feature"===w.type,v=g&&b;try{if(v){const t=d??new a.default({attributes:(0,H.nc)(e.fullTemplate,n.attributeOverrides),sourceLayer:p}),i=await this._processEdits(t);i&&await this._startUpdating({feature:i})}else h.push(T._configureSketchViewModel(this)),d?(t.layer.add(d),await this._startUpdating({feature:d})):await this._startCreating()}finally{m.remove()}const M=(0,o.hA)((()=>{for(const n of e.pendingFeatures)t.layer.remove(n),e.removePendingFeature(n)})),I=(0,u.watch)((()=>c?.timeZone),(e=>{this._featureFormViewModel.timeZone=e,this.data.timeZone=e}),u.initial),_=(0,o.hA)((()=>{(0,z.v)(n)&&i.cancelWorkflow({warnIfNoWorkflow:!1})}));this._featureFormHandle&&h.push(this._featureFormHandle),this.addHandles(h,this._handleKeys.beforeCommit),this.addHandles(y,this._handleKeys.afterCommit),this.addHandles([(0,o.hA)((()=>s.fileInfos.removeAll())),(0,o.vE)(h),(0,o.vE)(y),_,M,I],U)}async _waitForActiveToolCleared(){const e=this.data.viewModel.view;if(null==e?.activeTool)return;const t=new AbortController;this.addHandles((0,o.rE)(t),W),await(0,u.whenOnce)((()=>null==e?.activeTool),t.signal),t.abort()}};(0,i._)([(0,p.MZ)()],$.prototype,"createFeatureState",void 0),(0,i._)([(0,p.MZ)()],$.prototype,"data",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],$.prototype,"isNested",void 0),(0,i._)([(0,p.MZ)()],$.prototype,"featureFormViewModel",null),(0,i._)([(0,p.MZ)()],$.prototype,"hasPendingEdits",null),(0,i._)([(0,p.MZ)()],$.prototype,"hasPreviousStep",null),(0,i._)([(0,p.MZ)()],$.prototype,"_getDrawMeshHelpMessage",void 0),(0,i._)([(0,p.MZ)()],$.prototype,"helpMessage",null),(0,i._)([(0,p.MZ)()],$.prototype,"layer",null),(0,i._)([(0,p.MZ)()],$.prototype,"parent",null),(0,i._)([(0,p.MZ)()],$.prototype,"parentLayer",null),(0,i._)([(0,p.MZ)()],$.prototype,"keyboardCancellationEnabled",null),(0,i._)([(0,p.MZ)()],$.prototype,"reliesOnOwnerAdminPrivileges",null),(0,i._)([(0,p.MZ)()],$.prototype,"shouldShowAttachments",null),(0,i._)([(0,p.MZ)()],$.prototype,"shouldAllowAttachmentEditing",null),(0,i._)([(0,p.MZ)()],$.prototype,"sketchViewModel",null),(0,i._)([(0,p.MZ)()],$.prototype,"availableCreateTools",null),(0,i._)([(0,p.MZ)()],$.prototype,"_attachmentsActive",null),$=T=(0,i._)([(0,h.$)("esri.widgets.Editor.CreateFeaturesWorkflow")],$);const B=$},74309:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(89227),a=n(23278),r=n(43536);class o extends r.m{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.n.ALL),this.intersectionPoint=e}equals(e){return e instanceof o&&(0,i.p)(this.intersectionPoint,e.intersectionPoint)}}},79906:(e,t,n)=>{n.d(t,{$d:()=>f,GG:()=>S,N7:()=>y,Sx:()=>m,UQ:()=>_,cJ:()=>g,di:()=>F,dt:()=>w,f3:()=>k,k_:()=>h});var i=n(88102),a=n(58828),r=(n(21265),n(16804)),o=n(28473),s=n(22250),l=n(44827),c=n(6135),u=n(76945),d=n(38602);const p=new i.default("white");function h(e){if(!e)return 0;if((0,d.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,r.PN)((0,c.$4)(e)?.width)}function f(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function y(e){return e.resource?.href??""}function m(e,t){if(!e)return null;let n=null;return(0,d.wk)(e)?n=function(e){const t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(n="water"===e.type?e.color:e.material?e.material.color:null)})),n?new i.default(n):null}(e):(0,d.$y)(e)&&(n="cim"===e.type?(0,l.getCIMSymbolColor)(e):e.color?new i.default(e.color):null),n?g(n,t):null}function g(e,t){if(null==t||null==e)return e;const n=e.toRgba();return n[3]=n[3]*t,new i.default(n)}function w(e,t,n){e&&(t||null!=n)&&(t&&(t=new i.default(t)),(0,d.wk)(e)?function(e,t,n){const i=e.symbolLayers;if(!i)return;const a=e=>g(t=t??e??(null!=n?p:null),n);i.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=a(e.color);else{const t=null!=e.material?e.material.color:null,i=a(t);null==e.material?e.material=new u.N({color:i}):e.material.color=i,null!=n&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=g(e.outline.color,n))}}))}(e,t,n):(0,d.$y)(e)&&function(e,t,n){(t=t??e.color)&&(e.color=g(t,n)),null!=n&&"outline"in e&&e.outline?.color&&(e.outline.color=g(e.outline.color,n))}(e,t,n))}async function b(e,t){const i=e.symbolLayers;i&&await(0,a.jJ)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const n=v(t);null!=n&&(e.size=n)}(e,t);break;case"path":!function(e,t){const n=M(t,o.Un,[e.width,void 0,e.height]);e.width=I(t[0],e.width,1,n),e.height=I(t[2],e.height,1,n)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:a}=await async function(e){const{computeObjectLayerResourceSize:t}=await n.e(28897).then(n.bind(n,28897)),i=await t(e,10),{width:a,height:r,depth:o}=e,s=[a,o,r];let l=1;for(let n=0;n<3;n++){const e=s[n];if(null!=e){l=e/i[n];break}}for(let n=0;n<3;n++)null==s[n]&&(s[n]=i[n]*l);return{resourceSize:i,symbolSize:s}}(e),r=M(t,i,a);e.width=I(t[0],a[0],i[0],r),e.depth=I(t[1],a[1],i[1],r),e.height=I(t[2],a[2],i[2],r)}(e,t)}}(e,t)))}function v(e){for(const t of e)if("number"==typeof t)return t;return null}function M(e,t,n){for(let i=0;i<3;i++){const a=e[i];switch(a){case"symbol-value":{const e=n[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(a&&t[i])return a/t[i]}}return 1}function I(e,t,n,i){switch(e){case"proportional":return n*i;case"symbol-value":return null!=t?t:n;default:return e}}async function _(e,t){if(e&&t)return(0,d.wk)(e)?b(e,t):void((0,d.$y)(e)&&function(e,t){const n=v(t);if(null!=n)switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case"simple-line":e.width=n;break;case"text":e.font.size=n}}(e,t))}function S(e,t,n){if(e&&null!=t)if((0,d.wk)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if("object"===e.type)switch(n){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,d.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function F(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,s.zu)(t)}function k(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}},83874:(e,t,n)=>{n.d(t,{i:()=>h});var i=n(79625),a=n(74719),r=n(12130),o=n(42985),s=n(60757),l=n(76493),c=n(75400),u=n(65920),d=n(54824),p=n(78076);function h(e){let{edits:t,geometry:n,relationships:l,tag:c="",template:u}=e;if((0,s.AO)(n)){const e=n.geometry.clone();for(const n of e.paths)h({geometry:new d.default({spatialReference:e.spatialReference,paths:[n],hasZ:e.hasZ,hasM:e.hasM}),template:u,edits:t,relationships:l,tag:c});return}const{definition:p,layer:y}=u;n=f(n,y);const m=new i.default({attributes:p.defaultValues?{...p.defaultValues}:{},geometry:n,sourceLayer:y});if(b(m,y),y.globalIdField&&(m.attributes[y.globalIdField]=(0,r.yS)()),t.push({id:y.layerId,graphic:m,tag:c,layer:y}),0!==p.relationships.length)for(const s of p.relationships||[]){const e=s.template;if(null==s.relationshipMetadata||!(0,o.xZ)(e))throw new a.default("shared-template:missing-relationship-metadata-or-definition","Relationship part must have metadata and a fully loaded template with definition");const{layer:n}=e,c=new i.default({attributes:{...p.defaultValues},sourceLayer:n});b(c,n),n.globalIdField&&(c.attributes[n.globalIdField]=(0,r.yS)()),t.push({graphic:c,id:n.layerId,tag:"",layer:n}),l.push({...s.relationshipMetadata,sourceGraphic:m,destinationGraphic:c})}}function f(e,t){if(!e)return null;if(e.hasZ===t.hasZ&&e.hasM===t.hasM)return e;switch(e.type){case"point":return new c.default({spatialReference:e.spatialReference,x:e.x,y:e.y,...t.hasZ?e.hasZ?{z:e.z}:{z:g(t)}:{},...t.hasM?e.hasM?{m:e.m}:{m:w(t)??void 0}:{}});case"polygon":return new u.default({spatialReference:e.spatialReference,rings:y(e.rings,t.hasZ,t.hasM,g(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"polyline":return new d.default({spatialReference:e.spatialReference,paths:y(e.paths,t.hasZ,t.hasM,g(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:t.hasZ,hasM:t.hasM});case"multipoint":return new l.default({spatialReference:e.spatialReference,hasZ:t.hasZ,hasM:t.hasM,points:m(e.points,t.hasZ,t.hasM,g(t),w(t),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1)});default:return e}}function y(e,t,n,i,a,r,o){const s=[];for(const l of e)s.push(m(l,t,n,i,a,r,o));return s}function m(e,t,n,i,a,r,o){const s=[];for(const l of e){const e=[l[0],l[1]];t&&(e[2]=o>-1?l[2]:i),n&&(e[t?3:2]=r>-1?l[r]:a),s.push(e)}return s}function g(e){return e.capabilities.editing?.zDefault??0}function w(e){return e.capabilities.editing.supportsUpdateWithoutM?void 0:0}function b(e,t){(0,p.F2)(t)&&(e.sourceLayer=t.findSublayerForFeature(e))}},83908:(e,t,n)=>{n.d(t,{P:()=>l,v:()=>c});var i=n(79625),a=n(42198),r=n(49959),o=n(79953),s=n(39262);async function l(e){let{view:t,data:l,signal:u,next:d,cancel:p}=e;const{creationInfo:h}=l;if(!h)return(0,a.hA)();if(!c(h))return(0,a.hA)();const{layer:f}=h,y=null!=h.geometryToPlace;if(h.geometryToPlace=null,y)return p(),(0,a.hA)();const{Upload:m}=await n.e(69612).then(n.bind(n,69612));(0,r.throwIfAborted)(u);const g=new m;l.upload=g;let w=null;const b=()=>w?.remove(),v=(0,a.vE)([(0,o.watch)((()=>g.state),(e=>{switch(e){case"default":case"error":b();break;case"pending":b(),w=(0,s.Pz)(t);break;case"success":{h.maxFeatures=1;const{result:e}=g;"georeferenced"===e?.type||"georeferenced-reprojected"===e?.type?(h.geometryToPlace=e.mesh,h.initialFeature=new i.default({attributes:(0,s.nc)(l.fullTemplate,h.attributeOverrides),geometry:e.mesh,sourceLayer:f}),t.goTo(h.initialFeature,{animate:!1}).catch(r.ignoreAbortErrors)):h.geometryToPlace=e?.mesh,b(),d();break}}})),(0,a.hA)((()=>{g.cancel(),b()}))]);return g.uploadTo(f),v}function c(e){const t=e?.layer;return"scene"===t?.type}},95095:(e,t,n)=>{n.d(t,{$h:()=>y,Ef:()=>S,IP:()=>g,P1:()=>M,hF:()=>_,jQ:()=>v,rT:()=>I,rZ:()=>i,uR:()=>w});var i,a,r=n(5839),o=n(92143),s=n(84190),l=n(32006),c=n(98080),u=n(89227),d=n(28473),p=n(18162),h=n(26266),f=n(70576);function y(e,t){if(null==e||null==t)return;const n=m(e,t);return null!=n?(0,o.Wq)(n,"radians","geographic"):void 0}(a=i||(i={})).Absolute="absolute",a.Relative="relative",a.RelativeBilateral="relative-bilateral";const m=(()=>{const e=(0,d.vt)(),t=(0,d.vt)();return(n,i)=>((0,u.i)(e,n.x,n.y,n.z??0),(0,u.i)(t,i.x,i.y,i.z??0),g(e,t,n.spatialReference,i.spatialReference))})(),g=(()=>{const e=(0,c.vt)(),t=(0,d.vt)(),n=(0,d.vt)();return(i,a,r,o)=>{if((0,u.p)(i,a))return;const d=(0,h.geodesicCompatibleSpatialReference)(r),y=(0,h.geodesicCompatibleSpatialReference)(o);if(d&&y&&(0,f.aI)(d,y)&&(0,p.F)(i,r,t,d)&&(0,p.F)(a,o,n,y)){const{azimuth:e}=(0,h.inverseGeodeticSolver)(k,t,n,d);return null!=e?(0,s.oU)(e,"degrees","radians"):void 0}e[0]=a[0]-i[0],e[1]=a[1]-i[1];let m=(0,l.g7)(c.JP,e);return e[0]<0&&(m=T-m),m}})();function w(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Absolute;if(t&&n)switch(a){case i.Absolute:return y(t,n);case i.Relative:return v(b(e,t,n),i.Relative);case i.RelativeBilateral:return v(b(e,t,n),i.RelativeBilateral)}}function b(e,t,n){if(!e||!t||!n)return;const i=m(e,t),a=m(t,n);return null!=i&&null!=a?(0,o.Wq)(a-i,"radians","geographic"):void 0}function v(e,t){if(null!=e)switch(t){case i.Absolute:return M(e);case i.Relative:{const t=_(e);let n=x.normalize(t,0,!0);return-180===n&&(n=180),(0,o.Wq)(n,"degrees","geographic")}case i.RelativeBilateral:{const t=_(e),n=Math.abs(x.normalize(t,0,!0));return(0,o.Wq)(n,"degrees","geographic")}}}function M(e){const t=_(e),n=A.normalize(t,0,!0);return(0,o.Wq)(n,"degrees","geographic")}const I=(()=>{const e=(0,d.vt)();return function(t,n,i,a,r){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,u.c)(e,n);const c=_(r);if("geodesic"===l){const r=(0,h.geodesicCompatibleSpatialReference)(i);if(r&&(0,p.F)(e,i,e,r))return(0,h.directGeodeticSolver)(t,e,c,a,r),t[2]=n[2],!!(0,p.F)(t,r,t,i)}const d=(0,o.g2)(c,"geographic","arithmetic"),f=(0,s.oU)(d,"degrees","radians"),y=n[0]+a*Math.cos(f),m=n[1]+a*Math.sin(f),g=n[2];return(0,u.i)(t,y,m,g),!0}})();function _(e){if(null!=e)return(0,o.g2)(F(e),e.rotationType,"geographic")}function S(e){if(null!=e)return(0,o.g2)(F(e),e.rotationType,"arithmetic")}function F(e){return(0,s.oU)(e.value,e.unit,"degrees")}const k=new h.InverseGeodeticSolverResult,T=2*Math.PI,A=r.ie,x=new r.hr(-180,180)},98555:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var i=n(93800),a=n(6946),r=n(89129),o=n(50925),s=n(90450),l=n(48602),c=(n(21265),n(14746),n(75269)),u=n(42985),d=n(17508);let p=class extends a.default{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.fullTemplate=null,this.parent=null,this.temporaryHighlightFeature=null,this.sketchOptions=null,this.snappingManager=null,this.templateExecutorInfo=null,this.viewModel=null,this.upload=null,this._pendingEdits=new s.A}get isSharedTemplateWorkflow(){return!!this.fullTemplate&&(0,u.w2)(this.fullTemplate)}get pendingFeatures(){return new r.default([...this._pendingEdits.keys()])}set selectedPendingFeature(e){this._set("selectedPendingFeature",e),this.temporaryHighlightFeature=null}set timeZone(e){this._set("timeZone",e),this._pendingEdits.forEach((t=>{t.timeZone=e}))}isSubmittable(e){const t=this._pendingEdits.get(e);return!!t?.submittable||!!t?.isAssociation}isDisplayable(e){return!this._pendingEdits.get(e)?.isAssociation}addPendingFeature(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isAssociation:!1};this.temporaryHighlightFeature=null;const{_pendingEdits:i}=this;if(i.has(e))return i.get(e);e.sourceLayer||o.A.getLogger("esri.widgets.Editor.CreateFeaturesWorkflowData").warn("source-layer-not-set","A feature added to `pendingFeatures` did not have `sourceLayer` set. This may cause problems throughout `CreateFeaturesWorkflow`.");const a=new d.default({feature:e,isAssociation:n.isAssociation});return a.trackChanges(t),i.set(e,a),a}getEditsForPendingFeature(e){return this._pendingEdits.get(e)}removePendingFeature(e){this.temporaryHighlightFeature=null;const{_pendingEdits:t}=this,n=t.get(e);n&&(n.destroy(),t.delete(e)),this.selectedPendingFeature===e&&(this.selectedPendingFeature=null)}getFeatureTitle(e){return this._pendingEdits.get(e)?.displayTitle}};(0,i._)([(0,l.MZ)()],p.prototype,"creationInfo",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"editorItem",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"fullTemplate",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"isSharedTemplateWorkflow",null),(0,i._)([(0,l.MZ)()],p.prototype,"parent",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"pendingFeatures",null),(0,i._)([(0,l.MZ)()],p.prototype,"selectedPendingFeature",null),(0,i._)([(0,l.MZ)()],p.prototype,"temporaryHighlightFeature",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],p.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"templateExecutorInfo",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"viewModel",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"upload",void 0),(0,i._)([(0,l.MZ)()],p.prototype,"timeZone",null),p=(0,i._)([(0,c.$)("esri.widgets.Editor.CreateFeaturesWorkflowData")],p);const h=p}}]);