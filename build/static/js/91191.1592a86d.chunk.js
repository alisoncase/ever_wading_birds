"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[91191],{91191:(e,t,i)=>{i.d(t,{default:()=>d});var r=i(79625),o=i(62631),a=i(50925),s=i(49959),n=i(65920),l=i(58507),u=i(57703);class d{constructor(e){this.viewModel=e,this.createFootprints=async e=>{await(0,s.waitTick)(e);const{coveragePolygons:t,currentBestFeature:i,isAdditionalCoverageVisible:o}=this.viewModel;for(const a of t)a?.imageID===i.attributes.objectId?this.viewModel.bestFeatureFootprint=new r.default({attributes:{imageID:a?.imageID},geometry:a,symbol:u.Fz,visible:!1}):this.viewModel.additionalFootprints.push(new r.default({attributes:{imageID:a?.imageID},geometry:a,symbol:u.P1.clone(),visible:o}))},this.updateFootprint=async(e,t)=>{const{activeViewer:i,currentBestFeature:l,currentCoverageVisible:d,footprintExtent:c}=this.viewModel,g=i?.imageSize;if(l&&g&&c)try{const i=await this.viewModel.getMapPoint(e,{feature:l,mode:"default",imageSize:g});(0,s.throwIfAborted)(t);const a=i.filter(o.Ru);if(!a.length)return;const c=[a.map((e=>{let{x:t,y:i}=e;return[t,i,1]}))];c[0].push(c[0][0]);const h=new n.default({rings:c,spatialReference:a[0].spatialReference});this.viewModel.updateCurrentCoveragePolygon(new r.default({geometry:h,attributes:{imageID:l.attributes.objectId},symbol:u.Fz,visible:d}))}catch(h){(0,s.isAbortError)(h)||a.A.getLogger(this.viewModel).error("update-footprint",h)}else this.viewModel.updateCurrentCoveragePolygon(null)},this.updateFootprintPanorama=async(e,t)=>{const{horizontalFieldOfView:i,pitch:o,verticalFieldOfView:a,yaw:d}=e,{activeViewer:c,currentBestFeature:g,currentCoverageVisible:h,footprintExtent:p}=this.viewModel,v=c?.imageSize;if(!g||!v||!p)return void this.viewModel.updateCurrentCoveragePolygon(null);const{cameraPitch:w,objectId:f}=g.attributes;if(o+w-a/2>180)return void this.viewModel.updateCurrentCoveragePolygon(null);let b=[];if(o+w+a/2<180)b=[[-i/2,a/2],[i/2,a/2],...o-a/2<0?[[-i/2,-a/2],[i/2,-a/2]]:[[i/2,-a/2],[-i/2,-a/2]]];else if(o+w-a/2<180&&o+w+a/2>180){b=[[-i/2,-a/2]];const e=Math.floor(i/6),t=i/e;for(let r=0;r<=e;r++)b.push([r*t-i/2,90-o]);b.push([i/2,-a/2]),o-a/2<0&&([b[0],b[b.length-1]]=[b[b.length-1],b[0]])}const m=b.map((e=>{let[t,i]=e;return(0,l._H)(d+t,o+i,v[0],v[1])})),y=await this.viewModel.getMapPoint(m,{feature:g,mode:"panorama",imageSize:v});(0,s.throwIfAborted)(t);const M=[y.map((e=>{let{x:t,y:i}=e;return[t,i,1]}))];M[0].push(M[0][0]);const C=new n.default({rings:M,spatialReference:y[0].spatialReference});this.viewModel.updateCurrentCoveragePolygon(new r.default({geometry:C,attributes:{imageID:f},symbol:u.Fz.clone(),visible:h}))}}}}}]);