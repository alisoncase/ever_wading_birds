"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[17066,53829],{4401:(e,t,i)=>{i.d(t,{g:()=>o});var r=i(75357),a=i(56771),n=i(52858);async function o(e,t,i,o){return i=r.default.from(i||{}),(0,a.R7)(e,"execute",i,t??{},o).then((async e=>{let{data:t}=e;return{results:await Promise.all(t.results?.map(a.D4)??[]),messages:t.messages?.map((e=>n.default.fromJSON(e)))??[]}}))}},12037:(e,t,i)=>{i.d(t,{O:()=>o});var r=i(75357),a=i(56771),n=i(99055);async function o(e,t,i,o){return i=r.default.from(i||{}),(0,a.R7)(e,"submitJob",i,t??{},o).then((t=>{let{data:i}=t;const r=n.default.fromJSON(i);return r.sourceUrl=e,r}))}},19983:(e,t,i)=>{i.d(t,{E5:()=>l,JU:()=>o,Of:()=>a,Uk:()=>n,WK:()=>s,g7:()=>u,lO:()=>c,lQ:()=>y});var r=i(74719);function a(e){return e&&"function"==typeof e.highlight}function n(e){return e&&"function"==typeof e.maskOccludee}function o(e,t,i){return null==e||e>=i&&(0===t||e<=t)}function l(e,t){if(t&&e){const{minScale:i,maxScale:r}=e;if(s(i,r))return o(t,i,r)}return!0}function s(e,t){return null!=e&&e>0||null!=t&&t>0}function u(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}function c(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatures"in e&&"layer"in e&&"view"in e}function y(e,t,i){return new r.default("layerview:spatial-reference-incompatible",`The spatial reference of this ${e}${t?`(wkid:${t})`:""} is incompatible with the spatial reference of the view${i?`(wkid:${i})`:""}.`,{})}},36627:(e,t,i)=>{i.d(t,{U:()=>r});const r=(0,i(42761).O)()({AIX:"aix",EPS:"eps",GIF:"gif",JPG:"jpg",PDF:"pdf",PNG32:"png32",PNG8:"png8",SVG:"svg",SVGZ:"svgz",TIFF:"tiff"},{ignoreUnknown:!1})},53829:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var r=i(93800),a=i(6946),n=i(48602),o=(i(21265),i(50925),i(14746),i(75269)),l=i(34587);let s=class extends a.default{constructor(e){super(e),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};(0,r._)([(0,n.MZ)()],s.prototype,"attributionVisible",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"exportOptions",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"forceFeatureAttributes",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"format",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"includeCharts",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"includeTables",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"label",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"layout",void 0),(0,r._)([(0,n.MZ)({type:l.default})],s.prototype,"layoutItem",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"layoutOptions",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"outScale",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"report",void 0),(0,r._)([(0,n.MZ)({type:l.default})],s.prototype,"reportItem",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"reportOptions",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"scalePreserved",void 0),(0,r._)([(0,n.MZ)()],s.prototype,"showLabels",void 0),s=(0,r._)([(0,o.$)("esri.rest.support.PrintTemplate")],s);const u=s},66374:(e,t,i)=>{i.d(t,{U:()=>n,r:()=>a});const r=new(i(42761).J)({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),a=r.fromJSON.bind(r),n=r.toJSON.bind(r)},83563:(e,t,i)=>{function r(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?n(e.view.floors,t.floorInfo.floorField):null}function a(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?n(e,t.floorInfo.floorField):null}function n(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{E:()=>r,f:()=>a})},94685:(e,t,i)=>{i.r(t),i.d(t,{execute:()=>_,getGpPrintParams:()=>U,getGpServerUrl:()=>C,getMode:()=>k,getTasks:()=>R,printCacheMap:()=>V});var r=i(13248),a=i(23060),n=i(42761),o=i(16804),l=i(43103),s=i(65920),u=i(95011),c=i(83563),y=i(71237),f=i(10193),p=i(4401),d=i(12037),m=i(36627),g=i(66374),h=i(88102),b=i(92744),w=i(99071),S=i(83031),v=i(19983);function I(e){if(!e.attributionVisible)return;let t;return"function"==typeof e.originOf&&"user"===e.originOf("copyright")&&(t=e.copyright),t||!e.hasAttributionData?(t??=e.portalItem?.accessInformation,t??=e.copyright,t??void 0):void 0}function L(e){return"bing-maps"===e?.type}function x(e){return e&&"blendMode"in e&&"effect"in e}function D(e){return"catalog"===e.layer.type}function T(e){return"group"===e.layer.type}function O(e){const t=e.layer;if(x(t)){const i=t.blendMode;if((!i||"normal"===i)&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}var P=i(53829);const M=new n.J({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"}),A=(M.fromJSON.bind(M),M.toJSON.bind(M)),E={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},F=new n.J({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),N=new n.J({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),V=new Map;async function _(e,t,i){const r=await J(e,i),a=await U(t,r);if("sync"===await k(e,i)){const{results:t}=await(0,p.g)(e,a,void 0,i);return t?.[0]?.value}const n=await(0,d.O)(e,a,void 0,i);await n.waitForJobCompletion({interval:t.updateDelay});const{value:o}=await n.fetchResultData("Output_File",null,i);return o}async function J(e,t){const i=C(e),r=V.get(i)??{gpServerUrl:i,legendLayerNameMap:{},legendLayers:[]};return r.gpMetadata??=(await(0,a.default)(i,(0,f.jV)({f:"json"},t))).data,r.cimVersion=r.gpMetadata.cimVersion,V.set(i,r),r}async function k(e,t){return function(e){return e.gpMetadata?.executionType?N.fromJSON(e.gpMetadata.executionType):"sync"}(await J(e,t))}async function R(e,t){return(await J(e,t)).gpMetadata.tasks}async function U(e,t){t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const i=e.template||new P.default;null==i.showLabels&&(i.showLabels=!0);const a=i.exportOptions;let n;const o=(0,g.U)(i.layout);if(a&&(n={dpi:a.dpi},"map_only"===o?.toLowerCase()||""===o)){const{width:e,height:t}=a;n.outputSize=null!=e&&null!=t?[e,t]:void 0}const l=i.layoutOptions;let s;if(l){let e,t;"Miles"===l.scalebarUnit||"Kilometers"===l.scalebarUnit?(e="Kilometers",t="Miles"):"Meters"!==l.scalebarUnit&&"Feet"!==l.scalebarUnit||(e="Meters",t="Feet"),s={titleText:l.titleText,authorText:l.authorText,copyrightText:l.copyrightText,customTextElements:l.customTextElements,elementOverrides:l.elementOverrides,scaleBarOptions:e||t?{metricUnit:F.toJSON(e)??void 0,metricLabel:e?E[e]:void 0,nonMetricUnit:F.toJSON(t)??void 0,nonMetricLabel:t?E[t]:void 0}:void 0}}let u=null;l?.legendLayers&&(u=l.legendLayers.map((e=>{const i=e.layerId;t.legendLayerNameMap[i]=e.title;const r={id:i};return e.subLayerIds&&(r.subLayerIds=e.subLayerIds),r})));const c=await async function(e,t,i){const r=e.view;let a=r.spatialReference;const n={operationalLayers:await z(r,t,i)};t.includeTables&&(n.tables=await async function(e){const t=[],i=[];for(const a of e.map.allTables)"feature"!==a.type||a.loaded||i.push(a.load());i.length&&await Promise.allSettled(i);for(const a of e.map.allTables)if("feature"===a.type&&a.loaded&&a.isTable&&"feature-layer"===a.source?.type){const e={id:(r=pe(a)).id,title:r.title,customParameters:r.customParameters,layerDefinition:{definitionExpression:r.layerDefinition?.definitionExpression},url:r.url};ue(e,a),t.push(e)}var r;return t.length?t:void 0}(r));let o=e.extent||i.ssExtent||r.extent;if(a?.isWrappable&&(o=o.clone()._normalize(!0),a=o.spatialReference),n.mapOptions={extent:o&&o.toJSON(),spatialReference:a&&a.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,r.background&&(n.background=r.background.toJSON()),r.rotation&&(n.mapOptions.rotation=-r.rotation),t.scalePreserved&&(n.mapOptions.scale=t.outScale||r.scale),null!=r.timeExtent){const e=null!=r.timeExtent.start?r.timeExtent.start.getTime():null,t=null!=r.timeExtent.end?r.timeExtent.end.getTime():null;n.mapOptions.time=[e,t]}return t.reportOptions&&(n.reportOptions=t.reportOptions),n}(e,i,t);if(c.operationalLayers){const e=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),t=/[\u0600-\u06FF]/,i=i=>{const r=i.text,a=i.font,n=a?.family?.toLowerCase();r&&a&&("arial"===n||"arial unicode ms"===n)&&(a.family=e.test(r)?"Arial Unicode MS":"Arial","normal"!==a.style&&t.test(r)&&(a.family="Arial Unicode MS"))};for(const r of c.operationalLayers)if(r.featureCollection?.layers)for(const e of r.featureCollection.layers){if(e.layerDefinition?.drawingInfo?.renderer?.symbol){const t=e.layerDefinition.drawingInfo.renderer;"esriTS"===t.symbol.type&&i(t.symbol)}if(e.featureSet?.features)for(const t of e.featureSet.features)t.symbol&&"esriTS"===t.symbol.type&&i(t.symbol)}}e.outSpatialReference&&(c.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(c,{exportOptions:n,layoutOptions:s||{}}),Object.assign(c.layoutOptions,{legendOptions:{operationalLayers:null!=u?u:t.legendLayers.slice()}}),t.legendLayers.length=0,V.set(t.gpServerUrl,t);const y={Web_Map_as_JSON:JSON.stringify(c),Format:m.U.toJSON(i.format),Layout_Template:o,Layout_Item_ID:void 0,Report_Template:A(i.report),Report_Item_ID:void 0};if(i.layoutItem){delete y.Layout_Template;const e=i.layoutItem;await e.load(),"public"!==e.access&&r.id&&await r.id.getCredential(t.gpServerUrl),y.Layout_Item_ID=JSON.stringify({id:e.id})}if(i.reportItem){delete y.Report_Template;const e=i.reportItem;await e.load(),"public"!==e.access&&r.id&&await r.id.getCredential(t.gpServerUrl),y.Report_Item_ID=JSON.stringify({id:e.id})}return e.extraParameters&&Object.assign(y,e.extraParameters),y}function C(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}async function z(e,t,i){const r=[],a={layerView:null,printTemplate:t,view:e};let n=0;t.scalePreserved&&(n=t.outScale||e.scale);const o=function(e,t){const i=e.allLayerViews.items;if(t===e.scale)return i.filter((e=>!e.suspended));const r=new Array;for(const a of i){const e=a.parent;e&&e!==a.view&&(D(e)||T(e))&&!r.includes(e)||a.visible&&a.visibleAtCurrentTimeExtent&&(0,v.E5)(a.layer.effectiveScaleRange,t)&&r.push(a)}return r}(e,n);for(const l of o){const e=l.layer;if(!e.loaded||"layers"in e)continue;let t;a.layerView=l,t=O(l)?await ee(e,a,i):L(e)?G(e):"csv"===e?.type?await Z(e,a,i):"catalog-footprint"===e?.type?await $(e,a,i):"feature"===e?.type?await j(e,a,i):"geojson"===e?.type?await B(e,a,i):"graphics"===e?.type?await K(e,a,i):"imagery"===e?.type?q(e,i):"imagery-tile"===e?.type?await Q(e,a,i):"kml"===e?.type?await H(e,a,i):"map-image"===e?.type?X(e,a,i):"map-notes"===e?.type?await Y(a,i):"open-street-map"===e?.type?{type:"OpenStreetMap"}:"stream"===e?.type?await te(e,a,i):"subtype-group"===e?.type?await ie(e,i):"tile"===e?.type?re(e,i):"vector-tile"===e?.type?await ae(e,a,i):"web-tile"===e?.type?ne(e):"wfs"===e?.type?await oe(e,a,i):"wms"===e?.type?le(e,i):"wmts"===e?.type?se(e):await ee(e,a,i),t&&(Array.isArray(t)?r.push(...t):(t.id=e.id,t.title=i.legendLayerNameMap[e.id]||e.title,t.opacity=l.fullOpacity,t.minScale=e.minScale||0,t.maxScale=e.maxScale||0,x(e)&&e.blendMode&&"normal"!==e.blendMode&&(t.blendMode=e.blendMode),r.push(t)))}if(n)for(const l of r)l.minScale=0,l.maxScale=0;if(e.graphics?.length){const a=await W(null,e.graphics,t,i);a&&r.push(a)}return r}function G(e){return{culture:e.culture,key:e.key,type:"BingMaps"+("aerial"===e.style?"Aerial":"hybrid"===e.style?"Hybrid":"Road")}}async function $(e,t,i){let{layerView:r,printTemplate:a}=t;if(parseFloat(i.cimVersion)<3.1)return W(e,await fe(r),a,i);const n=e.parent,o={id:(l=pe(n,"web-map")).id,url:l.url,layerType:l.layerType,customParameters:l.customParameters,dynamicGroupLayer:{visibility:!1},footprintLayer:l.footprintLayer,layerDefinition:l.layerDefinition};var l;return ue(o,n),o}async function Z(e,t,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const r=t.layerView,a=t.printTemplate;if(!(r.filter||e.portalItem&&"public"!==e.portalItem.access)){const t=pe(e,"web-map");return t.type="CSV",delete t.popupInfo,delete t.layerType,t.showLabels=a.showLabels&&e.labelsVisible,t}return W(e,await fe(r),a,i)}async function W(e,t,i,r){let a;const n={layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}},o={layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}},l={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}},c={layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}},y={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}};if(y.layerDefinition.name="textLayer",delete y.layerDefinition.drawingInfo,e){if("esri.layers.FeatureLayer"===e.declaredClass||"esri.layers.StreamLayer"===e.declaredClass?n.layerDefinition.name=o.layerDefinition.name=l.layerDefinition.name=c.layerDefinition.name=r.legendLayerNameMap[e.id]||e.arcgisProps?.title||e.title:"esri.layers.GraphicsLayer"===e.declaredClass&&(t=e.graphics.items),e.renderer){const t=e.renderer.toJSON(),i=n.layerDefinition.drawingInfo;i&&(i.renderer=t);const r=o.layerDefinition.drawingInfo;r&&(r.renderer=t);const a=l.layerDefinition.drawingInfo;a&&(a.renderer=t);const s=c.layerDefinition.drawingInfo;s&&(s.renderer=t)}if(i.showLabels&&e.labelsVisible&&"function"==typeof e.write){const t=pe(e,"web-map"),i=t.layerDefinition?.drawingInfo?.labelingInfo;if(i){a=!0;const e=n.layerDefinition.drawingInfo;e&&(e.labelingInfo=i);const t=o.layerDefinition.drawingInfo;t&&(t.labelingInfo=i);const r=l.layerDefinition.drawingInfo;r&&(r.labelingInfo=i);const s=c.layerDefinition.drawingInfo;s&&(s.labelingInfo=i)}}}let f;e?.renderer||a||(delete n.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo);const p=e?.fieldsIndex,d=e?.renderer;if(p){const t=new Set;a&&await(0,u.collectLabelingFields)(t,e),d&&"function"==typeof d.collectRequiredFields&&await d.collectRequiredFields(t,p),f=Array.from(t);const i=p.fields.map((e=>e.toJSON()));n.layerDefinition.fields=i,o.layerDefinition.fields=i,l.layerDefinition.fields=i,c.layerDefinition.fields=i}const m=t?.length;let g;for(let u=0;u<m;u++){const e=t[u]||t.at(u);if(!1!==e.visible&&e.geometry){if(g=e.toJSON(),g.hasOwnProperty("popupTemplate")&&delete g.popupTemplate,g.geometry?.z&&delete g.geometry.z,g.symbol&&(g.symbol.angle||delete g.symbol.angle,de(g.symbol)?g.symbol=await ce(g.symbol,r):g.symbol.text&&delete g.attributes),(!i||!i.forceFeatureAttributes)&&f?.length){const e={};for(const t of f)g.attributes?.hasOwnProperty(t)&&(e[t]=g.attributes[t]);g.attributes=e}"polygon"===e.geometry.type?n.featureSet.features.push(g):"polyline"===e.geometry.type?o.featureSet.features.push(g):"point"===e.geometry.type?g.symbol?.text?y.featureSet.features.push(g):l.featureSet.features.push(g):"multipoint"===e.geometry.type?c.featureSet.features.push(g):"extent"===e.geometry.type&&(g.geometry=s.default.fromExtent(e.geometry).toJSON(),n.featureSet.features.push(g))}}const h=[n,o,c,l,y].filter((e=>e.featureSet.features.length>0));for(const s of h){const e=s.featureSet.features.every((e=>e.symbol));if(e&&(!i||!i.forceFeatureAttributes))for(const t of s.featureSet.features)delete t.attributes;e&&delete s.layerDefinition.drawingInfo,s.layerDefinition.drawingInfo?.renderer&&await ye(s.layerDefinition.drawingInfo.renderer,r)}return h.length?{featureCollection:{layers:h},showLabels:a}:null}async function j(e,t,i){let r;const a=e.renderer,n=parseFloat(i.cimVersion);if("binning"===e.featureReduction?.type||"cluster"===e.featureReduction?.type&&n<2.9||"pie-chart"===a?.type||"dot-density"===a?.type&&n<2.6)return ee(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const o=t.layerView,{printTemplate:l,view:s}=t,u="feature-layer"!==e.source?.type&&"ogc-feature"!==e.source?.type;if(o.filter||u||!a||"field"in a&&null!=a.field&&!e.getField(a.field)){const t=await fe(o);r=await W(e,t,l,i)}else{if(r={id:(f=pe(e)).id,title:f.title,url:f.url,layerType:f.layerType,customParameters:f.customParameters,layerDefinition:f.layerDefinition,charts:l.includeCharts?f.charts:void 0},l.attributionVisible&&(r.credits=I(e)),r.showLabels=l.showLabels&&e.labelsVisible,ue(r,e),delete r.layerDefinition?.featureReduction?.disablePopup,delete r.layerDefinition?.featureReduction?.popupInfo,o.displayFilterEnabled||delete r.layerDefinition?.displayFilterInfo,r.layerDefinition?.drawingInfo?.renderer&&(delete r.layerDefinition.minScale,delete r.layerDefinition.maxScale,await ye(r.layerDefinition.drawingInfo.renderer,i),"visualVariables"in a&&a.visualVariables?.[0])){const e=a.visualVariables[0];if("size"===e.type&&e.maxSize&&"number"!=typeof e.maxSize&&e.minSize&&"number"!=typeof e.minSize){const t=(0,y.getSizeRangeAtScale)(e,s.scale);r.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=t.minSize,r.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=t.maxSize}}const t=(0,c.E)(o);if(t&&(r.layerDefinition??={},r.layerDefinition.definitionExpression=r.layerDefinition.definitionExpression?`(${r.layerDefinition.definitionExpression}) AND (${t})`:t),e.gdbVersion&&(r.layerDefinition??={},r.layerDefinition.gdbVersion=e.gdbVersion),o.hasHighlight&&"highlightIds"in o){const t=o;r.selectionObjectIds=t.highlightIds,r.selectionSymbol=function(e,t){const i=t.color?.clone()??new h.default([0,255,255]),r=t.haloColor?.clone()??i.clone();switch(e){case"envelope":case"polygon":return i.a*=t.fillOpacity??.25,new b.default({color:i,outline:new w.default({color:r}),style:"solid"});case"polyline":return new w.default({color:r});default:return r.a=1,new S.default({color:r,outline:null})}}(e.geometryType,t.highlightOptions??s.highlightOptions)}}var f;return r}async function B(e,t,i){return"binning"===e.featureReduction?.type||"cluster"===e.featureReduction?.type?ee(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),W(e,await fe(t.layerView),t.printTemplate,i))}async function K(e,t,i){let{printTemplate:r}=t;return W(e,null,r,i)}function q(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(r=pe(e)).layerType,customParameters:r.customParameters};var r;return i.bandIds=e.bandIds,i.compressionQuality=e.compressionQuality,i.format=e.format,i.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction&&(i.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(i.layerDefinition??={},i.layerDefinition.drawingInfo??={},i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON()),ue(i,e),i}async function Q(e,t,i){if("flow"===e.renderer?.type)return ee(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const r={bandIds:(a=pe(e)).bandIds,customParameters:a.customParameters,interpolation:a.interpolation,layerDefinition:a.layerDefinition};var a;return r.layerType="ArcGISImageServiceLayer",ue(r,e),r}async function H(e,t,i){const r=t.printTemplate;if(!e.portalItem||"public"===e.portalItem.access){const t=pe(e,"web-map");return t.type="kml",delete t.layerType,t.url=(0,l.normalize)(e.url),t}const a=[],n=t.layerView,o="data:image/png;base64,";n.allVisibleMapImages.forEach(((t,i)=>{const r={id:`${e.id}_image${i}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:n.fullOpacity,extent:t.extent};t.href.startsWith(o)?r.imageData=t.href.slice(22):r.url=t.href,a.push(r)}));const s=[...n.allVisiblePoints.items,...n.allVisiblePolylines.items,...n.allVisiblePolygons.items],u={id:e.id,...await W(null,s,r,i)};return a.push(u),a}function X(e,t,i){let r,{printTemplate:a,view:n}=t;const o={id:e.id,subLayerIds:[]};let l=[];const s=n.scale,u=e=>{const t=0===s,i=0===e.minScale||s<=e.minScale,r=0===e.maxScale||s>=e.maxScale;if(e.visible&&(t||i&&r))if(e.sublayers)e.sublayers.forEach(u);else{const t=e.toExportImageJSON(),i={id:e.id,name:e.title,layerDefinition:{definitionExpression:t.definitionExpression,drawingInfo:t.drawingInfo,orderBy:t.orderBy,source:t.source}};l.unshift(i),o.subLayerIds.push(e.id)}};var c;return e.sublayers&&e.sublayers.forEach(u),l.length&&(l=l.map((e=>{let{id:t,name:i,layerDefinition:r}=e;return{id:t,name:i,layerDefinition:r}})),r={layerType:(c=pe(e)).layerType,customParameters:c.customParameters},r.layers=l,r.visibleLayers=e.capabilities?.exportMap?.supportsDynamicLayers?void 0:o.subLayerIds,a.attributionVisible&&(r.credits=I(e)),e.gdbVersion&&(r.gdbVersion=e.gdbVersion),ue(r,e),e.legendEnabled&&i.legendLayers.push(o)),r}async function Y(e,t){let{layerView:i,printTemplate:r}=e;const a=[],n=i.layer;if(null!=n.featureCollections)for(const o of n.featureCollections){const e=await W(o,o.source,r,t);e&&a.push(...e.featureCollection.layers)}else if(null!=n.sublayers)for(const o of n.sublayers){const e=await W(null,o.graphics,r,t);e&&a.push(...e.featureCollection.layers)}return{featureCollection:{layers:a}}}async function ee(e,t,i){let{printTemplate:r,view:a}=t;const n={type:"image"},s={format:"png",ignoreBackground:!0,ignorePadding:!0,layers:[e]};0!==a.rotation&&(s.rotation=0);const u=i.ssExtent||a.state.extent.clone();let c=96,y=!0,f=!0;if(r.exportOptions){const e=r.exportOptions;null!=e.dpi&&e.dpi>0&&(c=e.dpi),null!=e.width&&e.width>0&&(y=e.width%2==a.width%2),null!=e.height&&e.height>0&&(f=e.height%2==a.height%2)}if("map-only"===r.layout&&r.scalePreserved&&(!r.outScale||r.outScale===a.scale)&&96===c&&(!y||!f)&&a.state.extent.equals(a.extent)&&(s.area={x:0,y:0,width:a.width,height:a.height},y||(s.area.width-=1),f||(s.area.height-=1),!i.ssExtent)){const e=a.toMap((0,o.tc)(s.area.width,s.area.height));u.ymin=e.y,u.xmax=e.x,i.ssExtent=u}n.extent=u.clone()._normalize(!0).toJSON();const p=await a.takeScreenshot(s);return n.imageData=(0,l.dataComponents)(p.dataUrl)?.data,n}async function te(e,t,i){let{layerView:r,printTemplate:a}=t;return e.legendEnabled&&i.legendLayers.push({id:e.id}),W(e,await fe(r),a,i)}async function ie(e,t){if(e.legendEnabled)for(const a of e.sublayers)a.legendEnabled&&t.legendLayers.push({id:a.id});const i={customParameters:(r=pe(e)).customParameters,effect:r.effect,layerDefinition:r.layerDefinition,layerType:r.layerType,layers:r.layers,url:r.url};var r;if(Array.isArray(i.layers))for(const a of i.layers)delete a.popupInfo;return ue(i,e),i}function re(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(r=pe(e)).layerType,customParameters:r.customParameters};var r;return ue(i,e),i}async function ae(e,t,i){const r=t.layerView;if(e.serviceUrl&&e.styleUrl&&!r.spriteSourceChanged&&!r.styleChanged){const t=(0,f.gf)(e.styleUrl,e.apiKey),r=(0,f.gf)(e.serviceUrl,e.apiKey);if(!t&&!r||"2.1.0"!==i.cimVersion){const i={type:"VectorTileLayer"};return i.styleUrl=(0,l.normalize)(e.styleUrl),i.token=t,r!==t&&(i.additionalTokens=[{url:e.serviceUrl,token:r}]),i}}return ee(e,t,i)}function ne(e){const t=e.urlTemplate?.replace(/\${/g,"{"),i={type:"WebTiledLayer",urlTemplate:t,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(i.subDomains=e.subDomains),i}async function oe(e,t,i){return parseFloat(i.cimVersion)<3.5?ee(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),{layerType:(r=pe(e,"web-map")).layerType,layerDefinition:r.layerDefinition,url:r.url,wfsInfo:r.wfsInfo});var r}function le(e,t){let i;const r=[],a=e=>{e.visible&&(e.sublayers?e.sublayers.forEach(a):e.name&&r.unshift(e.name))};return e.sublayers&&e.sublayers.forEach(a),r.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:r}),i={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:r,url:(0,l.normalize)(e.url),version:e.version}),i}function se(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:(0,l.normalize)(e.url)}}function ue(e,t){t.url&&(e.url=(0,l.normalize)(e.url||t.url),e.token=(0,f.gf)(e.url,t.apiKey))}async function ce(e,t){t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const r=t.canvas.getContext("2d");let n,l;if(e.path){const t=new Path2D(e.path);t.closePath(),r.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",r.fill(t);const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;const i=e.canvas.width,r=e.canvas.height,a=e.getImageData(0,0,i,r).data;let n,o,l,s,u,c;e:for(o=r;o--;)for(n=i;n--;)if(a[4*(i*o+n)+3]>t){c=o;break e}if(!c)return null;e:for(n=i;n--;)for(o=c+1;o--;)if(a[4*(i*o+n)+3]>t){u=n;break e}e:for(n=0;n<=u;++n)for(o=c+1;o--;)if(a[4*(i*o+n)+3]>t){l=n;break e}e:for(o=0;o<=c;++o)for(n=l;n<=u;++n)if(a[4*(i*o+n)+3]>t){s=o;break e}return{x:l,y:s,width:u-l,height:c-s}}(r);if(!a)return null;r.clearRect(0,0,i,i);const s=(0,o.Lz)(e.size)/Math.max(a.width,a.height);r.scale(s,s);const u=i/s,c=u/2-a.width/2-a.x,y=u/2-a.height/2-a.y;if(r.translate(c,y),Array.isArray(e.color)&&r.fill(t),e.outline?.width&&Array.isArray(e.outline.color)){const i=e.outline;r.lineWidth=(0,o.Lz)(i.width)/s,r.lineJoin="round",r.strokeStyle=`rgba(${i.color[0]},${i.color[1]},${i.color[2]},${i.color[3]/255})`,r.stroke(t),a.width+=r.lineWidth,a.height+=r.lineWidth}a.width*=s,a.height*=s;const f=r.getImageData(512-a.width/2,512-a.height/2,Math.ceil(a.width),Math.ceil(a.height));n=f.width,l=f.height,r.canvas.width=n,r.canvas.height=l,r.putImageData(f,0,0)}else{const t="image/svg+xml"===e.contentType?"data:image/svg+xml;base64,"+e.imageData:e.url,i=(await(0,a.default)(t,{responseType:"image"})).data;n=(0,o.Lz)(e.width),l=(0,o.Lz)(e.height),r.canvas.width=n,r.canvas.height=l,r.drawImage(i,0,0,r.canvas.width,r.canvas.height)}return{type:"esriPMS",imageData:r.canvas.toDataURL("image/png").slice(22),angle:e.angle,contentType:"image/png",height:(0,o.PN)(l),width:(0,o.PN)(n),xoffset:e.xoffset,yoffset:e.yoffset}}async function ye(e,t){const i=e.type;if("simple"===i&&de(e.symbol))e.symbol=await ce(e.symbol,t);else if("uniqueValue"===i||"classBreaks"===i){de(e.defaultSymbol)&&(e.defaultSymbol=await ce(e.defaultSymbol,t));const r=e["uniqueValue"===i?"uniqueValueInfos":"classBreakInfos"];if(r)for(const e of r)de(e.symbol)&&(e.symbol=await ce(e.symbol,t))}}async function fe(e){return e.queryFeatures(e.createQuery()).then((e=>e.features))}function pe(e,t){return e.write({},{ignorePersistenceEnabled:!0,origin:t})??{}}function de(e){return e&&(e.path||"image/svg+xml"===e.contentType||e.url?.endsWith(".svg"))}}}]);