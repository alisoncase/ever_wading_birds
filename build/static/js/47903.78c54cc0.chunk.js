"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[47903],{24589:(e,t,n)=>{n.d(t,{n:()=>i});var o=n(43103);function i(e){return r[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,o.getPathExtension)(e);return a[t]||s}(e.url)}(e)]||l}const r={},s="text/plain",l=r[s],a={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const d in a)r[a[d]]=d},47903:(e,t,n)=>{n.r(t),n.d(t,{ManipulatedObject3DMediaElement:()=>R});var o=n(93800),i=n(58448),r=n(42198),s=n(79953),l=n(48602),a=(n(21265),n(50925),n(14746),n(75269)),d=n(6946),p=n(62631),c=n(15492),u=n(75400),h=n(65920),m=n(96913),g=n(58715),y=n(77626);let v=class extends d.default{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new c.U}initialize(){this.addHandles([(0,r.DQ)(this._updatingHandles),this._updatingHandles.add((()=>{const e=this.element.georeference;return"control-points"===e?.type?e.controlPoints:null}),(e=>this._elementControlPointsChanged(e)),s.initial)])}_elementControlPointsChanged(e){const t=e?.map((e=>{let{mapPoint:t}=e;return t})).filter(p.Ru),n=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(t,n,(e=>{if(!e)return void this._replaceOperations(null);const{_operations:t}=this,o=new h.default({rings:[e.map((e=>{let{x:t,y:n}=e;return[t,n]}))],spatialReference:n});if(t?.trySetGeometry(o))return void this.onModifiedExternally();const i=this.view.state.viewingMode;this._replaceOperations(new g.S(y.ZE.fromGeometry(o,i),i,(e=>this._operationsGeometryChanged(e))))})))}_operationsGeometryChanged(e){const{element:{georeference:t},_operations:n}=this;if(!n||!t||"control-points"!==t.type||!t.controlPoints)return;const o=n.data.geometry,i=t.controlPoints.map((e=>{let{mapPoint:t}=e;return t})).filter(p.Ru);if(o.rings[0]?.length!==i.length)return;const r=o.rings[0].map((e=>{let[t,n]=e;return new u.default({x:t,y:n,spatialReference:o.spatialReference})})),s=i.map((e=>{let{spatialReference:t}=e;return t}));this._updatingHandles.addPromise(this._whenProjected(r,s,(t=>this._updateElementControlPoints(t,e))))}_updateElementControlPoints(e,t){const{georeference:n}=this.element;if(!n||!e||"control-points"!==n.type||n.controlPoints?.length!==e?.length)return;const o=n.controlPoints;if(o?.length===e.length)for(let i=0;i<o.length;i++)t&&(o[i].sourcePoint=n.toSource(e[i])),o[i].mapPoint=e[i]}async _whenProjected(e,t,n){if(!e)return void n(e);const{_operations:o,element:{georeference:i}}=this,r=e.map((e=>{let{spatialReference:t}=e;return t})),s=Array.isArray(t)?t:new Array(r.length).fill(t);await(0,m.initializeProjection)(Array.from(r).map(((e,t)=>({source:e,dest:s[t]}))));const l=e.map(((e,t)=>(0,m.project)(e,s[t])));o===this._operations&&i===this.element.georeference&&n(l)}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e}};(0,o._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"view",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"layer",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"element",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"onModifiedExternally",void 0),(0,o._)([(0,l.MZ)()],v.prototype,"_operations",void 0),(0,o._)([(0,l.MZ)()],v.prototype,"operations",null),(0,o._)([(0,l.MZ)()],v.prototype,"updating",null),v=(0,o._)([(0,a.$)("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],v);var _=n(30124);let f=class extends d.default{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new c.U}initialize(){this.addHandles([(0,r.DQ)(this._updatingHandles),this._updatingHandles.add((()=>this.element.georeference?.coords),(e=>this._elementCoordinatesChanged(e)),s.initial)])}_elementCoordinatesChanged(e){this._updatedElementCoordinates!==e&&this._updatingHandles.addPromise(this._whenProjected(e,this.view.spatialReference,(e=>{if(!e)return void this._replaceOperations(null);const{_operations:t}=this;t?.trySetGeometry(e)?this.onModifiedExternally():this._replaceOperations(_.p.fromGeometry(e,this.view.state.viewingMode))})))}_operationsGeometryChanged(){const{element:{georeference:e},_operations:t}=this;if(!t||!e)return;const n=t.data.geometry;if(!e.coords)return void this._updateElementCoordinates(n);const o=e.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(n,o,(e=>this._updateElementCoordinates(e))))}_updateElementCoordinates(e){const{georeference:t}=this.element;t&&(t.coords=e,this._updatedElementCoordinates=t.coords)}async _whenProjected(e,t,n){if(!e)return void n(e);const{_operations:o,element:{georeference:i}}=this,r=await(0,m.projectWithZConversion)(e,t);o===this._operations&&i===this.element.georeference&&n(r)}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",(()=>this._operationsGeometryChanged())),e),this.onModifiedExternally()}};(0,o._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"view",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"layer",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"element",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"onModifiedExternally",void 0),(0,o._)([(0,l.MZ)()],f.prototype,"_operations",void 0),(0,o._)([(0,l.MZ)()],f.prototype,"operations",null),(0,o._)([(0,l.MZ)()],f.prototype,"updating",null),f=(0,o._)([(0,a.$)("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],f);var M=n(89227),w=n(28473),b=n(31183),P=n(86249),Z=n(50543);function E(e,t,n){return O(e.allLayerViews.find((e=>e.layer===t)),n)}function O(e,t){if(!e||"media-3d"!==e.type||e.suspended)return!1;const n=e.layer.source;return!!n&&(n instanceof P.default||n instanceof Z.default?n===t:"hasElement"in n&&n.hasElement(t))}let H=class extends d.default{grabbableForEvent(){return!0}constructor(e){super(e),this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.grabbing=!1,this.dragging=!1,this.hovering=!0,this.selected=!1,this.cursor=null,this.consumesClicks=!0,this.events=new i.A.EventEmitter,this.addHandles((0,s.watch)((()=>this.selected),(e=>this.events.emit("select-changed",{action:e?"select":"deselect"})),s.sync))}destroy(){this._set("view",null)}intersectionDistance(e){const{view:t,layer:n,element:o}=this;if(!E(t,n,o))return null;const i=t.toMap(e,{include:{layer:n,element:o}});return i&&(0,b.g)(i,C,t.renderSpatialReference)?(0,M.j)(C,t.state.camera.eye):null}onElevationChange(){}onViewChange(){}};(0,o._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],H.prototype,"element",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],H.prototype,"layer",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],H.prototype,"view",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"interactive",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"selectable",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"grabbable",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"grabbing",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"dragging",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"hovering",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"selected",void 0),(0,o._)([(0,l.MZ)()],H.prototype,"cursor",void 0),H=(0,o._)([(0,a.$)("esri.views.3d.interactive.editingTools.media.MediaElementManipulator3D")],H);const C=(0,w.vt)(),x=Symbol();let R=class extends i.A.EventedAccessor{get operations(){return this._controller?.operations}get elevationInfo(){return{mode:"on-the-ground",offset:0}}get _layerView(){const e=this.view.allLayerViews.find((e=>e.layer===this.layer));return"media-3d"===e?.type?e:null}get visible(){return O(this._layerView,this.element)}get isDraped(){return!0}get origin(){return null}get updating(){return!!this._controller?.updating}get _controllerClass(){return"transform"===this.tool||"control-points"!==this.element.georeference?.type?f:v}constructor(e){super(e),this.tool="transform"}initialize(){this.addHandles([(0,s.watch)((()=>this._controllerClass),(e=>this._updateController(e)),s.syncAndInitial),(0,s.on)((()=>this._layerView),"element-render-changed",(e=>{let{element:t}=e;this.element===t&&this.emit("committed")}))])}toMap(e){const{layer:t,element:n}=this;return this.view.toMap(e,{include:{layer:t,element:n}})}createManipulator(e){const{view:t,layer:n,element:o}=this;return new H({view:t,layer:n,element:o,...e})}_updateController(e){if(this._controller&&this._controller instanceof e)return;this.removeHandles(x);const{view:t,layer:n,element:o}=this,i=()=>{this.emit("modified-externally")};this._controller=new e({view:t,layer:n,element:o,onModifiedExternally:i}),i(),this.addHandles((0,r.DQ)(this._controller),x)}};(0,o._)([(0,l.MZ)({constructOnly:!0})],R.prototype,"view",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],R.prototype,"layer",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],R.prototype,"element",void 0),(0,o._)([(0,l.MZ)()],R.prototype,"tool",void 0),(0,o._)([(0,l.MZ)()],R.prototype,"_controller",void 0),(0,o._)([(0,l.MZ)()],R.prototype,"elevationInfo",null),(0,o._)([(0,l.MZ)()],R.prototype,"_layerView",null),(0,o._)([(0,l.MZ)()],R.prototype,"visible",null),(0,o._)([(0,l.MZ)()],R.prototype,"updating",null),(0,o._)([(0,l.MZ)()],R.prototype,"_controllerClass",null),R=(0,o._)([(0,a.$)("esri.views.3d.interactive.editingTools.ManipulatedObject3DMediaElement")],R)},50543:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var o,i=n(93800),r=n(23060),s=n(74719),l=n(63160),a=n(50925),d=n(64682),p=n(79953),c=n(43103),u=n(48602),h=(n(21265),n(14746),n(75269)),m=n(15484),g=n(32395),y=n(19783),v=n(37623),_=n(85042);let f=class extends g.A{constructor(e){super(e),this.autoplay=!0,this.content=null,this.controller=null,this.type="video",this[o]=!0}load(){const e=this.video;return"string"==typeof e?this.addResolvingPromise(Promise.all([this._preProcessVideoUrl(e),n.e(8582).then(n.bind(n,8582))]).then((async e=>{let[t,{default:n}]=e;this.controller=new n,this.controller.playerUrl=t,await(0,p.whenOnce)((()=>this.controller?.element)),this.controller.loop=!0,this.controller.muted=!0,this.controller.playsInline=!0,this.controller.crossOrigin="anonymous",await(0,p.whenOnce)((()=>"can-play"===this.controller?.state)),await this.controller.play(),this.autoplay||this.controller.pause(),this._set("content",this.controller.element)}))):e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then((()=>{this._set("content",e)}))):this.addResolvingPromise(Promise.reject(new s.default("video-element:invalid-video-type","Invalid video type",{video:e}))),Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}get currentTime(){return this.controller?.currentTime}set currentTime(e){if(!this.controller)return;const t=(0,d.qE)(e,0,this.controller.duration);this.controller?.setCurrentTime(t)}get duration(){return this.controller?.duration}set video(e){"not-loaded"===this.loadStatus?this._set("video",e):a.A.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}writeVideo(e,t,n,o){if(!e)return void(o?.messages&&o.messages.push(new s.default("video-element:unsupported-video","video source is missing")));const i=function(e){return"string"==typeof e&&!(0,c.isDataProtocol)(e)&&!(0,c.isBlobProtocol)(e)}(e)?e:null;if(!i)return void(o?.messages&&o.messages.push(new s.default("video-element:unsupported-video","video source must be an absolute url")));!(0,c.isAbsolute)(i)&&o?.blockedRelativeUrls&&o.blockedRelativeUrls.push(i);const r=(0,c.makeAbsolute)(i);(0,_.i)(r)?o?.messages&&o.messages.push(new s.default("video-element:unsupported-video","video source cannot be an item resource")):t[n]=r}async _preProcessVideoUrl(e){if((0,c.getProxyRule)(e))return(0,c.addProxy)(e);try{return await(0,r.default)(e,{method:"head"}),e}catch{return(0,c.addProxy)(e,!0)}}_loadVideo(e){return new Promise(((t,n)=>{const o=(0,l.Oo)(e,"canplay",(()=>{this.removeHandles("canplay"),this.autoplay?e.play().then(t,n):t()}));this.addHandles(o,"canplay"),"anonymous"!==e.crossOrigin&&(e.crossOrigin="anonymous",(0,c.isBlobProtocol)(e.src)||(e.src=e.src))}))}};o=v.UR,(0,i._)([(0,u.MZ)()],f.prototype,"autoplay",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"content",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"contentWidth",null),(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"contentHeight",null),(0,i._)([(0,u.MZ)()],f.prototype,"controller",void 0),(0,i._)([(0,u.MZ)({type:Number})],f.prototype,"currentTime",null),(0,i._)([(0,u.MZ)({type:Number})],f.prototype,"duration",null),(0,i._)([(0,u.MZ)(y.x3)],f.prototype,"video",null),(0,i._)([(0,m.K)("video")],f.prototype,"writeVideo",null),(0,i._)([(0,u.MZ)(y.m$)],f.prototype,"type",void 0),f=(0,i._)([(0,h.$)("esri.layers.support.VideoElement")],f);const M=f},86249:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var o,i=n(93800),r=n(23060),s=n(74719),l=n(99571),a=n(43103),d=n(12130),p=n(48602),c=(n(21265),n(50925),n(14746),n(14800)),u=n(75269),h=n(15484),m=n(32395),g=n(19783),y=n(24589),v=n(37623),_=n(85042);let f=class extends m.A{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[o]=!0,this.image=null}load(){const e=this.image;if("string"==typeof e){const t=(0,l.M5)(e).then((e=>{this._set("content",e)}));this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then((()=>{this._set("content",e)}));this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new s.default("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,n){return(0,_.f)(t.url,n)}writeImage(e,t,n,o){if(null==e)return;const i=o?.portalItem,s=o?.resources;if(!i||!s)return void("string"==typeof e&&(t[n]=(0,_.t)(e,o)));const l=function(e){return"string"==typeof e&&!(0,a.isDataProtocol)(e)&&!(0,a.isBlobProtocol)(e)}(e)?e:null;if(l){if(null==(0,_.i)(l))return void(t[n]=l);const e=(0,_.t)(l,{...o,verifyItemRelativeUrls:o?.verifyItemRelativeUrls?{writtenUrls:o.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},_.M.NO);if(i&&e&&!(0,a.isAbsolute)(e))return s.toKeep.push({resource:i.resourceFromPath(e),compress:!1}),void(t[n]=e)}t[n]="<pending>",s.pendingOperations.push(async function(e){if("string"==typeof e)return(0,a.isDataProtocol)(e)?(0,a.dataToBlob)(e):(await(0,r.default)(e,{responseType:"blob"})).data;return new Promise((t=>function(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,o=document.createElement("canvas"),i=o.getContext("2d");return o.width=t,o.height=n,e instanceof HTMLImageElement?i.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&i.putImageData(e,0,0),o}(e).toBlob(t)))}(e).then((e=>{const o=function(e,t){const n=(0,d.lk)(),o=`${(0,a.join)("media",n)}.${(0,y.n)({type:"blob",blob:e})}`;return t.resourceFromPath(o)}(e,i);t[n]=o.itemRelativeUrl,s.toAdd.push({resource:o,content:{type:"blob",blob:e},compress:!1,finish:e=>{this.image=e.url}})})))}};o=v.Of,(0,i._)([(0,p.MZ)()],f.prototype,"animationOptions",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],f.prototype,"content",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],f.prototype,"contentWidth",null),(0,i._)([(0,p.MZ)({readOnly:!0})],f.prototype,"contentHeight",null),(0,i._)([(0,p.MZ)(g.x3)],f.prototype,"image",void 0),(0,i._)([(0,c.w)("image",["url"])],f.prototype,"readImage",null),(0,i._)([(0,h.K)("image")],f.prototype,"writeImage",null),(0,i._)([(0,p.MZ)(g.m$)],f.prototype,"type",void 0),f=(0,i._)([(0,u.$)("esri.layers.support.ImageElement")],f);const M=f}}]);