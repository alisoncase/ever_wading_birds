"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[10963,15576,28109,33420,41543,44827,50913,63924,66201,79906,88582],{6135:(e,t,n)=>{n.d(t,{$4:()=>b,O0:()=>I,O1:()=>w,Sw:()=>M,eH:()=>v,rc:()=>g});var r=n(21772),i=n(88102),o=n(23060),s=n(76612),a=n(16804),l=n(44827);const c="picture-fill",d="simple-fill",u="simple-line",f="simple-marker",p="text",m="cim",h=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),y=new s.q(1e3);function v(e){const t=e.style;let n=null;if(e)switch(e.type){case f:"cross"!==t&&"x"!==t&&(n=e.color);break;case d:t&&"solid"!==t?"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,r.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):n=e.color;break;case c:n={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case p:n=e.color;break;case m:n=(0,l.getCIMSymbolColor)(e)}return n}function g(e,t){const n=e+"-"+t;return void 0!==y.get(n)?Promise.resolve(y.get(n)):(0,o.default)(e,{responseType:"image"}).then((e=>{const r=e.data,i=r.naturalWidth,o=r.naturalHeight,s=document.createElement("canvas");s.width=i,s.height=o;const a=s.getContext("2d");a.fillStyle=t,a.fillRect(0,0,i,o),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const l=s.toDataURL();return y.put(n,l),l}))}function b(e){if(!e)return null;let t=null;switch(e.type){case d:case c:case f:t=b(e.outline);break;case u:{const n=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:w(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=I(t).join(",")||"none");break}default:t=null}return t}function I(e){if(!e?.style)return[];const{dashArray:t,style:n,width:r}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const i=r??0,o=h.has(n)?h.get(n).map((e=>e*i)):[];if("butt"!==e.cap)for(const[s,a]of o.entries())o[s]=s%2==1?a+i:Math.max(a-i,1);return o}const w=(()=>{const e={};return t=>{if(e[t])return e[t];const n=t.replaceAll("-","");return e[t]=n,n}})(),M=new i.default([128,128,128])},9137:(e,t,n)=>{n.d(t,{D:()=>a,S:()=>c});var r=n(64682),i=n(50821),o=n(17745),s=n(87118);function a(e,t){let{level:n,class:r,...a}=e;const c=l(n);return(0,s.K)(`h${c}`,{...a,"aria-level":String(c),class:(0,o.Ly)(i.D.heading,r),role:"heading"},t)}function l(e){return(0,r.qE)(Math.ceil(e),1,6)}function c(e){return l(e+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}},10382:(e,t,n)=>{function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function o(e,t,n,r,i,o,s,a,l,c,d,u,f,p,m,h){return[e,t,n,r,i,o,s,a,l,c,d,u,f,p,m,h]}n.d(t,{fA:()=>o,o8:()=>i,vt:()=>r,zK:()=>s});const s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:i,create:r,createView:function(e,t){return new Float64Array(e,t,16)},fromValues:o},Symbol.toStringTag,{value:"Module"}))},15576:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r,i=n(93800),o=n(6946),s=n(79953),a=n(48602),l=(n(21265),n(50925),n(14746),n(75269));let c=r=class extends o.default{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles((0,s.watch)((()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]}),(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)}),s.initial))}get description(){return this.template?.description}set description(e){this.template&&(this.template.description=e)}get disabled(){return this.disabledFunction?.(this)??!1}get label(){return this.template?.name}set label(e){this.template&&(this.template.name=e)}get id(){return`${this.label??""}\u2013${this.layer?.id}`}get supportsUpload(){return"scene"===this.layer?.type}clone(){const e=null!=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new r({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};(0,i._)([(0,a.MZ)()],c.prototype,"description",null),(0,i._)([(0,a.MZ)()],c.prototype,"disabled",null),(0,i._)([(0,a.MZ)()],c.prototype,"disabledFunction",void 0),(0,i._)([(0,a.MZ)()],c.prototype,"label",null),(0,i._)([(0,a.MZ)()],c.prototype,"layer",void 0),(0,i._)([(0,a.MZ)()],c.prototype,"template",void 0),(0,i._)([(0,a.MZ)()],c.prototype,"thumbnail",void 0),(0,i._)([(0,a.MZ)()],c.prototype,"id",null),(0,i._)([(0,a.MZ)()],c.prototype,"supportsUpload",null),c=r=(0,i._)([(0,l.$)("esri.widgets.FeatureTemplates.TemplateItem")],c);const d=c},27892:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var r=n(93800),i=n(79953),o=n(48602),s=(n(21265),n(50925),n(14746),n(75269)),a=n(78076),l=n(27811),c=n(29831),d=n(75788),u=n(6946);let f=class extends u.default{constructor(e){super(e),this.filter=!0}};(0,r._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"filter",void 0),f=(0,r._)([(0,s.$)("esri.widgets.FeatureTemplates.VisibleElements")],f);const p=f;var m=n(49403),h=n(50821),y=n(68908),v=n(34462),g=(n(17745),n(76697)),b=n(66201),I=n(87118);const w="esri-feature-templates";function M(e){return e.id}let _=class extends l.default{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new d.default,this.visibleElements=new p,this.renderCustomItem=e=>null,this.renderCustomGroupContent=e=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=e=>null,this.renderItemContentEnd=e=>null,this._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const n=e.target;if(function(e){return!!e?.["data-has-icon"]}(n))return void t.unobserve(n);const r=function(e){return e?.["data-item"]}(n),{layer:i,template:o}=r;S(n,!0);const s=await(0,v.z)(o,i).catch((()=>(S(n,!1),null)));if(null==s)return;n.appendChild(s)}}))})),this._renderItemIcon=e=>(0,a.bI)(e.layer)?(0,I.K)("span",{"data-has-icon":!0,"data-item":e,key:"icon"},(0,I.K)("calcite-icon",{icon:"table"})):(0,I.K)("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"}),this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}initialize(){const e=e=>{let{label:t}=e;return!this.filterText||!!t?.toLowerCase().includes(this.filterText.toLowerCase())};this.addHandles((0,i.watch)((()=>this.viewModel),((t,n)=>{t&&!t.filterFunction&&(this.filterFunction=e),n&&n!==t&&n.filterFunction===e&&(n.filterFunction=null)}),i.initial))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return(0,m.W)({icon:()=>Promise.resolve().then(n.bind(n,92439)),loader:()=>Promise.resolve().then(n.bind(n,23173)),input:()=>n.e(46138).then(n.bind(n,46138)),list:()=>Promise.all([n.e(46138),n.e(89939),n.e(18170)]).then(n.bind(n,18170)),"list-item":()=>Promise.all([n.e(73373),n.e(14960)]).then(n.bind(n,28898)),notice:()=>n.e(51132).then(n.bind(n,51132))})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:n,headingLevel:r,messages:i,viewModel:{items:o,numberOfFeatureTemplates:s,selectedItem:a,state:l}}=this,d=this.visibleElements.filter&&s>1;if(function(e){return e.length>0&&(0,c.X6)(e[0])}(o)){const e=o.find((e=>e.label===c._t.label));e&&(e.label=i.other)}return(0,I.K)("div",{"aria-label":i.widgetLabel,class:this.classes(w,h.D.widget)},"loading"===l?(0,I.K)("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):"ready"===l?(0,I.K)(y.kk,{disabled:e,enableListScroll:t,filterEnabled:d,filterText:n,headingLevel:r,id:this.id,identify:M,items:o,messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:a??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:e=>{this.filterText=e},onItemSelect:e=>!(0,c.X6)(e)&&this.viewModel.select(e)}):null)}};function S(e,t){e&&(e["data-has-icon"]=t)}(0,r._)([(0,o.MZ)()],_.prototype,"disabled",null),(0,r._)([(0,o.MZ)()],_.prototype,"enableListScroll",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"filterFunction",null),(0,r._)([(0,o.MZ)()],_.prototype,"filterText",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"groupBy",null),(0,r._)([(0,o.MZ)()],_.prototype,"headingLevel",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"icon",null),(0,r._)([(0,o.MZ)()],_.prototype,"label",null),(0,r._)([(0,o.MZ)()],_.prototype,"layers",null),(0,r._)([(0,o.MZ)(),(0,g.G)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],_.prototype,"messages",void 0),(0,r._)([(0,o.MZ)(),(0,g.G)("esri/t9n/common")],_.prototype,"messagesCommon",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],_.prototype,"selectedItem",null),(0,r._)([(0,o.MZ)()],_.prototype,"selectionMode",void 0),(0,r._)([(0,o.MZ)(),(0,b.U)("select")],_.prototype,"viewModel",void 0),(0,r._)([(0,o.MZ)({type:p,nonNullable:!0})],_.prototype,"visibleElements",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"renderCustomItem",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"renderCustomGroupContent",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"renderItemLabel",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"renderItemDescription",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"renderItemContent",void 0),(0,r._)([(0,o.MZ)()],_.prototype,"renderItemContentEnd",void 0),_=(0,r._)([(0,s.$)("esri.widgets.FeatureTemplates")],_);const C=_},28109:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var r=n(93800),i=n(6946),o=n(93633),s=n(48602),a=(n(21265),n(50925),n(14746),n(75269));let l=class extends(o.A.IdentifiableMixin(i.default)){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return null==e||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find((t=>t.template===e))}};(0,r._)([(0,s.MZ)()],l.prototype,"allItems",void 0),(0,r._)([(0,s.MZ)()],l.prototype,"filterFunction",void 0),(0,r._)([(0,s.MZ)()],l.prototype,"items",null),(0,r._)([(0,s.MZ)()],l.prototype,"label",void 0),(0,r._)([(0,s.MZ)()],l.prototype,"id",null),l=(0,r._)([(0,a.$)("esri.widgets.FeatureTemplates.TemplateItemGroup")],l);const c=l},28417:(e,t,n)=>{n.d(t,{Kw:()=>o,RE:()=>a,Sl:()=>s});var r=n(13248),i=n(23060);async function o(e,t,n){const o=r.id?.findCredential(e.restUrl);if(!o)return null;if("loaded"===e.loadStatus&&""===t&&e.user?.sourceJSON&&!1===n)return e.user.sourceJSON;const s={responseType:"json",query:{f:"json"}};if(n&&(s.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,i.default)(e.restUrl+"/community/self",s);if(t.data){const e=t.data;if(e?.username)return e}return null}const a=await(0,i.default)(e.restUrl+"/community/users/"+t,s);if(a.data){const e=a.data;return e.error?null:e}return null}async function s(e,t,n){const r=await o(e,t,!0);return r?.privileges?.includes(n)??!1}async function a(e,t,n){const r=await o(e,t,!0);return r?.userLicenseTypeExtensions?.includes(n)??!1}},29831:(e,t,n)=>{n.d(t,{AY:()=>a,Ex:()=>l,JS:()=>c,K_:()=>d,X6:()=>u,_t:()=>i,wu:()=>o,zA:()=>s});var r=n(45622);const i={key:Symbol(),label:"Other\u200b"};function o(e){return"templateInfos"in e}function s(e){const t=[];for(const{layer:n,templates:r}of e)for(const e of r)t.push({layer:n,template:e});return t}function a(e,t){const n=new Map;for(const o of e){const e=t(o),{key:s,label:a}=null!=e.key?e:i;(0,r.tE)(n,s,(()=>({label:a,templateInfos:[]}))).templateInfos.push(o)}return Array.from(n.values())}function l(e,t){return{label:e.title??"",templateInfos:t.map((t=>({layer:e,template:t})))}}async function c(e,t){return"subtype-sublayer"===e.type?await(e.parent?.load(t)):await e.load(t),e}function d(e){const t=new Map,n=[];for(const r of e)if(u(r)){n.push(r);for(const e of r.items)t.set(e.template,e)}else t.set(r.template,r);return[t,n]}const u=e=>"items"in e},34462:(e,t,n)=>{n.d(t,{z:()=>l});var r=n(79625),i=n(16804),o=n(42985),s=n(69943),a=n(26286);async function l(e,t,n){if(!(0,s.DU)(e)&&(0,o.Rj)(e)&&e.thumbnail){const n=`data:image/png;base64,${e.thumbnail.imageData}`,r=document.createElement("div");return r.classList.add("esri-thumbnail-preview"),"geometryType"in t&&t.geometryType&&r.classList.add(`esri-thumbnail-preview--${t.geometryType}`),r.style.backgroundImage=`url(${n})`,r}const r=await c(t,e);if(null==r)return null;const l={maxSize:(0,i.PN)(n?.maxSize??32)};if(((0,s.DU)(e)||(0,o.gZ)(e))&&"renderer"in t&&"dictionary"===t.renderer?.type&&(l.fieldMap=t.renderer.fieldMap??void 0,l.feature=(0,s.DU)(e)?e:{attributes:e.prototype.attributes??{}}),(0,s.DU)(e)&&e.geometry&&!1!==n?.useGeometry&&!e.geometry.type.includes("point")){l.geometry=e.geometry,l.useMarkerSymbolSize=!1;const t=(0,i.PN)(n?.maxSize??22);l.size={width:t,height:t}}return await(0,a.renderPreviewHTML)(r,l)}async function c(e,t){if(!(0,s.DU)(t)&&(0,o.Rj)(t))return d(e);if("renderer"in e&&e.renderer){const{renderer:n}=e,i=(0,s.DU)(t)?t:new r.default({attributes:t.prototype.attributes});if("getSymbolAsync"in n){const e=await n.getSymbolAsync(i);if(e)return e}}return d(e)}async function d(e){if(!("geometryType"in e))return null;const{geometryType:t}=e,r="point"===t||"multipoint"===t?await Promise.resolve().then(n.bind(n,83031)):"polyline"===t?await Promise.resolve().then(n.bind(n,99071)):"polygon"===t||"mesh"===t||"multipatch"===t?await Promise.resolve().then(n.bind(n,92744)):null;return r?new r.default:null}},42985:(e,t,n)=>{n.d(t,{Cq:()=>h,Dt:()=>y,JC:()=>v,Rj:()=>f,Sf:()=>p,b:()=>I,gZ:()=>u,w2:()=>m,xZ:()=>g});var r=n(50925),i=n(45622),o=n(49959),s=n(35920),a=n(91046),l=n(78076),c=n(48485);const d=()=>r.A.getLogger("esri.editing.templateUtils");function u(e){return null!=e&&"prototype"in e}function f(e){return m(e)&&!("definition"in e)}function p(e){return m(e)&&"definition"in e}function m(e){return null!=e&&"templateId"in e}function h(e){return p(e)&&"feature"===e?.type&&(null==e.definition||(0,a.sC)(e.definition))}function y(e){return p(e)&&"group"===e?.type&&(null==e.definition||(0,a.Xc)(e.definition))}function v(e){return p(e)&&"preset"===e?.type&&(null==e.definition||(0,a.vf)(e.definition))}function g(e){return p(e)&&null!=e?.definition}const b=e=>null==e||"object"!=typeof e?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap((e=>e.templates)):[]];async function I(e,t,n){if(null==t)return e.map((e=>({layer:e,templates:b(e)})));const r=await async function(e,t){const n=await(0,c.Z)(t).load(),r=new Set;for(const i of e)(0,s.kb)(r,w(n,i));return await Promise.all(Array.from(r).map((e=>e.featureService.load()))),r}(e,t);(0,o.throwIfAborted)(n);const a=new Map,u=Array.from(r).map((e=>async function(e){let{serviceInfo:t,out:n,signal:r}=e;const{featureService:s,layersAndTables:a}=t,c=await async function(e){let{featureService:t,layers:n,signal:r}=e;if(!t.capabilities?.editing.supportsSharedTemplates)return new Map;const o=new Map(n.map((e=>[e.layerId,e]))),s=await t.querySharedTemplates({query:{layers:Array.from(o.keys())},requestOptions:{signal:r}}),a=new Map;for(const l of s)for(const e of l.layerIds)o.has(e)&&(0,i.tE)(a,o.get(e),(()=>[])).push(l);return a}({featureService:s,layers:a.toArray(),signal:r});(0,o.throwIfAborted)(r);for(const[i,o]of c.entries())if(0!==o.length)if((0,l.F2)(i)){const e=M(o),t=[],r=e.get(1/0)??t;for(const o of i.sublayers){const i=e.get(o.subtypeCode)??t;n.set(o,[...i,...r])}}else n.set(i,o)}({serviceInfo:e,out:a,signal:n,view:t}))),f=await Promise.allSettled(u);for(const i of f.filter((e=>"rejected"===e.status)))d().warn("Failed to fetch shared templates for service. Will use standard templates if available.",i.reason);return e.map((e=>({layer:e,templates:a.get(e)??b(e)})))}function w(e,t){return(0,l.Sv)(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):(0,l.yZ)(t)?e.tablesAndLayersLookup.get(t):null}function M(e){const t=new Map;for(const n of e)(0,i.tE)(t,n.subtypeCode??1/0,(()=>[])).push(n);return t}},44827:(e,t,n)=>{n.r(t),n.d(t,{applyCIMSymbolColor:()=>p,applyCIMSymbolRotation:()=>y,getCIMSymbolColor:()=>d,getCIMSymbolRotation:()=>h,getCIMSymbolSize:()=>o,getCIMSymbolType:()=>v,scaleCIMMarker:()=>l,scaleCIMSymbol:()=>a,scaleCIMSymbolTo:()=>s});var r=n(88102),i=n(61154);function o(e){const t=(0,i.lW)(e);if("CIMTextSymbol"===t?.type)return t.height??0;let n=0;if(t?.symbolLayers)for(const r of t.symbolLayers)(0,i.MM)(r)&&null!=r.size&&r.size>n?n=r.size:(0,i.mA)(r)&&null!=r.width&&r.width>n?n=r.width:(0,i.jn)(r);return n}function s(e,t,n){if(!e)return;const r=(0,i.lW)(e),s=o(e);0!==s?a(r,t/s,!1,n):function(e,t){if(e)if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const n of e.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":n.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":n.width=t}}else e.height=t}(r,t)}function a(e,t,n,r){if(e)if("CIMTextSymbol"!==e.type){if(n&&e.effects)for(const n of e.effects)c(n,t);if(e.symbolLayers)for(const n of e.symbolLayers){switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":l(n,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!r?.preserveOutlineWidth&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":a(n.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}if(n.effects)for(const e of n.effects)c(e,t)}}else null!=e.height&&(e.height*=t)}function l(e,t,n){if(e&&(e.markerPlacement&&function(e,t){switch((0,i.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const r of e.markerGraphics)e.scaleSymbolsProportionally||a(r.symbol,t,!0,n)}function c(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const n=e.dashTemplate.map((e=>e*t));e.dashTemplate=n}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function d(e){const t=[];return u((0,i.lW)(e),t),t.length?new r.default((0,i.e6)(t[0])):null}function u(e,t){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(n?.symbolLayers)for(const o of n.symbolLayers)if(!(o.colorLocked||r&&((0,i.mA)(o)||(0,i.MM)(o)&&o.markerPlacement&&(0,i.zr)(o.markerPlacement))))switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor&&f(t,o.tintColor);break;case"CIMVectorMarker":o.markerGraphics?.forEach((e=>{u(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":f(t,o.color);break;case"CIMHatchFill":u(o.lineSymbol,t)}}function f(e,t){for(const n of e)if(n.join(".")===t.join("."))return;e.push(t)}function p(e,t,n){t instanceof r.default||(t=new r.default(t));const o=(0,i.lW)(e);o&&m(o,t,n)}function m(e,t,n){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const o="CIMPolygonSymbol"===r?.type;if(r?.symbolLayers)for(const s of r.symbolLayers){if(s.colorLocked)continue;if(o)if(n){const{layersToColor:e}=n;if(((0,i.mA)(s)||(0,i.MM)(s)&&s.markerPlacement&&(0,i.zr)(s.markerPlacement))&&"fill"===e||(0,i.jn)(s)&&"outline"===e)continue}else if((0,i.mA)(s)||(0,i.MM)(s)&&s.markerPlacement&&(0,i.zr)(s.markerPlacement))continue;const e=t.toArray();switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor=e;break;case"CIMVectorMarker":s.markerGraphics?.forEach((e=>{m(e.symbol,t,n)}));break;case"CIMSolidStroke":case"CIMSolidFill":s.color=e;break;case"CIMHatchFill":m(s.lineSymbol,t,n)}}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,i.lW)(e);if("CIMTextSymbol"===n?.type||"CIMPointSymbol"===n?.type){const e=n.angle;return null!=e&&t?360-e:e??0}return 0}function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=(0,i.lW)(e);if(n&&(t=360-t),"CIMTextSymbol"!==r?.type){if("CIMPointSymbol"===r?.type&&r.symbolLayers){const e=t-(r.angle||0);for(const t of r.symbolLayers)if((0,i.MM)(t)){let n=t.rotation||0;t.rotateClockwise?n-=e:n+=e,t.rotation=n}r.angle=t}}else r.angle=t}function v(e){const t=(0,i.lW)(e);if(!t)return null;switch(t.type){case"CIMPointSymbol":return"CIMPointSymbol";case"CIMLineSymbol":return"CIMLineSymbol";case"CIMPolygonSymbol":return"CIMPolygonSymbol";case"CIMTextSymbol":return"CIMTextSymbol";case"CIMMeshSymbol":return"CIMMeshSymbol";default:return null}}},48485:(e,t,n)=>{n.d(t,{Z:()=>T});var r=n(93800),i=n(13248),o=n(89129),s=n(74719),a=n(58448),l=n(81933),c=n(50925),d=n(45622),u=n(20620),f=n(49959),p=n(90450),m=n(79953),h=n(43103),y=n(48602),v=(n(21265),n(14746),n(75269)),g=n(15492),b=n(65073),I=n(78076),w=n(78139),M=n(28417),_=n(46707),S=n(6946);let C=class extends S.default{constructor(e){super(e),this.layers=new o.default,this.lockType="none",this.tables=new o.default,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new o.default([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){return this.featureService.sourceJSON?.currentVersion??0}};(0,r._)([(0,y.MZ)({constructOnly:!0})],C.prototype,"canCreateVersion",void 0),(0,r._)([(0,y.MZ)({constructOnly:!0})],C.prototype,"canEditVersionedData",void 0),(0,r._)([(0,y.MZ)({constructOnly:!0})],C.prototype,"featureService",void 0),(0,r._)([(0,y.MZ)({constructOnly:!0})],C.prototype,"layers",void 0),(0,r._)([(0,y.MZ)()],C.prototype,"layersAndTables",null),(0,r._)([(0,y.MZ)()],C.prototype,"lockType",void 0),(0,r._)([(0,y.MZ)({constructOnly:!0})],C.prototype,"tables",void 0),(0,r._)([(0,y.MZ)()],C.prototype,"versionInfo",void 0),(0,r._)([(0,y.MZ)({constructOnly:!0})],C.prototype,"versionService",void 0),(0,r._)([(0,y.MZ)()],C.prototype,"hasAdvancedEditingUserTypeExtension",void 0),(0,r._)([(0,y.MZ)()],C.prototype,"loggedInServiceUser",void 0),(0,r._)([(0,y.MZ)()],C.prototype,"featureServiceVersion",null),C=(0,r._)([(0,v.$)("esri.undoredo.support.ServiceVersionInfo")],C);var k=n(46538);const L=new Map;function T(e){return(0,d.tE)(L,e,(()=>{const t=new A({view:e});return e.addHandles({remove(){L.delete(e),t.destroy()}}),t.load().catch((e=>{c.A.getLogger("esri.views.Services").error("Failed to load service metadata",e)})),t}))}let A=class extends(l.A.LoadableMixin(u.A.EsriPromiseMixin(a.A.EventedAccessor))){constructor(e){super(e),this._updatingHandles=new g.U,this.items=new o.default,this.tablesAndLayersLookup=new p.A,this.additionalLayers=new o.default,this._debouncedCheckAndUpdateServiceInfos=(0,f.debounce)((async()=>{const e=[];for(const t of this.items){if(0===t.layersAndTables.length)continue;const n=t.layersAndTables.getItemAt(0);n?.gdbVersion!==t.versionInfo?.versionIdentifier.name&&e.push(t)}0!==e.length&&(await(0,m.whenOnce)((()=>!this.updating)),await this._updateVersionInfos(e))})),this._debouncedLayersChanged=(0,f.debounce)((async()=>{const e=this._detectNewLayersAndTables();0!==e.length&&(await(0,m.whenOnce)((()=>!this._updatingHandles.updating)),await this._updatingHandles.addPromise((async()=>{const t=new Set;for(const r of e)if("feature"===r.type||"subtype-group"===r.type){if(!r.url)continue;const e=(0,b.qg)(r.url).url.path,i=this._findServiceInfo(e);if(i)this.tablesAndLayersLookup.set(r,i),r.isTable?i.tables.push(r):i.layers.push(r);else if(!t.has(e))try{await this._addServiceInfo(e,r)}catch(n){c.A.getLogger(this).error(`Failed to load feature service: ${e}`,n)}finally{t.add(e)}}})()))})),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(e){return(0,f.throwIfAborted)(e),this.addHandles([(0,m.watch)((()=>this._allLayersAndTables),(()=>{this._debouncedLayersChanged().catch((e=>{c.A.getLogger(this).warn("Failed to update service info",e)}))})),(0,m.watch)((()=>this.items.map((e=>e.layersAndTables.map((e=>e.gdbVersion??"")).join(",")))),(()=>{this.checkAndUpdateServiceInfos().catch((e=>{c.A.getLogger(this).warn("Failed to update service info",e)}))}))]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return"loading"===this.loadStatus||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(e,t,n)})())}createVersion(e){return this._updatingHandles.addPromise((async()=>{const t=e.featureServerUrl,n=this._findServiceInfo(t);if(!n?.versionService)throw new s.default("services:no-version-management-service");const r=n.hasAdvancedEditingUserTypeExtension,i=n.loggedInServiceUser.toUpperCase(),o=function(e){return!e||0===e.trim().length}(e.ownerName)?i:e.ownerName?.trim().toUpperCase();if(o!==i){if(n.featureServiceVersion<=11.1)throw new s.default("services:versioning-api-error");if(!r)throw new s.default("services:no-advanced-editing-user-type-extension")}if("SDE"===o?.toUpperCase()&&"DEFAULT"===e.versionName.toUpperCase())throw new s.default("services:no-valid-version-name");{const t=await n.versionService.getVersionInfos();if(t?.find((t=>t.versionIdentifier.name.toUpperCase()===(o+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(i+"."+e.versionName).toUpperCase())))throw new s.default("services:no-valid-version-name")}const a=await n.versionService.createVersion({versionName:e.versionName,access:o!==i?"public":e.access,description:e.description});if(o!==i){const{guid:t,name:r}=a.versionIdentifier;await n.versionService.alterVersion({guid:t,name:r},{ownerName:o,access:e.access})}e.switchToVersion&&await this._changeVersionInternal(t,a.versionIdentifier.name,a.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:a.versionIdentifier,versionManagementService:n.versionService})})())}deleteVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{const r=this._findServiceInfo(e);if(!r?.versionService)throw new s.default("services:no-version-management-service");if(r.featureServiceVersion<=11.1)throw new s.default("services:versioning-api-error");if(!r.hasAdvancedEditingUserTypeExtension)throw new s.default("services:no-advanced-editing-user-type-extension");const i={name:t,guid:n};await r.versionService.deleteVersion(i)&&(await this._updateVersionInfo(r),this.emit("version-deleted",{versionIdentifier:i,versionManagementService:r.versionService}))})())}startEditing(e){return this._updatingHandles.addPromise((async()=>{const t=this._findServiceInfo(e);if(!t?.versionService)throw new s.default("services:no-version-management-service");if(!t.hasAdvancedEditingUserTypeExtension)throw new s.default("services:no-advanced-editing-user-type-extension");const n=t.versionInfo?.versionIdentifier??{name:t.versionService.defaultVersionIdentifier.name,guid:t.versionService.defaultVersionIdentifier.guid};let r=!0;("none"!==t.versionService.getLockType(n)||(r=await t.versionService.startReading(n),r))&&(r=await t.versionService.startEditing(n),t.updateLockType())})())}finishEditing(e,t){return this._updatingHandles.addPromise((async()=>{const n=this._findServiceInfo(e);if(!n?.versionService)throw new s.default("services:no-version-management-service");if(!n.hasAdvancedEditingUserTypeExtension)throw new s.default("services:no-advanced-editing-user-type-extension");const r=n.versionInfo?.versionIdentifier??{name:n.versionService.defaultVersionIdentifier.name,guid:n.versionService.defaultVersionIdentifier.guid},i=n.versionService.getLockType(r);if("none"!==i)return"read"===i?(await n.versionService.stopReading(r),void n.updateLockType()):"edit"===i?(await n.versionService.stopEditing(r,t),await n.versionService.stopReading(r),void n.updateLockType()):void 0})())}async _changeVersionInternal(e,t,n){const r=this._findServiceInfo(e);if(!r?.versionService)throw new s.default("services:no-version-management-service");const i=r.versionInfo?.versionIdentifier??{name:r.versionService.defaultVersionIdentifier.name,guid:r.versionService.defaultVersionIdentifier.guid},o={name:t,guid:n};await r.versionService.changeVersion(this.view?.map,i,o)&&await this._updateVersionInfo(r)}async _updateVersionInfo(e){const t=e.versionService;if(!t)return;if(0===e.layersAndTables.length)return;const n=e.layersAndTables.getItemAt(0)?.gdbVersion,r=n?await t.getVersionIdentifierFromName(n):t.defaultVersionIdentifier;e.versionInfo=await t.getVersionInfoExtended(r)}_findServiceInfo(e){return this.items.find((t=>t.featureService.url===e))??null}_removeFeatureService(e){this.items.remove(e)}async _findPortal(e){const t=i.id?.findServerInfo(e??"");if(!t?.owningSystemUrl)return null;const n=`${t.owningSystemUrl}/sharing/rest`,r=w.default.getDefault();return r?.loaded&&(0,h.normalize)(r.restUrl)===(0,h.normalize)(n)?r:new w.default({authMode:"immediate",url:t.owningSystemUrl}).load()}_updateVersionInfos(e){return this._updatingHandles.addPromise((async()=>{for(const t of e)await this._updateVersionInfo(t).catch((e=>{c.A.getLogger(this).error("Failed to update version details",e)}))})())}async _addServiceInfo(e,t){const n=new _.default({url:e});await n.load();const r=await this._findPortal(e),i=r?.user?.username;let s=!1;i&&(s=await(0,M.RE)(r,i,"advediting"));let a=null;n.versionManagementServiceUrl&&(a=new k.default({url:n.versionManagementServiceUrl}),await a.load());const l=t.isTable?[]:[t],c=t.isTable?[t]:[],d=new C({loggedInServiceUser:i??"",hasAdvancedEditingUserTypeExtension:s,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:n,versionService:a,layers:new o.default(l),tables:new o.default(c)});return a&&await this._updateVersionInfo(d),this.items.push(d),this.tablesAndLayersLookup.set(t,d),t.isTable?d.tables.push(t):d.layers.push(t),d}get _allLayersAndTables(){return[...this.view.map.allLayers,...this.view.map.allTables,...this.additionalLayers]}_detectNewLayersAndTables(){const e=new Set(this._allLayersAndTables),t=[];for(const n of e)"feature"!==n.type&&"subtype-group"!==n.type||this._processed.has(n)||t.push(n);for(const n of this._processed)if(!e.has(n)&&((0,I.F2)(n)||(0,I.yZ)(n))){const e=this.tablesAndLayersLookup.get(n);if(!e)continue;this.tablesAndLayersLookup.delete(n),n.isTable?e.tables.remove(n):e.layers.remove(n),0===e.layersAndTables.length&&this._removeFeatureService(e)}return this._processed=e,t}};(0,r._)([(0,y.MZ)({constructOnly:!0})],A.prototype,"view",void 0),(0,r._)([(0,y.MZ)()],A.prototype,"items",void 0),(0,r._)([(0,y.MZ)()],A.prototype,"tablesAndLayersLookup",void 0),(0,r._)([(0,y.MZ)()],A.prototype,"additionalLayers",void 0),(0,r._)([(0,y.MZ)()],A.prototype,"updating",null),(0,r._)([(0,y.MZ)()],A.prototype,"_allLayersAndTables",null),A=(0,r._)([(0,v.$)("esri.undoredo.support.Services")],A)},66201:(e,t,n)=>{function r(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const n=t._delegatedEventNames,r=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);n.push(...r)}}n.d(t,{U:()=>r})},66509:(e,t,n)=>{function r(){return[0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3]]}function o(e,t,n,r){return[e,t,n,r]}n.d(t,{fA:()=>o,o8:()=>i,vt:()=>r,zK:()=>s});const s=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:i,create:r,fromValues:o},Symbol.toStringTag,{value:"Module"}))},68908:(e,t,n)=>{n.d(t,{Gx:()=>p,kk:()=>d});var r=n(9137),i=n(17745),o=n(87118);const s="esri-item-list",a=`${s}__list-item`,l={base:s,filterContainerSticky:`${s}__filter-container--sticky`,group:`${s}__group`,groupHeader:`${s}__group__header`,item:a,itemDisabled:`${a}--disabled`,itemIcon:`${a}-icon`,itemContentEnd:`${a}-content-end`,noMatchesMessage:`${s}__no-matches-message`,scroller:`${s}__scroller`,scrollerEnabled:`${s}__scroller--enabled`},c=4;function d(e){const{disabled:t,filterText:n="",id:r,messages:i,onFilterChange:s,...a}=e;return(0,o.K)("div",{key:r},e.filterEnabled??1?f({disabled:t,filterText:n,id:r,messages:i,onFilterChange:s}):null,u({...a,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:n,messages:i}))}function u(e){const{headingLevel:t,items:n,...r}=e;return 0===n.length?(0,o.K)("div",{class:l.noMatchesMessage,key:"no-matches"},e.messages.noMatches):(0,o.K)("div",{class:(0,i.Ly)({[l.scroller]:!0,[l.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},n.map((e=>function(e){return!!e.items}(e)?y({...r,group:e,headingLevel:t}):p({...r,grouped:!0,item:e}))))}function f(e){const{disabled:t,messages:n,filterText:r,enableListScroll:i}=e;return(0,o.K)("div",{class:i?void 0:l.filterContainerSticky,key:"filter"},(0,o.K)("calcite-input",{disabled:t,placeholder:n.filterPlaceholder,type:"search",value:r,onCalciteInputInput:t=>{const n=t.currentTarget;e.onFilterChange&&e.onFilterChange(n.value)}}))}function p(e){const{disabled:t,grouped:n,identify:r,item:s,onItemMouseEnter:a,onItemMouseLeave:c,onItemSelect:d,renderIcon:u,renderCustomItem:f,renderItemContent:p,renderItemContentEnd:y,renderItemLabel:v,renderItemDescription:g,renderItemActionEnd:b,renderItemTitle:I,selectedItem:w}=e,M=m(s,r),_=M===m(w,r),S=f?.(e);if(S)return S;const C=p?.(s),k=y?.(s),L=b?.(s),T=!(!s.disabled&&!t),A=u?.(s);return(0,o.K)("calcite-list-item",{afterUpdate:e=>{e.selected=_},"aria-level":n?"2":"",class:(0,i.Ly)({[l.item]:!0,[l.itemDisabled]:T}),"data-item":s,description:C?void 0:g?.(s)??void 0,disabled:T,key:M,label:C?void 0:v?.(s)??s.label??void 0,onblur:e=>c?.(h(e)),onfocus:e=>a?.(h(e)),onmouseenter:e=>a?.(h(e)),onmouseleave:e=>c?.(h(e)),selected:_,title:I?.(s)??void 0,onCalciteListItemSelect:e=>{e.preventDefault(),d?.(h(e))}},A?(0,o.K)("div",{class:l.itemIcon,key:"content-start",slot:"content-start"},A):void 0,C?(0,o.K)("div",{key:"content",slot:"content"},C):null,k?(0,o.K)("div",{class:l.itemContentEnd,key:"content-end",slot:"content-end"},k):null,L??null)}function m(e,t){return e?`${t?.(e)||e.id}__${e.label}`:""}function h(e){return e.currentTarget["data-item"]}function y(e){const{disabled:t,group:n,headingLevel:i=c,selectionMode:s="none",renderCustomGroupContent:a,...d}=e,u=a?.(e);return(0,o.K)("div",{class:l.group,key:n.label??void 0},(0,o.K)(r.D,{class:l.groupHeader,level:i},n.label),u||(0,o.K)("calcite-list",{disabled:t,label:n.label??"",selectionAppearance:"border",selectionMode:s},n.items.map((e=>p({...d,disabled:t,item:e,grouped:!0})))))}},75788:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var r=n(93800),i=n(58828),o=n(58448),s=n(17741),a=n(49959),l=n(79953),c=n(48602),d=(n(21265),n(50925),n(14746),n(75269)),u=n(15492),f=n(42985),p=n(78076),m=n(29831),h=n(15576),y=n(28109);const v=e=>{let{layer:t}=e;return{key:t,label:t.title??""}},g=e=>{let{layer:t}=e;return{key:t.geometryType,label:t.geometryType??""}};let b=class extends o.A.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new u.U,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([(0,l.watch)((()=>[this.templateInfos,this.layers]),((e,t)=>{let[n]=e;n&&n===t?.at(0)||(this._updateTask=(0,s.DC)(this._updateTask),n?this._updateAllItems(n):this._getTemplatesAndUpdateAllItems())}),l.syncAndInitial),(0,l.watch)((()=>this._groupByFunction),(()=>{null==this.templateInfos&&(this._updateTask=(0,s.DC)(this._updateTask),this._getTemplatesAndUpdateAllItems())}),l.sync),(0,l.watch)((()=>this.filterFunction),(e=>{for(const t of this._allItems)(0,m.X6)(t)&&(t.filterFunction=e)}),l.sync)])}set groupBy(e){if(this._set("groupBy",e),"function"!=typeof e)switch(e){case"layer":this._groupByFunction=v;break;case"geometry":this._groupByFunction=g;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const n=()=>this.notifyChange("state");this.addHandles(e.map((e=>(0,l.when)((()=>e.loadStatus),n))),t)}this._set("layers",e)}get state(){return this.updating?"loading":0!==this.layers.length||this.templateInfos?.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce(((e,t)=>(0,m.X6)(t)?e+t.allItems.length:e+1),0)}get items(){const{filterFunction:e}=this;return null==e?this._allItems:this._allItems.filter((t=>(0,m.X6)(t)?t.items.length>0:e(t)))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)(0,m.X6)(e)&&e.reapplyFilter()}select(e){let{emit:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.selectedItem,r=e?.clone()||null;this._set("selectedItem",r),t&&this.emit("select",{item:r,oldItem:n,template:r?.template??null})}_createItem(e,t){return new h.default({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return"string"==typeof e?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(0===e.length)return function(e){for(const t of e){if((0,m.X6)(t))for(const e of t.items)e.destroy();t.destroy()}}(t),void(this._allItems=[]);const[n,r]=(0,m.K_)(t),i=e=>{const t=n.get(e.template);return t?(n.delete(e.template),t):this._createItem(e.template,e.layer)},{filterFunction:o}=this,s=e.filter(I).map((e=>(0,m.wu)(e)?new y.default({filterFunction:o,label:e.label,allItems:e.templateInfos.filter(I).map((e=>i(e)))}):i(e)));for(const a of[...n.values(),...r])a.destroy();this._allItems=s}async _getTemplatesFromLayers(e){const t=[],n={signal:e};await Promise.all(this.layers.map((async r=>{await(0,m.JS)(r,n),(0,a.throwIfAborted)(e);const i=(0,p.BR)(r)?.operations;i?.supportsEditing&&i?.supportsAdd&&((0,p.F2)(r)?t.push(...r.sublayers):t.push(r))})));const r=await(0,f.b)(t,this.view,e);(0,a.throwIfAborted)(e);const i=(0,m.zA)(r),o=this._groupByFunction;if(null==o)return i;const s=(0,m.AY)(i,o);return 1===s.length&&s[0].label===m._t.label?s[0].templateInfos:s}async _getTemplatesAndUpdateAllItems(){if(0===this.layers.length)return;const e=(0,i.UT)((async e=>{const t=await this._getTemplatesFromLayers(e);(0,a.throwIfAborted)(e),this._updateAllItems(t)}));this._updateTask=e,this._updatingHandles.addPromise(e.promise)}};function I(e){return(0,m.wu)(e)?e.templateInfos.some(I):!(0,f.w2)(e.template)||!1!==e.template.visible}(0,r._)([(0,c.MZ)()],b.prototype,"_allItems",void 0),(0,r._)([(0,c.MZ)()],b.prototype,"_groupByFunction",void 0),(0,r._)([(0,c.MZ)()],b.prototype,"_updatingHandles",void 0),(0,r._)([(0,c.MZ)()],b.prototype,"disabled",void 0),(0,r._)([(0,c.MZ)()],b.prototype,"disabledItemFunction",void 0),(0,r._)([(0,c.MZ)({value:null})],b.prototype,"filterFunction",void 0),(0,r._)([(0,c.MZ)()],b.prototype,"groupBy",null),(0,r._)([(0,c.MZ)({value:[]})],b.prototype,"layers",null),(0,r._)([(0,c.MZ)()],b.prototype,"state",null),(0,r._)([(0,c.MZ)({readOnly:!0})],b.prototype,"numberOfFeatureTemplates",null),(0,r._)([(0,c.MZ)({readOnly:!0})],b.prototype,"items",null),(0,r._)([(0,c.MZ)({readOnly:!0})],b.prototype,"selectedItem",void 0),(0,r._)([(0,c.MZ)()],b.prototype,"templateInfos",void 0),(0,r._)([(0,c.MZ)()],b.prototype,"updating",null),(0,r._)([(0,c.MZ)()],b.prototype,"view",void 0),b=(0,r._)([(0,d.$)("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],b);const w=b},79906:(e,t,n)=>{n.d(t,{$d:()=>m,GG:()=>S,N7:()=>h,Sx:()=>y,UQ:()=>_,cJ:()=>v,di:()=>C,dt:()=>g,f3:()=>k,k_:()=>p});var r=n(88102),i=n(58828),o=(n(21265),n(16804)),s=n(28473),a=n(22250),l=n(44827),c=n(6135),d=n(76945),u=n(38602);const f=new r.default("white");function p(e){if(!e)return 0;if((0,u.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.PN)((0,c.$4)(e)?.width)}function m(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function h(e){return e.resource?.href??""}function y(e,t){if(!e)return null;let n=null;return(0,u.wk)(e)?n=function(e){const t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(n="water"===e.type?e.color:e.material?e.material.color:null)})),n?new r.default(n):null}(e):(0,u.$y)(e)&&(n="cim"===e.type?(0,l.getCIMSymbolColor)(e):e.color?new r.default(e.color):null),n?v(n,t):null}function v(e,t){if(null==t||null==e)return e;const n=e.toRgba();return n[3]=n[3]*t,new r.default(n)}function g(e,t,n){e&&(t||null!=n)&&(t&&(t=new r.default(t)),(0,u.wk)(e)?function(e,t,n){const r=e.symbolLayers;if(!r)return;const i=e=>v(t=t??e??(null!=n?f:null),n);r.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=i(e.color);else{const t=null!=e.material?e.material.color:null,r=i(t);null==e.material?e.material=new d.N({color:r}):e.material.color=r,null!=n&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=v(e.outline.color,n))}}))}(e,t,n):(0,u.$y)(e)&&function(e,t,n){(t=t??e.color)&&(e.color=v(t,n)),null!=n&&"outline"in e&&e.outline?.color&&(e.outline.color=v(e.outline.color,n))}(e,t,n))}async function b(e,t){const r=e.symbolLayers;r&&await(0,i.jJ)(r,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const n=I(t);null!=n&&(e.size=n)}(e,t);break;case"path":!function(e,t){const n=w(t,s.Un,[e.width,void 0,e.height]);e.width=M(t[0],e.width,1,n),e.height=M(t[2],e.height,1,n)}(e,t);break;case"object":await async function(e,t){const{resourceSize:r,symbolSize:i}=await async function(e){const{computeObjectLayerResourceSize:t}=await n.e(28897).then(n.bind(n,28897)),r=await t(e,10),{width:i,height:o,depth:s}=e,a=[i,s,o];let l=1;for(let n=0;n<3;n++){const e=a[n];if(null!=e){l=e/r[n];break}}for(let n=0;n<3;n++)null==a[n]&&(a[n]=r[n]*l);return{resourceSize:r,symbolSize:a}}(e),o=w(t,r,i);e.width=M(t[0],i[0],r[0],o),e.depth=M(t[1],i[1],r[1],o),e.height=M(t[2],i[2],r[2],o)}(e,t)}}(e,t)))}function I(e){for(const t of e)if("number"==typeof t)return t;return null}function w(e,t,n){for(let r=0;r<3;r++){const i=e[r];switch(i){case"symbol-value":{const e=n[r];return null!=e?e/t[r]:1}case"proportional":break;default:if(i&&t[r])return i/t[r]}}return 1}function M(e,t,n,r){switch(e){case"proportional":return n*r;case"symbol-value":return null!=t?t:n;default:return e}}async function _(e,t){if(e&&t)return(0,u.wk)(e)?b(e,t):void((0,u.$y)(e)&&function(e,t){const n=I(t);if(null!=n)switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case"simple-line":e.width=n;break;case"text":e.font.size=n}}(e,t))}function S(e,t,n){if(e&&null!=t)if((0,u.wk)(e)){const r=e.symbolLayers;r&&r.forEach((e=>{if("object"===e.type)switch(n){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,u.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function C(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,a.zu)(t)}function k(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}},91046:(e,t,n)=>{function r(e){return"feature"===e.type}function i(e){return"group"===e.type}function o(e){return"preset"===e.type}n.d(t,{Xc:()=>i,sC:()=>r,vf:()=>o})}}]);