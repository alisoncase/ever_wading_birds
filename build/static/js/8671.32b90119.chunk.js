"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[8671],{8671:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var i=a(93800),d=a(6946),s=a(89129),r=a(90450),n=a(48602),o=(a(21265),a(50925),a(14746),a(75269)),l=a(3835),c=a(63080);let h=class extends((0,c.U)(d.default)){constructor(e){super(e),this.savedGraphics=new s.default,this.type="data-capture",this.pendingGraphics=new r.A}get collectionId(){return this.viewModel.collectionId}handleCreate(e){const{state:t,graphic:a,tool:i}=e,d=a?.geometry;if("complete"!==t||!a||!d)return;const{collectionId:r,viewModel:{dataCaptureLayer:n,currentBestFeature:o,imageGeometryField:c,oiObjectIdField:h,activeViewer:p,mode:u},pendingGraphics:v}=this,w=p?.imageSize;o&&c&&r&&h&&n&&w&&"none"!==u&&(function(e,t,a,i,d,r,n,o,c,h){e.sourceLayer=h,e.attributes=e.attributes??{},e.attributes[a]=btoa(JSON.stringify({geometry:(0,l.zT)(t.clone(),c,o).toJSON()})),e.attributes[i]=d.attributes.objectId,r.has(n)||r.set(n,new s.default),r.get(n).add(e)}(a,d,c,h,o,v,r,w,u,n),this.viewModel.emit("after-data-capture-complete",{pendingGraphics:v.get(r)?.toArray()??null}),this.viewModel.sketch?.create(i))}handleDelete(e){const{dataCaptureLayer:t}=this.viewModel;if(!t)return;const{graphics:a}=e;this.pendingGraphics.get(t.id)?.removeMany(a),this.savedGraphics.removeMany(a),this.viewModel.deleteDataCaptureFeatures(function(e,t){return e.map((e=>{let{attributes:a}=e;return t?a[t]:null})).filter(Boolean)}(a,t.objectIdField))}handleDestroy(){const{dataCaptureLayer:e}=this.viewModel;e&&(this.viewModel.stopDataCapture(),this.savedGraphics.removeAll(),this.pendingGraphics=null)}handleUpdate(e){const{toolEventInfo:t,state:a,graphics:i}=e;if(t)this.viewModel.sketch?.undo();else switch(a){case"complete":this.viewModel.emit("deselect-data-capture-features",{graphics:i});break;case"start":this.viewModel.emit("select-data-capture-features",{graphics:i})}}};(0,i._)([(0,n.MZ)()],h.prototype,"collectionId",null),(0,i._)([(0,n.MZ)()],h.prototype,"savedGraphics",void 0),(0,i._)([(0,n.MZ)()],h.prototype,"type",void 0),(0,i._)([(0,n.MZ)()],h.prototype,"pendingGraphics",void 0),h=(0,i._)([(0,o.$)("esri.widgets.OrientedImageryViewer.adapters.sketch.DataCaptureAdapter")],h);const p=h},63080:(e,t,a)=>{a.d(t,{U:()=>o});var i=a(93800),d=a(79953),s=a(48602),r=(a(21265),a(50925),a(14746),a(75269));const n="sketch-handles",o=e=>{let t=class extends e{initialize(){this.addHandles((0,d.watch)((()=>this.viewModel?.sketch),(e=>{this.removeHandles(n),e&&this.addHandles([e.on("create",(e=>this.handleCreate(e))),e.on("update",(e=>this.handleUpdate(e))),e.on("undo",(e=>this.handleUndo(e))),e.on("redo",(e=>this.handleRedo(e))),e.on("delete",(e=>this.handleDelete(e))),e.on("destroy",(()=>this.handleDestroy())),e.on("duplicate",(e=>this.handleDuplicate(e))),(0,d.watch)((()=>e.activeComponent),(e=>{"draw-2d"!==e?.type&&"draw-3d"!==e?.type||(e.elevationLockOnVertexAddDisabled=!0)}),d.syncAndInitial)],n)}),d.syncAndInitial))}handleCreate(e){}handleUpdate(e){}handleUndo(e){}handleRedo(e){}handleDelete(e){}handleDestroy(){}handleDuplicate(e){}};return(0,i._)([(0,s.MZ)()],t.prototype,"type",void 0),(0,i._)([(0,s.MZ)()],t.prototype,"viewModel",void 0),t=(0,i._)([(0,r.$)("esri.widgets.OrientedImageryViewer.mixins.SketchHandlerMixin")],t),t}}}]);