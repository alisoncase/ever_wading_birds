"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[9538],{79538:(e,t,n)=>{n.d(t,{EG:()=>m,Ll:()=>$,R3:()=>w,UH:()=>u,aM:()=>p,fs:()=>d,i0:()=>T});var i=n(66845),r=n(95011),o=n(96247),s=(n(76983),n(73210)),a=n(40731);const u=",",l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},f=new Set(["integer","small-integer"]);let c=null;function d(e){return(0,r.vE)(e)||(0,r.zD)(e)||(0,r.Ah)(e)}async function m(e){const{field:t,field2:n,field3:i,normalizationField:r,valueExpression:s}=e;let a=[];if(s){if(!c){const{arcadeUtils:e}=await(0,o.lw)();c=e}a=c.extractFieldNames(s)}return t&&a.push(t),n&&a.push(n),i&&a.push(i),r&&a.push(r),a}function g(e){return String(e).padStart(2,"0")}function h(e,t,n){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${g((n?e.getMonth():e.getUTCMonth())+1)}-${g(n?e.getDate():e.getUTCDate())} ${g(n?e.getHours():e.getUTCHours())}:${g(n?e.getMinutes():e.getUTCMinutes())}:${g(n?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function p(e,t,n,i){const{hasQueryEngine:r}=e,o=`(${h(n,y(e,n),r)} - ${h(t,y(e,t),r)})`;let s=l[i],a="/";return s<1&&(s=1/s,a="*"),{sqlExpression:1===s?o:`(${o} ${a} ${s})`,sqlWhere:null}}function y(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const n=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,r.vE)(n))return"field"}}function w(e,t){const n=t&&e.getField(t);return!!n&&f.has(n.type)}function $(e){return`cast(${e} as float)`}function T(e,t){const{format:n,timeZoneOptions:r,fieldType:o}=t??{};let u,l;if(r&&({timeZone:u,timeZoneName:l}=(0,a.hv)(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,(0,i.J2)(n||"short-date-short-time"),o)),"string"==typeof e&&isNaN(Date.parse("time-only"===o?`1970-01-01T${e}Z`:e)))return e;switch(o){case"date-only":{const t=(0,i.J2)(n||"short-date");return"string"==typeof e?(0,i.iS)(e,{...t}):(0,i.Yq)(e,{...t,timeZone:s.n$})}case"time-only":{const t=(0,i.J2)(n||"short-time");return"string"==typeof e?(0,i.F8)(e,t):(0,i.Yq)(e,{...t,timeZone:s.n$})}case"timestamp-offset":{if(!u&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=n||r?(0,i.J2)(n||"short-date-short-time"):void 0,o=t?{...t,timeZone:u,timeZoneName:l}:void 0;return"string"==typeof e?(0,i.Ey)(e,o):(0,i.Yq)(e,o)}default:{const t=n||r?(0,i.J2)(n||"short-date-short-time"):void 0;return(0,i.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:u,timeZoneName:l}:void 0)}}}}}]);