"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[71976],{30091:(e,t,r)=>{r.d(t,{$1:()=>m,CR:()=>f,MB:()=>d,PC:()=>y,Yx:()=>u,bP:()=>h});var a=r(36357),s=r(70576),n=r(95011);class o{constructor(){this.code=null,this.description=null}}class i{constructor(e){this.error=new o,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function u(e){return new i(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function h(e){return new l(e)}const c=new Set;function d(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];c.clear();for(const s in r){const o=e.get(s);if(!o)continue;const i=p(o,r[s]);if(c.add(o.name),o&&(a||o.editable)){const e=(0,n.validateFieldValue)(o,i);if(e)return u((0,n.validationErrorToString)(e,o,i));t[o.name]=i}}for(const s of e.requiredFields??[])if(!c.has(s.name))return u(`missing required field "${s.name}"`);return null}function p(e,t){let r=t;return(0,n.isNumericField)(e)&&"string"==typeof t?r=parseFloat(t):(0,n.isStringField)(e)&&null!=t&&"string"!=typeof t?r=String(t):(0,n.isDateField)(e)&&"string"==typeof t&&(r=(0,a._U)(t)),(0,n.sanitizeNullFieldValue)(r)}let g;function f(e,t){if(!e||!(0,s.fn)(t))return e;if("rings"in e||"paths"in e){if(null==g)throw new TypeError("geometry engine not loaded");return g.simplify(t,e)}return e}async function m(e,t){!(0,s.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==g&&(g=await Promise.all([r.e(31329),r.e(51805)]).then(r.bind(r,32984))),g}()}const y={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:["COUNT","SUM","AVG","VAR","STDDEV","MIN","MAX","PERCENTILE_CONT","PERCENTILE_DISC","CentroidAggregate","EnvelopeAggregate","ConvexHullAggregate"],supportedNormalizationTypes:["field","log","naturalLog","percentOfTotal","squareRoot"]}},71976:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var a=r(58828),s=r(74719),n=r(50925),o=r(49959),i=r(21965),u=r(70576),l=r(81765),h=r(33657),c=r(78670),d=r(1413),p=r(13791),g=r(42958),f=r(30091),m=r(7641),y=r(76747),_=r(69943),w=r(73210);const C="esri.layers.WFSLayer";class x{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{getFeatureUrl:r,getFeatureOutputFormat:a,fields:n,geometryType:i,featureType:u,maxRecordCount:l,maxTotalRecordCount:h,maxPageCount:g,objectIdField:f,customParameters:_}=e,{spatialReference:C,getFeatureSpatialReference:x}=(0,m.getGetFeatureSpatialReference)(r,u,e.spatialReference);try{await(0,d.Nk)(x,C)}catch{throw new s.default("unsupported-projection","Projection not supported",{inSpatialReference:x,outSpatialReference:C})}(0,o.throwIfAborted)(t),this._customParameters=_,this._featureType=u,this._fieldsIndex=y.default.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some((e=>"esriFieldTypeDate"===e.type))?{timeZoneIANA:w.n$}:null}),this._geometryType=i,this._getFeatureUrl=r,this._getFeatureOutputFormat=a,this._getFeatureSpatialReference=x,this._maxRecordCount=l,this._maxTotalRecordCount=h,this._maxPageCount=g,this._objectIdField=f,this._spatialReference=C;let R=await this._snapshotFeatures(t);if(R.errors.length>0&&(this._supportsPagination=!1,R=await this._snapshotFeatures(t),R.errors.length>0))throw R.errors[0];return this._queryEngine=new p.do({fieldsIndex:this._fieldsIndex,geometryType:i,hasM:!1,hasZ:!1,objectIdField:f,spatialReference:C,timeInfo:null,featureStore:new c.A({geometryType:i,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(R.features),{warnings:F(R),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new s.default("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),(await this._queryEngine.executeQueryForIds(e,t.signal)).filter(_.Et)}async queryExtent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),(0,h.J)(this._queryEngine,e,t.signal)}async queryAttributeBins(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeAttributeBinsQuery(e,t.signal)}async refresh(e){return this._customParameters=e.customParameters,this._maxRecordCount=e.maxRecordCount,this._maxTotalRecordCount=e.maxTotalRecordCount,this._maxPageCount=e.maxPageCount,this._snapshotTask?.abort(),this._snapshotTask=(0,a.UT)((e=>this._snapshotFeatures({signal:e}))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const t of F(e))n.A.getLogger(C).warn(new i.A("wfs-layer:refresh-warning",t.message,t.details));e.errors?.length&&n.A.getLogger(C).warn(new i.A("wfs-layer:refresh-error","Refresh completed with errors",{errors:e.errors}))}),(()=>{this._queryEngine.featureStore.clear()})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=e?.signal,r=this._maxTotalRecordCount,a=this._maxPageCount,s=this._supportsPagination?await(0,m.getFeatureCount)(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let n=[];const i=[];if(null==s)try{n=await this._singleQuery(t)}catch(u){(0,o.isAbortError)(u)||i.push(u)}else{const e=Math.min(s,r),u=function*(e,t,r){for(let a=0;a<t;a++)yield e._pageQuery(a,r)}(this,Math.max(1,Math.min(Math.ceil(e/this._maxRecordCount),a)),t);await Promise.allSettled(Array.from({length:10}).map((()=>async function(e,t,r){let s=e.next();for(;!s.done;){try{const e=await s.value;t.push(...e)}catch(a){(0,o.isAbortError)(a)||r.push(a)}s=e.next()}}(u,n,i))))}return(0,o.throwIfAborted)(t),{features:n,totalRecordCount:s,maxTotalRecordCount:r,maxPageCount:a,errors:i}}async _singleQuery(e){const t=await(0,m.getFeature)(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:e});return this._processGeoJSON(t,{signal:e})}async _pageQuery(e,t){const r=e*this._maxRecordCount,a=await(0,m.getFeature)(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:r,count:this._maxRecordCount,signal:t});return this._processGeoJSON(a,{startIndex:r,signal:t})}_processGeoJSON(e,t){(0,g.sO)(e,this._getFeatureSpatialReference.wkid);const{startIndex:r,signal:a}=t;(0,o.throwIfAborted)(a);const s=(0,g.bd)(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!(0,u.aI)(this._spatialReference,this._getFeatureSpatialReference))for(const o of s)null!=o.geometry&&(o.geometry=(0,l.Ux)((0,d.Cv)((0,l.zv)(o.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let n=r??1;for(const o of s){const e={};(0,f.MB)(this._fieldsIndex,e,o.attributes,!0),o.attributes=e,null==e[this._objectIdField]&&(o.objectId=e[this._objectIdField]=n++)}return s}}function F(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:"wfs-layer:maxRecordCount-too-low",message:`Could only fetch ${e.features.length} of ${e.totalRecordCount} in ${e.maxPageCount} queries. Try increasing the value of WFSLayer.maxRecordCount.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:"wfs-layer:large-dataset",message:`The number of ${e.totalRecordCount} features exceeds the maximum allowed of ${e.maxTotalRecordCount}.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}}}]);