"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[76254],{1262:(e,t,i)=>{i.d(t,{A:()=>C});var n=i(93800),s=i(17741),o=i(79953),a=i(56612),r=i(48602),l=(i(21265),i(50925),i(14746),i(75269)),d=i(27811),c=i(41514),u=i(60266),p=i(49403),h=i(50821),m=(i(17745),i(76697)),v=i(87118),_=i(81558);const g="esri-feature-utility-network-associations",y=`${g}__loading-container`,b={base:g,listContainer:`${g}__list`,loadingContainer:y,loadingContainerSticky:`${y}--sticky`};let f=class extends d.default{constructor(e,t){super(e,t),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new _.A,this.messages=null,this.messagesCommon=null,this.visibleElements=new c.A}initialize(){this._featureElementInfo=new u.A,this.addHandles([(0,o.watch)((()=>[this.viewModel.description,this.viewModel.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),o.initial)])}loadDependencies(){return(0,p.W)({icon:()=>Promise.resolve().then(i.bind(i,92439)),list:()=>Promise.all([i.e(46138),i.e(89939),i.e(18170)]).then(i.bind(i,18170)),"list-item":()=>Promise.all([i.e(73373),i.e(14960)]).then(i.bind(i,28898)),loader:()=>Promise.resolve().then(i.bind(i,23173)),notice:()=>i.e(51132).then(i.bind(i,51132))})}destroy(){this._featureElementInfo=(0,s.pR)(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){const{state:e}=this.viewModel;return(0,v.K)("div",{class:this.classes(b.base,h.D.widget)},this._featureElementInfo?.render(),"loading"===e?this._renderLoading():"disabled"===e?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,v.K)("div",{class:b.loadingContainerSticky,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,v.K)("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return(0,v.K)("div",{class:b.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){return(0,v.K)("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,v.K)("div",{slot:"message"},this.messages?.noAssociations))}_renderAssociationType(e){const{viewModel:t}=this,i=this._getAssociationTypeTitle(e);return(0,v.K)("calcite-list-item",{description:(0,a._e)(e.description),key:`association-type-${e.type}`,label:(0,a._e)(i),value:e.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:t,listType:e,title:i})},(0,v.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderAssociations(e){const{viewModel:t}=this;return"featureForm"===t.source||t.getFeatureCountForAssociationType(e.type)>0?this._renderAssociationType(e):void 0}_renderContent(){const{messages:e,viewModel:t}=this,{state:i,associationTypes:n}=t;return(0,v.K)("div",{class:b.listContainer,key:"list-container"},"ready"===i?(0,v.K)("div",null,(0,v.K)("calcite-list",{displayMode:"flat",label:e?.associationsList},n.map((e=>this._renderAssociations(e))))):null,this._renderStickyLoading())}_getAssociationTypeTitle(e){const{messages:t}=this;if(e.title)return e.title;switch(e.type){case"attachment":return t.associationsAttachments;case"connectivity":return t.associationsConnectivity;case"structure":return t.associationsStructure;case"content":return t.associationsContents;case"container":return t.associationsContainer}}_setupFeatureElementInfo(){const{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,n=t.title&&this.title;this._featureElementInfo?.set({description:i,title:n,headingLevel:e})}};(0,n._)([(0,r.MZ)({constructOnly:!0})],f.prototype,"onSelectAssociationType",void 0),(0,n._)([(0,r.MZ)()],f.prototype,"flowType",void 0),(0,n._)([(0,r.MZ)()],f.prototype,"flowItems",void 0),(0,n._)([(0,r.MZ)()],f.prototype,"parentFeatureViewModel",void 0),(0,n._)([(0,r.MZ)()],f.prototype,"featureVisibleElements",void 0),(0,n._)([(0,r.MZ)()],f.prototype,"description",null),(0,n._)([(0,r.MZ)()],f.prototype,"headingLevel",void 0),(0,n._)([(0,r.MZ)()],f.prototype,"title",null),(0,n._)([(0,r.MZ)({type:_.A})],f.prototype,"viewModel",void 0),(0,n._)([(0,r.MZ)(),(0,m.G)("esri/widgets/Feature/t9n/Feature")],f.prototype,"messages",void 0),(0,n._)([(0,r.MZ)(),(0,m.G)("esri/t9n/common")],f.prototype,"messagesCommon",void 0),(0,n._)([(0,r.MZ)({type:c.A,nonNullable:!0})],f.prototype,"visibleElements",void 0),f=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],f);const C=f},9137:(e,t,i)=>{i.d(t,{D:()=>r,S:()=>d});var n=i(64682),s=i(50821),o=i(17745),a=i(87118);function r(e,t){let{level:i,class:n,...r}=e;const d=l(i);return(0,a.K)(`h${d}`,{...r,"aria-level":String(d),class:(0,o.Ly)(s.D.heading,n),role:"heading"},t)}function l(e){return(0,n.qE)(Math.ceil(e),1,6)}function d(e){return l(e+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}},18771:(e,t,i)=>{i.d(t,{w:()=>s});i(88677);var n=i(23224);function s(e){const{percentAlong:t}=e;return null==t?"":(0,n.ZV)(t,{style:"percent",maximumFractionDigits:2})}},39097:(e,t,i)=>{function n(e){const{associationType:t}=e;return"connectivity"===t||"junction-junction-connectivity"===t||"junction-edge-from-connectivity"===t||"junction-edge-midspan-connectivity"===t||"junction-edge-to-connectivity"===t}i.d(t,{s:()=>n})},41514:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(93800),s=i(6946),o=i(48602),a=(i(21265),i(50925),i(14746),i(75269));let r=class extends s.default{constructor(e){super(e),this.title=!0,this.description=!0}};(0,n._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],r.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],r.prototype,"description",void 0),r=(0,n._)([(0,a.$)("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],r);const l=r},58455:(e,t,i)=>{i.d(t,{A:()=>g});var n=i(93800),s=(i(88677),i(90450)),o=i(79953),a=i(48602),r=(i(21265),i(50925),i(14746),i(75269)),l=i(27811),d=i(49403),c=(i(17745),i(76697)),u=i(87118),p=i(81558),h=i(99961);const m="esri-utility-network-association-list",v={featureObserver:`${m}__feature-observer`,filterContainer:`${m}__filter-container`,limitNoticeContainer:`${m}__limit-notice-container`,loadingContainer:`${m}__loading-container`};let _=class extends l.default{constructor(e,t){super(e,t),this._isFeatureCountNoticeOpen=!0,this._observer=new IntersectionObserver((e=>{let[t]=e;t?.isIntersecting&&this._increaseFeaturePage()}),{root:window.document}),this._observerNode=null,this.featuresPerPage=50,this.filterText="",this.headingLevel=5,this.maxFeatureCount=1e3,this.messagesFeature=null,this.messagesCommon=null,this.selectedLayer=null,this.tooltipReferenceMap=new s.A,this.viewModel=new p.A}initialize(){this.setUpObserver()}loadDependencies(){return(0,d.W)({icon:()=>Promise.resolve().then(i.bind(i,92439)),input:()=>i.e(46138).then(i.bind(i,46138)),loader:()=>Promise.resolve().then(i.bind(i,23173)),notice:()=>i.e(51132).then(i.bind(i,51132))})}destroy(){this.tooltipReferenceMap.clear()}get associatedFeatureCount(){const e=this.viewModel.associationViewModels,t=this.selectedLayer?e.get(this.selectedLayer):null;return t?t.length:0}set currentFeaturePage(e){const{featuresPerPage:t,associatedFeatureCount:i}=this,n=Math.ceil(i/t)||1,s=Math.max(Math.min(e,n),1);this._set("currentFeaturePage",s)}get currentFeaturePage(){return this._get("currentFeaturePage")??1}get endIndex(){const{currentFeaturePage:e,featuresPerPage:t,maxFeatureCount:i}=this;return Math.min(e*t,i)}renderConnectivityIcon(e,t){const{tooltipReferenceMap:i}=this;let n;switch(e){case"junction-edge-from-connectivity":n="connection-end-left";break;case"junction-edge-to-connectivity":n="connection-end-right";break;case"junction-edge-midspan-connectivity":n="connection-middle";break;default:n="connection-to-connection"}return(0,u.K)("calcite-icon",{afterCreate:e=>i.set(t,e),afterRemoved:()=>i.delete(t),icon:n,scale:"s",slot:"content-start"})}renderFeatureCountWarning(){const{associatedFeatureCount:e,maxFeatureCount:t,messagesFeature:i}=this;return e>t?(0,u.K)("calcite-notice",{class:this._isFeatureCountNoticeOpen?v.limitNoticeContainer:void 0,closable:!0,icon:"information",kind:"info",open:!0,scale:"s",width:"full",onCalciteNoticeBeforeOpen:()=>this._isFeatureCountNoticeOpen=!0,onCalciteNoticeClose:()=>this._isFeatureCountNoticeOpen=!1},(0,u.K)("div",{slot:"title"},i.associationsLimitNoticeTitle),(0,u.K)("div",{slot:"message"},(0,h.V)(i.associationsLimitNoticeMessage,{number:t}))):null}renderFeatureObserver(){return(0,u.K)("div",{afterCreate:this._onObserverCreate,bind:this,class:v.featureObserver,key:"feature-observer"})}renderFilter(){return(0,u.K)("div",{class:v.filterContainer,key:"filter"},(0,u.K)("calcite-input",{icon:"search",placeholder:this.messagesFeature.associationFilterPlaceholder,type:"search",onCalciteInputInput:e=>{this.filterText=e.currentTarget.value.trim().toLowerCase(),this.currentFeaturePage=1}}))}renderLoading(){return(0,u.K)("div",{class:v.loadingContainer,key:"loading-container"},this.renderLoadingIcon())}renderLoadingIcon(){return(0,u.K)("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}getConnectivityTooltip(e){const{messagesFeature:t}=this;switch(e){case"connectivity":case"junction-junction-connectivity":return t.associationsJunctionJunction;case"junction-edge-from-connectivity":return t.associationsJunctionEdgeFrom;case"junction-edge-midspan-connectivity":return t.associationsJunctionEdgeMidspan;case"junction-edge-to-connectivity":return t.associationsJunctionEdgeTo;default:return""}}setUpObserver(){this.addHandles((0,o.watch)((()=>this._observerNode),(()=>this._onObserverChange())))}_increaseFeaturePage(){this.currentFeaturePage++}async _onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);const{state:e,showAllEnabled:t}=this.viewModel;this._observerNode&&"ready"===e&&t&&this._observer.observe(this._observerNode)}_onObserverCreate(e){this._observerNode=e}};(0,n._)([(0,a.MZ)()],_.prototype,"_observer",void 0),(0,n._)([(0,a.MZ)()],_.prototype,"_observerNode",void 0),(0,n._)([(0,a.MZ)()],_.prototype,"associatedFeatureCount",null),(0,n._)([(0,a.MZ)()],_.prototype,"currentFeaturePage",null),(0,n._)([(0,a.MZ)()],_.prototype,"endIndex",null),(0,n._)([(0,a.MZ)()],_.prototype,"featuresPerPage",void 0),(0,n._)([(0,a.MZ)()],_.prototype,"filterText",void 0),(0,n._)([(0,a.MZ)()],_.prototype,"headingLevel",void 0),(0,n._)([(0,a.MZ)()],_.prototype,"maxFeatureCount",void 0),(0,n._)([(0,a.MZ)(),(0,c.G)("esri/widgets/Feature/t9n/Feature")],_.prototype,"messagesFeature",void 0),(0,n._)([(0,a.MZ)(),(0,c.G)("esri/t9n/common")],_.prototype,"messagesCommon",void 0),(0,n._)([(0,a.MZ)()],_.prototype,"selectedLayer",void 0),(0,n._)([(0,a.MZ)()],_.prototype,"tooltipReferenceMap",void 0),(0,n._)([(0,a.MZ)({type:p.A})],_.prototype,"viewModel",void 0),_=(0,n._)([(0,r.$)("esri.widgets.support.UtilityNetworkAssociations.UtilityNetworkAssociationList")],_);const g=_},58683:(e,t,i)=>{function n(e){return"junction-edge-midspan-connectivity"===e.associationType}i.d(t,{S:()=>n})},60266:(e,t,i)=>{i.d(t,{A:()=>p});var n=i(93800),s=i(48602),o=(i(21265),i(50925),i(14746),i(75269)),a=i(27811),r=i(9137),l=(i(17745),i(87118));const d="esri-feature-element-info",c={base:d,title:`${d}__title`,description:`${d}__description`};let u=class extends a.default{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,l.K)("div",{class:c.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?(0,l.K)(r.D,{class:c.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?(0,l.K)("div",{class:c.description,innerHTML:e,key:"description"}):null}};(0,n._)([(0,s.MZ)()],u.prototype,"description",void 0),(0,n._)([(0,s.MZ)()],u.prototype,"headingLevel",void 0),(0,n._)([(0,s.MZ)()],u.prototype,"title",void 0),u=(0,n._)([(0,o.$)("esri.widgets.Feature.support.FeatureElementInfo")],u);const p=u},62541:(e,t,i)=>{i.d(t,{d:()=>n});const n={danger:"exclamation-mark-circle",info:"information",success:"check",warning:"exclamation-mark-triangle",brand:void 0,neutral:void 0,inverse:void 0}},65946:(e,t,i)=>{i.d(t,{D6:()=>c,XG:()=>u});var n=i(49403),s=i(9137),o=i(62541),a=i(17745),r=i(87118);const l="esri-editor__prompt",d={base:l,header:`${l}__header`,heading:`${l}__header__heading`,message:`${l}__message`,divider:`${l}__divider`,actions:`${l}__actions`,halfWidthButton:`${l}__half-width-button`},c=()=>(0,n.W)({button:()=>Promise.resolve().then(i.bind(i,20423)),icon:()=>Promise.resolve().then(i.bind(i,92439)),scrim:()=>i.e(86836).then(i.bind(i,64455)),label:()=>i.e(60216).then(i.bind(i,60216)),"radio-button":()=>i.e(35906).then(i.bind(i,35906)),"radio-button-group":()=>i.e(31544).then(i.bind(i,31544))});function u(e){let{actions:t,context:i,headingLevel:n,message:l,title:c,...u}=e;const{primary:p,secondary:h}=t;let m;switch(i){case"danger":m="danger";break;case"info":m="brand";break;default:m="neutral"}const v=(0,r.K)("calcite-button",{afterCreate:e=>(0,a.Z6)(e),appearance:"solid",classes:{[d.halfWidthButton]:!!h},"data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:m,onclick:p.action,width:"full"},p.label),_=h&&(0,r.K)("calcite-button",{appearance:"outline",class:d.halfWidthButton,"data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:m,onclick:h.action,width:"full"},h.label);return(0,r.K)("calcite-scrim",{"data-testid":"prompt",key:"prompt"},(0,r.K)("div",{class:`${d.base}--${i}`},(0,r.K)("div",{class:d.header},(0,r.K)("calcite-icon",{icon:o.d.warning}),(0,r.K)(s.D,{class:d.heading,level:n},c)),(0,r.K)("div",{class:d.message},l),function(e){let{radios:t,onRadioSelection:i,defaultRadioSelection:n}=e;return t?.length?(0,r.K)("calcite-radio-button-group",{name:"PromptChoiceList"},t.map((e=>(0,r.K)("calcite-label",{layout:"inline"},(0,r.K)("calcite-radio-button",{checked:e.value===n,value:e.value,onCalciteRadioButtonChange:()=>i?.(e.value)}),e.label)))):void 0}(u)??(0,r.K)("div",{class:d.divider}),(0,r.K)("div",{class:d.actions},_,v)))}},72735:(e,t,i)=>{function n(e,t,i){const{associationType:n}=e;switch(n){case"attachment":return"to"===t?i.attachment:i.structure;case"containment":return"to"===t?i.content:i.container;case"junction-edge-from-connectivity":case"junction-edge-to-connectivity":case"junction-edge-midspan-connectivity":case"junction-junction-connectivity":case"connectivity":return i.connectivity}}i.d(t,{o:()=>n})},76254:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ie});var n=i(93800),s=(i(88677),i(62631)),o=(i(21265),i(50925)),a=i(45622),r=i(49959),l=i(79953),d=i(48602),c=i(75269),u=i(95011),p=i(78076),h=i(69943),m=i(27811),v=i(65946),_=i(1262),g=i(92471);const y="esri-feature-form",b=`${y}__group`,f=`${y}__input`,C=`${y}__related-records`,F={base:y,form:`${y}__form`,formHeader:`${y}__form-header`,label:`${y}__label`,labelTextContent:`${y}__label-text-content`,fieldInput:`${f}`,inputRadio:`${f}--radio`,inputRadioGroup:`${f}--radio-group`,inputRadioLabel:`${f}--radio-label`,inputDisabled:`${f}--disabled`,inputSwitch:`${f}--switch`,centeredButton:`${y}__centered-button`,description:`${y}__description-text`,listObserver:`${y}__list-observer`,relatedRecordsHeader:`${C}_header`,relatedRecordsLabel:`${C}_label`,relatedRecordsList:`${C}_list`,dateInputContainer:`${y}__date-input-container`,textElement:`${y}__text-element`,group:b,groupSequential:`${b}--sequential`,groupActive:`${b}--active`};var w=i(41327),M=i(94495),k=i(6946);i(14746);let I=class extends k.default{constructor(e){super(e),this.associationDetails=!0}};(0,n._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],I.prototype,"associationDetails",void 0),I=(0,n._)([(0,c.$)("esri.widgets.FeatureForm.VisibleElements")],I);const L=I;var R=i(56612),K=i(73585),A=i(17745),O=i(87118),T=i(72735),N=i(39652);function x(e){const{feature:t,heading:i}=e,n=i||(0,N.R)(t),s=function(e){const{feature:t,association:i,associationType:n,messages:s}=e,{attachment:o,connectivity:a,container:r,content:l,structure:d}=s,c=t.sourceLayer;if(!i&&!n)return;if(!i)switch(n){case"attachment":return o;case"container":return r;case"connectivity":return a;case"content":return l;case"structure":return d}if(!c)return;const u=t.attributes[c.globalIdField]===i.fromNetworkElement.globalId?"from":"to";return(0,T.o)(i,u,s)}(e)??"";return(0,O.K)("calcite-block",{description:s,heading:n})}let Z=class extends k.default{constructor(e){super(e),this.associationDetails=!0}};(0,n._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],Z.prototype,"associationDetails",void 0),Z=(0,n._)([(0,c.$)("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.VisibleElements")],Z);const D=Z;var S=i(49403),V=i(50821),$=i(9137),E=i(76697),P=i(81558),U=i(58455),G=i(18771),H=i(39097),W=i(58683),B=i(99961);const j="esri-feature-form-utility-network-association-list",q={base:j,header:`${j}__header`,headingContent:`${j}__heading-content`,listContainer:`${j}__list-container`};let z=class extends U.A{constructor(e,t){super(e,t),this._isLoadingSelectFeature=!1,this.associationInput=null,this.headingLevel=5,this.messagesFeatureForm=null,this.onSelectLayer=()=>{},this.onSelectFeature=async()=>{},this.onAddAssociation=()=>{},this.viewModel=new P.A,this.visibleElements=new D}initialize(){this.setUpObserver()}loadDependencies(){return(0,S.W)({chip:()=>i.e(60382).then(i.bind(i,60382)),fab:()=>i.e(25905).then(i.bind(i,25905)),icon:()=>Promise.resolve().then(i.bind(i,92439)),list:()=>Promise.all([i.e(46138),i.e(89939),i.e(18170)]).then(i.bind(i,18170)),"list-item":()=>Promise.all([i.e(73373),i.e(14960)]).then(i.bind(i,28898)),tooltip:()=>Promise.resolve().then(i.bind(i,75703))})}get associatedFeatureCount(){const{associationInput:e}=this;if(!e)return 0;const{associatedFeatureInfos:t,associatedLayer:i}=e,n=i?t.get(i):null;return n?n.length:0}render(){const{associationInput:e}=this;if(!e)return(0,O.K)("div",{class:this.classes(q.base,V.D.widget)});const{associatedLayer:t}=e,{state:i}=this.viewModel;return(0,O.K)("div",{class:this.classes(q.base,V.D.widget)},"loading"===i||"querying"===i?this.renderLoading():t?this._renderFeatureList(e,t):this._renderLayerList(e))}_renderLayerList(e){const{associatedFeatureInfos:t,editable:i}=e;return(0,O.K)("div",{class:q.listContainer},(0,O.K)("calcite-list",{label:this.messagesFeatureForm?.associations.associatedLayers},Array.from(t.keys(),(t=>this._renderLayerItem(e,t)))),i?(0,O.K)("calcite-fab",{appearance:"outline-fill",icon:"plus",key:`${e.uid}-add-button`,kind:"neutral",onclick:()=>this.onAddAssociation({feature:e.feature,associationType:e.activeAssociationType,utilityNetwork:e.utilityNetwork}),text:this.messagesCommon.add,textEnabled:!0}):null)}_renderFeatureList(e,t){return(0,O.K)(O.w,null,this._renderHeader(e,t),(0,O.K)("div",{class:q.listContainer},this.renderFeatureCountWarning(),(0,O.K)("calcite-list",{label:this.messagesFeatureForm?.associations.associatedFeatures},this._renderAssociatedFeatureListPage(e,t),this.renderFeatureObserver())))}_renderLayerTitle(e){return e.title?(0,O.K)($.D,{key:"title",level:this.headingLevel},(0,O.K)("div",{class:q.headingContent},(0,O.K)("calcite-icon",{icon:"layer"}),e.title)):null}_renderTotal(e,t){const{messagesFeature:i}=this,{associatedFeatureInfos:n}=e,s=n.get(t),o=(0,B.V)(i?.numberRecords,{number:s?.length??"0"});return(0,O.K)("div",{key:t.id},o)}_renderHeader(e,t){const{messagesFeatureForm:i}=this,{activeAssociationType:n,featureItem:s,feature:o}=e;return(0,O.K)("div",{class:q.header,key:"filter"},this.visibleElements.associationDetails?(0,O.K)(x,{associationType:n?.type,feature:o,heading:s?.label,messages:i.associations}):void 0,this._renderLayerTitle(t),this.renderFilter(),this._renderTotal(e,t))}_renderAssociatedFeatureListPage(e,t){const{filterText:i,endIndex:n}=this,s=this.messagesCommon.untitled,o=e.associatedFeatureInfos.get(t)?.filter((e=>(0,w.vp)(e,s).toLowerCase().includes(i)??!1)).slice(0,n).toArray()??[];return[...this._renderTooltips(o),...this._renderAssociatedFeatureList(o)]}_renderItemTooltip(e){const{tooltipReferenceMap:t}=this,i=e.feature.uid.toString();return(0,H.s)(e.association)?(0,O.K)("calcite-tooltip",{key:`tooltip-${i}`,overlayPositioning:"fixed",referenceElement:t.get(i)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){const t=this.messagesCommon.untitled,i=(0,w.vp)(e,t),n=e.feature.uid.toString();return(0,O.K)("calcite-list-item",{description:(0,R._e)(e.terminalName??""),key:`associated-feature-type-${n}`,label:(0,R._e)(i),onCalciteListItemSelect:()=>this._selectAssociation(e)},(0,H.s)(e.association)?this.renderConnectivityIcon(e.association.associationType,n):null,(0,W.S)(e.association)?(0,O.K)("calcite-chip",{label:(0,G.w)(e.association),scale:"s",slot:"content-end"},(0,G.w)(e.association)):null,(0,O.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderTooltips(e){return e.map((e=>this._renderItemTooltip(e)))}_renderAssociatedFeatureList(e){return e.map((e=>this._renderAssociatedFeature(e)))}_renderLayerItem(e,t){const{associatedFeatureInfos:i}=e,n=i.get(t)?.length??0;return(0,O.K)("calcite-list-item",{key:`${t.id}-show-all`,label:t.title??this.messagesCommon.untitled,open:!0,value:t.id,onCalciteListItemSelect:()=>this._showAllAssociations(t)},(0,O.K)("calcite-chip",{label:n.toString(),scale:"s",slot:"content-end"},n),(0,O.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}async _selectAssociation(e){this._isLoadingSelectFeature||(this._isLoadingSelectFeature=!0,await this.onSelectFeature({feature:e.feature,association:e.association}),this._isLoadingSelectFeature=!1)}_showAllAssociations(e){this.onSelectLayer({layer:e,associationInput:this.associationInput})}};(0,n._)([(0,d.MZ)()],z.prototype,"associatedFeatureCount",null),(0,n._)([(0,d.MZ)({type:K.default})],z.prototype,"associationInput",void 0),(0,n._)([(0,d.MZ)()],z.prototype,"headingLevel",void 0),(0,n._)([(0,d.MZ)(),(0,E.G)("esri/widgets/FeatureForm/t9n/FeatureForm")],z.prototype,"messagesFeatureForm",void 0),(0,n._)([(0,d.MZ)({constructOnly:!0})],z.prototype,"onSelectLayer",void 0),(0,n._)([(0,d.MZ)({constructOnly:!0})],z.prototype,"onSelectFeature",void 0),(0,n._)([(0,d.MZ)({constructOnly:!0})],z.prototype,"onAddAssociation",void 0),(0,n._)([(0,d.MZ)({type:P.A})],z.prototype,"viewModel",void 0),(0,n._)([(0,d.MZ)({type:D,nonNullable:!0})],z.prototype,"visibleElements",void 0),z=(0,n._)([(0,c.$)("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.FeatureFormUtilityNetworkAssociationList")],z);const J=z;var Q=i(53826),X=i(66201),Y=i(23224);const ee="data-field-name";let te=class extends m.default{constructor(e,t){super(e,t),this._associationsWidgetsMap=new Map,this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver((e=>{e.length&&e[0].isIntersecting&&this._incrementRelatedRecordPage()}),{root:window.document}),this._prompt=null,this._featureFormUNAssociationList=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new M.default,this.visibleElements=new L,this._onShowAllRelatedRecordsClick=e=>{const{feature:t,callbacks:i}=this;t&&i?.showAllRelatedRecords&&i.showAllRelatedRecords({parentFeature:t,relationshipId:e})},this._onAddRelatedRecordsClick=(e,t,i)=>{const{feature:n,callbacks:s}=this;let o=i;if(n&&s?.addRelatedRecord){if((0,p.F2)(i)&&e.activeCategory){const t=e.activeCategory.value,n=i.findSublayerForSubtypeCode(t);n&&(0,g.isRelatableFeatureSupportedLayer)(n)&&(o=n)}s.addRelatedRecord({parentFeature:n,relatedLayer:o,relationshipId:t})}},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([(0,l.watch)((()=>this.feature),(()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),(0,l.whenOnce)((()=>!this.viewModel.updating)).then((()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=e?.name||null,this._attemptFocusOnNextRender=!0}))})),(0,l.watch)((()=>[this._featureFormUNAssociationList,this.visibleElements.associationDetails]),(e=>{let[t,i]=e;t&&(t.visibleElements.associationDetails=i)}),l.initial),(0,l.watch)((()=>this.groupDisplay),(()=>this._syncGroupInputStates())),this.on("submit",(e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach((e=>this._inputsWithChanges.add(e))),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}})),(0,l.watch)((()=>[this.viewModel.activeRelationshipInput,this._listObserverNode]),(()=>this._onObserverChange())),(0,l.watch)((()=>this.viewModel.activeAssociationInput),(e=>{e&&this._featureFormUNAssociationList&&(this._featureFormUNAssociationList.associationInput=e,this._featureFormUNAssociationList.viewModel=e.viewModel)}))])}loadDependencies(){return(0,S.W)({block:()=>Promise.all([i.e(86290),i.e(74597),i.e(73373),i.e(31853)]).then(i.bind(i,31853)),button:()=>Promise.resolve().then(i.bind(i,20423)),chip:()=>i.e(60382).then(i.bind(i,60382)),combobox:()=>Promise.all([i.e(60382),i.e(89939),i.e(90609)]).then(i.bind(i,90609)),"combobox-item":()=>i.e(32045).then(i.bind(i,32045)),"combobox-item-group":()=>i.e(32099).then(i.bind(i,32099)),icon:()=>Promise.resolve().then(i.bind(i,92439)),input:()=>i.e(46138).then(i.bind(i,46138)),"input-date-picker":()=>Promise.all([i.e(86290),i.e(42015),i.e(57020)]).then(i.bind(i,57020)),"input-message":()=>i.e(60380).then(i.bind(i,60380)),"input-number":()=>Promise.all([i.e(9982),i.e(86634)]).then(i.bind(i,9982)),"input-time-picker":()=>Promise.all([i.e(86290),i.e(74597),i.e(42015),i.e(40435)]).then(i.bind(i,40435)),"input-time-zone":()=>Promise.all([i.e(60382),i.e(89939),i.e(90609),i.e(64699)]).then(i.bind(i,64699)),label:()=>i.e(60216).then(i.bind(i,60216)),list:()=>Promise.all([i.e(46138),i.e(89939),i.e(18170)]).then(i.bind(i,18170)),"list-item":()=>Promise.all([i.e(73373),i.e(14960)]).then(i.bind(i,28898)),loader:()=>Promise.resolve().then(i.bind(i,23173)),notice:()=>i.e(51132).then(i.bind(i,51132)),"radio-button":()=>i.e(35906).then(i.bind(i,35906)),"radio-button-group":()=>i.e(31544).then(i.bind(i,31544)),switch:()=>i.e(92812).then(i.bind(i,92812)),"text-area":()=>i.e(90423).then(i.bind(i,90423))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const{callbacks:e}=this;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _utilityNetworkAssociationsEnabled(){const{callbacks:e}=this;return!(!e?.viewAssociatedLayers||!e.viewAssociatedFeatures)}get _subtypes(){return(0,p.fV)(this.layer)}get associationId(){return this.viewModel.associationId}set associationId(e){this.viewModel.associationId=e}get associatedLayer(){return this.viewModel.associatedLayer}set associatedLayer(e){this.viewModel.associatedLayer=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get callbacks(){return this.viewModel.callbacks}set callbacks(e){this.viewModel.callbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{this._prompt?.cancel?.(),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return(0,O.K)("div",{class:this.classes(F.base,V.D.widget,V.D.panel)},"ready"===e?this._renderForm():null)}_renderForm(){return(0,O.K)("div",null,(0,O.K)("form",{class:F.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?(0,O.K)(v.XG,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel,{formTitle:t,formDescription:i}=e;if(!e.formHeaderVisible)return;const n=null!=t&&(0,O.K)($.D,{key:"title",level:this.headingLevel},t),s=null!=i&&(0,O.K)("p",{class:F.description,key:"description"},i);return(0,O.K)("div",{class:F.formHeader},n,s)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.activeAssociationInput?this._renderFeatureFormUtilityNetworkAssociationList():e.inputs.filter(s.Ru).filter((e=>e.visible)).map((e=>this._renderInput(e)))}_renderInput(e){return(0,w.Et)(e)?this._renderGroup(e):(0,w.rf)(e)?this._renderLabeledField(e):(0,w.nT)(e)?this._renderRelationshipInput(e):(0,w.k_)(e)?this._renderTextElementInput(e):(0,w.Au)(e)?this._renderUtilityNetworkAssociationsElementInput(e):void 0}_renderFeatureFormUtilityNetworkAssociationList(){return this._featureFormUNAssociationList?.render()}_selectAssociatedLayer(e){const{feature:t,callbacks:i}=this;t&&i?.viewAssociatedFeatures&&i.viewAssociatedFeatures({associatedLayer:e.layer})}async _selectAssociatedFeature(e){const{feature:t,callbacks:i}=this;t&&i?.selectAssociatedFeature&&await i.selectAssociatedFeature({parentFeature:t,...e})}_onAddAssociation(e){const{feature:t,callbacks:i}=this;t&&i?.addAssociation&&i.addAssociation(e)}_setUpUtilityNetworkAssociationList(){this._featureFormUNAssociationList||(this._featureFormUNAssociationList=new J({onSelectLayer:this._selectAssociatedLayer.bind(this),onSelectFeature:this._selectAssociatedFeature.bind(this),onAddAssociation:this._onAddAssociation.bind(this)}))}_renderUtilityNetworkAssociationsElementInput(e){if(this._utilityNetworkAssociationsEnabled)return this._setUpUtilityNetworkAssociationList(),(0,a.tE)(this._associationsWidgetsMap,e,(()=>new _.A({onSelectAssociationType:t=>{let{viewModel:i,listType:n}=t;i.activeAssociationType=n;const{feature:s,callbacks:o}=this;s&&o?.viewAssociatedLayers&&o.viewAssociatedLayers({associationId:e.uid})},viewModel:e.associationsViewModel}))).render()}_renderDescriptionOrEmpty(e,t){return null==e?null:(0,O.K)("div",{class:this.classes(F.description),id:t},e)}_renderGroup(e){const{disabled:t,formTemplate:i,headingLevel:n}=this,{description:s,id:o,inputs:a,label:r,open:l}=e,d=a.filter((e=>e.visible)),c=this.viewModel.findField(this._focusedFieldName),u=c?.group===e,p="sequential"===this.groupDisplay;return(0,O.K)("calcite-block",{class:this.classes(F.group,p?F.groupSequential:null,u?F.groupActive:null,t?F.inputDisabled:null),collapsible:!0,"data-group":e,description:s||void 0,disabled:t,heading:r??"",headingLevel:i?.title?(0,$.S)(n):n,id:o,key:o,open:l,onCalciteBlockToggle:t=>{let{currentTarget:i}=t;return this._onGroupToggle(i,e)}},d.map((e=>this._renderInput(e))))}_getFocusableInput(e,t){const i=(0,w.wr)(this.viewModel.inputs);let n;if("backward"===e&&i.reverse(),t)if((0,w.Et)(t)){const e=t.inputs.find((e=>e.visible));n=e?i.indexOf(e):0}else{let s;if((0,w.bx)(t)&&!t.group.open){const i=t.group.inputs.filter(w.rf);s="forward"===e?i[i.length-1]:i[0]}else s=t;n=i.indexOf(s)+1}else n=0;for(let s=n;s<i.length;s++){const e=i[s];if(e.visible&&(0,w.rf)(e))return e}return null}_renderLabeledField(e){const{dataType:t,feature:i,label:n,layer:s,required:o}=e,a={"aria-label":o?(0,B.V)(this.messages.requiredFieldLabel,{name:n}):n,class:F.label,key:`${s.id}-${i.uid}-${e.name}`},r=[(0,O.K)("div",{class:F.labelTextContent,key:"labelTextContainer"},n,o?(0,O.K)("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==t?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return"date"===t&&"coded-value"!==e.domain?.type?(0,O.K)("label",{...a},r):(0,O.K)("calcite-label",{...a},r)}_renderFieldInput(e){const{dataType:t,domain:i,inputType:n,name:s}=e,o=this.getCommonInputProps(e);if("coded-value"===i?.type){const t=this.viewModel.getFieldValueOptionsForField(s,this.messages.empty);return"switch"!==n||e.hasInvalidSwitchValue?"radio-buttons"===n?this._renderRadioButtonComponents(e,t.flat(),o):this._renderComboBoxComponent(e,t,o):this._renderSwitchComponent(e,o)}return"datetime-picker"===n||"date"===t?this._renderDateComponents(e,o):"number"===t?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,t){return"text-area"===e.inputType?t.readOnly?(0,O.K)("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:e=>this._saveValueFromComponent(e.currentTarget)}):(0,O.K)("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:e=>this._saveValueFromComponent(e.currentTarget)}):(0,O.K)("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:e=>this._saveValueFromComponent(e.currentTarget)})}_renderNumberComponent(e,t){const i=(0,u.isIntegerField)(e.field),n=i&&""!==t.value?Math.round(parseFloat(t.value)).toString():t.value;return(0,O.K)("calcite-input-number",{...t,integer:i,loading:e.updating,type:"number",value:n,onCalciteInputNumberInput:e=>this._saveValueFromComponent(e.currentTarget)})}_renderDateComponents(e,t){const{field:i}=e;switch(i.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,(0,Q.ZP)(i,t.value,{timeZone:this.timeZone,...(0,Q.ZT)(i)}))}}_renderDateOnlyFieldComponent(e,t){const{range:i,valid:n,value:s}=e,{class:o,key:a,readOnly:r}=t,{rawMax:l,rawMin:d}=i;return(0,O.K)("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:o,"data-date-part":"date","data-field-name":t[ee],key:`${a}-date-input`,max:(0,h.Kg)(l)?l:void 0,min:(0,h.Kg)(d)?d:void 0,numberingSystem:Q.fb,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:r,value:null!=s?`${s}`:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{valid:i,value:n}=e,{class:s,key:o,readOnly:a}=t;return(0,O.K)("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:s,"data-date-part":"time","data-field-name":t[ee],key:`${o}-time-input`,numberingSystem:Q.fb,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,step:e.timeStep,value:null!=n?`${n}`:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{name:i,range:n,timeZone:s,valid:o,value:a}=e,{class:r,key:l,readOnly:d}=t,{rawMax:c,rawMin:u}=n,p={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:Q.fb,overlayPositioning:"fixed",readOnly:d,[ee]:i,onfocus:this._onComponentFocus},h=(0,Q.T8)(c,s),m=(0,Q.T8)(u,s),v=(0,Q.T8)(a,s);return(0,O.K)("div",{class:F.dateInputContainer,key:`${l}-date-time-container`},(0,O.K)("calcite-input-date-picker",{...p,class:r,"data-date-part":"date",key:`${l}-date-input`,max:h?.date??void 0,min:m?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:v.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),(0,O.K)("calcite-input-time-picker",{...p,class:r,"data-date-part":"time",key:`${l}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:e.timeStep,value:v.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),e.includeTimeOffset?(0,O.K)("calcite-input-time-zone",{...p,class:r,"data-date-part":"timeZone",disabled:d,key:`${l}-timezone-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:v.timeZoneOffset??"0",onCalciteInputTimeZoneChange:e=>this._saveValueFromDateComponent(e.currentTarget)}):null)}_renderDateFieldComponents(e,t){const{includeTime:i,name:n,valid:s,value:o}=e,{class:a,key:r,max:l,min:d,readOnly:c}=t,{timeZone:u}=this,p={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,numberingSystem:Q.fb,overlayPositioning:"fixed",readOnly:c,[ee]:n,onfocus:this._onComponentFocus},h=(0,Q.Q0)(o,u),m=(0,Q.Q0)(l,u),v=(0,Q.Q0)(d,u);return(0,O.K)("div",{class:F.dateInputContainer,key:`${r}-date-time-container`},(0,O.K)("calcite-input-date-picker",{...p,class:a,"data-date-part":"date",key:`${r}-date-input`,max:m?.date??void 0,min:v?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:h.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),i?(0,O.K)("calcite-input-time-picker",{...p,class:a,"data-date-part":"time",key:`${r}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:1,value:h.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}):null)}_renderReadOnlyComponent(e,t){const i=this.getCommonInputProps(e);return(0,O.K)("calcite-input",{...i,class:this.classes(F.fieldInput,F.inputDisabled),readOnly:!0,type:"text",value:null!=t?`${t}`:i.value})}_renderComboBoxComponent(e,t,i){const{value:n,name:s}=e,{viewModel:o,_inputsWithChanges:a}=this,r="INSERT"===o.arcadeEditType,l=a.has(s),d=null==n&&(!r||l),c=r&&e.showNoValueOptionEnabled&&!l?()=>{}:i.onblur;return(0,O.K)("calcite-combobox",{...i,allowCustomValues:!1,clearDisabled:!0,disabled:i.readOnly,onblur:c,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:t=>{let{currentTarget:i}=t;d&&0===i.selectedItems.length?this._ignoreDeselectionOfNoValueOption(i):e.isSubtypeField&&0===i.selectedItems.length?i.value=`${e.value}`:this._saveValueFromComponent(i)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:i,name:n}=e,{messages:s,messagesTemplates:o,viewModel:a,_inputsWithChanges:r}=this,[l,d,c]=t.map((e=>e.map((e=>{let{name:t,value:n}=e;return(0,O.K)("calcite-combobox-item",{key:`#${n}`,selected:i===n,textLabel:t,value:`${n}`})})))),u=[];d.length>0&&u.push((0,O.K)("calcite-combobox-item-group",{key:"other",label:o.other},d)),c.length>0&&u.push((0,O.K)("calcite-combobox-item-group",{key:"unsupported",label:s.subtypes.unsupportedDomainGroupTitle},c)),u.length>0?u.unshift((0,O.K)("calcite-combobox-item-group",{key:"recommended",label:s.recommended},l)):u.push(...l);const p="INSERT"===a.arcadeEditType,h=r.has(n),m=null==i&&(!p||h);return e.showNoValueOptionEnabled&&u.unshift((0,O.K)("calcite-combobox-item",{key:"empty-option",selected:m,textLabel:e.showNoValueLabel||s.empty,value:""})),u}_renderRadioButtonComponents(e,t,i){const{name:n,value:s}=e,o=t.map((e=>{let{name:t,value:o}=e;return this._renderRadioButtonComponent({key:t,label:t,name:n,value:o,selected:o===s,props:i})}));if(e.showNoValueOptionEnabled){const t="",a=e.showNoValueLabel||this.messages.empty,r=s===t||null===s;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:a,name:n,value:t,selected:r,props:i}))}return(0,O.K)("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:F.inputRadioGroup,"data-field-name":i[ee],key:`${i.key}-radio-group`,layout:"vertical",name:i.key,required:i.required},o)}_renderSwitchComponent(e,t){const{value:i}=e,n=!!(0,w.HG)(e.element,"switch")&&i===e.element.input.onValue;return(0,O.K)("calcite-switch",{...t,checked:n,class:F.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:e=>this._saveValueFromComponent(e.currentTarget)})}_renderRadioButtonComponent(e){let{key:t,name:i,value:n,selected:s,label:o,props:a}=e;return(0,O.K)("calcite-label",{class:F.inputRadioLabel,key:t,layout:"inline"},(0,O.K)("calcite-radio-button",{...a,afterCreate:void 0,afterUpdate:void 0,checked:s,class:F.inputRadio,disabled:a.readOnly,name:i,onblur:()=>{this._focusedFieldName=null},value:n,onCalciteRadioButtonChange:e=>{let{currentTarget:t}=e;t.checked&&this._saveValueFromComponent(t)}}),o)}_renderAuxiliaryText(e){const t=e.name,i=this._inputsWithChanges.has(t)&&!e.submittable?(0,w.tM)(e,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(t)?this.messages.validationErrors.valuesIncompatible:null!=e.valueExpressionExecutor&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=i?(0,O.K)("calcite-input-message",{icon:!0,status:"invalid"},i):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?(0,O.K)("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){if(!e.showAllActionVisible||!this.callbacks?.showAllRelatedRecords)return;const t=this.messages;return(0,O.K)("calcite-list-item",{description:(0,B.V)(t.totalCount,{count:e.featureCount}),key:"show-all-related-features",label:t.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(e.relationshipId)},(0,O.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:i,relatedLayer:n}=e,{messages:s,callbacks:o}=this;if(t&&o?.addRelatedRecord&&n)return(0,O.K)("calcite-button",{alignment:"center",appearance:"outline-fill",class:F.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${i}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(e,i,n)},round:!0,scale:"s",width:"full"},e.relatedLayerIsTable?s.addRecord:s.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:i,description:n,title:s}=e,{feature:o,callbacks:a}=this,{highlightHelper:r}=this.viewModel,l=r?()=>r.add(i):void 0,d=r?()=>r.remove(i):void 0;return(0,O.K)("calcite-list-item",{bind:this,description:n,key:`${t}-${i.uid}`,label:s,onclick:()=>{r?.removeAll(),a?.editRelatedRecord&&o&&a.editRelatedRecord({parentFeature:o,relationshipId:t,relatedFeature:i})},onmouseenter:l,onmouseleave:d,value:s},(0,O.K)("calcite-icon",{icon:(0,w.l_)(i),slot:"content-start"}),(0,O.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{relationshipId:t,activeCategory:i}=e,n=i?null:this._renderDescriptionOrEmpty(e.description);return(0,O.K)("calcite-label",{class:this.classes(F.label,F.relatedRecordsLabel),key:`relationship-${t}-container`},(0,O.K)("div",null,this._renderRelatedRecordsHeaderContainer(e),n,this._renderRelationshipInputContent(e)),this._renderAddRelatedRecordButton(e))}_renderRelationshipInputContent(e){return e.featureCount>0?this._renderRelatedRecordsList(e):e.activeCategory&&0===e.featureCount?this._renderNoRelatedRecordsNotice():e.allCategories?.length?this._renderCategoryList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0}_renderCategoryList(e){return(0,O.K)("calcite-list",{displayMode:"flat",label:this.messages.relatedRecordsList,loading:e.updating},e.categories?.map((t=>this._renderCategory(e,t))),this._renderShowAllCategoriesListItem(e))}_renderCategory(e,t){const{count:i,name:n,value:s}=t,o=(0,Y.ZV)(i);return(0,O.K)("calcite-list-item",{key:`${n}-${s}`,label:n,onCalciteListItemSelect:()=>this._selectCategory(e,t)},(0,O.K)("calcite-chip",{label:o,scale:"s",slot:"content-end"},o),(0,O.K)("calcite-icon",{flipRtl:!0,icon:"chevron-left",scale:"s",slot:"content-end"}))}_selectCategory(e,t){this.relationshipId=e.relationshipId,e.activeCategory=t}_renderShowAllCategoriesListItem(e){if(!e.showAllCategoriesVisible)return;const t=this.messages;return(0,O.K)("calcite-list-item",{description:(0,B.V)(t.totalCount,{count:e.allCategories?.length??0}),key:"show-all-categories",label:t.showAll,value:!0,onCalciteListItemSelect:()=>e.showAllEnabled=!0},(0,O.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderRelatedRecordsHeaderContainer(e){const t=e.updating||!e.loaded;return(0,O.K)("div",{class:F.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},(0,O.K)("span",null,e.label),t?(0,O.K)("calcite-loader",{inline:!0,key:"loader",label:this.messagesCommon?.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return(0,O.K)("calcite-list",{class:F.relatedRecordsList,label:this.messages?.relatedRecordsList},e.relatedFeatureInfos.map((e=>this._renderRelatedRecordListItem(e,t))),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){const{messages:t}=this,i=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,n=e.relationship?.keyField,s=this.viewModel.findField(n),o=e.layer?.fieldsIndex.get(n),a=s?.label||o?.alias||n,r=(0,B.V)(i,{relatedLayerName:e.relatedLayer?.title,originKeyField:a});return(0,O.K)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,O.K)("div",{slot:"message"},r))}_renderNoRelatedRecordsNotice(){return(0,O.K)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,O.K)("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){if(this.viewModel.activeRelationshipInput?.showAllEnabled)return(0,O.K)("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:F.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return(0,O.K)("div",{class:F.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:i,hint:n,label:s,maxLength:o,minLength:a,name:r,range:{max:l,min:d},required:c,valid:u,value:p}=e,h=this._inputsWithChanges.has(r),m=!i||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":u?"false":"true",class:this.classes(F.fieldInput,m?F.inputDisabled:null),status:h&&!u?"invalid":"idle",key:r,label:s,max:null!=l?l:void 0,min:null!=d?d:void 0,maxLength:o>-1?o:void 0,minLength:a>-1?a:void 0,placeholder:n??void 0,readOnly:m,required:c,value:null==p?"":`${p}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[ee]:r}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(ee))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),i=e.dataset.datePart,n=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&null!=e.value&&null!=t.value){const i=new ResizeObserver((()=>{switch(e.value=void 0,t.field.type){case"date":e.value=(0,Q.Q0)(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=(0,Q.T8)(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}i.unobserve(e)}));i.observe(e)}if(null!=n)switch(i){case"date":n.date=e;break;case"time":n.time=e;break;case"timeZone":n.timeZone=e}else this._dateComponentMap.set(t.name,{[i]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);(0,w.Gq)(t)&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,i=e.querySelector("calcite-radio-button"),n=t||i;n&&this._afterComponentCreateOrUpdate(n)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,i=this._getFieldInputFromHTMLElement(e),n=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&n===i&&(this._attemptFocusOnNextRender=!1,(0,w.bx)(i)&&(i.group.open=!0),(0,A.Z6)(e))}_onComponentFocus(e){const t=e.target,i=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=i.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,"readOnly"in t&&t.readOnly||this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,i=this._getFieldInputFromHTMLElement(e),n=i.field.type,{name:s,range:o}=i,a=this._dateComponentMap.get(s);if(!a)return;let r=this.viewModel.getValue(s),l=null;"date-only"===n?l=Array.isArray(e.value)?e.value[0]:e.value:"time-only"===n?(r=(0,Q.iP)(r),l=(0,Q.iP)(e.value)):l="timestamp-offset"===n?null!=e.value?(0,Q.Ng)({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:r,defaultTimeZone:t}):null:null!=e.value?(0,Q.oh)({oldValue:r,dateComponent:a.date,timeComponent:a.time,timeZone:t,max:o.max,min:o.min}):null,null!==l&&e.value?r!==l&&this._updateFieldValue(s,l):this._updateFieldValue(s,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),i=this._parseValue(e),n=t.value;t.isSubtypeField&&(0,w.U3)(this.layer,n,i)?this._pendingSubtypeChoice||i===n||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,i)):this._updateFieldValue(t.name,i)}async _handleSubtypeChoice(e,t){const{value:i,name:n}=e,{messages:s,viewModel:o,messagesCommon:a,_subtypes:l}=this;if(this._updateFieldValue(n,t),!l?.length)return;const d=l.find((e=>e.code===t)),c=l.find((e=>e.code===i))?.name??`${i}`;if(!d)return;const u=(0,r.createResolver)();o.pendingSubtypeChoice=u;let p="update-fields";const h=[{label:s.subtypes.useDefaultValuesOption,value:"update-fields"},{label:s.subtypes.keepCurrentValuesOption,value:"keep-existing"}],m={context:"info",title:s.subtypes.changeWarningTitle,message:(0,B.V)(s.subtypes.changeWarning,{originalType:c,newType:d.name}),radios:h,defaultRadioSelection:"update-fields",onRadioSelection:e=>p=e,actions:{primary:{label:a.apply,action:()=>u.resolve(p),type:"positive"},secondary:{label:a.cancel,type:"neutral",action:()=>u.resolve("undo")}},cancel:()=>u.reject()};try{switch(this.showPrompt(m),await u.promise){case"update-fields":o.applySubtypeDefaults(d),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,i)}}finally{o.pendingSubtypeChoice=null,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown(e){let{key:t,target:i}=e;const n=this._getFieldInputFromHTMLElement(i);"Enter"===t&&(0,w.bx)(n)&&!n.group.open&&(n.group.open=!0)}_updateFieldValue(e,t){const i=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),i!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter((e=>{let[t,i]=e;return null!=i})));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),i=e.value;return(0,w.HG)(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:null==i||""===i?null:"number"===t.dataType?"-0"===i||"-0."===i||"-0,"===i?i:parseFloat(i):"date"===t.field.type?parseFloat(i):i}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:i}=e;0===i.length&&t&&"selected"in t?t.selected=!0:o.A.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){e.open?(t.open=!0,this._focusedFieldName=this._getFocusableInput("forward",t)?.name||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach((e=>{e!==t&&(e.open=!1)}))):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){"Enter"===e.key&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e?.incrementPage()}_syncGroupInputStates(){if("sequential"!==this.groupDisplay)return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter((e=>e.open));0===t.length?e[0].open=!0:t.length>1&&t.slice(1).forEach((e=>e.open=!1))}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};(0,n._)([(0,d.MZ)()],te.prototype,"_listObserverNode",void 0),(0,n._)([(0,d.MZ)()],te.prototype,"_relatedRecordsEnabled",null),(0,n._)([(0,d.MZ)()],te.prototype,"_utilityNetworkAssociationsEnabled",null),(0,n._)([(0,d.MZ)()],te.prototype,"_prompt",void 0),(0,n._)([(0,d.MZ)()],te.prototype,"_subtypes",null),(0,n._)([(0,d.MZ)()],te.prototype,"associationId",null),(0,n._)([(0,d.MZ)()],te.prototype,"associatedLayer",null),(0,n._)([(0,d.MZ)()],te.prototype,"disabled",null),(0,n._)([(0,d.MZ)()],te.prototype,"feature",null),(0,n._)([(0,d.MZ)()],te.prototype,"_featureFormUNAssociationList",void 0),(0,n._)([(0,d.MZ)()],te.prototype,"formTemplate",null),(0,n._)([(0,d.MZ)()],te.prototype,"groupDisplay",void 0),(0,n._)([(0,d.MZ)()],te.prototype,"headingLevel",void 0),(0,n._)([(0,d.MZ)()],te.prototype,"icon",null),(0,n._)([(0,d.MZ)()],te.prototype,"label",null),(0,n._)([(0,d.MZ)()],te.prototype,"layer",null),(0,n._)([(0,d.MZ)()],te.prototype,"map",null),(0,n._)([(0,d.MZ)(),(0,E.G)("esri/widgets/FeatureForm/t9n/FeatureForm")],te.prototype,"messages",void 0),(0,n._)([(0,d.MZ)(),(0,E.G)("esri/t9n/common")],te.prototype,"messagesCommon",void 0),(0,n._)([(0,d.MZ)(),(0,E.G)("esri/widgets/Feature/t9n/Feature")],te.prototype,"messagesFeature",void 0),(0,n._)([(0,d.MZ)(),(0,E.G)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],te.prototype,"messagesTemplates",void 0),(0,n._)([(0,d.MZ)()],te.prototype,"callbacks",null),(0,n._)([(0,d.MZ)()],te.prototype,"relationshipId",null),(0,n._)([(0,d.MZ)()],te.prototype,"spatialReference",null),(0,n._)([(0,d.MZ)()],te.prototype,"strict",null),(0,n._)([(0,d.MZ)()],te.prototype,"timeZone",null),(0,n._)([(0,d.MZ)()],te.prototype,"showPrompt",null),(0,n._)([(0,d.MZ)()],te.prototype,"clearPrompt",null),(0,n._)([(0,d.MZ)(),(0,X.U)(["value-change","submit"])],te.prototype,"viewModel",void 0),(0,n._)([(0,d.MZ)({type:L,nonNullable:!0})],te.prototype,"visibleElements",void 0),(0,n._)([(0,d.MZ)()],te.prototype,"test",null),te=(0,n._)([(0,c.$)("esri.widgets.FeatureForm")],te);const ie=te}}]);