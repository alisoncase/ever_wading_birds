"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[38394],{38394:(e,t,s)=>{s.d(t,{cZ:()=>U,XW:()=>x,_P:()=>G,fe:()=>C,sD:()=>O});var r,a=s(23060),i=s(74719),n=s(45622),l=s(81765),o=s(39817),c=s(93321);class d{constructor(){this.version="",this.queryResult=new u}}class u{constructor(){this.featureResult=new y}}class y{constructor(){this.objectIdFieldName="",this.uniqueIdField=new p,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new f,this.geometryType=null,this.spatialReference=new c.default,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new m,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class p{constructor(){this.name="",this.isSystemMaintained=!1}}class f{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class m{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new T,this.translate=new h}}class T{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class h{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class _{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class g{constructor(){this.attributes=[],this.compressedGeometry=new w,this.centroid=new w,this.aggregateGeometries=[]}}class w{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}!function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"}(r||(r={}));const E=[r.ELEMENTUID,r.TYPENAME];var b,q;!function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(b||(b={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(q||(q={}));var I,N,A,R,F=s(559),D=s(6317);function M(e){const t=new d;t.version=e.version;const s=e.get_query_result();if(0!==s.results_type.value)throw new Error("Got a non-feature collection type");const r=s.get_feature_result(),a=t.queryResult.featureResult;a.objectIdFieldName=r.objectid_field_name,a.exceededTransferLimit=r.exceeded_transfer_limit,a.hasM=r.has_m,a.hasZ=r.has_z,a.geometryType=D.bV[r.geometry_type.value],a.globalIdFieldName=r.globalid_field_name,a.geohashFieldName=r.geohash_field_name;const i=a.uniqueIdField,n=r.unique_id_field;i.name=n.name,i.isSystemMaintained=n.isSystemMaintained;const l=a.geometryProperties,o=r.geometry_properties;l.shapeAreaFieldName=o.shapeAreaFieldName,l.shapeLengthFieldName=o.shapeLengthFieldName,l.units=o.units;const c=a.spatialReference,u=r.spatial_reference;c.wkid=u.wkid,c.latestWkid=u.latestWkid,c.vcsWkid=u.vcsWkid,c.latestVcsWkid=u.latestVcsWkid,c.wkt=u.wkt,a.transform=v(r.transform);const y=a.fields,p=a.fieldNameToAttributeIndexMap,f=r.fields,m=f.size();for(let d=0;d<m;d++){const e=f.get(d),t=S(e);y.push(t),p[t.name]=d,e.delete()}f.delete();const T=a.values,h=r.values_count();for(let d=0;d<h;d++)T.push(r.get_value_at(d));const _=a.features,w=r.features,b=w.size();if(b>0)for(const d of E)if(void 0===p[d])throw new Error(`Feature collection missing required attribute: ${d}`);for(let d=0;d<b;d++){const e=new g,t=w.get(d),s=e.attributes,r=t.attributes_count();for(let o=0;o<r;o++)s.push(t.get_attribute_at(o));const a=t.get_compressed_geometry();a&&(e.compressedGeometry=L(a),e.centroid=L(t.get_centroid()));const i=e.aggregateGeometries,n=t.aggregate_geometries,l=n.size();for(let o=0;o<l;o++){const e=n.get(o),t=L(e);i.push(t),e.delete()}n.delete(),_.push(e),t.delete()}w.delete();const q=a.geometryFields,I=r.geometry_fields,N=I.size();for(let d=0;d<N;d++){const e=I.get(d),t=k(e);q.push(t),e.delete()}return I.delete(),t}function L(e){const t=new w;t.geometryType=D.bV[e.geometry_type.value];const s=[],r=[];for(let a=0;a<e.lengths.length;a++)s.push(e.lengths[a]);for(let a=0;a<e.coords.length;a++)r.push(e.coords[a]);return t.lengths=s,t.coords=r,t}function S(e){const t=new _;return t.name=e.name,t.alias=e.alias,t.fieldType=D.r5[e.field_type.value],t.sqlType=A[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function k(e){const t=S(e);return t.geometryType=D.bV[e.geometry_type.value],t}function v(e){const t=new m;t.quantizeOriginPosition=N[e.quantizeOriginPosition.value];const s=t.scale,r=e.scale;s.xScale=r.xScale,s.yScale=r.yScale,s.mScale=r.mScale,s.zScale=r.zScale;const a=t.translate,i=e.translate;return a.xTranslate=i.xTranslate,a.yTranslate=i.yTranslate,a.mTranslate=i.mTranslate,a.zTranslate=i.zTranslate,t}async function U(e,t){t??=!1;const s={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,a.default)(e,{responseType:"array-buffer"}),s=await t.data;return async function(e){const t=new((await(0,F.I)()).MapOfObjectIdentifierSetsDecoder),s=t.decode(new Uint8Array(e)),r=new Map;if(0!==s.error_code)throw new i.default("knowledge-graph:layer-support-utils",s.error_message);const a=t.get_map_of_identifier_sets(),n=a.keys,l=n.size();for(let o=0;o<l;o++){const e=n.get(o),t=a.query_identifier_set(e),s=[];if(t.id_array_type.value===R.GLOBALID_ARRAY){const e=t.get_globalid_array(),r=e.count();for(let t=0;t<r;t++)s.push(e.get_globalid_at(t))}else if(t.id_array_type.value===R.IDENTIFIER_ARRAY){const e=t.get_identifier_array(),r=e.count();for(let t=0;t<r;t++)s.push(e.get_identifier_at(t).toString())}else if(t.id_array_type.value===R.STRING_ARRAY){const e=t.get_string_array(),r=e.count();for(let t=0;t<r;t++)s.push(e.get_string_at(t))}else{if(t.id_array_type.value!==R.OID_ARRAY)throw new i.default("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=t.get_oid_array(),r=e.count();for(let t=0;t<r;t++)s.push(e.get_objectid_at(t).toString())}}r.set(e,s)}return t.delete(),r}(new Uint8Array(s))}(e).then((e=>{!function(e,t){for(const[s,r]of e){const e=(0,n.tE)(t.namedTypeDefinitions,s,(()=>({useAllData:!1,members:new Map})));for(const t of r)e.members.has(t)||e.members.set(t,{id:t})}}(e,s)})),s}async function G(e,t,s){const r=await(0,F.I)(),a=new r.FeatureCollection;try{P(a,r,e,"entities",t,s);const i=new r.FeatureCollectionEncoder,n=z(a,i),l=structuredClone(n);return i.delete(),l}finally{a.delete()}}async function O(e,t,s){const r=await(0,F.I)(),a=new r.FeatureCollection;try{P(a,r,e,"relationships",t,s);const i=new r.FeatureCollectionEncoder,n=z(a,i),l=structuredClone(n);return i.delete(),l}finally{a.delete()}}async function C(e){const t=await(0,F.I)(),s=new t.MapOfObjectIdentifierSets;!function(e,t,s){for(const[r,a]of s.namedTypeDefinitions){if(!a.members||a.useAllData)continue;const s=a.members.keys();let i=!1,n=!0;const l=new t.ObjectIdArray,o=new t.StringArray,c=new t.GlobalIdArray,d=new t.IdentifierArray,u=new t.ObjectIdentifierSet;for(const e of s)n&&(i=!isNaN(Number(e)),n=!1),i?l.add_objectid(Number(e)):(o.add_string(e),c.add_globalid(e)),d.add_identifier(e);u.set_oid_array(l),u.set_string_array(o),u.set_globalid_array(c),u.set_identifier_array(d),l.delete(),o.delete(),c.delete(),d.delete(),e.put_identifier_set(r,u),u.delete()}}(s,t,e);const r=new t.MapOfObjectIdentifierSetsEncoder;try{r.set_map_of_identifier_sets(s),r.encode();const e=r.get_encoding_result();if(0!==e.error.error_code)throw new i.default("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return r.delete(),t}finally{s.delete()}}function P(e,t,s,r,a,i){e.version="";const n=new t.QueryResult,o=new t.FeatureResult,c="entities"===r?b:q;o.unique_id_field={name:c[c.ELEMENTUID],isSystemMaintained:!1},o.globalid_field_name=c[c.ELEMENTUID],o.geohash_field_name="",o.geometry_properties={shapeAreaFieldName:"",shapeLengthFieldName:"",units:""},o.spatial_reference={wkid:4326,latestWkid:4326,vcsWkid:0,latestVcsWkid:0,wkt:""},o.exceeded_transfer_limit=!1,o.has_z=!1,o.has_m=!1,o.transform={quantizeOriginPosition:{value:N.upperLeft},scale:{xScale:1e-9,yScale:1e-9,mScale:1e-4,zScale:1e-4},translate:{xTranslate:-400,yTranslate:-400,mTranslate:-1e5,zTranslate:-1e5}};for(const l of Object.keys(c).filter((e=>isNaN(Number(e))))){const e=new t.Field;if(e.name=l,e.alias=l,e.sql_type={value:A.sqlTypeBigInt},"entities"===r)switch(l){case c[c.ELEMENTUID]:case c[c.TYPENAME]:e.field_type={value:D.r5.esriFieldTypeString}}else switch(l){case c[c.ELEMENTUID]:case c[c.TYPENAME]:case q[q.FROMUID]:case q[q.TOUID]:e.field_type={value:D.r5.esriFieldTypeString}}e.domain="",o.add_field(e),e.delete()}const d=new Map;for(const l of a.dataModel.entityTypes)d.set(l.name,"entities");for(const l of a.dataModel.relationshipTypes)d.set(l.name,"relationships");for(const[u,y]of s.namedTypeDefinitions)if(r===d.get(u))for(const e of y.members.values()){const s=new t.Feature;for(const n of Object.keys(c).filter((e=>isNaN(Number(e)))))if("entities"===r)switch(n){case c[c.ELEMENTUID]:s.add_attribute(e.id,t.esriFieldType.esriFieldTypeString);break;case c[c.TYPENAME]:s.add_attribute(u,t.esriFieldType.esriFieldTypeString)}else switch(n){case c[c.ELEMENTUID]:s.add_attribute(e.id,t.esriFieldType.esriFieldTypeString);break;case q[q.FROMUID]:s.add_attribute(i.has(e.id)?i.get(e.id)[0]:"",t.esriFieldType.esriFieldTypeString);break;case q[q.TOUID]:s.add_attribute(i.has(e.id)?i.get(e.id)[1]:"",t.esriFieldType.esriFieldTypeString);break;case c[c.TYPENAME]:s.add_attribute(u,t.esriFieldType.esriFieldTypeString)}let a;if(e.linkChartLocation&&"x"in e.linkChartLocation?a=(0,l.Ux)(e.linkChartLocation):e.linkChartLocation&&(a=e.linkChartLocation),e.linkChartLocation&&a){const e=new t.FeatureCollectionGeometry;let i=!1;switch(r){case"entities":e.geometry_type=t.esriGeometryType.esriGeometryPoint,i=!0;break;case"relationships":e.geometry_type=t.esriGeometryType.esriGeometryPolyline}e.coords=new Float64Array(a.coords),e.lengths=new Uint32Array(i?[1]:a.lengths),s.set_compressed_geometry(e),e.delete()}o.add_feature(s),s.delete()}switch(r){case"entities":o.geometry_type=t.esriGeometryType.esriGeometryPoint;break;case"relationships":o.geometry_type=t.esriGeometryType.esriGeometryPolyline}return n.set_feature_result(o),e.set_query_result(n),o.delete(),n.delete(),e}async function Y(e){const t=await(0,a.default)(e,{responseType:"array-buffer"});return async function(e){const t=new((await(0,F.I)()).FeatureCollectionDecoder),s=t.decode(new Uint8Array(e));if(0!==s.error_code)throw new i.default("knowledge-graph:layer-support-utils",s.error_message);const r=t.get_feature_collection(),a=M(r);return t.delete(),a}(await t.data)}function V(e,t){if(!e?.queryResult?.featureResult)return t;const s=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const a of e.queryResult.featureResult.features){const e=a.attributes[s[r.TYPENAME]],i=(0,n.tE)(t.namedTypeDefinitions,e,(()=>({useAllData:!1,members:new Map}))),l=a.attributes[s[r.ELEMENTUID]];if(a.compressedGeometry?.coords?.length>0){let e=a.compressedGeometry.lengths;"esriGeometryPoint"===a.compressedGeometry.geometryType&&(e=[]),i.members.set(l,{id:l,linkChartLocation:new o.A(e,a.compressedGeometry.coords)})}else i.members.set(l,{id:l})}return t}!function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"}(I||(I={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(N||(N={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(A||(A={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(R||(R={}));const z=(e,t)=>{t.set_feature_collection(e),t.encode();const s=t.get_encoding_result();if(0!==s.error.error_code)throw new i.default("knowledge-graph:layer-support-utils",s.error.error_message);return s.get_byte_buffer()},x={fetchAndConvertSerializedLinkChart:e=>async function(e){const t=[],s={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(Y(e.entitiesUrl).then((e=>{V(e,s)}))),e.relationshipsUrl&&t.push(Y(e.relationshipsUrl).then((e=>{V(e,s)}))),await Promise.all(t),s}(e)}}}]);