"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[15576,28109,41543,50913,63924],{10382:(e,t,n)=>{function i(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function r(e,t,n,i,s,r,o,a,l,d,u,c,p,f,h,y){return[e,t,n,i,s,r,o,a,l,d,u,c,p,f,h,y]}n.d(t,{fA:()=>r,o8:()=>s,vt:()=>i,zK:()=>o});const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:s,create:i,createView:function(e,t){return new Float64Array(e,t,16)},fromValues:r},Symbol.toStringTag,{value:"Module"}))},15576:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i,s=n(93800),r=n(6946),o=n(79953),a=n(48602),l=(n(21265),n(50925),n(14746),n(75269));let d=i=class extends r.default{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles((0,o.watch)((()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]}),(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)}),o.initial))}get description(){return this.template?.description}set description(e){this.template&&(this.template.description=e)}get disabled(){return this.disabledFunction?.(this)??!1}get label(){return this.template?.name}set label(e){this.template&&(this.template.name=e)}get id(){return`${this.label??""}\u2013${this.layer?.id}`}get supportsUpload(){return"scene"===this.layer?.type}clone(){const e=null!=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new i({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};(0,s._)([(0,a.MZ)()],d.prototype,"description",null),(0,s._)([(0,a.MZ)()],d.prototype,"disabled",null),(0,s._)([(0,a.MZ)()],d.prototype,"disabledFunction",void 0),(0,s._)([(0,a.MZ)()],d.prototype,"label",null),(0,s._)([(0,a.MZ)()],d.prototype,"layer",void 0),(0,s._)([(0,a.MZ)()],d.prototype,"template",void 0),(0,s._)([(0,a.MZ)()],d.prototype,"thumbnail",void 0),(0,s._)([(0,a.MZ)()],d.prototype,"id",null),(0,s._)([(0,a.MZ)()],d.prototype,"supportsUpload",null),d=i=(0,s._)([(0,l.$)("esri.widgets.FeatureTemplates.TemplateItem")],d);const u=d},28109:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(93800),s=n(6946),r=n(93633),o=n(48602),a=(n(21265),n(50925),n(14746),n(75269));let l=class extends(r.A.IdentifiableMixin(s.default)){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return null==e||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find((t=>t.template===e))}};(0,i._)([(0,o.MZ)()],l.prototype,"allItems",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"filterFunction",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"items",null),(0,i._)([(0,o.MZ)()],l.prototype,"label",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"id",null),l=(0,i._)([(0,a.$)("esri.widgets.FeatureTemplates.TemplateItemGroup")],l);const d=l},28417:(e,t,n)=>{n.d(t,{Kw:()=>r,RE:()=>a,Sl:()=>o});var i=n(13248),s=n(23060);async function r(e,t,n){const r=i.id?.findCredential(e.restUrl);if(!r)return null;if("loaded"===e.loadStatus&&""===t&&e.user?.sourceJSON&&!1===n)return e.user.sourceJSON;const o={responseType:"json",query:{f:"json"}};if(n&&(o.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,s.default)(e.restUrl+"/community/self",o);if(t.data){const e=t.data;if(e?.username)return e}return null}const a=await(0,s.default)(e.restUrl+"/community/users/"+t,o);if(a.data){const e=a.data;return e.error?null:e}return null}async function o(e,t,n){const i=await r(e,t,!0);return i?.privileges?.includes(n)??!1}async function a(e,t,n){const i=await r(e,t,!0);return i?.userLicenseTypeExtensions?.includes(n)??!1}},29831:(e,t,n)=>{n.d(t,{AY:()=>a,Ex:()=>l,JS:()=>d,K_:()=>u,X6:()=>c,_t:()=>s,wu:()=>r,zA:()=>o});var i=n(45622);const s={key:Symbol(),label:"Other\u200b"};function r(e){return"templateInfos"in e}function o(e){const t=[];for(const{layer:n,templates:i}of e)for(const e of i)t.push({layer:n,template:e});return t}function a(e,t){const n=new Map;for(const r of e){const e=t(r),{key:o,label:a}=null!=e.key?e:s;(0,i.tE)(n,o,(()=>({label:a,templateInfos:[]}))).templateInfos.push(r)}return Array.from(n.values())}function l(e,t){return{label:e.title??"",templateInfos:t.map((t=>({layer:e,template:t})))}}async function d(e,t){return"subtype-sublayer"===e.type?await(e.parent?.load(t)):await e.load(t),e}function u(e){const t=new Map,n=[];for(const i of e)if(c(i)){n.push(i);for(const e of i.items)t.set(e.template,e)}else t.set(i.template,i);return[t,n]}const c=e=>"items"in e},42985:(e,t,n)=>{n.d(t,{Cq:()=>y,Dt:()=>v,JC:()=>m,Rj:()=>p,Sf:()=>f,b:()=>w,gZ:()=>c,w2:()=>h,xZ:()=>g});var i=n(50925),s=n(45622),r=n(49959),o=n(35920),a=n(91046),l=n(78076),d=n(48485);const u=()=>i.A.getLogger("esri.editing.templateUtils");function c(e){return null!=e&&"prototype"in e}function p(e){return h(e)&&!("definition"in e)}function f(e){return h(e)&&"definition"in e}function h(e){return null!=e&&"templateId"in e}function y(e){return f(e)&&"feature"===e?.type&&(null==e.definition||(0,a.sC)(e.definition))}function v(e){return f(e)&&"group"===e?.type&&(null==e.definition||(0,a.Xc)(e.definition))}function m(e){return f(e)&&"preset"===e?.type&&(null==e.definition||(0,a.vf)(e.definition))}function g(e){return f(e)&&null!=e?.definition}const _=e=>null==e||"object"!=typeof e?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap((e=>e.templates)):[]];async function w(e,t,n){if(null==t)return e.map((e=>({layer:e,templates:_(e)})));const i=await async function(e,t){const n=await(0,d.Z)(t).load(),i=new Set;for(const s of e)(0,o.kb)(i,I(n,s));return await Promise.all(Array.from(i).map((e=>e.featureService.load()))),i}(e,t);(0,r.throwIfAborted)(n);const a=new Map,c=Array.from(i).map((e=>async function(e){let{serviceInfo:t,out:n,signal:i}=e;const{featureService:o,layersAndTables:a}=t,d=await async function(e){let{featureService:t,layers:n,signal:i}=e;if(!t.capabilities?.editing.supportsSharedTemplates)return new Map;const r=new Map(n.map((e=>[e.layerId,e]))),o=await t.querySharedTemplates({query:{layers:Array.from(r.keys())},requestOptions:{signal:i}}),a=new Map;for(const l of o)for(const e of l.layerIds)r.has(e)&&(0,s.tE)(a,r.get(e),(()=>[])).push(l);return a}({featureService:o,layers:a.toArray(),signal:i});(0,r.throwIfAborted)(i);for(const[s,r]of d.entries())if(0!==r.length)if((0,l.F2)(s)){const e=b(r),t=[],i=e.get(1/0)??t;for(const r of s.sublayers){const s=e.get(r.subtypeCode)??t;n.set(r,[...s,...i])}}else n.set(s,r)}({serviceInfo:e,out:a,signal:n,view:t}))),p=await Promise.allSettled(c);for(const s of p.filter((e=>"rejected"===e.status)))u().warn("Failed to fetch shared templates for service. Will use standard templates if available.",s.reason);return e.map((e=>({layer:e,templates:a.get(e)??_(e)})))}function I(e,t){return(0,l.Sv)(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):(0,l.yZ)(t)?e.tablesAndLayersLookup.get(t):null}function b(e){const t=new Map;for(const n of e)(0,s.tE)(t,n.subtypeCode??1/0,(()=>[])).push(n);return t}},48485:(e,t,n)=>{n.d(t,{Z:()=>Z});var i=n(93800),s=n(13248),r=n(89129),o=n(74719),a=n(58448),l=n(81933),d=n(50925),u=n(45622),c=n(20620),p=n(49959),f=n(90450),h=n(79953),y=n(43103),v=n(48602),m=(n(21265),n(14746),n(75269)),g=n(15492),_=n(65073),w=n(78076),I=n(78139),b=n(28417),S=n(46707),A=n(6946);let T=class extends A.default{constructor(e){super(e),this.layers=new r.default,this.lockType="none",this.tables=new r.default,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new r.default([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){return this.featureService.sourceJSON?.currentVersion??0}};(0,i._)([(0,v.MZ)({constructOnly:!0})],T.prototype,"canCreateVersion",void 0),(0,i._)([(0,v.MZ)({constructOnly:!0})],T.prototype,"canEditVersionedData",void 0),(0,i._)([(0,v.MZ)({constructOnly:!0})],T.prototype,"featureService",void 0),(0,i._)([(0,v.MZ)({constructOnly:!0})],T.prototype,"layers",void 0),(0,i._)([(0,v.MZ)()],T.prototype,"layersAndTables",null),(0,i._)([(0,v.MZ)()],T.prototype,"lockType",void 0),(0,i._)([(0,v.MZ)({constructOnly:!0})],T.prototype,"tables",void 0),(0,i._)([(0,v.MZ)()],T.prototype,"versionInfo",void 0),(0,i._)([(0,v.MZ)({constructOnly:!0})],T.prototype,"versionService",void 0),(0,i._)([(0,v.MZ)()],T.prototype,"hasAdvancedEditingUserTypeExtension",void 0),(0,i._)([(0,v.MZ)()],T.prototype,"loggedInServiceUser",void 0),(0,i._)([(0,v.MZ)()],T.prototype,"featureServiceVersion",null),T=(0,i._)([(0,m.$)("esri.undoredo.support.ServiceVersionInfo")],T);var M=n(46538);const F=new Map;function Z(e){return(0,u.tE)(F,e,(()=>{const t=new L({view:e});return e.addHandles({remove(){F.delete(e),t.destroy()}}),t.load().catch((e=>{d.A.getLogger("esri.views.Services").error("Failed to load service metadata",e)})),t}))}let L=class extends(l.A.LoadableMixin(c.A.EsriPromiseMixin(a.A.EventedAccessor))){constructor(e){super(e),this._updatingHandles=new g.U,this.items=new r.default,this.tablesAndLayersLookup=new f.A,this.additionalLayers=new r.default,this._debouncedCheckAndUpdateServiceInfos=(0,p.debounce)((async()=>{const e=[];for(const t of this.items){if(0===t.layersAndTables.length)continue;const n=t.layersAndTables.getItemAt(0);n?.gdbVersion!==t.versionInfo?.versionIdentifier.name&&e.push(t)}0!==e.length&&(await(0,h.whenOnce)((()=>!this.updating)),await this._updateVersionInfos(e))})),this._debouncedLayersChanged=(0,p.debounce)((async()=>{const e=this._detectNewLayersAndTables();0!==e.length&&(await(0,h.whenOnce)((()=>!this._updatingHandles.updating)),await this._updatingHandles.addPromise((async()=>{const t=new Set;for(const i of e)if("feature"===i.type||"subtype-group"===i.type){if(!i.url)continue;const e=(0,_.qg)(i.url).url.path,s=this._findServiceInfo(e);if(s)this.tablesAndLayersLookup.set(i,s),i.isTable?s.tables.push(i):s.layers.push(i);else if(!t.has(e))try{await this._addServiceInfo(e,i)}catch(n){d.A.getLogger(this).error(`Failed to load feature service: ${e}`,n)}finally{t.add(e)}}})()))})),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(e){return(0,p.throwIfAborted)(e),this.addHandles([(0,h.watch)((()=>this._allLayersAndTables),(()=>{this._debouncedLayersChanged().catch((e=>{d.A.getLogger(this).warn("Failed to update service info",e)}))})),(0,h.watch)((()=>this.items.map((e=>e.layersAndTables.map((e=>e.gdbVersion??"")).join(",")))),(()=>{this.checkAndUpdateServiceInfos().catch((e=>{d.A.getLogger(this).warn("Failed to update service info",e)}))}))]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return"loading"===this.loadStatus||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(e,t,n)})())}createVersion(e){return this._updatingHandles.addPromise((async()=>{const t=e.featureServerUrl,n=this._findServiceInfo(t);if(!n?.versionService)throw new o.default("services:no-version-management-service");const i=n.hasAdvancedEditingUserTypeExtension,s=n.loggedInServiceUser.toUpperCase(),r=function(e){return!e||0===e.trim().length}(e.ownerName)?s:e.ownerName?.trim().toUpperCase();if(r!==s){if(n.featureServiceVersion<=11.1)throw new o.default("services:versioning-api-error");if(!i)throw new o.default("services:no-advanced-editing-user-type-extension")}if("SDE"===r?.toUpperCase()&&"DEFAULT"===e.versionName.toUpperCase())throw new o.default("services:no-valid-version-name");{const t=await n.versionService.getVersionInfos();if(t?.find((t=>t.versionIdentifier.name.toUpperCase()===(r+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(s+"."+e.versionName).toUpperCase())))throw new o.default("services:no-valid-version-name")}const a=await n.versionService.createVersion({versionName:e.versionName,access:r!==s?"public":e.access,description:e.description});if(r!==s){const{guid:t,name:i}=a.versionIdentifier;await n.versionService.alterVersion({guid:t,name:i},{ownerName:r,access:e.access})}e.switchToVersion&&await this._changeVersionInternal(t,a.versionIdentifier.name,a.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:a.versionIdentifier,versionManagementService:n.versionService})})())}deleteVersion(e,t,n){return this._updatingHandles.addPromise((async()=>{const i=this._findServiceInfo(e);if(!i?.versionService)throw new o.default("services:no-version-management-service");if(i.featureServiceVersion<=11.1)throw new o.default("services:versioning-api-error");if(!i.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const s={name:t,guid:n};await i.versionService.deleteVersion(s)&&(await this._updateVersionInfo(i),this.emit("version-deleted",{versionIdentifier:s,versionManagementService:i.versionService}))})())}startEditing(e){return this._updatingHandles.addPromise((async()=>{const t=this._findServiceInfo(e);if(!t?.versionService)throw new o.default("services:no-version-management-service");if(!t.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const n=t.versionInfo?.versionIdentifier??{name:t.versionService.defaultVersionIdentifier.name,guid:t.versionService.defaultVersionIdentifier.guid};let i=!0;("none"!==t.versionService.getLockType(n)||(i=await t.versionService.startReading(n),i))&&(i=await t.versionService.startEditing(n),t.updateLockType())})())}finishEditing(e,t){return this._updatingHandles.addPromise((async()=>{const n=this._findServiceInfo(e);if(!n?.versionService)throw new o.default("services:no-version-management-service");if(!n.hasAdvancedEditingUserTypeExtension)throw new o.default("services:no-advanced-editing-user-type-extension");const i=n.versionInfo?.versionIdentifier??{name:n.versionService.defaultVersionIdentifier.name,guid:n.versionService.defaultVersionIdentifier.guid},s=n.versionService.getLockType(i);if("none"!==s)return"read"===s?(await n.versionService.stopReading(i),void n.updateLockType()):"edit"===s?(await n.versionService.stopEditing(i,t),await n.versionService.stopReading(i),void n.updateLockType()):void 0})())}async _changeVersionInternal(e,t,n){const i=this._findServiceInfo(e);if(!i?.versionService)throw new o.default("services:no-version-management-service");const s=i.versionInfo?.versionIdentifier??{name:i.versionService.defaultVersionIdentifier.name,guid:i.versionService.defaultVersionIdentifier.guid},r={name:t,guid:n};await i.versionService.changeVersion(this.view?.map,s,r)&&await this._updateVersionInfo(i)}async _updateVersionInfo(e){const t=e.versionService;if(!t)return;if(0===e.layersAndTables.length)return;const n=e.layersAndTables.getItemAt(0)?.gdbVersion,i=n?await t.getVersionIdentifierFromName(n):t.defaultVersionIdentifier;e.versionInfo=await t.getVersionInfoExtended(i)}_findServiceInfo(e){return this.items.find((t=>t.featureService.url===e))??null}_removeFeatureService(e){this.items.remove(e)}async _findPortal(e){const t=s.id?.findServerInfo(e??"");if(!t?.owningSystemUrl)return null;const n=`${t.owningSystemUrl}/sharing/rest`,i=I.default.getDefault();return i?.loaded&&(0,y.normalize)(i.restUrl)===(0,y.normalize)(n)?i:new I.default({authMode:"immediate",url:t.owningSystemUrl}).load()}_updateVersionInfos(e){return this._updatingHandles.addPromise((async()=>{for(const t of e)await this._updateVersionInfo(t).catch((e=>{d.A.getLogger(this).error("Failed to update version details",e)}))})())}async _addServiceInfo(e,t){const n=new S.default({url:e});await n.load();const i=await this._findPortal(e),s=i?.user?.username;let o=!1;s&&(o=await(0,b.RE)(i,s,"advediting"));let a=null;n.versionManagementServiceUrl&&(a=new M.default({url:n.versionManagementServiceUrl}),await a.load());const l=t.isTable?[]:[t],d=t.isTable?[t]:[],u=new T({loggedInServiceUser:s??"",hasAdvancedEditingUserTypeExtension:o,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:n,versionService:a,layers:new r.default(l),tables:new r.default(d)});return a&&await this._updateVersionInfo(u),this.items.push(u),this.tablesAndLayersLookup.set(t,u),t.isTable?u.tables.push(t):u.layers.push(t),u}get _allLayersAndTables(){return[...this.view.map.allLayers,...this.view.map.allTables,...this.additionalLayers]}_detectNewLayersAndTables(){const e=new Set(this._allLayersAndTables),t=[];for(const n of e)"feature"!==n.type&&"subtype-group"!==n.type||this._processed.has(n)||t.push(n);for(const n of this._processed)if(!e.has(n)&&((0,w.F2)(n)||(0,w.yZ)(n))){const e=this.tablesAndLayersLookup.get(n);if(!e)continue;this.tablesAndLayersLookup.delete(n),n.isTable?e.tables.remove(n):e.layers.remove(n),0===e.layersAndTables.length&&this._removeFeatureService(e)}return this._processed=e,t}};(0,i._)([(0,v.MZ)({constructOnly:!0})],L.prototype,"view",void 0),(0,i._)([(0,v.MZ)()],L.prototype,"items",void 0),(0,i._)([(0,v.MZ)()],L.prototype,"tablesAndLayersLookup",void 0),(0,i._)([(0,v.MZ)()],L.prototype,"additionalLayers",void 0),(0,i._)([(0,v.MZ)()],L.prototype,"updating",null),(0,i._)([(0,v.MZ)()],L.prototype,"_allLayersAndTables",null),L=(0,i._)([(0,m.$)("esri.undoredo.support.Services")],L)},66509:(e,t,n)=>{function i(){return[0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3]]}function r(e,t,n,i){return[e,t,n,i]}n.d(t,{fA:()=>r,o8:()=>s,vt:()=>i,zK:()=>o});const o=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:s,create:i,fromValues:r},Symbol.toStringTag,{value:"Module"}))},75788:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var i=n(93800),s=n(58828),r=n(58448),o=n(17741),a=n(49959),l=n(79953),d=n(48602),u=(n(21265),n(50925),n(14746),n(75269)),c=n(15492),p=n(42985),f=n(78076),h=n(29831),y=n(15576),v=n(28109);const m=e=>{let{layer:t}=e;return{key:t,label:t.title??""}},g=e=>{let{layer:t}=e;return{key:t.geometryType,label:t.geometryType??""}};let _=class extends r.A.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new c.U,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([(0,l.watch)((()=>[this.templateInfos,this.layers]),((e,t)=>{let[n]=e;n&&n===t?.at(0)||(this._updateTask=(0,o.DC)(this._updateTask),n?this._updateAllItems(n):this._getTemplatesAndUpdateAllItems())}),l.syncAndInitial),(0,l.watch)((()=>this._groupByFunction),(()=>{null==this.templateInfos&&(this._updateTask=(0,o.DC)(this._updateTask),this._getTemplatesAndUpdateAllItems())}),l.sync),(0,l.watch)((()=>this.filterFunction),(e=>{for(const t of this._allItems)(0,h.X6)(t)&&(t.filterFunction=e)}),l.sync)])}set groupBy(e){if(this._set("groupBy",e),"function"!=typeof e)switch(e){case"layer":this._groupByFunction=m;break;case"geometry":this._groupByFunction=g;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const n=()=>this.notifyChange("state");this.addHandles(e.map((e=>(0,l.when)((()=>e.loadStatus),n))),t)}this._set("layers",e)}get state(){return this.updating?"loading":0!==this.layers.length||this.templateInfos?.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce(((e,t)=>(0,h.X6)(t)?e+t.allItems.length:e+1),0)}get items(){const{filterFunction:e}=this;return null==e?this._allItems:this._allItems.filter((t=>(0,h.X6)(t)?t.items.length>0:e(t)))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)(0,h.X6)(e)&&e.reapplyFilter()}select(e){let{emit:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.selectedItem,i=e?.clone()||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:n,template:i?.template??null})}_createItem(e,t){return new y.default({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return"string"==typeof e?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(0===e.length)return function(e){for(const t of e){if((0,h.X6)(t))for(const e of t.items)e.destroy();t.destroy()}}(t),void(this._allItems=[]);const[n,i]=(0,h.K_)(t),s=e=>{const t=n.get(e.template);return t?(n.delete(e.template),t):this._createItem(e.template,e.layer)},{filterFunction:r}=this,o=e.filter(w).map((e=>(0,h.wu)(e)?new v.default({filterFunction:r,label:e.label,allItems:e.templateInfos.filter(w).map((e=>s(e)))}):s(e)));for(const a of[...n.values(),...i])a.destroy();this._allItems=o}async _getTemplatesFromLayers(e){const t=[],n={signal:e};await Promise.all(this.layers.map((async i=>{await(0,h.JS)(i,n),(0,a.throwIfAborted)(e);const s=(0,f.BR)(i)?.operations;s?.supportsEditing&&s?.supportsAdd&&((0,f.F2)(i)?t.push(...i.sublayers):t.push(i))})));const i=await(0,p.b)(t,this.view,e);(0,a.throwIfAborted)(e);const s=(0,h.zA)(i),r=this._groupByFunction;if(null==r)return s;const o=(0,h.AY)(s,r);return 1===o.length&&o[0].label===h._t.label?o[0].templateInfos:o}async _getTemplatesAndUpdateAllItems(){if(0===this.layers.length)return;const e=(0,s.UT)((async e=>{const t=await this._getTemplatesFromLayers(e);(0,a.throwIfAborted)(e),this._updateAllItems(t)}));this._updateTask=e,this._updatingHandles.addPromise(e.promise)}};function w(e){return(0,h.wu)(e)?e.templateInfos.some(w):!(0,p.w2)(e.template)||!1!==e.template.visible}(0,i._)([(0,d.MZ)()],_.prototype,"_allItems",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"_groupByFunction",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"_updatingHandles",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"disabled",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"disabledItemFunction",void 0),(0,i._)([(0,d.MZ)({value:null})],_.prototype,"filterFunction",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"groupBy",null),(0,i._)([(0,d.MZ)({value:[]})],_.prototype,"layers",null),(0,i._)([(0,d.MZ)()],_.prototype,"state",null),(0,i._)([(0,d.MZ)({readOnly:!0})],_.prototype,"numberOfFeatureTemplates",null),(0,i._)([(0,d.MZ)({readOnly:!0})],_.prototype,"items",null),(0,i._)([(0,d.MZ)({readOnly:!0})],_.prototype,"selectedItem",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"templateInfos",void 0),(0,i._)([(0,d.MZ)()],_.prototype,"updating",null),(0,i._)([(0,d.MZ)()],_.prototype,"view",void 0),_=(0,i._)([(0,u.$)("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],_);const I=_},91046:(e,t,n)=>{function i(e){return"feature"===e.type}function s(e){return"group"===e.type}function r(e){return"preset"===e.type}n.d(t,{Xc:()=>s,sC:()=>i,vf:()=>r})}}]);