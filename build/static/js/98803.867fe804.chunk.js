"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[21184,57581,79538,92471,98803],{21184:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var i=n(93800),r=n(79625),a=n(6946),o=n(89129),l=n(74719),s=n(79953),u=n(48602),d=n(32980),c=(n(21265),n(14746),n(75269)),f=n(2005),p=n(57581),y=n(85379),h=n(92471);const m={editing:!1,operations:{add:!0,update:!0,delete:!0}},g=o.default.ofType(p.default);let b=class extends a.default{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...m},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new g,this.fileInfos=new o.default,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles((0,s.watch)((()=>this.graphic),(()=>this._graphicChanged()),s.initial))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...m,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t,orderByFields:n}=this;if(!e||"function"!=typeof e.queryAttachments)throw new l.default("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getObjectId();if("number"!=typeof i)throw new l.default("invalid-object-id","getAttachments(): Numeric object id is required");const r=n?.map((e=>`${e.field} ${"descending"===e.order?"DESC":"ASC"}`)),a=new y.default({objectIds:[i],returnMetadata:!0,orderByFields:r}),o=[],s=e.queryAttachments(a).then((e=>e[i]||o)).catch((()=>o));this._getAttachmentsPromise=s,this.notifyChange("state");const u=await s;return t.destroyAll(),u.length&&t.addMany(u),this._getAttachmentsPromise=null,this.notifyChange("state"),u}async addAttachment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graphic;const{_attachmentLayer:n,attachmentInfos:i,capabilities:r}=this;if(!t)throw new l.default("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new l.default("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!r.operations?.add)throw new l.default("invalid-capabilities","addAttachment(): add capabilities are required.");if(!n||"function"!=typeof n.addAttachment)throw new l.default("invalid-layer","addAttachment(): A valid layer is required.");const a=n.addAttachment(t,e).then((e=>this._queryAttachment(e.objectId,t))),o=await a;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:n,graphic:i,capabilities:r}=this;if(!e)throw new l.default("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!r.operations?.delete)throw new l.default("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new l.default("invalid-layer","deleteAttachment(): A valid layer is required.");if(!i)throw new l.default("invalid-graphic","deleteAttachment(): A graphic is required.");const a=t.deleteAttachments(i,[e.id]).then((()=>e)),o=await a;return n.remove(o),o.destroy(),o}async updateAttachment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeAttachmentInfo;const{_attachmentLayer:n,attachmentInfos:i,graphic:r,capabilities:a}=this;if(!e)throw new l.default("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new l.default("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!a.operations?.update)throw new l.default("invalid-capabilities","updateAttachment(): Update capabilities are required.");const o=i.indexOf(t);if(!n||"function"!=typeof n.updateAttachment)throw new l.default("invalid-layer","updateAttachment(): A valid layer is required.");if(!r)throw new l.default("invalid-graphic","updateAttachment(): A graphic is required.");const s=n.updateAttachment(r,t.id,e).then((e=>this._queryAttachment(e.objectId))),u=await s;return i.splice(o,1,u),u}async commitFiles(){return await Promise.all(this.fileInfos.items.map((e=>this.addAttachment(e.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const n={file:e,form:t};return this.fileInfos.add(n),n}updateFile(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!n)return null;const i=this.fileInfos.indexOf(n);return i>-1&&this.fileInfos.splice(i,1,{file:e,form:t}),this.fileInfos.items[i]}deleteFile(e){const t=this.fileInfos.find((t=>t.file===e));return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:n}=this;if(!e||!n?.queryAttachments)throw new l.default("invalid-attachment-id","Could not query attachment.");const i=this._getObjectId(t);if("number"!=typeof i)throw new l.default("invalid-object-id","getAttachments(): Numeric object id is required");const r=new y.default({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return n.queryAttachments(r).then((e=>e[i][0]))}_getObjectId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>this.attachmentInfos.destroyAll())))}_setAttachmentLayer(){const{graphic:e}=this,t=(0,h.getSourceLayer)(e);this._attachmentLayer=t?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}};(0,i._)([(0,u.MZ)()],b.prototype,"capabilities",void 0),(0,i._)([(0,d.w)("capabilities")],b.prototype,"castCapabilities",null),(0,i._)([(0,u.MZ)()],b.prototype,"activeAttachmentInfo",void 0),(0,i._)([(0,u.MZ)()],b.prototype,"activeFileInfo",void 0),(0,i._)([(0,u.MZ)({readOnly:!0,type:g})],b.prototype,"attachmentInfos",void 0),(0,i._)([(0,u.MZ)()],b.prototype,"fileInfos",void 0),(0,i._)([(0,u.MZ)({type:r.default})],b.prototype,"graphic",void 0),(0,i._)([(0,u.MZ)()],b.prototype,"mode",void 0),(0,i._)([(0,u.MZ)({type:[f.default]})],b.prototype,"orderByFields",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],b.prototype,"state",null),(0,i._)([(0,u.MZ)()],b.prototype,"filesEnabled",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],b.prototype,"supportsResizeAttachments",null),b=(0,i._)([(0,c.$)("esri.widgets.Attachments.AttachmentsViewModel")],b);const I=b},57581:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var i,r=n(93800),a=n(19455),o=n(48602),l=n(80556),s=(n(21265),n(14746),n(75269));function u(e){const{exifInfo:t,exifName:n,tagName:i}=e;if(!t||!n||!i)return null;const r=t.find((e=>e.name===n));return r?function(e){const{tagName:t,tags:n}=e;if(!n||!t)return null;const i=n.find((e=>e.name===t));return i?.value||null}({tagName:i,tags:r.tags}):null}const d={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let c=i=class extends a.A{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=u({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return d[t]||null}clone(){return new i({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,r._)([(0,o.MZ)({type:String})],c.prototype,"contentType",void 0),(0,r._)([(0,o.MZ)()],c.prototype,"exifInfo",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],c.prototype,"orientationInfo",null),(0,r._)([(0,o.MZ)({type:l.jz})],c.prototype,"id",void 0),(0,r._)([(0,o.MZ)({type:String})],c.prototype,"globalId",void 0),(0,r._)([(0,o.MZ)({type:String})],c.prototype,"keywords",void 0),(0,r._)([(0,o.MZ)({type:String})],c.prototype,"name",void 0),(0,r._)([(0,o.MZ)({json:{read:!1}})],c.prototype,"parentGlobalId",void 0),(0,r._)([(0,o.MZ)({json:{read:!1}})],c.prototype,"parentObjectId",void 0),(0,r._)([(0,o.MZ)({type:l.jz})],c.prototype,"size",void 0),(0,r._)([(0,o.MZ)({json:{read:!1}})],c.prototype,"url",void 0),c=i=(0,r._)([(0,s.$)("esri.rest.query.support.AttachmentInfo")],c);const f=c},79538:(e,t,n)=>{n.d(t,{BV:()=>Z,EG:()=>I,Lk:()=>T,Ll:()=>L,Np:()=>d,R3:()=>_,SO:()=>y,T1:()=>q,UH:()=>u,Wy:()=>w,XR:()=>p,aM:()=>F,fs:()=>b,i0:()=>M,i3:()=>g});var i=n(66845),r=n(95011),a=n(96247),o=n(76983),l=n(73210),s=n(40731);const u=",",d={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},c="percent-of-total",f="field",p={exclude:["median"]},y={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},h=new Set(["integer","small-integer"]);let m=null;const g=["date","date-only","timestamp-offset"];function b(e){return(0,r.isDateField)(e)||(0,r.isDateOnlyField)(e)||(0,r.isTimestampOffsetField)(e)}async function I(e){const{field:t,field2:n,field3:i,normalizationField:r,valueExpression:o}=e;let l=[];if(o){if(!m){const{arcadeUtils:e}=await(0,a.lw)();m=e}l=m.extractFieldNames(o)}return t&&l.push(t),n&&l.push(n),i&&l.push(i),r&&l.push(r),l}function w(e){let t=e.normalizationType;return t||(e.normalizationField?t=f:null!=e.normalizationTotal&&(t=c)),t??void 0}function v(e){return String(e).padStart(2,"0")}function A(e,t,n){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${v((n?e.getMonth():e.getUTCMonth())+1)}-${v(n?e.getDate():e.getUTCDate())} ${v(n?e.getHours():e.getUTCHours())}:${v(n?e.getMinutes():e.getUTCMinutes())}:${v(n?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function F(e,t,n,i){const{hasQueryEngine:r}=e,a=`(${A(n,T(e,n),r)} - ${A(t,T(e,t),r)})`;let o=y[i],l="/";return o<1&&(o=1/o,l="*"),{sqlExpression:1===o?a:`(${a} ${l} ${o})`,sqlWhere:null}}function T(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const n=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,r.isDateField)(n))return"field"}}function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;for(const n in t)if(t[n].includes(e))return n}function q(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=null;return e&&("string"==typeof e?t.includes(e)&&(i=e):i=(0,o.q3)(e)),n?i||"gray":i}function _(e,t){const n=t&&e.getField(t);return!!n&&h.has(n.type)}function L(e){return`cast(${e} as float)`}function M(e,t){const{format:n,timeZoneOptions:r,fieldType:a}=t??{};let o,u;if(r&&({timeZone:o,timeZoneName:u}=(0,s.hv)(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,(0,i.J2)(n||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const t=(0,i.J2)(n||"short-date");return"string"==typeof e?(0,i.iS)(e,{...t}):(0,i.Yq)(e,{...t,timeZone:l.n$})}case"time-only":{const t=(0,i.J2)(n||"short-time");return"string"==typeof e?(0,i.F8)(e,t):(0,i.Yq)(e,{...t,timeZone:l.n$})}case"timestamp-offset":{if(!o&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=n||r?(0,i.J2)(n||"short-date-short-time"):void 0,a=t?{...t,timeZone:o,timeZoneName:u}:void 0;return"string"==typeof e?(0,i.Ey)(e,a):(0,i.Yq)(e,a)}default:{const t=n||r?(0,i.J2)(n||"short-date-short-time"):void 0;return(0,i.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:o,timeZoneName:u}:void 0)}}}},92471:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>Q,createFieldInfoMap:()=>Y,findRelatedLayer:()=>le,findUtilityNetwork:()=>se,fixTokens:()=>E,formatAttributes:()=>K,formatEditInfo:()=>V,formatValueToFieldInfo:()=>G,getAllFieldInfos:()=>B,getFieldInfo:()=>P,getFieldInfoLabel:()=>L,getFixedFieldName:()=>M,getFixedFieldNames:()=>x,getHighlightKeyForFeature:()=>ce,getSourceLayer:()=>T,graphicCallback:()=>Z,htmlEntities:()=>J,isAssociatedFeatureSupportedLayer:()=>z,isExpressionField:()=>_,isFeatureSupportedLayer:()=>R,isGraphicForRelatableFeatureSupportedLayer:()=>D,isRelatableFeatureSupportedLayer:()=>U,isRelatableLayer:()=>S,isRelatedField:()=>te,preLayerQueryCallback:()=>ae,preRequestCallback:()=>oe,querySourceLayer:()=>X,queryUpdatedFeature:()=>ee,shouldOpenInNewTab:()=>q,substituteAttributes:()=>k,substituteFieldsInLinksAndAttributes:()=>j});var i=n(21265),r=n(50925),a=n(56612),o=n(66845),l=n(23224),s=n(95011),u=n(78076),d=n(79538),c=n(96247),f=n(40731);const p=()=>r.A.getLogger("esri.widgets.Feature.support.featureUtils"),y=/href=(""|'')/gi,h=/(\{([^{\r\n]+)\})/g,m=/'/g,g=/^\s*expression\//i,b=/(\n)/gi,I=/[\u00A0-\u9999<>&]/gim,w=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,v=/^(?:mailto:|tel:)/,A="relationships/",F=(0,o.J2)("short-date-short-time");function T(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function Z(e){let{type:t,value:n,event:i}=e;try{return"function"==typeof n?n(i):await n}catch(r){return void p().error("error",`An error occurred when calling the "${t}" function`,{error:r,graphic:i.graphic,value:n})}}function q(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!v.test(e.trim().toLowerCase())}function _(e){return!!e&&g.test(e)}function L(e,t){const n=function(e,t){if(!t||!_(t)||!e)return;const n=t.replace(g,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===n}))}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function M(e,t){const n=N(t,e);return n?n.name:e}function x(e,t){return e&&e.map((e=>M(e,t)))}function N(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function C(e){return`${e}`.trim()}function j(e){let{attributes:t,globalAttributes:n,layer:i,text:r,expressionAttributes:a,fieldInfoMap:o}=e;return r?k({formattedAttributes:n,template:O(r,{...n,...a,...t},i),fieldInfoMap:o}):""}function k(e){let{formattedAttributes:t,template:n,fieldInfoMap:i}=e;return C(function(e){return e.replaceAll(y,"")}((0,a.HC)((0,a.HC)(n,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,i))),t)))}function $(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t[e];if("string"==typeof i){const r="%27",a=(n?encodeURIComponent(i):i).replaceAll(m,r);t[e]=a}}(e,n,t))),n}function E(e,t){return e.replaceAll(h,((e,n,i)=>{const r=N(t,i);return r?`{${r.name}}`:n}))}function O(e,t,n){const i=E(e,n);return i?i.replaceAll(w,((e,n,i)=>function(e,t,n){const i=(t=C(t))&&"{"!==t[0];return(0,a.HC)(e,$(n,i||!1))}(e,n||i,t))):i}function R(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function S(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function U(e){return R(e)&&S(e)}function z(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function D(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&U(e.sourceLayer)}function G(e,t){const{fieldInfos:n,fieldName:i,preventPlacesFormatting:r,layer:a,timeZone:o}=t,u=P(n,i),c=N(a,i);if(u&&!(0,s.isRasterPixelValueField)(i)){const t=c?.type,n=u.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,d.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}})}const f=u?.format;return"string"==typeof e&&(0,s.isRasterPixelValueField)(i)&&f?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?H(e,",",", ",t):e.includes(";")?H(e,";","; ",t):e.includes(" ")?H(e," "," ",t):(0,l.ZV)(Number(e),(0,l.yx)(t))}(e,f):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,f))||null==e||null==f?Q(e):(0,l.ZV)(e,r?{...(0,l.yx)(f),minimumFractionDigits:0,maximumFractionDigits:20}:(0,l.yx)(f))}function H(e,t,n,i){return e.trim().split(t).map((e=>(0,l.ZV)(Number(e),(0,l.yx)(i)))).join(n)}function P(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function V(e,t,n,i){const{creatorField:r,creationDateField:a,editorField:l,editDateField:s}=e;if(!t)return;const u=(0,f.hv)(i&&"preferredTimeZone"in i?i.preferredTimeZone:null,!(!i||!("datesInUnknownTimezone"in i))&&!!i.datesInUnknownTimezone,n,F,"date"),d={...F,...u},c=t[s];if("number"==typeof c){const e=t[l];return{type:"edit",date:(0,o.Yq)(c,d),user:e}}const p=t[a];if("number"==typeof p){const e=t[r];return{type:"create",date:(0,o.Yq)(p,d),user:e}}return null}function Y(e,t){const n=new Map;if(!e)return n;for(const i of e){if(!i.fieldName)continue;const e=M(i.fieldName,t);i.fieldName=e,n.set(e.toLowerCase(),i)}return n}function B(e){const t=[];if(!e)return t;const{fieldInfos:n,content:i}=e;return n&&t.push(...n),i&&Array.isArray(i)?(i.forEach((e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}})),t):t}function J(e){return e.replaceAll(I,(e=>`&#${e.charCodeAt(0)};`))}function Q(e){return"string"==typeof e?e.replaceAll(b,'<br class="esri-text-new-line" />'):e}function W(e){const{value:t,fieldName:n,fieldInfos:r,fieldInfoMap:a,layer:o,graphic:l,timeZone:u}=e;if(null==t)return"";const c=function(e){let{fieldName:t,value:n,graphic:r,layer:a}=e;if(te(t))return null;if(!a||"function"!=typeof a.getFieldDomain)return null;const o=r&&a.getFieldDomain(t,{feature:r,excludeImpliedDomains:(0,i.A)("esri-widget-legacy-field-domain-calculation")});return o&&"coded-value"===o.type?o.getName(n):null}({fieldName:n,value:t,graphic:l,layer:o});if(c)return c;const f=function(e){let{fieldName:t,graphic:n,layer:i}=e;if(te(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const a=i.getFeatureType(n);return a?a.name:null}({fieldName:n,graphic:l,layer:o});if(f)return f;if(a.get(n.toLowerCase()))return G(t,{fieldInfos:r||Array.from(a.values()),fieldName:n,layer:o,timeZone:u});const p=o?.fieldsIndex?.get(n);return p&&((0,d.fs)(p)||(0,s.isTimeOnlyField)(p))?(0,d.i0)(t,{fieldType:p.type,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:u,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}}):Q(t)}function K(e){let{fieldInfos:t,attributes:n,layer:i,graphic:r,fieldInfoMap:a,relatedInfos:o,timeZone:l}=e;const s={};return o?.forEach((e=>function(e){let{attributes:t,relatedInfo:n,fieldInfoMap:i,fieldInfos:r,layer:a,timeZone:o}=e;t&&n&&(n.relatedFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:i,fieldInfos:r,layer:a,timeZone:o}))),n.relatedStatsFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:i,fieldInfos:r,layer:a,timeZone:o}))))}({attributes:s,relatedInfo:e,fieldInfoMap:a,fieldInfos:t,layer:i,timeZone:l}))),n&&Object.keys(n).forEach((e=>{const o=n[e];s[e]=W({fieldName:e,fieldInfos:t,fieldInfoMap:a,layer:i,value:o,graphic:r,timeZone:l})})),s}async function X(e,t){const{layer:n,graphic:i,outFields:r,objectIds:a,returnGeometry:o,spatialReference:l}=e,s=a[0];if("number"!=typeof s&&"string"!=typeof s){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:i,objectId:s,requiredFields:r};return p().warn(e,t),null}if(!(0,u.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:i,requiredFields:r,returnGeometry:o};return p().warn(e,t),null}const d=n.createQuery();return d.objectIds=a,d.outFields=r?.length?r:[n.objectIdField],d.returnGeometry=!!o,d.returnZ=!!o,d.returnM=!!o,d.outSpatialReference=l,(await n.queryFeatures(d,t)).features[0]}async function ee(e,t){let{graphic:n,popupTemplate:i,layer:r,spatialReference:a}=e;if(!r||!i)return;if("function"==typeof r.load&&await r.load(t),!n.attributes)return;const o=r.objectIdField,l=n.attributes[o];if(null==l)return;const u=[l],d=await i.getRequiredFields(r.fieldsIndex),f=(0,s.featureHasFields)(d,n),p=f?[]:d.includes(o)?d:[...d,o],y=i.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(i);if(f&&!y)return;const h=await X({layer:r,graphic:n,outFields:p,objectIds:u,returnGeometry:y,spatialReference:a},t);h&&(h.geometry&&(n.geometry=h.geometry),h.attributes&&(n.attributes={...n.attributes,...h.attributes}))}function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(A)}function ne(e){let{attributes:t,graphic:n,relatedInfo:i,fieldInfos:r,fieldInfoMap:a,layer:o,timeZone:l}=e;t&&n&&i&&Object.keys(n.attributes).forEach((e=>{const s=function(e){return`${A}${e.layerId}/${e.fieldName}`}({layerId:i.relation.id.toString(),fieldName:e}),u=n.attributes[e];t[s]=W({fieldName:s,fieldInfos:r,fieldInfoMap:a,layer:o,value:u,graphic:n,timeZone:l})}))}const ie=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},re=e=>{let{layer:t,method:n,query:i,definitionExpression:r}=e;if(!t.capabilities?.query?.supportsCacheHint||"attachments"===n)return;const a=null!=i.where?i.where:null,o=null!=i.geometry?i.geometry:null;ie(r)||ie(a)||"extent"===o?.type||"tile"===i.resultType||(i.cacheHint=!0)},ae=e=>{let{query:t,layer:n,method:i}=e;re({layer:n,method:i,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})},oe=e=>{let{queryPayload:t,layer:n,method:i}=e;re({layer:n,method:i,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})};function le(e,t,n){return e&&t&&n?"sublayer"===t.type?de({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:n})||de({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):de({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||de({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function se(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function ue(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function de(e){let{map:t,relationship:n,relationship:{relatedTableId:i},relatedLayer:r,layers:a}=e;if(!a)return null;for(const o of a){if("map-image"===o.type){const e=de({layers:o.sublayers,map:t,relatedLayer:r,relationship:n})||de({layers:o.subtables,map:t,relatedLayer:r,relationship:n});if(e)return e;continue}if(!U(o))continue;if("sublayer"===r.type){if(o!==r&&o.id===i)return o.isTable?ue(t,o):o;continue}const e="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!e)return null;if("sublayer"!==o.type){if(o!==r&&o.url===e&&o.layerId===i)return o}else if(o!==r&&o.layer?.url===e&&o.id===i)return o.isTable?ue(t,o):o}return null}function ce(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}}}]);