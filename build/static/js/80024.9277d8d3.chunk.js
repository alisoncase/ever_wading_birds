"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[57581,67011,74058,80024],{377:(e,t,i)=>{i.d(t,{A:()=>y});var r=i(93800),s=i(6946),n=i(62631),o=i(48602),a=i(32980),l=(i(21265),i(75269)),u=i(26964),d=i(89202),c=i(92471),h=i(5414);const p={chartAnimation:!0};let f=class extends s.default{constructor(e){super(e),this.abilities={...p},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...p,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{mediaInfos:e,layer:t}=this,i=this.attributes??{},r=this.formattedAttributes??{},s=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return e?.map((e=>{const n=e?.clone();if(!n)return null;if(n.title=(0,c.substituteFieldsInLinksAndAttributes)({attributes:i,fieldInfoMap:o,globalAttributes:r,expressionAttributes:s,layer:t,text:n.title}),n.caption=(0,c.substituteFieldsInLinksAndAttributes)({attributes:i,fieldInfoMap:o,globalAttributes:r,expressionAttributes:s,layer:t,text:n.caption}),n.altText=(0,c.substituteFieldsInLinksAndAttributes)({attributes:i,fieldInfoMap:o,globalAttributes:r,expressionAttributes:s,layer:t,text:n.altText}),"image"===n.type){if(!n.value)return;return this._setImageValue({value:n.value,formattedAttributes:r,layer:t}),n.value.sourceURL?n:void 0}if("pie-chart"===n.type||"line-chart"===n.type||"column-chart"===n.type||"bar-chart"===n.type){if(!n.value)return;return this._setChartValue({value:n.value,chartType:n.type,attributes:i,formattedAttributes:r,layer:t,expressionAttributes:s}),n}return null})).filter(n.Ru)??[]}_setImageValue(e){const t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const e=(0,c.fixTokens)(o,s);i.sourceURL=(0,c.substituteAttributes)({formattedAttributes:r,template:e,fieldInfoMap:t})}if(n){const e=(0,c.fixTokens)(n,s);i.linkURL=(0,c.substituteAttributes)({formattedAttributes:r,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n,expressionAttributes:o}=e,{popupTemplate:a,relatedInfos:l}=this,{fields:u,normalizeField:d}=t,h=n;if(t.fields=(0,c.getFixedFieldNames)(u,h),d&&(t.normalizeField=(0,c.getFixedFieldName)(d,h)),!u.some((e=>!!(null!=r[e]||(0,c.isRelatedField)(e)&&l?.size))))return;const p=a?.fieldInfos??[];u.forEach(((e,n)=>{const a=t.colors?.[n];if((0,c.isRelatedField)(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:p,fieldName:e,formattedAttributes:r,chartType:s,value:t,color:a})]);const l=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,expressionAttributes:o,fieldName:e,fieldInfos:p,color:a});t.series.push(l)}))}_getRelatedChartInfos(e){const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n,color:o}=e,a=[],l=(0,h.kC)(i),u=l&&this.relatedInfos?.get(l.layerId.toString());if(!u)return a;const{relatedFeatures:d,relation:c}=u;if(!c||!d)return a;const{cardinality:p}=c;return d.forEach((e=>{const{attributes:u}=e;u&&Object.keys(u).forEach((e=>{e===l.fieldName&&a.push(this._getChartOption({value:n,attributes:u,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:e,hasMultipleRelatedFeatures:d?.length>1,fieldInfos:t,color:o}))}))})),"one-to-many"===p||"many-to-many"===p?a:[a[0]]}_getTooltip(e){let{label:t,value:i,chartType:r}=e;return"pie-chart"===r?`${t}`:`${t}: ${i}`}_getChartOption(e){const{value:t,attributes:i,formattedAttributes:r,expressionAttributes:s,fieldName:n,relatedFieldName:o,fieldInfos:a,chartType:l,hasMultipleRelatedFeatures:p,color:f}=e,y=this.layer,m=this.fieldInfoMap??new Map,{normalizeField:g,tooltipField:_}=t,b=g?(0,c.isRelatedField)(g)?i[(0,h.kC)(g).fieldName]:i[g]:null,I=(0,c.isExpressionField)(n)&&s&&void 0!==s[n]?s[n]:o&&void 0!==i[o]?i[o]:void 0!==i[n]?i[n]:r[n],v=new d.default({fieldName:n,color:f,value:void 0===I?null:I&&b?I/b:I});if((0,c.isRelatedField)(n)){const e=m.get(n.toLowerCase()),t=_&&m.get(_.toLowerCase()),s=e?.fieldName??n,a=p&&_?(0,h.kC)(_).fieldName:t?.fieldName??_,u=p&&a?i[a]:r[a]??e?.label??e?.fieldName??o,d=p&&o?i[o]:r[s];return v.tooltip=this._getTooltip({label:u,value:d,chartType:l}),v}const w=(0,c.getFieldInfo)(a,n),F=(0,c.getFixedFieldName)(n,y),T=_&&void 0!==r[_]?r[_]:(0,c.getFieldInfoLabel)(w||new u.default({fieldName:F}),this.popupTemplate?.expressionInfos),A=r[F];return v.tooltip=this._getTooltip({label:T,value:A,chartType:l}),v}};(0,r._)([(0,o.MZ)()],f.prototype,"abilities",void 0),(0,r._)([(0,a.w)("abilities")],f.prototype,"castAbilities",null),(0,r._)([(0,o.MZ)()],f.prototype,"activeMediaInfoIndex",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],f.prototype,"activeMediaInfo",null),(0,r._)([(0,o.MZ)()],f.prototype,"attributes",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"description",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"fieldInfoMap",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"formattedAttributes",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"expressionAttributes",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],f.prototype,"formattedMediaInfos",null),(0,r._)([(0,o.MZ)()],f.prototype,"isAggregate",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"layer",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],f.prototype,"formattedMediaInfoCount",null),(0,r._)([(0,o.MZ)()],f.prototype,"mediaInfos",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"popupTemplate",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"relatedInfos",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"title",void 0),f=(0,r._)([(0,l.$)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],f);const y=f},2180:(e,t,i)=>{i.d(t,{e:()=>l,s:()=>a});var r=i(10193),s=i(83238),n=i(87520),o=i(53512);async function a(e,t,i){const r=await l(e,t,i);return n.default.fromJSON(r)}async function l(e,t,i){const n=(0,r.Dl)(e),a={...i},l=o.default.from(t),{data:u}=await(0,s.eW)(n,l,l.sourceSpatialReference,a);return u}},3481:(e,t,i)=>{i.d(t,{Fq:()=>o,Yc:()=>s,Yq:()=>n});var r=i(12560);function s(e){if(null==e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new r.default({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function n(e){if(null==e)return null;const t=e.clone();return void 0!==e.cache._geVersion&&(t.cache._geVersion=e.cache._geVersion),t}function o(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},5414:(e,t,i)=>{i.d(t,{LI:()=>w,Xx:()=>I,cl:()=>g,hM:()=>v,kC:()=>m,nD:()=>_});var r=i(23060),s=i(62631),n=i(74719),o=i(50925),a=i(49959),l=i(95011),u=i(2180),d=i(53512),c=i(31482),h=i(97975),p=i(92471);const f=()=>o.A.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),y=new Map;function m(e){if(!(0,p.isRelatedField)(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function g(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function _(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:r}=e,s=i?.value;t.relatedFeatures=s?s.features:[];const n=r?.value;t.relatedStatsFeatures=n?n.features:[]}async function b(e,t,i,r){const n=i.layerId.toString(),{layerInfo:o,relation:h,relatedFields:p,outStatistics:f,url:y,sourceSpatialReference:m}=t,g=function(e){return e?(0,s.Am)(e):void 0}(p),_=function(e){return e?(0,s.Am)(e,((e,t)=>JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON()))):void 0}(f);if(!o||!h)return null;const b=function(e){let{originRelationship:t,relationships:i,layerId:r}=e;return i.find((e=>{let{relatedTableId:i,id:s}=e;return`${i}`===r&&s===t?.id}))??null}({originRelationship:h,relationships:o.relationships,layerId:n});if(b?.relationshipTableId&&b.keyFieldInRelationshipTable){const t=(await function(e,t,i,r){const s=new c.default;return s.outFields=["*"],s.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],s.gdbVersion=i.gdbVersion??null,s.historicMoment=i.historicMoment??null,i.queryRelatedFeatures?.(s,r)??Promise.resolve({})}(e,b,i,r))[e.attributes[i.objectIdField]];if(!t)return null;const s=t.features.map((e=>e.attributes[o.objectIdField]));if(_?.length&&o.supportsStatistics){const e=new d.default;e.where=function(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}(o.objectIdField,s,1e3),e.outFields=g,e.outStatistics=_,e.sourceSpatialReference=m;const i={features:Promise.resolve(t),statsFeatures:(0,u.s)(y,e)};return(0,a.eachAlways)(i)}}const I=b?.keyField;if(I){const t=(0,l.isNumericField)(function(e,t){if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}(o.fields,I)),s=function(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}(e.attributes,h.keyField),n=t?`${I}=${s}`:`${I}='${s}'`,c=i.historicMoment,p=i.gdbVersion,f=(0,u.s)(y,new d.default({where:n,outFields:g,sourceSpatialReference:m,historicMoment:c,gdbVersion:p}),r),b=_?.length&&o.supportsStatistics?(0,u.s)(y,new d.default({where:n,outFields:g,outStatistics:_,sourceSpatialReference:m}),r):null,v={features:f};return b&&(v.statsFeatures=b),(0,a.eachAlways)(v)}return null}function I(e,t){let{relatedInfos:i,layer:s}=e;const o={};return i.forEach(((e,t)=>{const{relation:i}=e;if(!i){const e=new n.default("relation-required","A relation is required on a layer to retrieve related records.");throw f().error(e),e}const{relatedTableId:a}=i;if("number"!=typeof a){const e=new n.default("A related table ID is required on a layer to retrieve related records.");throw f().error(e),e}const l=`${s.url}/${a}`,u=y.get(l),d=u??function(e,t){return(0,r.default)(e,{query:{f:"json"},signal:t?.signal})}(l);u||y.set(l,d),o[t]=d})),(0,a.whenOrAbort)((0,a.eachAlways)(o),t)}function v(e,t){let{graphic:i,relatedInfos:r,layer:s}=e;const n={};return r.forEach(((e,r)=>{e.layerInfo&&(n[r]=b(i,e,s,t))})),(0,a.eachAlways)(n)}function w(e){let{relatedInfo:t,fieldName:i,fieldInfo:r}=e;if(t.relatedFields?.push(i),r.statisticType){const e=new h.default({statisticType:r.statisticType,onStatisticField:i,outStatisticFieldName:i});t.outStatistics?.push(e)}}},5957:(e,t,i)=>{function r(e){const t={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){t[i]=[];for(let e=0;e<s.length;e++)t[i][e]=r(s[e])}else"object"==typeof s?s.toJSON&&(t[i]=JSON.stringify(s)):t[i]=s}return t}i.d(t,{z:()=>r})},21184:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var r=i(93800),s=i(79625),n=i(6946),o=i(89129),a=i(74719),l=i(79953),u=i(48602),d=i(32980),c=(i(21265),i(14746),i(75269)),h=i(2005),p=i(57581),f=i(85379),y=i(92471);const m={editing:!1,operations:{add:!0,update:!0,delete:!0}},g=o.default.ofType(p.default);let _=class extends n.default{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...m},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new g,this.fileInfos=new o.default,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles((0,l.watch)((()=>this.graphic),(()=>this._graphicChanged()),l.initial))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...m,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t,orderByFields:i}=this;if(!e||"function"!=typeof e.queryAttachments)throw new a.default("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId();if("number"!=typeof r)throw new a.default("invalid-object-id","getAttachments(): Numeric object id is required");const s=i?.map((e=>`${e.field} ${"descending"===e.order?"DESC":"ASC"}`)),n=new f.default({objectIds:[r],returnMetadata:!0,orderByFields:s}),o=[],l=e.queryAttachments(n).then((e=>e[r]||o)).catch((()=>o));this._getAttachmentsPromise=l,this.notifyChange("state");const u=await l;return t.destroyAll(),u.length&&t.addMany(u),this._getAttachmentsPromise=null,this.notifyChange("state"),u}async addAttachment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graphic;const{_attachmentLayer:i,attachmentInfos:r,capabilities:s}=this;if(!t)throw new a.default("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new a.default("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations?.add)throw new a.default("invalid-capabilities","addAttachment(): add capabilities are required.");if(!i||"function"!=typeof i.addAttachment)throw new a.default("invalid-layer","addAttachment(): A valid layer is required.");const n=i.addAttachment(t,e).then((e=>this._queryAttachment(e.objectId,t))),o=await n;return r.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,capabilities:s}=this;if(!e)throw new a.default("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations?.delete)throw new a.default("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new a.default("invalid-layer","deleteAttachment(): A valid layer is required.");if(!r)throw new a.default("invalid-graphic","deleteAttachment(): A graphic is required.");const n=t.deleteAttachments(r,[e.id]).then((()=>e)),o=await n;return i.remove(o),o.destroy(),o}async updateAttachment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeAttachmentInfo;const{_attachmentLayer:i,attachmentInfos:r,graphic:s,capabilities:n}=this;if(!e)throw new a.default("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new a.default("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations?.update)throw new a.default("invalid-capabilities","updateAttachment(): Update capabilities are required.");const o=r.indexOf(t);if(!i||"function"!=typeof i.updateAttachment)throw new a.default("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new a.default("invalid-graphic","updateAttachment(): A graphic is required.");const l=i.updateAttachment(s,t.id,e).then((e=>this._queryAttachment(e.objectId))),u=await l;return r.splice(o,1,u),u}async commitFiles(){return await Promise.all(this.fileInfos.items.map((e=>this.addAttachment(e.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!i)return null;const r=this.fileInfos.indexOf(i);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){const t=this.fileInfos.find((t=>t.file===e));return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new a.default("invalid-attachment-id","Could not query attachment.");const r=this._getObjectId(t);if("number"!=typeof r)throw new a.default("invalid-object-id","getAttachments(): Numeric object id is required");const s=new f.default({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(s).then((e=>e[r][0]))}_getObjectId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>this.attachmentInfos.destroyAll())))}_setAttachmentLayer(){const{graphic:e}=this,t=(0,y.getSourceLayer)(e);this._attachmentLayer=t?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}};(0,r._)([(0,u.MZ)()],_.prototype,"capabilities",void 0),(0,r._)([(0,d.w)("capabilities")],_.prototype,"castCapabilities",null),(0,r._)([(0,u.MZ)()],_.prototype,"activeAttachmentInfo",void 0),(0,r._)([(0,u.MZ)()],_.prototype,"activeFileInfo",void 0),(0,r._)([(0,u.MZ)({readOnly:!0,type:g})],_.prototype,"attachmentInfos",void 0),(0,r._)([(0,u.MZ)()],_.prototype,"fileInfos",void 0),(0,r._)([(0,u.MZ)({type:s.default})],_.prototype,"graphic",void 0),(0,r._)([(0,u.MZ)()],_.prototype,"mode",void 0),(0,r._)([(0,u.MZ)({type:[h.default]})],_.prototype,"orderByFields",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],_.prototype,"state",null),(0,r._)([(0,u.MZ)()],_.prototype,"filesEnabled",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],_.prototype,"supportsResizeAttachments",null),_=(0,r._)([(0,c.$)("esri.widgets.Attachments.AttachmentsViewModel")],_);const b=_},25637:(e,t,i)=>{i.d(t,{A:()=>l});var r=i(93800),s=i(48602),n=(i(21265),i(50925),i(14746),i(75269)),o=i(21184);let a=class extends o.default{constructor(e){super(e),this.description=null,this.title=null}};(0,r._)([(0,s.MZ)()],a.prototype,"description",void 0),(0,r._)([(0,s.MZ)()],a.prototype,"title",void 0),a=(0,r._)([(0,n.$)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],a);const l=a},26723:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(93800),s=i(6946),n=i(48602),o=(i(21265),i(50925),i(14746),i(75269)),a=i(56488),l=i(26964),u=i(92471);let d=class extends s.default{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const r=t.clone();r.label=(0,u.getFieldInfoLabel)(r,e),i.push(r)})),i}};(0,r._)([(0,n.MZ)()],d.prototype,"attributes",void 0),(0,r._)([(0,n.MZ)({type:[a.default]})],d.prototype,"expressionInfos",void 0),(0,r._)([(0,n.MZ)()],d.prototype,"description",void 0),(0,r._)([(0,n.MZ)({type:[l.default]})],d.prototype,"fieldInfos",void 0),(0,r._)([(0,n.MZ)({readOnly:!0})],d.prototype,"formattedFieldInfos",null),(0,r._)([(0,n.MZ)()],d.prototype,"title",void 0),d=(0,r._)([(0,o.$)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],d);const c=d},27531:(e,t,i)=>{i.d(t,{A:()=>b});var r=i(93800),s=i(79625),n=i(6946),o=i(62631),a=i(85715),l=i(89129),u=i(93633),d=i(49959),c=i(79953),h=i(48602),p=(i(21265),i(50925),i(75269)),f=i(31482),y=i(92471),m=i(41327);let g=class extends(a.A.ClonableMixin(u.A.IdentifiableMixin(n.default))){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const e=new AbortController;this._queryAbortController=e,await(0,d.ignoreAbortErrors)(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const e=new AbortController;this._queryFeatureCountAbortController=e,await(0,d.ignoreAbortErrors)(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const e=new AbortController;this._queryPageAbortController=e,await(0,d.ignoreAbortErrors)(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=(0,d.debounce)(this._queryController,100),this._queryFeatureCountDebounced=(0,d.debounce)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,d.debounce)(this._queryPageController,100),this._query=async()=>{const{_queryAbortController:e,relatedFeatures:t}=this;this.featureCount&&("subtype-group"!==this.relatedLayer?.type||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,t.destroyAll(),this.destroyed||t.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:e?.signal}))))},this.addHandles([(0,c.watch)((()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory]),(()=>this._queryDebounced()),c.initial),(0,c.watch)((()=>[this.featurePage,this.showAllEnabled]),(()=>this._queryPageDebounced())),(0,c.watch)((()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory]),(()=>this._queryFeatureCountDebounced()))])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:i}=this,r=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,1),r))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map((e=>{const i=e.clone();return i.field=(0,y.getFixedFieldName)(e.field,t),i})):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&null!=this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&null!=this.relationshipId&&null!=this.objectId&&e?.supportsCount&&e?.supportsPagination)}get allCategoriesCount(){return this.allCategories?.length??0}get categories(){const{allCategories:e}=this;return this.showAllEnabled?e:e?.slice(0,this.displayCount)??null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new l.default}get relatedLayer(){const{layer:e,map:t,relationship:i}=this;if(!e?.loaded||!t||!i)return null;const r="subtype-sublayer"===e.type&&e.parent&&(0,y.isRelatableFeatureSupportedLayer)(e.parent)?e.parent:e;return(0,y.findRelatedLayer)(t,r,i)??null}get relatedLayerKeyField(){const{relatedLayer:e,relationshipId:t}=this;return e?.loaded&&null!=t?e.relationships?.find((e=>e.id===t))?.keyField:null}get relatedLayerKeyFields(){const{relatedLayer:e}=this;return e?.loaded?e.relationships?.map((e=>e.keyField)).filter(o.Ru)??[]:[]}get relationship(){const{relationshipId:e,layer:t}=this;return null!=e&&t?.loaded?t.relationships?.find((t=>{let{id:i}=t;return i===e}))??null:null}get relationshipKey(){const{relationshipKeyField:e}=this;return(e&&this.graphic?.attributes?.[e])??null}get relationshipKeyField(){return this.relationship?.keyField||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new l.default}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r,_loaded:s,canLoad:n}=this;return t||n&&!s?"loading":e||i?"querying":r?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find((t=>t.getObjectId()===e))}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:t}=this;await(e?.load()),await(t?.load());const{_queryFeatureCountAbortController:r,activeCategory:s,canQuery:n,objectId:a,relatedLayerKeyField:l,relationshipId:u,relationshipKey:d,supportsCacheHint:c}=this;if(!n||!e||!t||null==a)return this._set("featureCount",0),void this._set("allCategories",null);if("subtype-group"===t?.type&&!s){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),l&&null!=d){const{default:e}=await Promise.all([i.e(81765),i.e(29071),i.e(68584),i.e(47464),i.e(85793),i.e(66809),i.e(2938),i.e(46705)]).then(i.bind(i,69086)),{uniqueValueInfos:s}=await e({layer:t,sqlWhere:`${l} = '${d}'`,field:t.subtypeField,signal:r?.signal}),n=s.map((e=>{let{count:i,value:r}=e;const s=t.subtypes?.find((e=>e.code===r))?.name;return null!=r&&s?{count:i,value:r,name:s}:void 0})).filter(o.Ru);this._set("allCategories",n)}return}const{historicMoment:h,gdbVersion:p}=e,y=new f.default({cacheHint:c,gdbVersion:p,historicMoment:h,relationshipId:u,returnGeometry:!1,objectIds:[a],where:this._getRelationshipWhereClause(t)}),m=await e.queryRelatedFeaturesCount(y,{signal:r?.signal});this._set("allCategories",null),this._set("featureCount",m[a]||0)}_getRelationshipWhereClause(e){const{activeCategory:t}=this,i=e.createQuery(),r="subtypeField"in e?e.subtypeField:void 0,s=t&&r?`${r} = ${t.value}`:void 0,n=i.where;return n&&s?`(${n}) AND (${s})`:n??s}_sliceFeatures(e){const{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:r,featureCount:s}=this;!i||t<2||!s||"subtype-group"===this.relatedLayer?.type&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:r?.signal}))}async _queryRelatedFeatures(e){const{displayCount:t,featureCount:i,featurePage:r,featuresPerPage:s,layer:n,orderByFieldsFixedCasing:o,relatedLayer:a,relatedLayerKeyFields:l,relationshipId:u,showAllEnabled:d,supportsCacheHint:c}=this,{canQuery:h,objectId:p}=this;if(!h||!n||!a||null==p)return[];const y=d?((r-1)*s+i)%i:0,g=d?s:t,b=a.objectIdField,I="subtypeField"in a?a.subtypeField:void 0,v=[...o.map((e=>e.field)),...(0,m.n4)(a),...l,b,I].filter(_),w=o.map((e=>`${e.field} ${e.order}`)),{historicMoment:F,gdbVersion:T}=n,A=new f.default({orderByFields:w,start:y,num:g,outFields:v,cacheHint:c,historicMoment:F,gdbVersion:T,relationshipId:u,returnGeometry:!1,objectIds:[p],where:this._getRelationshipWhereClause(a)}),M=await n.queryRelatedFeatures(A,{signal:e?.signal}),C=M[p]?.features||[];return"subtype-group"===a.type&&I?C.forEach((e=>{const t=e.attributes[I],i=a.findSublayerForSubtypeCode?.(t);e.sourceLayer=i,e.layer=i})):C.forEach((e=>{e.sourceLayer=a,e.layer=a})),C}};function _(e){return null!=e&&""!==e}(0,r._)([(0,h.MZ)()],g.prototype,"_loaded",void 0),(0,r._)([(0,h.MZ)()],g.prototype,"_queryAbortController",void 0),(0,r._)([(0,h.MZ)()],g.prototype,"_queryPageAbortController",void 0),(0,r._)([(0,h.MZ)()],g.prototype,"_queryFeatureCountAbortController",void 0),(0,r._)([(0,h.MZ)({value:1})],g.prototype,"featurePage",null),(0,r._)([(0,h.MZ)()],g.prototype,"featuresPerPage",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"orderByFieldsFixedCasing",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"supportsCacheHint",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"canLoad",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"canQuery",null),(0,r._)([(0,h.MZ)()],g.prototype,"activeCategory",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"allCategories",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"allCategoriesCount",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"categories",null),(0,r._)([(0,h.MZ)()],g.prototype,"description",void 0),(0,r._)([(0,h.MZ)({value:3})],g.prototype,"displayCount",null),(0,r._)([(0,h.MZ)({type:s.default})],g.prototype,"graphic",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"itemDescriptionFieldName",null),(0,r._)([(0,h.MZ)()],g.prototype,"layer",void 0),(0,r._)([(0,h.MZ)()],g.prototype,"map",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"objectId",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"objectIdField",null),(0,r._)([(0,h.MZ)()],g.prototype,"orderByFields",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relatedFeatures",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relatedLayer",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relatedLayerKeyField",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relatedLayerKeyFields",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relationship",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relationshipKey",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relationshipKeyField",null),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"featureCount",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],g.prototype,"relatedFeatureViewModels",null),(0,r._)([(0,h.MZ)()],g.prototype,"relationshipId",void 0),(0,r._)([(0,h.MZ)()],g.prototype,"showAllEnabled",void 0),(0,r._)([(0,h.MZ)()],g.prototype,"state",null),(0,r._)([(0,h.MZ)()],g.prototype,"title",void 0),g=(0,r._)([(0,p.$)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],g);const b=g},35527:(e,t,i)=>{i.d(t,{k:()=>l});var r=i(3481),s=i(12711),n=i(51536);function o(e){if(!e)return"";const t=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let i="";for(const r of e.match(t)||[])switch(r){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":i+=r;break;case"A":case"a":i+="a";break;default:i+=`'${r}'`}return i}const a="esri.core.sql.timeonly";class l{constructor(e,t,i,r){this._hour=e,this._minute=t,this._second=i,this._millisecond=r,this.declaredRootClass=a}static isTimeOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===a}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return l.isTimeOnly(e)&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new l(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,r.Fq)(this.hour)&&(0,r.Fq)(this.minute)&&(0,r.Fq)(this.second)&&(0,r.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e||""===e?this.toString():(e=o(e))?n.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:(0,s.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,t,i,r){const s=new l(e,t,i,r);return s.isValid()?s:null}static fromReader(e){if(!e)return null;const t=e.split(":");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const t=Math.floor(e/1e3%60),i=Math.floor(e/6e4%60),r=Math.floor(e/36e5%24),s=Math.floor(e%1e3);return new l(r,i,t,s)}static fromDateJS(e){return new l(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new l(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const i=[];t?(t=o(t))&&i.push(t):null!==t&&""!==t||(i.push("HH:mm:ss"),i.push("HH:mm:ss.SSS"),i.push("hh:mm:ss a"),i.push("hh:mm:ss.SSS a"),i.push("HH:mm"),i.push("hh:mm a"),i.push("H:mm"),i.push("h:mm a"),i.push("H:mm:ss"),i.push("h:mm:ss a"),i.push("H:mm:ss.SSS"),i.push("h:mm:ss.SSS a"));for(const r of i){const t=n.c9.fromFormat(e,r);if(t.isValid)return new l(t.hour,t.minute,t.second,t.millisecond)}return null}plus(e,t){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}return null}toUTCDateTime(){return n.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}}},39817:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(42080);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new s(e.lengths,e.coords)}static fromRect(e){const[t,i,r,n]=e,o=r-t,a=n-i;return new s([5],[t,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}get usedMemory(){return 64+(0,r.Qf)(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let i=0;i<this.lengths.length;i++){const r=this.lengths[i];if(r<3)continue;let s=this.coords[2*t],n=this.coords[2*t+1];for(let i=1;i<r;i+=1){const r=this.coords[2*(i+t)],o=this.coords[2*(i+t)+1];e+=-.5*(r-s)*(o+n),s=r,n=o}t+=r}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const r=this.lengths[i];for(let i=0;i<r;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=r}}deltaDecode(){const e=this.clone(),{coords:t,lengths:i}=e;let r=0;for(const s of i){for(let e=1;e<s;e++)t[2*(r+e)]+=t[2*(r+e)-2],t[2*(r+e)+1]+=t[2*(r+e)-1];r+=s}return e}clone(e){if(0===this.lengths.length)return new s([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),i=this.coords.slice(0,t);return e?(e.set(i),new s(this.lengths,e)):new s(Array.from(this.lengths),Array.from(i))}}},40602:(e,t,i)=>{function r(e,t){return e?t?4:3:t?3:2}function s(e,t,i,s){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],u=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:c}=t,h=r(i,s);let p=0;for(const r of d){const e=n(u,c,p,r,i,s);e&&l.push(e),p+=r*h}if(l.sort(((e,t)=>{let r=e[2]-t[2];return 0===r&&i&&(r=e[4]-t[4]),r})),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,i&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<u[0]||a[0]>u[1]||a[1]<u[2]||a[1]>u[3]||i&&(a[2]<u[4]||a[2]>u[5]))&&(a.length=0)}if(!a.length){const e=t.lengths[0]?o(c,0,d[0],i,s):null;if(!e)return null;a[0]=e[0],a[1]=e[1],i&&e.length>2&&(a[2]=e[2])}return e}function n(e,t,i,s,n,o){const a=r(n,o);let l=i,u=i+a,d=0,c=0,h=0,p=0,f=0;for(let r=0,m=s-1;r<m;r++,l+=a,u+=a){const i=t[l],r=t[l+1],s=t[l+2],o=t[u],a=t[u+1],y=t[u+2];let m=i*a-o*r;p+=m,d+=(i+o)*m,c+=(r+a)*m,n&&(m=i*y-o*s,h+=(s+y)*m,f+=m),i<e[0]&&(e[0]=i),i>e[1]&&(e[1]=i),r<e[2]&&(e[2]=r),r>e[3]&&(e[3]=r),n&&(s<e[4]&&(e[4]=s),s>e[5]&&(e[5]=s))}if(p>0&&(p*=-1),f>0&&(f*=-1),!p)return null;const y=[d,c,.5*p];return n&&(y[3]=h,y[4]=.5*f),y}function o(e,t,i,s,n){const o=r(s,n);let c=t,h=t+o,p=0,f=0,y=0,m=0;for(let r=0,g=i-1;r<g;r++,c+=o,h+=o){const t=e[c],i=e[c+1],r=e[c+2],n=e[h],o=e[h+1],g=e[h+2],_=s?l(t,i,r,n,o,g):a(t,i,n,o);if(_)if(p+=_,s){const e=d(t,i,r,n,o,g);f+=_*e[0],y+=_*e[1],m+=_*e[2]}else{const e=u(t,i,n,o);f+=_*e[0],y+=_*e[1]}}return p>0?s?[f/p,y/p,m/p]:[f/p,y/p]:i>0?s?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,i,r){const s=i-e,n=r-t;return Math.sqrt(s*s+n*n)}function l(e,t,i,r,s,n){const o=r-e,a=s-t,l=n-i;return Math.sqrt(o*o+a*a+l*l)}function u(e,t,i,r){return[e+.5*(i-e),t+.5*(r-t)]}function d(e,t,i,r,s,n){return[e+.5*(r-e),t+.5*(s-t),i+.5*(n-i)]}i.d(t,{Q:()=>s})},42080:(e,t,i)=>{i.d(t,{$B:()=>s,Qf:()=>u,Qh:()=>a,RS:()=>n,ez:()=>h,i5:()=>p,lM:()=>o,qK:()=>c,rq:()=>d});var r=i(25048);function s(e){return 32+e.length}const n=16;function o(e){if(!e)return 0;let t=c;for(const i in e)e.hasOwnProperty(i)&&(t+=l(e[i],!1));return t}function a(e){if(!e)return 0;if("number"==typeof e[0])return u(e);if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return d(e,8);let i=h;for(let r=0;r<t;r++)i+=l(e[r]);return i}(e);let t=c;for(const i in e)e.hasOwnProperty(i)&&(t+=l(e[i]));return t}function l(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"object":return t?a(e):c;case"string":return s(e);case"number":return n;case"boolean":return 4;default:return 8}}function u(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.reduce(((e,t)=>e+(t?(0,r.iu)(t)?t.byteLength+p:Array.isArray(t)?d(t,n):0:0)),0)}function d(e,t){return h+e.length*t}const c=32,h=16,p=145},50939:(e,t,i)=>{i.d(t,{A:()=>F});var r=i(93800),s=i(79625),n=i(6946),o=i(58828),a=i(17741),l=i(49959),u=i(79953),d=i(76469),c=i(48602),h=(i(21265),i(50925),i(14746),i(75269)),p=i(75400),f=(i(76519),i(62155),i(83014),i(23621),i(45608)),y=i(36917),m=(i(19609),i(7282)),g=(i(12969),i(89174)),_=i(78759),b=i(26723),I=i(377),v=i(95579);let w=class extends n.default{constructor(e){super(e),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{const e=this.contentElement?.type;this.contentElementViewModel?.destroy();const t="fields"===e?new b.A:"media"===e?new I.A:"text"===e?new _.A:null;this._set("contentElementViewModel",t)},this._compileThrottled=(0,d.n)(this._startCompile,(()=>this.notifyChange("state")),1,this),this._evaluateThrottled=(0,d.n)(this._startEvaluate,(()=>this.notifyChange("state")),1,this),this.addHandles([(0,u.watch)((()=>[this.expressionInfo,this.graphic]),(()=>this._compileThrottled()),u.initial),(0,u.watch)((()=>[this.contentElement]),(()=>this._createVM()),u.initial),(0,u.when)((()=>{if(!this._compileTask?.finished)return null;const e=this._compileTask.value,t=e?.dependencies;return[e,this.spatialReference,this.map,this.view,t?.has("view-scale")?this.view?.scale:null,t?.has("view-time-extent")?this.view?.timeExtent?.start:null,t?.has("view-time-extent")?this.view?.timeExtent?.end:null]}),(e=>{let[t]=e;return this._evaluateThrottled(t)}))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){this._compileTask=(0,a.DC)(this._compileTask),this._evaluateTask=(0,a.DC)(this._evaluateTask),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null)}get contentElement(){return this._evaluateTask?.value}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{contentElement:e,contentElementViewModel:t}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||!this._compileTask?.finished||!this._evaluateTask?.finished?"loading":e||t?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}_startCompile(){this._evaluateTask=(0,a.DC)(this._evaluateTask),this._compileTask=(0,a.DC)(this._compileTask),this._compileTask=(0,o.UT)((async e=>{const{expressionInfo:t,graphic:i}=this;if(!t||!i)return null;const r=await(0,v.lw)();(0,l.throwIfAborted)(e);const s=await(0,v.Wo)({expressionInfo:t,arcade:r,graphic:i});return(0,l.throwIfAborted)(e),s}))}_startEvaluate(e){this._evaluateTask=(0,a.DC)(this._evaluateTask),this._evaluateTask=(0,o.UT)((async t=>{const{graphic:i}=this;if(!e||!i)return null;const{interceptor:r,spatialReference:s,map:n,location:o,view:a}=this,u=await e.evaluate({graphic:i,interceptor:r,location:o,map:n,options:{signal:t},spatialReference:s,view:a});(0,l.throwIfAborted)(t);const d=u;if(!d||"esri.arcade.Dictionary"!==d.declaredClass)return null;const c=await d.castAsJsonAsync(t);(0,l.throwIfAborted)(t);const h=c?.type,p="media"===h?y.default.fromJSON(c):"text"===h?m.default.fromJSON(c):"fields"===h?f.default.fromJSON(c):null;return"media"===p.type&&!p.mediaInfos||"fields"===p.type&&!p.fieldInfos||"text"===p.type&&!p.text?null:p}))}};(0,r._)([(0,c.MZ)()],w.prototype,"_compileTask",void 0),(0,r._)([(0,c.MZ)()],w.prototype,"_evaluateTask",void 0),(0,r._)([(0,c.MZ)({type:g.default})],w.prototype,"expressionInfo",void 0),(0,r._)([(0,c.MZ)({type:s.default})],w.prototype,"graphic",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],w.prototype,"contentElement",null),(0,r._)([(0,c.MZ)({readOnly:!0})],w.prototype,"contentElementViewModel",void 0),(0,r._)([(0,c.MZ)()],w.prototype,"interceptor",void 0),(0,r._)([(0,c.MZ)({type:p.default})],w.prototype,"location",void 0),(0,r._)([(0,c.MZ)()],w.prototype,"spatialReference",null),(0,r._)([(0,c.MZ)({readOnly:!0})],w.prototype,"state",null),(0,r._)([(0,c.MZ)()],w.prototype,"map",null),(0,r._)([(0,c.MZ)()],w.prototype,"view",void 0),w=(0,r._)([(0,h.$)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],w);const F=w},51320:(e,t,i)=>{i.r(t),i.d(t,{default:()=>D});var r=i(93800),s=i(79625);var n,o=i(6946),a=i(62631),l=i(58828),u=i(89129),d=i(93633),c=i(50925),h=i(17741),p=i(49959),f=i(79953),y=i(76469),m=i(48602),g=i(32980),_=(i(21265),i(75269)),b=i(75400),I=i(93321),v=i(7282),w=i(1802),F=i(73210),T=i(25637),A=i(78759),M=i(50939),C=i(26723),x=i(377),S=i(27531),E=i(95579),O=i(92471),Z=i(5414),L=i(81558);const P="content-view-models",N="relationship-view-models",k={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0};let q=n=class extends(d.A.IdentifiableMixin(o.default)){constructor(e){super(e),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...k},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._graphicChangedThrottled=(0,y.n)(this._graphicChanged,(()=>this.notifyChange("waitingForContent")),1,this),this._isAllowedContentType=e=>{const{abilities:t}=this;return"attachments"===e.type&&!!t.attachmentsContent||"custom"===e.type&&!!t.customContent||"fields"===e.type&&!!t.fieldsContent||"media"===e.type&&!!t.mediaContent||"text"===e.type&&!!t.textContent||"expression"===e.type&&!!t.expressionContent||"relationship"===e.type&&!!t.relationshipContent||"utility-network-associations"===e.type&&!!t.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=(0,y.n)(this._evaluateExpressionAttributes,(()=>this.notifyChange("waitingForContent")),1,this),this.addHandles([(0,f.watch)((()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone]),(()=>this._graphicChangedThrottled()),f.initial),(0,f.when)((()=>{if(!this._graphicChangedTask?.finished||null==this._graphicChangedTask.value)return null;const e=this._graphicChangedTask.value,t=e?.expressionInfos?.dependencies;return[e,t?.has("view-scale")?this.view?.scale:null,t?.has("view-time-extent")?this.view?.timeExtent?.start:null,t?.has("view-time-extent")?this.view?.timeExtent?.end:null]}),(e=>{let[t]=e;return this._evaluateExpressionAttributesThrottled(t)}))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=(0,h.DC)(this._graphicChangedTask),this._evaluateExpressionAttributesTask=(0,h.DC)(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return(0,O.createFieldInfoMap)((0,O.getAllFieldInfos)(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return(0,O.getSourceLayer)(this.graphic)}castAbilities(e){return{...k,...e}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??F.qU}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){const{_graphicChangedThrottled:e,_evaluateExpressionAttributesThrottled:t,_graphicChangedTask:i,_evaluateExpressionAttributesTask:r,_associationVMAbortController:s}=this;return e.hasPendingUpdates()||t.hasPendingUpdates()||null!=i&&!i.finished||null!=r&&!r.finished||!!s}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof x.A&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof x.A&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof x.A&&t.previous()}async updateGeometry(){const{graphic:e,spatialReference:t,_sourceLayer:i}=this;await(i?.load());const r=i?.objectIdField;if(!r||!e||!i)return;const s=e?.attributes?.[r];if(null==s)return;const n=[s];if(!e.geometry){const r=await(0,O.querySourceLayer)({layer:i,graphic:e,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:t}),s=r?.geometry;s&&(e.geometry=s)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){this._evaluateExpressionAttributesTask=(0,h.DC)(this._evaluateExpressionAttributesTask),this._graphicChangedTask=(0,h.DC)(this._graphicChangedTask),this._graphicChangedTask=(0,l.UT)((async e=>{this._error=null,this._clear();const{graphic:t}=this;try{if(!t)return null;const{_sourceLayer:i,_effectivePopupTemplate:r}=this,s=this.spatialReference;await(0,O.queryUpdatedFeature)({graphic:t,popupTemplate:r,layer:i,spatialReference:s},{signal:e});const[{value:n},{value:o}]=await(0,p.eachAlways)([this._getContent(),this._getTitle()]),[,{value:a}]=await(0,p.eachAlways)([this._checkForRelatedFeatures({signal:e}),(0,E.lO)(r?.expressionInfos,t)]);return{expressionInfos:a,content:n,title:o}}catch(i){throw(0,p.isAbortError)(i)||(this._error=i,c.A.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate})),i}}))}_compileContentElement(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):"relationship"===e.type?this._compileRelationship(e,t):"utility-network-associations"===e.type?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map(((e,t)=>this._compileContentElement(e,t))).filter(a.Ru):"string"==typeof e?this._compileText(new v.default({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(N),this.removeHandles(P),this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_matchesFeature(e,t){const i=e?.graphic?.getObjectId(),r=t?.getObjectId();return null!=i&&null!=r&&i===r}_setRelatedFeaturesViewModels(e){let{relatedFeatureViewModels:t,relatedFeatures:i,map:r}=e;const{view:s,spatialReference:o,timeZone:a}=this;i?.filter(Boolean).forEach((e=>{t.some((t=>this._matchesFeature(t,e)))||t.add(new n({abilities:{relationshipContent:!1},map:r,view:s,spatialReference:o,timeZone:a,graphic:e}))})),t.forEach((e=>{const r=i?.find((t=>this._matchesFeature(e,t)));r||t.remove(e)}))}_setExpressionContentVM(e,t){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=e,n=r?.type;s&&n&&("fields"===n&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),"media"===n&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),"text"===n&&s.set(this._createTextVMParams(r)))}_compileRelationship(e,t){const{displayCount:i,orderByFields:r,relationshipId:s,title:n,description:o}=e,{_sourceLayer:a,graphic:l,map:u}=this;if(!(0,O.isRelatableFeatureSupportedLayer)(a))return;const d=new S.A({displayCount:i,graphic:l,orderByFields:r,relationshipId:s,layer:a,map:u,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[t]=d,this.addHandles((0,f.on)((()=>d.relatedFeatures),"change",(()=>this._setRelatedFeaturesViewModels(d))),N),e}_matchesGlobalFeature(e,t){const i=e?.association.globalId,r=t?.association.globalId;return null!=i&&null!=r&&i===r}async _setUpUtilityNetworkAssociationsViewModels(e,t,i){const{view:r,spatialReference:s,timeZone:o}=this;e.forEach(((i,r)=>{const s=t.get(r);s?i.forEach((t=>{s.find((e=>this._matchesGlobalFeature(t,e)))||(i.remove(t),0===i.length&&e.delete(r))})):(i.removeAll(),e.delete(r))})),t.forEach(((t,a)=>{const l=e.get(a)||new u.default;t?.filter(Boolean).forEach((e=>{l.some((t=>this._matchesGlobalFeature(t,e)))||l.add({association:e.association,featureViewModel:new n({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:r,spatialReference:s,timeZone:o,graphic:e.feature}),terminalName:e.terminalName})})),e.set(a,l)}));const a=new AbortController;this._associationVMAbortController=a,await this._sortListObjectsByTitle(e,{signal:a.signal}),this._associationVMAbortController===a&&(this._associationVMAbortController=null)}async _sortListObjectsByTitle(e,t){for(const i of e.values()){const e=i.map((e=>(0,f.whenOnce)((()=>"ready"===e.featureViewModel.state),t?.signal)));await Promise.all(e),i.sort(this._compareByFeatureTitle)}}_compareByFeatureTitle(e,t){const i=(0,w.getFeaturePopupTitle)(e.featureViewModel),r=(0,w.getFeaturePopupTitle)(t.featureViewModel);return i.localeCompare(r,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(e,t){const{displayCount:i,title:r,description:s,associationTypes:n}=e,{_sourceLayer:o,graphic:a,map:l}=this;if(!(0,O.isAssociatedFeatureSupportedLayer)(o))return;const u=new L.A({graphic:a,displayCount:i,associationTypes:n,layer:o,map:l,...this._compileTitleAndDesc({title:r,description:s})});return this.contentViewModels[t]=u,this.addHandles([(0,f.watch)((()=>u.associationFeatures.values()),(()=>this._setUpUtilityNetworkAssociationsViewModels(u.associationViewModels,u.associationFeatures,u.map)))],"association-view-models"),e}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:o,view:a,location:l}=this,u=new M.A({expressionInfo:i,graphic:r,interceptor:n.interceptor,map:s,spatialReference:o,view:a,location:l});return this.contentViewModels[t]=u,this.addHandles((0,f.watch)((()=>u.contentElementViewModel),(()=>this._setExpressionContentVM(u,t)),f.initial),P),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s,orderByFields:n}=e;return this.contentViewModels[t]=new T.A({graphic:i,orderByFields:n,...this._compileTitleAndDesc({title:s,description:r})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new A.A({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc(e){let{title:t,description:i}=e;const{_fieldInfoMap:r,_sourceLayer:s,graphic:n,formattedAttributes:o}=this,a=n?.attributes,l=this._expressionAttributes,u=o.global;return{title:(0,O.substituteFieldsInLinksAndAttributes)({attributes:a,fieldInfoMap:r,globalAttributes:u,expressionAttributes:l,layer:s,text:t}),description:(0,O.substituteFieldsInLinksAndAttributes)({attributes:a,fieldInfoMap:r,globalAttributes:u,expressionAttributes:l,layer:s,text:i})}}_createFieldsVMParams(e,t){const i=this._effectivePopupTemplate,r=this.formattedAttributes,s={...r?.global,...r?.content[t]},n=e?.fieldInfos||i?.fieldInfos,o=n?.filter((e=>{let{fieldName:t}=e;return!!t&&((0,O.isExpressionField)(t)||(0,O.isRelatedField)(t)||s.hasOwnProperty(t))})),a=i?.expressionInfos,{description:l,title:u}=e;return{attributes:s,expressionInfos:a,fieldInfos:o,...this._compileTitleAndDesc({title:u,description:l})}}_compileFields(e,t){const i=e.clone(),r=new C.A(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,u=this.formattedAttributes,d=r?.attributes??{},{description:c,mediaInfos:h,title:p}=e;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:d,isAggregate:r?.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...u?.global,...u?.content[t]},expressionAttributes:l,mediaInfos:h,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:p,description:c})}}_compileMedia(e,t){const i=e.clone(),r=new x.A(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const n=t?.attributes??{},o=this.formattedAttributes?.global??{};e.text=(0,O.substituteFieldsInLinksAndAttributes)({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new A.A(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:r}=this;if(!e)return;const{lastEditInfoEnabled:s}=e,n=t?.editFieldsInfo;return s&&n?(0,O.formatEditInfo)(n,i?.attributes,r,t):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,n=r?.attributes??{},o=this.formattedAttributes?.global??{};return(0,O.substituteFieldsInLinksAndAttributes)({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,O.graphicCallback)({type:"title",value:e?.title,event:{graphic:t}}):null}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,O.graphicCallback)({type:"content",value:e?.content,event:{graphic:t}}):null}_evaluateExpressionAttributes(e){let{title:t,content:i,expressionInfos:r}=e;this._evaluateExpressionAttributesTask=(0,h.DC)(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=(0,l.UT)((async e=>{const{graphic:s,map:o,view:a,spatialReference:l,location:u}=this;try{if(!s)return;let d;if(null!=r){const t=[];for(const[i,d]of r.expressions.entries())null!=d?t.push(d.evaluate({graphic:s,interceptor:n.interceptor,location:u,map:o,options:{signal:e},spatialReference:l,view:a}).then((e=>[i,(0,E.vc)(e)])).catch((()=>[i,void 0]))):t.push(Promise.resolve([i,void 0]));d=Object.fromEntries(await Promise.all(t)),(0,p.throwIfAborted)(e)}this._expressionAttributes=d,this._graphicExpressionAttributes={...s.attributes,...d},this._set("formattedAttributes",this._createFormattedAttributes(i)),this._set("title",this._compileTitle(t)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(i)||null)}catch(d){(0,p.isAbortError)(d)||(this._error=d,c.A.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:d,graphic:s,popupTemplate:this._effectivePopupTemplate}))}}))}_createMediaFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:r}=e;const{_effectivePopupTemplate:s,graphic:n,relatedInfos:o,_sourceLayer:a,_fieldInfoMap:l,_graphicExpressionAttributes:u,timeZone:d}=this;r.content[i]=(0,O.formatAttributes)({fieldInfos:s?.fieldInfos,graphic:n,attributes:{...u,...t.attributes},layer:a,fieldInfoMap:l,relatedInfos:o,timeZone:d})}_createFieldsFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:r}=e;if(t.fieldInfos){const{graphic:e,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a,timeZone:l}=this;r.content[i]=(0,O.formatAttributes)({fieldInfos:t.fieldInfos,graphic:e,attributes:{...a,...t.attributes},layer:n,fieldInfoMap:o,relatedInfos:s,timeZone:l})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o,timeZone:a}=this,l=t?.fieldInfos,u={global:(0,O.formatAttributes)({fieldInfos:l,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r,timeZone:a}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&this._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:u}),"media"===e.type&&this._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:u})})),u}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,(0,O.getAllFieldInfos)(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=null!=s?.associatedLayer?await(s?.associatedLayer.load(i)):s;if(!n||!e)return;const o=t.filter((e=>!!e.fieldName&&(0,O.isRelatedField)(e.fieldName)));if(!o?.length)return;t.forEach((e=>this._configureRelatedInfo(e,n)));const a=await(0,Z.Xx)({relatedInfos:r,layer:n},i);Object.keys(a).forEach((e=>{const t=r.get(e.toString()),i=a[e]?.value;t&&i&&(t.layerInfo=i.data)}));const l=await(0,Z.hM)({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach((e=>{(0,Z.nD)(l[e]?.value,r.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=(0,Z.kC)(e.fieldName||"");if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||(0,Z.cl)(s,t);o&&((0,Z.LI)({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};q.interceptor=new class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||(this.preLayerQueryCallback=e=>{}),this.preRequestCallback||(this.preLayerQueryCallback=e=>{})}}(O.preLayerQueryCallback,O.preRequestCallback),(0,r._)([(0,m.MZ)()],q.prototype,"_error",void 0),(0,r._)([(0,m.MZ)()],q.prototype,"_graphicChangedTask",void 0),(0,r._)([(0,m.MZ)()],q.prototype,"_evaluateExpressionAttributesTask",void 0),(0,r._)([(0,m.MZ)()],q.prototype,"_associationVMAbortController",void 0),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"_effectivePopupTemplate",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"_fieldInfoMap",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"_sourceLayer",null),(0,r._)([(0,m.MZ)()],q.prototype,"abilities",void 0),(0,r._)([(0,g.w)("abilities")],q.prototype,"castAbilities",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"content",void 0),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"contentViewModels",void 0),(0,r._)([(0,m.MZ)()],q.prototype,"description",void 0),(0,r._)([(0,m.MZ)({type:Boolean})],q.prototype,"defaultPopupTemplateEnabled",void 0),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"isTable",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"state",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"formattedAttributes",void 0),(0,r._)([(0,m.MZ)({type:s.default,value:null})],q.prototype,"graphic",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"lastEditInfo",void 0),(0,r._)([(0,m.MZ)({type:b.default})],q.prototype,"location",void 0),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"relatedInfos",void 0),(0,r._)([(0,m.MZ)({type:I.default})],q.prototype,"spatialReference",null),(0,r._)([(0,m.MZ)()],q.prototype,"timeZone",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"title",void 0),(0,r._)([(0,m.MZ)()],q.prototype,"map",null),(0,r._)([(0,m.MZ)({readOnly:!0})],q.prototype,"waitingForContent",null),(0,r._)([(0,m.MZ)()],q.prototype,"view",void 0),q=n=(0,r._)([(0,_.$)("esri.widgets.Feature.FeatureViewModel")],q);const D=q},52579:(e,t,i)=>{i.d(t,{A:()=>r});class r{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new r;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},57581:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h});var r,s=i(93800),n=i(19455),o=i(48602),a=i(80556),l=(i(21265),i(14746),i(75269));function u(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find((e=>e.name===i));return s?function(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find((e=>e.name===t));return r?.value||null}({tagName:r,tags:s.tags}):null}const d={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let c=r=class extends n.A{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=u({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return d[t]||null}clone(){return new r({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,s._)([(0,o.MZ)({type:String})],c.prototype,"contentType",void 0),(0,s._)([(0,o.MZ)()],c.prototype,"exifInfo",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],c.prototype,"orientationInfo",null),(0,s._)([(0,o.MZ)({type:a.jz})],c.prototype,"id",void 0),(0,s._)([(0,o.MZ)({type:String})],c.prototype,"globalId",void 0),(0,s._)([(0,o.MZ)({type:String})],c.prototype,"keywords",void 0),(0,s._)([(0,o.MZ)({type:String})],c.prototype,"name",void 0),(0,s._)([(0,o.MZ)({json:{read:!1}})],c.prototype,"parentGlobalId",void 0),(0,s._)([(0,o.MZ)({json:{read:!1}})],c.prototype,"parentObjectId",void 0),(0,s._)([(0,o.MZ)({type:a.jz})],c.prototype,"size",void 0),(0,s._)([(0,o.MZ)({json:{read:!1}})],c.prototype,"url",void 0),c=r=(0,s._)([(0,l.$)("esri.rest.query.support.AttachmentInfo")],c);const h=c},67011:(e,t,i)=>{i.d(t,{N3:()=>a,Om:()=>o});var r=i(42080),s=i(40602),n=i(39817);class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.geometry=e,this.attributes=t,this.centroid=i,this.objectId=r,this.displayId=s}static fromJSON(e){const t=e.geometry?n.A.fromJSON(e.geometry):null,i=e.centroid?n.A.fromJSON(e.centroid):null,r=e.objectId;return new o(t,e.attributes,i,r)}weakClone(){const e=new o(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new o(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=(0,s.Q)(new n.A,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+(0,r.lM)(this.attributes)+(this.geometry?.usedMemory??0)}}function a(e){return!!e.geometry?.coords?.length}},70612:(e,t,i)=>{i.d(t,{$P:()=>p,At:()=>v,J6:()=>s,JB:()=>F,Lk:()=>f,NI:()=>T,Qi:()=>w,eB:()=>A,eg:()=>g,f0:()=>m,gO:()=>_,ik:()=>b,ke:()=>c,nE:()=>h,rX:()=>y,yT:()=>I,zl:()=>r});var r,s,n,o=i(10844),a=i(73974),l=i(35527),u=i(50616),d=i(51536);function c(e){return u.default.fromJSON(e.toJSON())}function h(e){return e.toJSON?e.toJSON():e}function p(e){return e instanceof Date}function f(e){return e instanceof d.c9}function y(e){return e instanceof o.lY}function m(e){return e instanceof a.n}function g(e){return e instanceof l.k}(n=r||(r={}))[n.Standardised=0]="Standardised",n[n.StandardisedNoInterval=1]="StandardisedNoInterval",n[n.SqlServer=2]="SqlServer",n[n.Oracle=3]="Oracle",n[n.Postgres=4]="Postgres",n[n.PGDB=5]="PGDB",n[n.FILEGDB=6]="FILEGDB",n[n.NotEvaluated=7]="NotEvaluated",function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(s||(s={}));const _=1e3;const b={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},I={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},v={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};function w(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function F(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(s=t.cmp,function(e){return function(t,i){const r={key:t,value:e[t]},n={key:i,value:e[i]};return s(r,n)}});var s;const n=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let s,o;if(Array.isArray(t)){for(o="[",s=0;s<t.length;s++)s&&(o+=","),o+=e(t[s])||"null";return o+"]"}if(null===t)return"null";if(n.includes(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const a=n.push(t)-1,l=Object.keys(t).sort(r?.(t));for(o="",s=0;s<l.length;s++){const i=l[s],r=e(t[i]);r&&(o&&(o+=","),o+=JSON.stringify(i)+":"+r)}return n.splice(a,1),"{"+o+"}"}(e)}function T(e){switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"knowledge-graph-sublayer":case"oriented-imagery":case"subtype-group":case"wfs":return!0;default:return!1}}function A(e){switch(e.type){case"catalog-footprint":case"subtype-sublayer":return!0;default:return T(e)}}},73974:(e,t,i)=>{i.d(t,{n:()=>l});var r=i(10844),s=i(12711),n=i(51536);function o(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let t="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i)||[])switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"X":case"x":t+=r;break;default:r.length>=2&&"["===r.slice(0,1)&&"]"===r.slice(-1)?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}const a="esri.core.sql.dateonly";class l{constructor(e,t,i){this._year=e,this._month=t,this._day=i,this.declaredRootClass=a}static isDateOnly(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===a}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return l.isDateOnly(e)&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new l(this._year,this._month,this._day)}toDateTime(e){return n.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,r.mT)(e)})}toDateTimeLuxon(e){return n.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,r.mT)(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e||""===e)return this.toString();if(t&&(e=o(e)),!e)return"";const i=this.toDateTime("unknown");return r.lY.dateTimeToArcadeDate(i).toFormat(e,{locale:(0,s.JK)(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return r.lY.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,t){return l.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}toUTCDateTime(){return n.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const t=n.c9.fromMillis(e,{zone:n.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromSeconds(e){const t=n.c9.fromSeconds(e,{zone:n.mQ.utcInstance});return t.isValid?l.fromParts(t.year,t.month,t.day):null}static fromReader(e){if(!e)return null;const t=e.split("-");return 3!==t.length?null:new l(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}static fromParts(e,t,i){const r=new l(e,t,i);return!1===r.isValid?null:r}static fromDateJS(e){return l.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return l.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(""===e)return null;if(null===e)return null;const i=[];if(t)(t=o(t))&&i.push(t);else if(null===t||""===t){const t=n.c9.fromISO(e,{setZone:!0});return t.isValid?l.fromParts(t.year,t.month,t.day):null}for(const r of i){const i=n.c9.fromFormat(e,t??r);if(i.isValid)return new l(i.year,i.month,i.day)}return null}static fromNow(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"system";const t=n.c9.fromJSDate(new Date).setZone((0,r.mT)(e));return new l(t.year,t.month,t.day)}}},76469:(e,t,i)=>{function r(e,t,i,r){let s=null,n=1e3;"number"==typeof t?(n=t,r=i):(s=t??null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},u=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s&&s.apply(r,t),o=t,n?a||(a=setTimeout(l,n)):l()};return u.remove=()=>{a&&(clearTimeout(a),a=0)},u.forceUpdate=()=>{a&&(clearTimeout(a),l())},u.hasPendingUpdates=()=>!!a,u}i.d(t,{n:()=>r})},78759:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(93800),s=i(79625),n=i(6946),o=i(79953),a=i(48602),l=(i(21265),i(50925),i(14746),i(75269)),u=i(92471);let d=class extends n.default{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,o.watch)((()=>this.creator),(e=>{this._destroyContent(),this._createContent(e)}),o.initial))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&t&&((0,u.graphicCallback)({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}async _createContent(e){const t=this.graphic;if(!t||!e)return;const i=(0,u.graphicCallback)({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};(0,r._)([(0,a.MZ)({readOnly:!0})],d.prototype,"created",void 0),(0,r._)([(0,a.MZ)()],d.prototype,"creator",void 0),(0,r._)([(0,a.MZ)()],d.prototype,"destroyer",void 0),(0,r._)([(0,a.MZ)({type:s.default})],d.prototype,"graphic",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],d.prototype,"state",null),d=(0,r._)([(0,l.$)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],d);const c=d},83238:(e,t,i)=>{i.d(t,{GB:()=>b,IJ:()=>f,Jf:()=>_,Pk:()=>m,eW:()=>p,gW:()=>g,kS:()=>y});var r=i(23060),s=i(43103),n=i(78629),o=i(30312),a=i(70576),l=i(5957),u=i(29071),d=i(31714);const c="Layer does not support extent calculation.";function h(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let o,l,u;if(null!=i&&(l=i.spatialReference,u=(0,a.YX)(l),s.geometryType=(0,n.getJsonType)(i),s.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}(i,e.compactGeometryEnabled),s.inSR=u),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=(0,a.YX)(r.outSR),o=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,o=l),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(s.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const e=r.timeExtent,{start:t,end:i}=e;null==t&&null==i||(s.time=t===i?t:`${t??"null"},${i??"null"}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=o&&l.equals(o)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function p(e,t,i,r){const s=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await b(e,t,"json",r);return(0,d.q)(t,i,s.data),s}async function f(e,t,i,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await y(e,t,r),n=s;return n.data=(0,u.m)(s.data,i),n}function y(e,t,i){return b(e,t,"pbf",i)}function m(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):b(e,t,"json",i,{returnIdsOnly:!0})}function g(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):b(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}async function _(e,t,i){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await b(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}),s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(c);if(s.hasOwnProperty("count"))throw new Error(c);return r}async function b(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const u="string"==typeof e?(0,s.urlToObject)(e):e,d=t.geometry?[t.geometry]:[],c=await(0,o.normalizeCentralMeridian)(d,null,{signal:n.signal}),p=c?.[0];null!=p&&((t=t.clone()).geometry=p);const f=(0,l.z)({...u.query,f:i,...a,...h(t,a)});return(0,r.default)((0,s.join)(u.path,(y=a,null==t.formatOf3DObjects||y.returnCountOnly||y.returnExtentOnly||y.returnIdsOnly?"query":"query3d")),{...n,responseType:"pbf"===i?"array-buffer":"json",query:{...f,...n.query}});var y}},95579:(e,t,i)=>{i.d(t,{Wo:()=>y,lO:()=>m,lw:()=>d,vc:()=>u});var r=i(70612),s=i(50925),n=i(77969),o=i(92471),a=i(50821);const l=()=>s.A.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function u(e){return"string"==typeof e?(0,o.applyTextFormattingHTML)((0,o.htmlEntities)(e)):Array.isArray(e)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?(0,o.applyTextFormattingHTML)((0,o.htmlEntities)(e)):e}</li>`)).join("")}</ul>`}(e):"esri.arcade.Dictionary"===e?.declaredClass?function(e){const t=e.keys().map((t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof i?(0,o.applyTextFormattingHTML)((0,o.htmlEntities)(i)):i}</td></tr>`})).join("");return`<table class="${a.D.table}">${t}</table>`}(e):e}async function d(){const[e,t]=await Promise.all([i.e(40834).then(i.bind(i,18453)),Promise.all([i.e(81765),i.e(60897),i.e(95927),i.e(35494),i.e(18920)]).then(i.bind(i,18920))]);return{executor:e,syntaxUtils:t}}function c(e){return{scale:e?.scale,timeProperties:{currentStart:e?.timeExtent?.start,currentEnd:e?.timeExtent?.end,startIncluded:!0,endIncluded:!0}}}function h(e){return{$voxel:e}}async function p(e,t,i,r,s){let o=null;if(s.has("$aggregatedfeatures")){const s=await async function(e){let{graphic:t,view:i,options:r}=e;const{isAggregate:s,layer:n}=t;if(!s||!n||"2d"!==i?.type)return[];const o=await i.whenLayerView(n);if(!function(e){return"createQuery"in e&&"queryFeatures"in e}(o))return[];const a=o.createQuery(),l=t.getObjectId();a.aggregateIds=null!=l?[l]:[];const{features:u}=await o.queryFeatures(a,r);return u}({graphic:e,view:t,options:i}),a=e.sourceLayer||e.layer;o=function(e){let{layer:t,aggregatedFeatures:i,interceptor:r}=e;const{fields:s,objectIdField:o,geometryType:a,spatialReference:l,displayField:u}=t;return new n.default({fields:s,objectIdField:o,geometryType:a,spatialReference:l,displayField:u,interceptor:r,..."feature"===t.type?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null,source:i})}({layer:a,aggregatedFeatures:s,interceptor:r})}return{vars:{$feature:e,$aggregatedFeatures:o,$view:c(t)},[Symbol.dispose]:()=>o?.[Symbol.dispose]()}}function f(e,t,i,s){const n=(e.sourceLayer||e.layer)??void 0;return{$feature:e,$layer:null!=n&&(0,r.eB)(n)?n:"scene"===n?.type&&null!=n.associatedLayer?n.associatedLayer:void 0,$map:t,$datastore:n?.url,$userInput:i,$graph:"knowledge-graph-sublayer"===n?.type?n?.parentCompositeLayer?.knowledgeGraph:void 0,$view:c(s)}}async function y(e){let{expressionInfo:t,arcade:{executor:i,syntaxUtils:r},graphic:s}=e;const n=t?.expression;if(!n)return null;const o=function(e){const t="esri.views.3d.layers.VoxelGraphic"===e.declaredClass;return e.isAggregate?"popup-feature-reduction":t?"popup-voxel":"popup"}(s),a=i.createArcadeProfile(o);let u;try{u=await i.createArcadeExecutor(n,a)}catch(c){return l().error("arcade-executor-error",{error:c,expressionInfo:t}),null}const d=new Set;return u.variablesUsed.includes("$view")&&(r.scriptUsesViewProperties(u.syntaxTree,["scale"])&&d.add("view-scale"),r.scriptUsesViewProperties(u.syntaxTree,["timeProperties"])&&d.add("view-time-extent")),{dependencies:d,async evaluate(e){let{graphic:i,interceptor:r,location:s,map:n,options:a,spatialReference:d,view:y}=e;const m=await async function(e,t){let{graphic:i,map:r,location:s,view:n,options:o,interceptor:a,arcadeExecutor:l}=t;switch(e){case"popup":return{vars:f(i,r,s,n),[Symbol.dispose](){}};case"popup-feature-reduction":{const e=new Set(l.variablesUsed);return await p(i,n,o,a,e)}case"popup-voxel":return{vars:h(i),[Symbol.dispose](){}};default:throw new Error(`Unexpected profile name ${e}`)}}(o,{graphic:i,map:n,location:s,view:y,options:a,interceptor:r,arcadeExecutor:u}),g={abortSignal:a?.signal??void 0,interceptor:r??void 0,rawOutput:!0,spatialReference:d??void 0,timeZone:y?.timeZone,console(){l().info(...arguments)}};try{return await u.executeAsync(m.vars,g)}catch(c){return void l().error("arcade-execution-error",{error:c,graphic:i,expressionInfo:t})}finally{m[Symbol.dispose]()}}}}async function m(e,t){if(!e?.length)return{dependencies:new Set,expressions:new Map};const i=await d(),r=new Set,s=new Map;for(const n of e){const e=await y({expressionInfo:n,arcade:i,graphic:t});s.set(`expression/${n.name}`,e),e?.dependencies.forEach((e=>r.add(e)))}return{dependencies:r,expressions:s}}}}]);