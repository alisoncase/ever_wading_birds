"use strict";(self.webpackChunkever_wading_birds=self.webpackChunkever_wading_birds||[]).push([[3040],{13040:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var s=i(9950),a=i(2240),n=i(70443),l=i(83813),r=i(74841),o=i(42074),c=i(28429);const d="https://ekimvjwlyruqwmcnphoq.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVraW12andseXJ1cXdtY25waG9xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1ODU1MDQsImV4cCI6MjA1ODE2MTUwNH0.Wsi8U7o2rlUxYuo6HCSFoQprkWaRuLzrH3l26hDf_js";const p=(0,i(37774).UU)(d,m);var g=i(44414);const h=s.lazy((()=>i.e(9440).then(i.bind(i,99440))));const u=function(){const[e,t]=(0,s.useState)([]),[i,d]=(0,s.useState)({}),[m,u]=(0,s.useState)([]),[b,y]=(0,s.useState)(null),[f,x]=(0,s.useState)({species:"",lat:"",lon:"",date:(new Date).toISOString().split("T")[0],time:(new Date).toLocaleTimeString("en-US",{hour12:!1}).slice(0,5)}),[j,v]=(0,s.useState)(!1),[S,w]=(0,s.useState)(null),[N,D]=(0,s.useState)([]),[k,I]=(0,s.useState)(""),[_,F]=(0,s.useState)(!1),[T,C]=(0,s.useState)(!1),[L,E]=(0,s.useState)(!1),[z,O]=(0,s.useState)(""),[R,U]=(0,s.useState)(""),A=(0,s.useRef)(null),B=(0,s.useRef)(null);(0,s.useEffect)((()=>{console.log("Initializing WebMap and MapView...");const e=new n.A({basemap:"gray-vector"}),t=new a.A({container:A.current,map:e,center:[-80.898651,25.286615],zoom:9,ui:{components:["zoom","attribution"]},popup:{dockEnabled:!1,visible:!0}});B.current=t;const i=new l.A({view:t,useHeadingEnabled:!1,goToOverride:e=>(e.target.scale=5e3,e)});t.ui.add(i,{position:"top-left"}),e.basemap.baseLayers.forEach((e=>{e.popupEnabled=!1})),t.when((()=>{console.log("MapView successfully initialized."),t.ui.move("zoom","top-left"),t.on("click",(async e=>{const i=(await t.hitTest(e)).results.find((e=>{const t=e.graphic.layer;return t&&t.popupTemplate}));if(i){const s=i.graphic,a=s.attributes||{},n=s.layer.popupTemplate;t.popup.open({location:e.mapPoint,title:a.maplabel||n.title||"No Title",content:n.content||"No Content"})}else{t.popup.close();const{latitude:i,longitude:s}=e.mapPoint;x((e=>({...e,lat:i.toFixed(6),lon:s.toFixed(6)})))}}))})).catch((e=>{console.error("Error initializing MapView:",e)}));(async()=>{const t=async(e,t,i)=>{const{data:s,error:a}=await p.from(e).select("geom_geojson, maplabel");if(a)return console.error(`Error fetching ${t} data:`,a),null;const n=s.map(((e,t)=>({geometry:{type:"polyline",paths:JSON.parse(e.geom_geojson).coordinates},attributes:{objectid:t+1,maplabel:e.maplabel}})));return new r.default({source:n,fields:[{name:"objectid",alias:"ObjectID",type:"oid"},{name:"maplabel",alias:"Name",type:"string"}],objectIdField:"objectid",geometryType:"polyline",spatialReference:{wkid:4326},renderer:{type:"simple",symbol:{type:"simple-line",color:`rgba(${i}, 0.5)`,width:1}},title:t,visible:!0,popupEnabled:!0,popupTemplate:{title:"{maplabel}",content:"{maplabel}"},elevationInfo:{mode:"on-the-ground"}})},i=await t("roads","Roads","255, 255, 255"),s=await t("trails","Trails","77, 80, 75");i&&e.add(i),s&&e.add(s),i&&e.layers.reorder(i,0),s&&e.layers.reorder(s,0)})();(async()=>{const{data:i,error:s}=await p.from("pois").select("poitype, geom_geojson, maplabel");if(s)return void console.error("Error fetching POIs:",s);const a={"Boat Launch":"/img/Boat_Launch.svg",Campground:"/img/Campground.svg",Campsite:"/img/Campsite.svg","Canoe / Kayak Access":"/img/Canoe_Kayak_Access.svg","Entrance Station":"/img/Entrance_Station.svg","Food Service":"/img/Food_Service.svg","Parking Lot":"/img/Parking_Lot.svg","Picnic Area":"/img/Picnic_Area.svg","Ranger Station":"/img/Ranger_Station.svg",Restroom:"/img/Restroom.svg",Trailhead:"/img/Trailhead.svg","Visitor Center":"/img/Visitor_Center.svg"},n={},l=[];i.forEach((t=>{if(!n[t.poitype]){const i=new r.default({source:[],fields:[{name:"objectid",alias:"ObjectID",type:"oid"},{name:"poitype",alias:"POI Type",type:"string"},{name:"maplabel",alias:"Name",type:"string"}],objectIdField:"objectid",geometryType:"point",spatialReference:{wkid:4326},renderer:{type:"simple",symbol:{type:"picture-marker",url:a[t.poitype],width:"24px",height:"24px"}},title:t.poitype,visible:!1,popupEnabled:!0,popupTemplate:{title:"{maplabel}",content:"\n                <b>Type:</b> {poitype}<br>\n                <b>Name:</b> {maplabel}\n              "}});n[t.poitype]=i,l.push(i),e.add(i)}const i=JSON.parse(t.geom_geojson);n[t.poitype].source.push({geometry:{type:"point",longitude:i.coordinates[0],latitude:i.coordinates[1]},attributes:{objectid:n[t.poitype].source.length+1,poitype:t.poitype,maplabel:t.maplabel}})})),t.when((()=>{const e=t.map.layers;l.forEach((t=>{e.remove(t),e.add(t)}))})),d(n)})();(async()=>{const{data:e,error:t}=await p.from("birds").select("*");t?console.error("Error fetching birds:",t):u(e)})();return(async()=>{const{data:t,error:i}=await p.from("sightings").select("*");if(i)return console.error("Error fetching sightings:",i),null;const s=t.map(((e,t)=>({geometry:{type:"point",longitude:e.lon,latitude:e.lat},attributes:{sighting_id:e.sighting_id,species:e.species,formatted_date:new Date(e.date).toLocaleDateString("en-US"),time:e.time}})));D(s),console.log("Fetched Sightings Data:",t);const a=new r.default({source:s,fields:[{name:"sighting_id",alias:"Sighting ID",type:"oid"},{name:"species",alias:"Species",type:"string"},{name:"formatted_date",alias:"Date",type:"string"},{name:"time",alias:"Time",type:"string"}],objectIdField:"sighting_id",geometryType:"point",spatialReference:{wkid:4326},renderer:{type:"simple",symbol:{type:"picture-marker",url:"/img/Bird.svg",width:"24px",height:"24px"}},title:"Sightings",visible:!1,popupTemplate:{title:"Sighting Details",content:"\n            <b>Species:</b> {species}<br>\n            <b>Date:</b> {formatted_date}<br> \x3c!-- Use the renamed field --\x3e\n            <b>Time:</b> {time}\n          "}});e.add(a),w(a)})(),()=>{console.log("Destroying MapView..."),t&&t.destroy()}}),[]);const M=e=>{const t=B.current;if("sightings"===e){if(S){const e=!_;if(S.visible=e,t){const i=t.map.findLayerById(S.id);i&&(i.visible=e)}F(e)}}else{const s=i[e];if(s){if(s.visible=!s.visible,t){const e=t.map.findLayerById(s.id);e&&(e.visible=s.visible)}d({...i,[e]:s})}}},P=e=>{const{name:t,value:i}=e.target;x({...f,[t]:i})};return(0,g.jsx)(o.Kd,{children:(0,g.jsx)(s.Suspense,{fallback:(0,g.jsx)("div",{children:"Loading..."}),children:(0,g.jsxs)(c.BV,{children:[(0,g.jsx)(c.qh,{path:"/",element:(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{id:"mapViewDiv",ref:A,style:{height:"100vh",width:"100%"}}),(0,g.jsxs)("div",{className:"form-panel",children:[(0,g.jsx)("h3",{className:"text-center",children:"Submit a Bird Sighting"}),j?(0,g.jsxs)("div",{className:"thank-you-message text-center",children:[(0,g.jsx)("h4",{children:"Thank you for your submission!"}),(0,g.jsx)("button",{className:"btn btn-primary mt-3",onClick:()=>{x({species:"",lat:"",lon:"",date:"",time:""}),y(null),v(!1)},children:"Submit Another Sighting"})]}):(0,g.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const{species:t,lat:i,lon:s,date:a,time:n}=f,l={species:t,lat:parseFloat(i),lon:parseFloat(s),date:a,time:n},{error:o}=await p.from("sightings").insert([l]);if(o)console.error("Error submitting sighting:",o);else{console.log("Sighting submitted successfully:",l),v(!0);const{data:e,error:t}=await p.from("sightings").select("*");if(t)console.error("Error fetching updated sightings:",t);else{console.log("Updated sightings data:",e),console.log("Sightings data:",e.map((e=>e.date)));const t=e.map(((e,t)=>({geometry:{type:"point",longitude:e.lon,latitude:e.lat},attributes:{sighting_id:e.sighting_id,species:e.species,formatted_date:new Date(e.date).toLocaleDateString("en-US"),time:e.time}})));D(t),console.log("Updated Features:",t);const i=B.current;if(i&&S){const e=i.map.findLayerById(S.id);e&&i.map.remove(e)}const s=new r.default({source:t,fields:[{name:"sighting_id",alias:"Sighting ID",type:"oid"},{name:"species",alias:"Species",type:"string"},{name:"formatted_date",alias:"Date",type:"string"},{name:"time",alias:"Time",type:"string"}],objectIdField:"sighting_id",geometryType:"point",spatialReference:{wkid:4326},renderer:{type:"simple",symbol:{type:"picture-marker",url:"/img/Bird.svg",width:"24px",height:"24px"}},title:"Sightings",visible:_,popupTemplate:{title:"Sighting Details",content:e=>{const t=e.graphic.attributes;return console.log("Popup Attributes:",t),`\n                <b>Species:</b> ${t.species}<br>\n                <b>Date:</b> ${t.formatted_date}<br>\n                <b>Time:</b> ${t.time}\n              `}}});i&&i.map.add(s),w(s)}}},children:[(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"species",className:"form-label",children:"Select Bird Species:"}),(0,g.jsxs)("select",{id:"species",name:"species",className:"form-select",value:f.species,onChange:e=>{const t=m.find((t=>t.species===e.target.value));y(t),x({...f,species:e.target.value})},required:!0,children:[(0,g.jsx)("option",{value:"",children:"-- Select a Species --"}),m.map((e=>(0,g.jsx)("option",{value:e.species,children:e.species},e.species)))]})]}),b&&(0,g.jsxs)("div",{className:"bird-details mb-3",children:[(0,g.jsx)("h4",{children:b.species}),(0,g.jsx)("img",{src:b.photo,alt:b.species,className:"img-fluid bird-image mb-2"}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Photo Attribution:"})," ",(0,g.jsx)("span",{dangerouslySetInnerHTML:{__html:b.photo_attr}})]}),(0,g.jsx)("p",{children:b.info}),(0,g.jsx)("a",{href:b.info_link,target:"_blank",rel:"noopener noreferrer",children:"Learn More"})]}),(0,g.jsx)("p",{className:"text-muted mb-3",children:"Click anywhere on the map to populate the latitude and longitude fields."}),(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"lat",className:"form-label",children:"Latitude:"}),(0,g.jsx)("input",{type:"number",id:"lat",name:"lat",className:"form-control",value:f.lat,onChange:P,required:!0})]}),(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"lon",className:"form-label",children:"Longitude:"}),(0,g.jsx)("input",{type:"number",id:"lon",name:"lon",className:"form-control",value:f.lon,onChange:P,required:!0})]}),(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"date",className:"form-label",children:"Date:"}),(0,g.jsx)("input",{type:"date",id:"date",name:"date",className:"form-control",value:f.date,onChange:P,required:!0})]}),(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"time",className:"form-label",children:"Time:"}),(0,g.jsx)("input",{type:"time",id:"time",name:"time",className:"form-control",value:f.time,onChange:P,required:!0})]}),(0,g.jsx)("button",{type:"submit",className:"btn btn-primary w-100",children:"Submit Sighting"})]})]}),(0,g.jsx)("div",{className:"layer-toggles-wrapper "+(T?"minimized":""),style:{position:"absolute",bottom:"10px",left:"10px",zIndex:1e3},children:(0,g.jsxs)("div",{className:"layer-toggles",children:[(0,g.jsxs)("div",{className:"layer-header",children:[(0,g.jsx)("h5",{children:"Points of Interest"}),(0,g.jsx)("button",{className:"btn btn-sm btn-outline-secondary minimize-button",onClick:()=>{C(!T),console.log("isPOILayersMinimized:",!T)},children:T?"+":"-"})]}),!T&&(0,g.jsx)(g.Fragment,{children:Object.keys(i).sort(((e,t)=>e.localeCompare(t))).map((e=>(0,g.jsxs)("div",{className:"form-check",children:[(0,g.jsx)("input",{type:"checkbox",id:e,className:"form-check-input",checked:i[e].visible,onChange:()=>M(e)}),(0,g.jsx)("label",{htmlFor:e,className:"form-check-label",children:e})]},e)))})]})}),(0,g.jsx)("div",{className:"layer-toggles-wrapper "+(L?"minimized":""),style:{position:"absolute",bottom:"10px",left:"50%",transform:"translateX(-50%)",zIndex:1e3},children:(0,g.jsxs)("div",{className:"layer-toggles",children:[(0,g.jsxs)("div",{className:"layer-header",children:[(0,g.jsx)("h5",{children:"Sightings"}),(0,g.jsx)("button",{className:"btn btn-sm btn-outline-secondary minimize-button",onClick:()=>{E(!L),console.log("isSightingsLayersMinimized:",!L)},children:L?"+":"-"})]}),!L&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"form-check",children:[(0,g.jsx)("input",{type:"checkbox",id:"sightingsLayerToggle",className:"form-check-input",checked:_,onChange:()=>M("sightings")}),(0,g.jsx)("label",{htmlFor:"sightingsLayerToggle",className:"form-check-label",children:"View Sightings"})]}),(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"speciesFilter",className:"form-label",children:"Filter by Species:"}),(0,g.jsxs)("select",{id:"speciesFilter",className:"form-select",value:k,onChange:e=>I(e.target.value),children:[(0,g.jsx)("option",{value:"",children:"-- All Species --"}),m.map((e=>(0,g.jsx)("option",{value:e.species,children:e.species},e.species)))]})]}),(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"startDate",className:"form-label",children:"Start Date:"}),(0,g.jsx)("input",{type:"date",id:"startDate",className:"form-control",value:z,onChange:e=>O(e.target.value)})]}),(0,g.jsxs)("div",{className:"mb-3",children:[(0,g.jsx)("label",{htmlFor:"endDate",className:"form-label",children:"End Date:"}),(0,g.jsx)("input",{type:"date",id:"endDate",className:"form-control",value:R,onChange:e=>U(e.target.value)})]}),(0,g.jsx)("button",{className:"btn btn-primary w-100",onClick:()=>{if(!S||0===N.length)return void console.error("Sightings layer or its features are not initialized.");const e=N.filter((e=>{const{species:t,date:i}=e.attributes;return(!k||t===k)&&(!(z&&new Date(i)<new Date(z))&&!(R&&new Date(i)>new Date(R)))})),t=B.current;if(t&&S){const e=t.map.findLayerById(S.id);e&&t.map.remove(e)}const i=new r.default({source:e,fields:[{name:"sighting_id",alias:"Sighting ID",type:"oid"},{name:"species",alias:"Species",type:"string"},{name:"formatted_date",alias:"Date",type:"string"},{name:"time",alias:"Time",type:"string"}],objectIdField:"sighting_id",geometryType:"point",spatialReference:{wkid:4326},renderer:{type:"simple",symbol:{type:"picture-marker",url:"/img/Bird.svg",width:"24px",height:"24px"}},title:"Sightings",visible:_,popupTemplate:{title:"Sighting Details",content:"\n          <b>Species:</b> {species}<br>\n          <b>Date:</b> {expression/formatDate}<br>\n          <b>Time:</b> {time}\n        ",expressionInfos:[{name:"formatDate",title:"Formatted Date",expression:'\n              var dateField = $feature.formatted_date;\n              if (IsEmpty(dateField)) {\n                return "No Date";\n              }\n              return dateField; // Use the preformatted string\n            '}]}});t&&t.map.add(i),w(i)},children:"Apply Filters"})]})]})})]})}),(0,g.jsx)(c.qh,{path:"/about",element:(0,g.jsx)(h,{})})]})})})}}}]);